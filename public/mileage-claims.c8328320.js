function e(e,t,r,n){Object.defineProperty(e,t,{get:r,set:n,enumerable:!0,configurable:!0})}var t=globalThis,r={},n={},o=t.parcelRequire24fe;null==o&&((o=function(e){if(e in r)return r[e].exports;if(e in n){var t=n[e];delete n[e];var o={id:e,exports:{}};return r[e]=o,t.call(o.exports,o,o.exports),o.exports}var i=Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i}).register=function(e,t){n[e]=t},t.parcelRequire24fe=o);var i=o.register;i("dm1sG",function(t,r){e(t.exports,"AuthService",()=>l);var n=o("cQNiu");let i="localhost"===window.location.hostname,a={auth:{clientId:"27566b14-1439-4b8c-905c-6712687f1617",authority:"https://login.microsoftonline.com/009c4932-1b42-4c0f-ae49-eed8b8c9a26f",redirectUri:window.location.origin},cache:{cacheLocation:"sessionStorage",storeAuthStateInCookie:!1}},s={scopes:["User.Read","openid","profile","email"]},c=null;class l{static async initialize(){return i?null:(c||(c=new(0,n.PublicClientApplication)(a),await c.initialize()),c)}static async login(){if(i)return console.log("Local development: Simulating login"),{account:{username:"local.user@localhost",name:"Local Development User"}};await this.initialize();try{let e=await c.loginPopup(s);return console.log("Login successful:",e.account),e.account}catch(e){throw console.error("Login failed:",e),e}}static async logout(){if(i)return void console.log("Local development: Simulating logout");await this.initialize();try{await c.logoutPopup()}catch(e){console.error("Logout failed:",e)}}static async getCurrentUser(){if(i)return null;await this.initialize();let e=c.getAllAccounts();return e.length>0?e[0]:null}static async getAccessToken(){if(i)return"local-development-token";await this.initialize();let e=await this.getCurrentUser();if(!e)throw Error("No user logged in");try{return(await c.acquireTokenSilent({...s,account:e})).accessToken}catch(e){console.warn("Silent token acquisition failed, trying popup:",e);try{return(await c.acquireTokenPopup(s)).accessToken}catch(e){throw console.error("Token acquisition failed:",e),e}}}static async isAuthenticated(){return!i&&null!==await this.getCurrentUser()}static async getUserInfo(){if(i)return{name:"Local Development User",email:"local.user@localhost",id:"local-dev-user",extensionAttribute1:"dev-extension-value"};let e=await this.getCurrentUser();return e?{name:e.name,email:e.username,id:e.homeAccountId}:null}static async getStandardUserAttributes(){if(i)return{displayName:"Local Dev User",givenName:"Local",surname:"User",mail:"local.user@localhost",userPrincipalName:"local.user@localhost",id:"local-dev-user",jobTitle:"Developer",mobilePhone:null,officeLocation:"Local",preferredLanguage:"en-US",businessPhones:[],department:"Development"};try{let e=await this.getAccessToken(),t=await fetch("https://graph.microsoft.com/v1.0/me",{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(!t.ok)return console.warn(`Graph API call failed with status ${t.status}.`),null;let r=await t.json();return{displayName:r.displayName,givenName:r.givenName,surname:r.surname,mail:r.mail,userPrincipalName:r.userPrincipalName,id:r.id,jobTitle:r.jobTitle,mobilePhone:r.mobilePhone,officeLocation:r.officeLocation,preferredLanguage:r.preferredLanguage,businessPhones:r.businessPhones,department:r.department}}catch(e){return console.error("Failed to get standard user attributes:",e),null}}}l.initialize().catch(console.error)}),i("cQNiu",function(t,r){e(t.exports,"PublicClientApplication",()=>s);var n=o("hZfzG"),i=o("ar1EH"),a=o("apX1A");o("3OSZj"),o("9bRgi");class s{static async createPublicClientApplication(e){let t=await (0,n.createV3Controller)(e);return new s(e,t)}constructor(e,t){this.isBroker=!1,this.controller=t||new(0,i.StandardController)(new(0,a.StandardOperatingContext)(e))}async initialize(e){return this.controller.initialize(e,this.isBroker)}async acquireTokenPopup(e){return this.controller.acquireTokenPopup(e)}acquireTokenRedirect(e){return this.controller.acquireTokenRedirect(e)}acquireTokenSilent(e){return this.controller.acquireTokenSilent(e)}acquireTokenByCode(e){return this.controller.acquireTokenByCode(e)}addEventCallback(e,t){return this.controller.addEventCallback(e,t)}removeEventCallback(e){return this.controller.removeEventCallback(e)}addPerformanceCallback(e){return this.controller.addPerformanceCallback(e)}removePerformanceCallback(e){return this.controller.removePerformanceCallback(e)}enableAccountStorageEvents(){this.controller.enableAccountStorageEvents()}disableAccountStorageEvents(){this.controller.disableAccountStorageEvents()}getAccount(e){return this.controller.getAccount(e)}getAccountByHomeId(e){return this.controller.getAccountByHomeId(e)}getAccountByLocalId(e){return this.controller.getAccountByLocalId(e)}getAccountByUsername(e){return this.controller.getAccountByUsername(e)}getAllAccounts(e){return this.controller.getAllAccounts(e)}handleRedirectPromise(e){return this.controller.handleRedirectPromise(e)}loginPopup(e){return this.controller.loginPopup(e)}loginRedirect(e){return this.controller.loginRedirect(e)}logout(e){return this.controller.logout(e)}logoutRedirect(e){return this.controller.logoutRedirect(e)}logoutPopup(e){return this.controller.logoutPopup(e)}ssoSilent(e){return this.controller.ssoSilent(e)}getTokenCache(){return this.controller.getTokenCache()}getLogger(){return this.controller.getLogger()}setLogger(e){this.controller.setLogger(e)}setActiveAccount(e){this.controller.setActiveAccount(e)}getActiveAccount(){return this.controller.getActiveAccount()}initializeWrapperLibrary(e,t){return this.controller.initializeWrapperLibrary(e,t)}setNavigationClient(e){this.controller.setNavigationClient(e)}getConfiguration(){return this.controller.getConfiguration()}async hydrateCache(e,t){return this.controller.hydrateCache(e,t)}clearCache(e){return this.controller.clearCache(e)}}}),i("hZfzG",function(t,r){e(t.exports,"createV3Controller",()=>a),o("9bRgi");var n=o("apX1A"),i=o("ar1EH");async function a(e,t){let r=new(0,n.StandardOperatingContext)(e);return await r.initialize(),i.StandardController.createController(r,t)}o("3OSZj")}),i("9bRgi",function(t,r){e(t.exports,"NestedAppOperatingContext",()=>a);var n=o("6Fz9B"),i=o("kDILX");class a extends n.BaseOperatingContext{constructor(){super(...arguments),this.bridgeProxy=void 0,this.accountContext=null}getModuleName(){return a.MODULE_NAME}getId(){return a.ID}getBridgeProxy(){return this.bridgeProxy}async initialize(){try{if("undefined"!=typeof window){"function"==typeof window.__initializeNestedAppAuth&&await window.__initializeNestedAppAuth();let e=await i.BridgeProxy.create();this.accountContext=e.getAccountContext(),this.bridgeProxy=e,this.available=void 0!==e}}catch(e){this.logger.infoPii(`Could not initialize Nested App Auth bridge (${e})`)}return this.logger.info(`Nested App Auth Bridge available: ${this.available}`),this.available}}a.MODULE_NAME="",a.ID="NestedAppOperatingContext"}),i("6Fz9B",function(t,r){e(t.exports,"BaseOperatingContext",()=>l);var n=o("lxp2N"),i=o("f7l91"),a=o("2QnKr"),s=o("dp0vd"),c=o("2wtIk");class l{static loggerCallback(e,t){switch(e){case n.LogLevel.Error:console.error(t);return;case n.LogLevel.Info:console.info(t);return;case n.LogLevel.Verbose:console.debug(t);return;case n.LogLevel.Warning:console.warn(t);return;default:console.log(t);return}}constructor(e){let t;this.browserEnvironment="undefined"!=typeof window,this.config=(0,i.buildConfiguration)(e,this.browserEnvironment);try{t=window[s.BrowserCacheLocation.SessionStorage]}catch(e){}let r=t?.getItem(c.LOG_LEVEL_CACHE_KEY),o=t?.getItem(c.LOG_PII_CACHE_KEY)?.toLowerCase(),d="true"===o||"false"!==o&&void 0,h={...this.config.system.loggerOptions},u=r&&Object.keys(n.LogLevel).includes(r)?n.LogLevel[r]:void 0;u&&(h.loggerCallback=l.loggerCallback,h.logLevel=u),void 0!==d&&(h.piiLoggingEnabled=d),this.logger=new(0,n.Logger)(h,a.name,a.version),this.available=!1}getConfig(){return this.config}getLogger(){return this.logger}isAvailable(){return this.available}isBrowserEnvironment(){return this.browserEnvironment}}}),i("lxp2N",function(t,r){e(t.exports,"LogLevel",()=>i),e(t.exports,"Logger",()=>s);var n,i,a=o("gmw86");(n=i||(i={}))[n.Error=0]="Error",n[n.Warning=1]="Warning",n[n.Info=2]="Info",n[n.Verbose=3]="Verbose",n[n.Trace=4]="Trace";class s{constructor(e,t,r){this.level=i.Info;let n=e||s.createDefaultLoggerOptions();this.localCallback=n.loggerCallback||(()=>{}),this.piiLoggingEnabled=n.piiLoggingEnabled||!1,this.level="number"==typeof n.logLevel?n.logLevel:i.Info,this.correlationId=n.correlationId||a.Constants.EMPTY_STRING,this.packageName=t||a.Constants.EMPTY_STRING,this.packageVersion=r||a.Constants.EMPTY_STRING}static createDefaultLoggerOptions(){return{loggerCallback:()=>{},piiLoggingEnabled:!1,logLevel:i.Info}}clone(e,t,r){return new s({loggerCallback:this.localCallback,piiLoggingEnabled:this.piiLoggingEnabled,logLevel:this.level,correlationId:r||this.correlationId},e,t)}logMessage(e,t){if(t.logLevel>this.level||!this.piiLoggingEnabled&&t.containsPii)return;let r=new Date().toUTCString(),n=`[${r}] : [${t.correlationId||this.correlationId||""}]`,o=`${n} : ${this.packageName}@${this.packageVersion} : ${i[t.logLevel]} - ${e}`;this.executeCallback(t.logLevel,o,t.containsPii||!1)}executeCallback(e,t,r){this.localCallback&&this.localCallback(e,t,r)}error(e,t){this.logMessage(e,{logLevel:i.Error,containsPii:!1,correlationId:t||a.Constants.EMPTY_STRING})}errorPii(e,t){this.logMessage(e,{logLevel:i.Error,containsPii:!0,correlationId:t||a.Constants.EMPTY_STRING})}warning(e,t){this.logMessage(e,{logLevel:i.Warning,containsPii:!1,correlationId:t||a.Constants.EMPTY_STRING})}warningPii(e,t){this.logMessage(e,{logLevel:i.Warning,containsPii:!0,correlationId:t||a.Constants.EMPTY_STRING})}info(e,t){this.logMessage(e,{logLevel:i.Info,containsPii:!1,correlationId:t||a.Constants.EMPTY_STRING})}infoPii(e,t){this.logMessage(e,{logLevel:i.Info,containsPii:!0,correlationId:t||a.Constants.EMPTY_STRING})}verbose(e,t){this.logMessage(e,{logLevel:i.Verbose,containsPii:!1,correlationId:t||a.Constants.EMPTY_STRING})}verbosePii(e,t){this.logMessage(e,{logLevel:i.Verbose,containsPii:!0,correlationId:t||a.Constants.EMPTY_STRING})}trace(e,t){this.logMessage(e,{logLevel:i.Trace,containsPii:!1,correlationId:t||a.Constants.EMPTY_STRING})}tracePii(e,t){this.logMessage(e,{logLevel:i.Trace,containsPii:!0,correlationId:t||a.Constants.EMPTY_STRING})}isPiiLoggingEnabled(){return this.piiLoggingEnabled||!1}}}),i("gmw86",function(t,r){e(t.exports,"Constants",()=>n),e(t.exports,"HttpStatus",()=>o),e(t.exports,"HttpMethod",()=>i),e(t.exports,"OIDC_DEFAULT_SCOPES",()=>a),e(t.exports,"OIDC_SCOPES",()=>s),e(t.exports,"HeaderNames",()=>c),e(t.exports,"PersistentCacheKeys",()=>l),e(t.exports,"AADAuthorityConstants",()=>d),e(t.exports,"ClaimsRequestKeys",()=>h),e(t.exports,"PromptValue",()=>u),e(t.exports,"OAuthResponseType",()=>p),e(t.exports,"ServerResponseType",()=>g),e(t.exports,"ResponseMode",()=>m),e(t.exports,"GrantType",()=>C),e(t.exports,"CacheAccountType",()=>f),e(t.exports,"Separators",()=>y),e(t.exports,"CredentialType",()=>A),e(t.exports,"APP_METADATA",()=>E),e(t.exports,"CLIENT_INFO",()=>v),e(t.exports,"THE_FAMILY_ID",()=>T),e(t.exports,"AUTHORITY_METADATA_CONSTANTS",()=>I),e(t.exports,"AuthorityMetadataSource",()=>w),e(t.exports,"SERVER_TELEM_CONSTANTS",()=>S),e(t.exports,"AuthenticationScheme",()=>k),e(t.exports,"ThrottlingConstants",()=>R),e(t.exports,"Errors",()=>_),e(t.exports,"PasswordGrantConstants",()=>P),e(t.exports,"RegionDiscoverySources",()=>b),e(t.exports,"RegionDiscoveryOutcomes",()=>N),e(t.exports,"CacheOutcome",()=>O),e(t.exports,"JsonWebTokenTypes",()=>M),e(t.exports,"DEFAULT_TOKEN_RENEWAL_OFFSET_SEC",()=>x);let n={LIBRARY_NAME:"MSAL.JS",SKU:"msal.js.common",DEFAULT_AUTHORITY:"https://login.microsoftonline.com/common/",DEFAULT_AUTHORITY_HOST:"login.microsoftonline.com",DEFAULT_COMMON_TENANT:"common",ADFS:"adfs",DSTS:"dstsv2",AAD_INSTANCE_DISCOVERY_ENDPT:"https://login.microsoftonline.com/common/discovery/instance?api-version=1.1&authorization_endpoint=",CIAM_AUTH_URL:".ciamlogin.com",AAD_TENANT_DOMAIN_SUFFIX:".onmicrosoft.com",RESOURCE_DELIM:"|",NO_ACCOUNT:"NO_ACCOUNT",CLAIMS:"claims",CONSUMER_UTID:"9188040d-6c67-4c5b-b112-36a304b66dad",OPENID_SCOPE:"openid",PROFILE_SCOPE:"profile",OFFLINE_ACCESS_SCOPE:"offline_access",EMAIL_SCOPE:"email",CODE_GRANT_TYPE:"authorization_code",RT_GRANT_TYPE:"refresh_token",S256_CODE_CHALLENGE_METHOD:"S256",URL_FORM_CONTENT_TYPE:"application/x-www-form-urlencoded;charset=utf-8",AUTHORIZATION_PENDING:"authorization_pending",NOT_DEFINED:"not_defined",EMPTY_STRING:"",NOT_APPLICABLE:"N/A",NOT_AVAILABLE:"Not Available",FORWARD_SLASH:"/",IMDS_ENDPOINT:"http://169.254.169.254/metadata/instance/compute/location",IMDS_VERSION:"2020-06-01",IMDS_TIMEOUT:2e3,AZURE_REGION_AUTO_DISCOVER_FLAG:"TryAutoDetect",REGIONAL_AUTH_PUBLIC_CLOUD_SUFFIX:"login.microsoft.com",KNOWN_PUBLIC_CLOUDS:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"],SHR_NONCE_VALIDITY:240,INVALID_INSTANCE:"invalid_instance"},o={SUCCESS:200,SUCCESS_RANGE_START:200,SUCCESS_RANGE_END:299,REDIRECT:302,CLIENT_ERROR:400,CLIENT_ERROR_RANGE_START:400,BAD_REQUEST:400,UNAUTHORIZED:401,NOT_FOUND:404,REQUEST_TIMEOUT:408,GONE:410,TOO_MANY_REQUESTS:429,CLIENT_ERROR_RANGE_END:499,SERVER_ERROR:500,SERVER_ERROR_RANGE_START:500,SERVICE_UNAVAILABLE:503,GATEWAY_TIMEOUT:504,SERVER_ERROR_RANGE_END:599,MULTI_SIDED_ERROR:600},i={GET:"GET",POST:"POST"},a=[n.OPENID_SCOPE,n.PROFILE_SCOPE,n.OFFLINE_ACCESS_SCOPE],s=[...a,n.EMAIL_SCOPE],c={CONTENT_TYPE:"Content-Type",CONTENT_LENGTH:"Content-Length",RETRY_AFTER:"Retry-After",CCS_HEADER:"X-AnchorMailbox",WWWAuthenticate:"WWW-Authenticate",AuthenticationInfo:"Authentication-Info",X_MS_REQUEST_ID:"x-ms-request-id",X_MS_HTTP_VERSION:"x-ms-httpver"},l={ACTIVE_ACCOUNT_FILTERS:"active-account-filters"},d={COMMON:"common",ORGANIZATIONS:"organizations",CONSUMERS:"consumers"},h={ACCESS_TOKEN:"access_token",XMS_CC:"xms_cc"},u={LOGIN:"login",SELECT_ACCOUNT:"select_account",CONSENT:"consent",NONE:"none",CREATE:"create",NO_SESSION:"no_session"},p={CODE:"code",IDTOKEN_TOKEN:"id_token token",IDTOKEN_TOKEN_REFRESHTOKEN:"id_token token refresh_token"},g={QUERY:"query",FRAGMENT:"fragment"},m={QUERY:"query",FRAGMENT:"fragment",FORM_POST:"form_post"},C={IMPLICIT_GRANT:"implicit",AUTHORIZATION_CODE_GRANT:"authorization_code",CLIENT_CREDENTIALS_GRANT:"client_credentials",RESOURCE_OWNER_PASSWORD_GRANT:"password",REFRESH_TOKEN_GRANT:"refresh_token",DEVICE_CODE_GRANT:"device_code",JWT_BEARER:"urn:ietf:params:oauth:grant-type:jwt-bearer"},f={MSSTS_ACCOUNT_TYPE:"MSSTS",ADFS_ACCOUNT_TYPE:"ADFS",MSAV1_ACCOUNT_TYPE:"MSA",GENERIC_ACCOUNT_TYPE:"Generic"},y={CACHE_KEY_SEPARATOR:"-",CLIENT_INFO_SEPARATOR:"."},A={ID_TOKEN:"IdToken",ACCESS_TOKEN:"AccessToken",ACCESS_TOKEN_WITH_AUTH_SCHEME:"AccessToken_With_AuthScheme",REFRESH_TOKEN:"RefreshToken"},E="appmetadata",v="client_info",T="1",I={CACHE_KEY:"authority-metadata",REFRESH_TIME_SECONDS:86400},w={CONFIG:"config",CACHE:"cache",NETWORK:"network",HARDCODED_VALUES:"hardcoded_values"},S={SCHEMA_VERSION:5,MAX_LAST_HEADER_BYTES:330,MAX_CACHED_ERRORS:50,CACHE_KEY:"server-telemetry",CATEGORY_SEPARATOR:"|",VALUE_SEPARATOR:",",OVERFLOW_TRUE:"1",OVERFLOW_FALSE:"0",UNKNOWN_ERROR:"unknown_error"},k={BEARER:"Bearer",POP:"pop",SSH:"ssh-cert"},R={DEFAULT_THROTTLE_TIME_SECONDS:60,DEFAULT_MAX_THROTTLE_TIME_SECONDS:3600,THROTTLING_PREFIX:"throttling",X_MS_LIB_CAPABILITY_VALUE:"retry-after, h429"},_={INVALID_GRANT_ERROR:"invalid_grant",CLIENT_MISMATCH_ERROR:"client_mismatch"},P={username:"username",password:"password"},b={FAILED_AUTO_DETECTION:"1",INTERNAL_CACHE:"2",ENVIRONMENT_VARIABLE:"3",IMDS:"4"},N={CONFIGURED_NO_AUTO_DETECTION:"2",AUTO_DETECTION_REQUESTED_SUCCESSFUL:"4",AUTO_DETECTION_REQUESTED_FAILED:"5"},O={NOT_APPLICABLE:"0",FORCE_REFRESH_OR_CLAIMS:"1",NO_CACHED_ACCESS_TOKEN:"2",CACHED_ACCESS_TOKEN_EXPIRED:"3",PROACTIVELY_REFRESHED:"4"},M={Jwt:"JWT",Jwk:"JWK",Pop:"pop"},x=300}),i("f7l91",function(t,r){e(t.exports,"DEFAULT_IFRAME_TIMEOUT_MS",()=>f),e(t.exports,"DEFAULT_NATIVE_BROKER_HANDSHAKE_TIMEOUT_MS",()=>y),e(t.exports,"buildConfiguration",()=>A);var n=o("fh6Ng"),i=o("cmWPH"),a=o("gmw86"),s=o("jYvjz"),c=o("cnTdK"),l=o("lxp2N"),d=o("77Sbs"),h=o("gzUuE"),u=o("e0Klr"),p=o("dp0vd"),g=o("lUvW1"),m=o("elxln"),C=o("5S1XQ");let f=1e4,y=2e3;function A({auth:e,cache:t,system:r,telemetry:o},A){let E={clientId:a.Constants.EMPTY_STRING,authority:`${a.Constants.DEFAULT_AUTHORITY}`,knownAuthorities:[],cloudDiscoveryMetadata:a.Constants.EMPTY_STRING,authorityMetadata:a.Constants.EMPTY_STRING,redirectUri:"undefined"!=typeof window?(0,C.getCurrentUri)():"",postLogoutRedirectUri:a.Constants.EMPTY_STRING,navigateToLoginRequestUrl:!0,clientCapabilities:[],protocolMode:d.ProtocolMode.AAD,OIDCOptions:{serverResponseType:a.ServerResponseType.FRAGMENT,defaultScopes:[a.Constants.OPENID_SCOPE,a.Constants.PROFILE_SCOPE,a.Constants.OFFLINE_ACCESS_SCOPE]},azureCloudOptions:{azureCloudInstance:n.AzureCloudInstance.None,tenant:a.Constants.EMPTY_STRING},skipAuthorityMetadataCache:!1,supportsNestedAppAuth:!1,instanceAware:!1,encodeExtraQueryParams:!1},v={cacheLocation:p.BrowserCacheLocation.SessionStorage,cacheRetentionDays:5,temporaryCacheLocation:p.BrowserCacheLocation.SessionStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!!t&&t.cacheLocation===p.BrowserCacheLocation.LocalStorage,claimsBasedCachingEnabled:!1},T={loggerCallback:()=>{},logLevel:l.LogLevel.Info,piiLoggingEnabled:!1},I={...{...c.DEFAULT_SYSTEM_OPTIONS,loggerOptions:T,networkClient:A?new(0,m.FetchClient):h.StubbedNetworkModule,navigationClient:new(0,g.NavigationClient),loadFrameTimeout:0,windowHashTimeout:r?.loadFrameTimeout||6e4,iframeHashTimeout:r?.loadFrameTimeout||f,navigateFrameWait:0,redirectNavigationTimeout:3e4,asyncPopups:!1,allowRedirectInIframe:!1,allowPlatformBroker:!1,nativeBrokerHandshakeTimeout:r?.nativeBrokerHandshakeTimeout||y,pollIntervalMilliseconds:p.BrowserConstants.DEFAULT_POLL_INTERVAL_MS},...r,loggerOptions:r?.loggerOptions||T},w={application:{appName:a.Constants.EMPTY_STRING,appVersion:a.Constants.EMPTY_STRING},client:new(0,u.StubPerformanceClient)};if(e?.protocolMode!==d.ProtocolMode.OIDC&&e?.OIDCOptions&&new(0,l.Logger)(I.loggerOptions).warning(JSON.stringify((0,s.createClientConfigurationError)(i.cannotSetOIDCOptions))),e?.protocolMode&&e.protocolMode===d.ProtocolMode.OIDC&&I?.allowPlatformBroker)throw(0,s.createClientConfigurationError)(i.cannotAllowPlatformBroker);return{auth:{...E,...e,OIDCOptions:{...E.OIDCOptions,...e?.OIDCOptions}},cache:{...v,...t},system:I,telemetry:{...w,...o}}}}),i("fh6Ng",function(t,r){e(t.exports,"AzureCloudInstance",()=>n);let n={None:"none",AzurePublic:"https://login.microsoftonline.com",AzurePpe:"https://login.windows-ppe.net",AzureChina:"https://login.chinacloudapi.cn",AzureGermany:"https://login.microsoftonline.de",AzureUsGovernment:"https://login.microsoftonline.us"}}),i("cmWPH",function(t,r){e(t.exports,"redirectUriEmpty",()=>n),e(t.exports,"claimsRequestParsingError",()=>o),e(t.exports,"authorityUriInsecure",()=>i),e(t.exports,"urlParseError",()=>a),e(t.exports,"urlEmptyError",()=>s),e(t.exports,"emptyInputScopesError",()=>c),e(t.exports,"invalidClaims",()=>l),e(t.exports,"tokenRequestEmpty",()=>d),e(t.exports,"logoutRequestEmpty",()=>h),e(t.exports,"invalidCodeChallengeMethod",()=>u),e(t.exports,"pkceParamsMissing",()=>p),e(t.exports,"invalidCloudDiscoveryMetadata",()=>g),e(t.exports,"invalidAuthorityMetadata",()=>m),e(t.exports,"untrustedAuthority",()=>C),e(t.exports,"missingSshJwk",()=>f),e(t.exports,"missingSshKid",()=>y),e(t.exports,"missingNonceAuthenticationHeader",()=>A),e(t.exports,"invalidAuthenticationHeader",()=>E),e(t.exports,"cannotSetOIDCOptions",()=>v),e(t.exports,"cannotAllowPlatformBroker",()=>T),e(t.exports,"authorityMismatch",()=>I),e(t.exports,"invalidRequestMethodForEAR",()=>w),e(t.exports,"invalidAuthorizePostBodyParameters",()=>S);let n="redirect_uri_empty",o="claims_request_parsing_error",i="authority_uri_insecure",a="url_parse_error",s="empty_url_error",c="empty_input_scopes_error",l="invalid_claims",d="token_request_empty",h="logout_request_empty",u="invalid_code_challenge_method",p="pkce_params_missing",g="invalid_cloud_discovery_metadata",m="invalid_authority_metadata",C="untrusted_authority",f="missing_ssh_jwk",y="missing_ssh_kid",A="missing_nonce_authentication_header",E="invalid_authentication_header",v="cannot_set_OIDCOptions",T="cannot_allow_platform_broker",I="authority_mismatch",w="invalid_request_method_for_EAR",S="invalid_authorize_post_body_parameters"}),i("jYvjz",function(t,r){e(t.exports,"createClientConfigurationError",()=>c);var n=o("ckDmJ"),i=o("cmWPH");let a={[i.redirectUriEmpty]:"A redirect URI is required for all calls, and none has been set.",[i.claimsRequestParsingError]:"Could not parse the given claims request object.",[i.authorityUriInsecure]:"Authority URIs must use https.  Please see here for valid authority configuration options: https://docs.microsoft.com/en-us/azure/active-directory/develop/msal-js-initializing-client-applications#configuration-options",[i.urlParseError]:"URL could not be parsed into appropriate segments.",[i.urlEmptyError]:"URL was empty or null.",[i.emptyInputScopesError]:"Scopes cannot be passed as null, undefined or empty array because they are required to obtain an access token.",[i.invalidClaims]:"Given claims parameter must be a stringified JSON object.",[i.tokenRequestEmpty]:"Token request was empty and not found in cache.",[i.logoutRequestEmpty]:"The logout request was null or undefined.",[i.invalidCodeChallengeMethod]:'code_challenge_method passed is invalid. Valid values are "plain" and "S256".',[i.pkceParamsMissing]:"Both params: code_challenge and code_challenge_method are to be passed if to be sent in the request",[i.invalidCloudDiscoveryMetadata]:"Invalid cloudDiscoveryMetadata provided. Must be a stringified JSON object containing tenant_discovery_endpoint and metadata fields",[i.invalidAuthorityMetadata]:"Invalid authorityMetadata provided. Must by a stringified JSON object containing authorization_endpoint, token_endpoint, issuer fields.",[i.untrustedAuthority]:"The provided authority is not a trusted authority. Please include this authority in the knownAuthorities config parameter.",[i.missingSshJwk]:"Missing sshJwk in SSH certificate request. A stringified JSON Web Key is required when using the SSH authentication scheme.",[i.missingSshKid]:"Missing sshKid in SSH certificate request. A string that uniquely identifies the public SSH key is required when using the SSH authentication scheme.",[i.missingNonceAuthenticationHeader]:"Unable to find an authentication header containing server nonce. Either the Authentication-Info or WWW-Authenticate headers must be present in order to obtain a server nonce.",[i.invalidAuthenticationHeader]:"Invalid authentication header provided",[i.cannotSetOIDCOptions]:"Cannot set OIDCOptions parameter. Please change the protocol mode to OIDC or use a non-Microsoft authority.",[i.cannotAllowPlatformBroker]:"Cannot set allowPlatformBroker parameter to true when not in AAD protocol mode.",[i.authorityMismatch]:"Authority mismatch error. Authority provided in login request or PublicClientApplication config does not match the environment of the provided account. Please use a matching account or make an interactive request to login to this authority.",[i.invalidAuthorizePostBodyParameters]:"Invalid authorize post body parameters provided. If you are using authorizePostBodyParameters, the request method must be POST. Please check the request method and parameters.",[i.invalidRequestMethodForEAR]:"Invalid request method for EAR protocol mode. The request method cannot be GET when using EAR protocol mode. Please change the request method to POST."};i.redirectUriEmpty,a[i.redirectUriEmpty],i.claimsRequestParsingError,a[i.claimsRequestParsingError],i.authorityUriInsecure,a[i.authorityUriInsecure],i.urlParseError,a[i.urlParseError],i.urlEmptyError,a[i.urlEmptyError],i.emptyInputScopesError,a[i.emptyInputScopesError],i.invalidClaims,a[i.invalidClaims],i.tokenRequestEmpty,a[i.tokenRequestEmpty],i.logoutRequestEmpty,a[i.logoutRequestEmpty],i.invalidCodeChallengeMethod,a[i.invalidCodeChallengeMethod],i.pkceParamsMissing,a[i.pkceParamsMissing],i.invalidCloudDiscoveryMetadata,a[i.invalidCloudDiscoveryMetadata],i.invalidAuthorityMetadata,a[i.invalidAuthorityMetadata],i.untrustedAuthority,a[i.untrustedAuthority],i.missingSshJwk,a[i.missingSshJwk],i.missingSshKid,a[i.missingSshKid],i.missingNonceAuthenticationHeader,a[i.missingNonceAuthenticationHeader],i.invalidAuthenticationHeader,a[i.invalidAuthenticationHeader],i.cannotSetOIDCOptions,a[i.cannotSetOIDCOptions],i.cannotAllowPlatformBroker,a[i.cannotAllowPlatformBroker],i.authorityMismatch,a[i.authorityMismatch],i.invalidAuthorizePostBodyParameters,a[i.invalidAuthorizePostBodyParameters],i.invalidRequestMethodForEAR,a[i.invalidRequestMethodForEAR];class s extends n.AuthError{constructor(e){super(e,a[e]),this.name="ClientConfigurationError",Object.setPrototypeOf(this,s.prototype)}}function c(e){return new s(e)}}),i("ckDmJ",function(t,r){e(t.exports,"AuthError",()=>s),e(t.exports,"createAuthError",()=>c);var n=o("gmw86"),i=o("4vd0U");let a={[i.unexpectedError]:"Unexpected error in authentication.",[i.postRequestFailed]:"Post request failed from the network, could be a 4xx/5xx or a network unavailability. Please check the exact error code for details."};i.unexpectedError,a[i.unexpectedError],i.postRequestFailed,a[i.postRequestFailed];class s extends Error{constructor(e,t,r){super(t?`${e}: ${t}`:e),Object.setPrototypeOf(this,s.prototype),this.errorCode=e||n.Constants.EMPTY_STRING,this.errorMessage=t||n.Constants.EMPTY_STRING,this.subError=r||n.Constants.EMPTY_STRING,this.name="AuthError"}setCorrelationId(e){this.correlationId=e}}function c(e,t){return new s(e,t?`${a[e]} ${t}`:a[e])}}),i("4vd0U",function(t,r){e(t.exports,"unexpectedError",()=>n),e(t.exports,"postRequestFailed",()=>o);let n="unexpected_error",o="post_request_failed"}),i("cnTdK",function(t,r){e(t.exports,"DEFAULT_SYSTEM_OPTIONS",()=>g),e(t.exports,"buildClientConfiguration",()=>T),e(t.exports,"isOidcProtocolMode",()=>I);var n=o("1OX4r"),i=o("lxp2N"),a=o("gmw86"),s=o("6r4FB"),c=o("fh6Ng"),l=o("fzx9Z"),d=o("77Sbs"),h=o("anIdE"),u=o("e0Klr"),p=o("l6ONb");let g={tokenRenewalOffsetSeconds:a.DEFAULT_TOKEN_RENEWAL_OFFSET_SEC,preventCorsPreflight:!1},m={loggerCallback:()=>{},piiLoggingEnabled:!1,logLevel:i.LogLevel.Info,correlationId:a.Constants.EMPTY_STRING},C={claimsBasedCachingEnabled:!1},f={async sendGetRequestAsync(){throw(0,h.createClientAuthError)(p.methodNotImplemented)},async sendPostRequestAsync(){throw(0,h.createClientAuthError)(p.methodNotImplemented)}},y={sku:a.Constants.SKU,version:s.version,cpu:a.Constants.EMPTY_STRING,os:a.Constants.EMPTY_STRING},A={clientSecret:a.Constants.EMPTY_STRING,clientAssertion:void 0},E={azureCloudInstance:c.AzureCloudInstance.None,tenant:`${a.Constants.DEFAULT_COMMON_TENANT}`},v={application:{appName:"",appVersion:""}};function T({authOptions:e,systemOptions:t,loggerOptions:r,cacheOptions:o,storageInterface:a,networkInterface:s,cryptoInterface:c,clientCredentials:d,libraryInfo:h,telemetry:p,serverTelemetryManager:T,persistencePlugin:I,serializableCache:w}){let S={...m,...r};return{authOptions:{clientCapabilities:[],azureCloudOptions:E,skipAuthorityMetadataCache:!1,instanceAware:!1,encodeExtraQueryParams:!1,...e},systemOptions:{...g,...t},loggerOptions:S,cacheOptions:{...C,...o},storageInterface:a||new(0,l.DefaultStorageClass)(e.clientId,n.DEFAULT_CRYPTO_IMPLEMENTATION,new(0,i.Logger)(S),new(0,u.StubPerformanceClient)),networkInterface:s||f,cryptoInterface:c||n.DEFAULT_CRYPTO_IMPLEMENTATION,clientCredentials:d||A,libraryInfo:{...y,...h},telemetry:{...v,...p},serverTelemetryManager:T||null,persistencePlugin:I||null,serializableCache:w||null}}function I(e){return e.authOptions.authority.options.protocolMode===d.ProtocolMode.OIDC}}),i("1OX4r",function(t,r){e(t.exports,"DEFAULT_CRYPTO_IMPLEMENTATION",()=>a);var n=o("anIdE"),i=o("l6ONb");let a={createNewGuid:()=>{throw(0,n.createClientAuthError)(i.methodNotImplemented)},base64Decode:()=>{throw(0,n.createClientAuthError)(i.methodNotImplemented)},base64Encode:()=>{throw(0,n.createClientAuthError)(i.methodNotImplemented)},base64UrlEncode:()=>{throw(0,n.createClientAuthError)(i.methodNotImplemented)},encodeKid:()=>{throw(0,n.createClientAuthError)(i.methodNotImplemented)},async getPublicKeyThumbprint(){throw(0,n.createClientAuthError)(i.methodNotImplemented)},async removeTokenBindingKey(){throw(0,n.createClientAuthError)(i.methodNotImplemented)},async clearKeystore(){throw(0,n.createClientAuthError)(i.methodNotImplemented)},async signJwt(){throw(0,n.createClientAuthError)(i.methodNotImplemented)},async hashString(){throw(0,n.createClientAuthError)(i.methodNotImplemented)}}}),i("anIdE",function(t,r){e(t.exports,"ClientAuthError",()=>s),e(t.exports,"createClientAuthError",()=>c);var n=o("ckDmJ"),i=o("l6ONb");let a={[i.clientInfoDecodingError]:"The client info could not be parsed/decoded correctly",[i.clientInfoEmptyError]:"The client info was empty",[i.tokenParsingError]:"Token cannot be parsed",[i.nullOrEmptyToken]:"The token is null or empty",[i.endpointResolutionError]:"Endpoints cannot be resolved",[i.networkError]:"Network request failed",[i.openIdConfigError]:"Could not retrieve endpoints. Check your authority and verify the .well-known/openid-configuration endpoint returns the required endpoints.",[i.hashNotDeserialized]:"The hash parameters could not be deserialized",[i.invalidState]:"State was not the expected format",[i.stateMismatch]:"State mismatch error",[i.stateNotFound]:"State not found",[i.nonceMismatch]:"Nonce mismatch error",[i.authTimeNotFound]:"Max Age was requested and the ID token is missing the auth_time variable. auth_time is an optional claim and is not enabled by default - it must be enabled. See https://aka.ms/msaljs/optional-claims for more information.",[i.maxAgeTranspired]:"Max Age is set to 0, or too much time has elapsed since the last end-user authentication.",[i.multipleMatchingTokens]:"The cache contains multiple tokens satisfying the requirements. Call AcquireToken again providing more requirements such as authority or account.",[i.multipleMatchingAccounts]:"The cache contains multiple accounts satisfying the given parameters. Please pass more info to obtain the correct account",[i.multipleMatchingAppMetadata]:"The cache contains multiple appMetadata satisfying the given parameters. Please pass more info to obtain the correct appMetadata",[i.requestCannotBeMade]:"Token request cannot be made without authorization code or refresh token.",[i.cannotRemoveEmptyScope]:"Cannot remove null or empty scope from ScopeSet",[i.cannotAppendScopeSet]:"Cannot append ScopeSet",[i.emptyInputScopeSet]:"Empty input ScopeSet cannot be processed",[i.deviceCodePollingCancelled]:"Caller has cancelled token endpoint polling during device code flow by setting DeviceCodeRequest.cancel = true.",[i.deviceCodeExpired]:"Device code is expired.",[i.deviceCodeUnknownError]:"Device code stopped polling for unknown reasons.",[i.noAccountInSilentRequest]:"Please pass an account object, silent flow is not supported without account information",[i.invalidCacheRecord]:"Cache record object was null or undefined.",[i.invalidCacheEnvironment]:"Invalid environment when attempting to create cache entry",[i.noAccountFound]:"No account found in cache for given key.",[i.noCryptoObject]:"No crypto object detected.",[i.unexpectedCredentialType]:"Unexpected credential type.",[i.invalidAssertion]:"Client assertion must meet requirements described in https://tools.ietf.org/html/rfc7515",[i.invalidClientCredential]:"Client credential (secret, certificate, or assertion) must not be empty when creating a confidential client. An application should at most have one credential",[i.tokenRefreshRequired]:"Cannot return token from cache because it must be refreshed. This may be due to one of the following reasons: forceRefresh parameter is set to true, claims have been requested, there is no cached access token or it is expired.",[i.userTimeoutReached]:"User defined timeout for device code polling reached",[i.tokenClaimsCnfRequiredForSignedJwt]:"Cannot generate a POP jwt if the token_claims are not populated",[i.authorizationCodeMissingFromServerResponse]:"Server response does not contain an authorization code to proceed",[i.bindingKeyNotRemoved]:"Could not remove the credential's binding key from storage.",[i.endSessionEndpointNotSupported]:"The provided authority does not support logout",[i.keyIdMissing]:"A keyId value is missing from the requested bound token's cache record and is required to match the token to it's stored binding key.",[i.noNetworkConnectivity]:"No network connectivity. Check your internet connection.",[i.userCanceled]:"User cancelled the flow.",[i.missingTenantIdError]:"A tenant id - not common, organizations, or consumers - must be specified when using the client_credentials flow.",[i.methodNotImplemented]:"This method has not been implemented",[i.nestedAppAuthBridgeDisabled]:"The nested app auth bridge is disabled"};i.clientInfoDecodingError,a[i.clientInfoDecodingError],i.clientInfoEmptyError,a[i.clientInfoEmptyError],i.tokenParsingError,a[i.tokenParsingError],i.nullOrEmptyToken,a[i.nullOrEmptyToken],i.endpointResolutionError,a[i.endpointResolutionError],i.networkError,a[i.networkError],i.openIdConfigError,a[i.openIdConfigError],i.hashNotDeserialized,a[i.hashNotDeserialized],i.invalidState,a[i.invalidState],i.stateMismatch,a[i.stateMismatch],i.stateNotFound,a[i.stateNotFound],i.nonceMismatch,a[i.nonceMismatch],i.authTimeNotFound,a[i.authTimeNotFound],i.maxAgeTranspired,a[i.maxAgeTranspired],i.multipleMatchingTokens,a[i.multipleMatchingTokens],i.multipleMatchingAccounts,a[i.multipleMatchingAccounts],i.multipleMatchingAppMetadata,a[i.multipleMatchingAppMetadata],i.requestCannotBeMade,a[i.requestCannotBeMade],i.cannotRemoveEmptyScope,a[i.cannotRemoveEmptyScope],i.cannotAppendScopeSet,a[i.cannotAppendScopeSet],i.emptyInputScopeSet,a[i.emptyInputScopeSet],i.deviceCodePollingCancelled,a[i.deviceCodePollingCancelled],i.deviceCodeExpired,a[i.deviceCodeExpired],i.deviceCodeUnknownError,a[i.deviceCodeUnknownError],i.noAccountInSilentRequest,a[i.noAccountInSilentRequest],i.invalidCacheRecord,a[i.invalidCacheRecord],i.invalidCacheEnvironment,a[i.invalidCacheEnvironment],i.noAccountFound,a[i.noAccountFound],i.noCryptoObject,a[i.noCryptoObject],i.unexpectedCredentialType,a[i.unexpectedCredentialType],i.invalidAssertion,a[i.invalidAssertion],i.invalidClientCredential,a[i.invalidClientCredential],i.tokenRefreshRequired,a[i.tokenRefreshRequired],i.userTimeoutReached,a[i.userTimeoutReached],i.tokenClaimsCnfRequiredForSignedJwt,a[i.tokenClaimsCnfRequiredForSignedJwt],i.authorizationCodeMissingFromServerResponse,a[i.authorizationCodeMissingFromServerResponse],i.bindingKeyNotRemoved,a[i.bindingKeyNotRemoved],i.endSessionEndpointNotSupported,a[i.endSessionEndpointNotSupported],i.keyIdMissing,a[i.keyIdMissing],i.noNetworkConnectivity,a[i.noNetworkConnectivity],i.userCanceled,a[i.userCanceled],i.missingTenantIdError,a[i.missingTenantIdError],i.nestedAppAuthBridgeDisabled,a[i.nestedAppAuthBridgeDisabled];class s extends n.AuthError{constructor(e,t){super(e,t?`${a[e]}: ${t}`:a[e]),this.name="ClientAuthError",Object.setPrototypeOf(this,s.prototype)}}function c(e,t){return new s(e,t)}}),i("l6ONb",function(t,r){e(t.exports,"clientInfoDecodingError",()=>n),e(t.exports,"clientInfoEmptyError",()=>o),e(t.exports,"tokenParsingError",()=>i),e(t.exports,"nullOrEmptyToken",()=>a),e(t.exports,"endpointResolutionError",()=>s),e(t.exports,"networkError",()=>c),e(t.exports,"openIdConfigError",()=>l),e(t.exports,"hashNotDeserialized",()=>d),e(t.exports,"invalidState",()=>h),e(t.exports,"stateMismatch",()=>u),e(t.exports,"stateNotFound",()=>p),e(t.exports,"nonceMismatch",()=>g),e(t.exports,"authTimeNotFound",()=>m),e(t.exports,"maxAgeTranspired",()=>C),e(t.exports,"multipleMatchingTokens",()=>f),e(t.exports,"multipleMatchingAccounts",()=>y),e(t.exports,"multipleMatchingAppMetadata",()=>A),e(t.exports,"requestCannotBeMade",()=>E),e(t.exports,"cannotRemoveEmptyScope",()=>v),e(t.exports,"cannotAppendScopeSet",()=>T),e(t.exports,"emptyInputScopeSet",()=>I),e(t.exports,"deviceCodePollingCancelled",()=>w),e(t.exports,"deviceCodeExpired",()=>S),e(t.exports,"deviceCodeUnknownError",()=>k),e(t.exports,"noAccountInSilentRequest",()=>R),e(t.exports,"invalidCacheRecord",()=>_),e(t.exports,"invalidCacheEnvironment",()=>P),e(t.exports,"noAccountFound",()=>b),e(t.exports,"noCryptoObject",()=>N),e(t.exports,"unexpectedCredentialType",()=>O),e(t.exports,"invalidAssertion",()=>M),e(t.exports,"invalidClientCredential",()=>x),e(t.exports,"tokenRefreshRequired",()=>U),e(t.exports,"userTimeoutReached",()=>D),e(t.exports,"tokenClaimsCnfRequiredForSignedJwt",()=>q),e(t.exports,"authorizationCodeMissingFromServerResponse",()=>L),e(t.exports,"bindingKeyNotRemoved",()=>H),e(t.exports,"endSessionEndpointNotSupported",()=>B),e(t.exports,"keyIdMissing",()=>F),e(t.exports,"noNetworkConnectivity",()=>K),e(t.exports,"userCanceled",()=>G),e(t.exports,"missingTenantIdError",()=>z),e(t.exports,"methodNotImplemented",()=>V),e(t.exports,"nestedAppAuthBridgeDisabled",()=>Q);let n="client_info_decoding_error",o="client_info_empty_error",i="token_parsing_error",a="null_or_empty_token",s="endpoints_resolution_error",c="network_error",l="openid_config_error",d="hash_not_deserialized",h="invalid_state",u="state_mismatch",p="state_not_found",g="nonce_mismatch",m="auth_time_not_found",C="max_age_transpired",f="multiple_matching_tokens",y="multiple_matching_accounts",A="multiple_matching_appMetadata",E="request_cannot_be_made",v="cannot_remove_empty_scope",T="cannot_append_scopeset",I="empty_input_scopeset",w="device_code_polling_cancelled",S="device_code_expired",k="device_code_unknown_error",R="no_account_in_silent_request",_="invalid_cache_record",P="invalid_cache_environment",b="no_account_found",N="no_crypto_object",O="unexpected_credential_type",M="invalid_assertion",x="invalid_client_credential",U="token_refresh_required",D="user_timeout_reached",q="token_claims_cnf_required_for_signedjwt",L="authorization_code_missing_from_server_response",H="binding_key_not_removed",B="end_session_endpoint_not_supported",F="key_id_missing",K="no_network_connectivity",G="user_canceled",z="missing_tenant_id_error",V="method_not_implemented",Q="nested_app_auth_bridge_disabled"}),i("6r4FB",function(t,r){e(t.exports,"name",()=>n),e(t.exports,"version",()=>o);let n="@azure/msal-common",o="15.13.1"}),i("fzx9Z",function(t,r){e(t.exports,"CacheManager",()=>m),e(t.exports,"DefaultStorageClass",()=>C);var n=o("gmw86"),i=o("6GdIx"),a=o("4tMCV"),s=o("anIdE"),c=o("aRYMn"),l=o("eVKB1"),d=o("6r4FB"),h=o("aNZw2"),u=o("2eahm"),p=o("ckDmJ"),g=o("l6ONb");class m{constructor(e,t,r,n,o){this.clientId=e,this.cryptoImpl=t,this.commonLogger=r.clone(d.name,d.version),this.staticAuthorityOptions=o,this.performanceClient=n}getAllAccounts(e,t){return this.buildTenantProfiles(this.getAccountsFilteredBy(e,t),t,e)}getAccountInfoFilteredBy(e,t){if(0===Object.keys(e).length||Object.values(e).every(e=>!e))return this.commonLogger.warning("getAccountInfoFilteredBy: Account filter is empty or invalid, returning null"),null;let r=this.getAllAccounts(e,t);return r.length>1?r.sort(e=>e.idTokenClaims?-1:1)[0]:1===r.length?r[0]:null}getBaseAccountInfo(e,t){let r=this.getAccountsFilteredBy(e,t);return r.length>0?a.AccountEntity.getAccountInfo(r[0]):null}buildTenantProfiles(e,t,r){return e.flatMap(e=>this.getTenantProfilesFromAccountEntity(e,t,r?.tenantId,r))}getTenantedAccountInfoByFilter(e,t,r,n,o){let i;if(o&&!this.tenantProfileMatchesFilter(r,o))return null;let a=this.getIdToken(e,n,t,r.tenantId);return a&&(i=(0,l.extractTokenClaims)(a.secret,this.cryptoImpl.base64Decode),!this.idTokenClaimsMatchTenantProfileFilter(i,o))?null:(0,c.updateAccountTenantProfileData)(e,r,i,a?.secret)}getTenantProfilesFromAccountEntity(e,t,r,n){let o=a.AccountEntity.getAccountInfo(e),i=o.tenantProfiles||new Map,s=this.getTokenKeys();if(r){let e=i.get(r);if(!e)return[];i=new Map([[r,e]])}let c=[];return i.forEach(e=>{let r=this.getTenantedAccountInfoByFilter(o,s,e,t,n);r&&c.push(r)}),c}tenantProfileMatchesFilter(e,t){return(!t.localAccountId||!!this.matchLocalAccountIdFromTenantProfile(e,t.localAccountId))&&(!t.name||e.name===t.name)&&(void 0===t.isHomeTenant||e.isHomeTenant===t.isHomeTenant)}idTokenClaimsMatchTenantProfileFilter(e,t){return(!t||(!t.localAccountId||!!this.matchLocalAccountIdFromTokenClaims(e,t.localAccountId))&&(!t.loginHint||!!this.matchLoginHintFromTokenClaims(e,t.loginHint))&&(!t.username||!!this.matchUsername(e.preferred_username,t.username))&&(!t.name||!!this.matchName(e,t.name))&&(!t.sid||!!this.matchSid(e,t.sid)))&&!0}async saveCacheRecord(e,t,r,n){if(!e)throw(0,s.createClientAuthError)(g.invalidCacheRecord);try{e.account&&await this.setAccount(e.account,t,r),e.idToken&&n?.idToken!==!1&&await this.setIdTokenCredential(e.idToken,t,r),e.accessToken&&n?.accessToken!==!1&&await this.saveAccessToken(e.accessToken,t,r),e.refreshToken&&n?.refreshToken!==!1&&await this.setRefreshTokenCredential(e.refreshToken,t,r),e.appMetadata&&this.setAppMetadata(e.appMetadata,t)}catch(e){if(this.commonLogger?.error("CacheManager.saveCacheRecord: failed"),e instanceof p.AuthError)throw e;throw(0,u.createCacheError)(e)}}async saveAccessToken(e,t,r){let n={clientId:e.clientId,credentialType:e.credentialType,environment:e.environment,homeAccountId:e.homeAccountId,realm:e.realm,tokenType:e.tokenType,requestedClaimsHash:e.requestedClaimsHash},o=this.getTokenKeys(),a=i.ScopeSet.fromString(e.target);o.accessToken.forEach(e=>{if(!this.accessTokenKeyMatchesFilter(e,n,!1))return;let r=this.getAccessTokenCredential(e,t);r&&this.credentialMatchesFilter(r,n)&&i.ScopeSet.fromString(r.target).intersectingScopeSets(a)&&this.removeAccessToken(e,t)}),await this.setAccessTokenCredential(e,t,r)}getAccountsFilteredBy(e,t){let r=this.getAccountKeys(),n=[];return r.forEach(r=>{let o=this.getAccount(r,t);if(!o||e.homeAccountId&&!this.matchHomeAccountId(o,e.homeAccountId)||e.username&&!this.matchUsername(o.username,e.username)||e.environment&&!this.matchEnvironment(o,e.environment)||e.realm&&!this.matchRealm(o,e.realm)||e.nativeAccountId&&!this.matchNativeAccountId(o,e.nativeAccountId)||e.authorityType&&!this.matchAuthorityType(o,e.authorityType))return;let i={localAccountId:e?.localAccountId,name:e?.name},a=o.tenantProfiles?.filter(e=>this.tenantProfileMatchesFilter(e,i));a&&0===a.length||n.push(o)}),n}credentialMatchesFilter(e,t){return(!t.clientId||!!this.matchClientId(e,t.clientId))&&(!t.userAssertionHash||!!this.matchUserAssertionHash(e,t.userAssertionHash))&&("string"!=typeof t.homeAccountId||!!this.matchHomeAccountId(e,t.homeAccountId))&&(!t.environment||!!this.matchEnvironment(e,t.environment))&&(!t.realm||!!this.matchRealm(e,t.realm))&&(!t.credentialType||!!this.matchCredentialType(e,t.credentialType))&&(!t.familyId||!!this.matchFamilyId(e,t.familyId))&&(!t.target||!!this.matchTarget(e,t.target))&&(!t.requestedClaimsHash&&!e.requestedClaimsHash||e.requestedClaimsHash===t.requestedClaimsHash)&&(e.credentialType!==n.CredentialType.ACCESS_TOKEN_WITH_AUTH_SCHEME||(!t.tokenType||!!this.matchTokenType(e,t.tokenType))&&(t.tokenType!==n.AuthenticationScheme.SSH||!t.keyId||!!this.matchKeyId(e,t.keyId)))&&!0}getAppMetadataFilteredBy(e){let t=this.getKeys(),r={};return t.forEach(t=>{if(!this.isAppMetadata(t))return;let n=this.getAppMetadata(t);!n||e.environment&&!this.matchEnvironment(n,e.environment)||(!e.clientId||this.matchClientId(n,e.clientId))&&(r[t]=n)}),r}getAuthorityMetadataByAlias(e){let t=this.getAuthorityMetadataKeys(),r=null;return t.forEach(t=>{if(!this.isAuthorityMetadata(t)||-1===t.indexOf(this.clientId))return;let n=this.getAuthorityMetadata(t);n&&-1!==n.aliases.indexOf(e)&&(r=n)}),r}removeAllAccounts(e){this.getAllAccounts({},e).forEach(t=>{this.removeAccount(t,e)})}removeAccount(e,t){this.removeAccountContext(e,t),this.getAccountKeys().filter(t=>t.includes(e.homeAccountId)&&t.includes(e.environment)).forEach(e=>{this.removeItem(e,t),this.performanceClient.incrementFields({accountsRemoved:1},t)})}removeAccountContext(e,t){let r=this.getTokenKeys(),n=t=>t.includes(e.homeAccountId)&&t.includes(e.environment);r.idToken.filter(n).forEach(e=>{this.removeIdToken(e,t)}),r.accessToken.filter(n).forEach(e=>{this.removeAccessToken(e,t)}),r.refreshToken.filter(n).forEach(e=>{this.removeRefreshToken(e,t)})}removeAccessToken(e,t){let r=this.getAccessTokenCredential(e,t);if(this.removeItem(e,t),this.performanceClient.incrementFields({accessTokensRemoved:1},t),!r||r.credentialType.toLowerCase()!==n.CredentialType.ACCESS_TOKEN_WITH_AUTH_SCHEME.toLowerCase()||r.tokenType!==n.AuthenticationScheme.POP)return;let o=r.keyId;o&&this.cryptoImpl.removeTokenBindingKey(o).catch(()=>{this.commonLogger.error(`Failed to remove token binding key ${o}`,t),this.performanceClient?.incrementFields({removeTokenBindingKeyFailure:1},t)})}removeAppMetadata(e){return this.getKeys().forEach(t=>{this.isAppMetadata(t)&&this.removeItem(t,e)}),!0}getIdToken(e,t,r,o,i){this.commonLogger.trace("CacheManager - getIdToken called");let a={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:n.CredentialType.ID_TOKEN,clientId:this.clientId,realm:o},s=this.getIdTokensByFilter(a,t,r),c=s.size;if(c<1)return this.commonLogger.info("CacheManager:getIdToken - No token found"),null;if(c>1){let r=s;if(!o){let t=new Map;s.forEach((r,n)=>{r.realm===e.tenantId&&t.set(n,r)});let n=t.size;if(n<1)return this.commonLogger.info("CacheManager:getIdToken - Multiple ID tokens found for account but none match account entity tenant id, returning first result"),s.values().next().value;if(1===n)return this.commonLogger.info("CacheManager:getIdToken - Multiple ID tokens found for account, defaulting to home tenant profile"),t.values().next().value;r=t}return this.commonLogger.info("CacheManager:getIdToken - Multiple matching ID tokens found, clearing them"),r.forEach((e,r)=>{this.removeIdToken(r,t)}),i&&t&&i.addFields({multiMatchedID:s.size},t),null}return this.commonLogger.info("CacheManager:getIdToken - Returning ID token"),s.values().next().value}getIdTokensByFilter(e,t,r){let n=r&&r.idToken||this.getTokenKeys().idToken,o=new Map;return n.forEach(r=>{if(!this.idTokenKeyMatchesFilter(r,{clientId:this.clientId,...e}))return;let n=this.getIdTokenCredential(r,t);n&&this.credentialMatchesFilter(n,e)&&o.set(r,n)}),o}idTokenKeyMatchesFilter(e,t){let r=e.toLowerCase();return(!t.clientId||-1!==r.indexOf(t.clientId.toLowerCase()))&&(!t.homeAccountId||-1!==r.indexOf(t.homeAccountId.toLowerCase()))}removeIdToken(e,t){this.removeItem(e,t)}removeRefreshToken(e,t){this.removeItem(e,t)}getAccessToken(e,t,r,o){let a=t.correlationId;this.commonLogger.trace("CacheManager - getAccessToken called",a);let s=i.ScopeSet.createSearchScopes(t.scopes),c=t.authenticationScheme||n.AuthenticationScheme.BEARER,l=c&&c.toLowerCase()!==n.AuthenticationScheme.BEARER.toLowerCase()?n.CredentialType.ACCESS_TOKEN_WITH_AUTH_SCHEME:n.CredentialType.ACCESS_TOKEN,d={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:l,clientId:this.clientId,realm:o||e.tenantId,target:s,tokenType:c,keyId:t.sshKid,requestedClaimsHash:t.requestedClaimsHash},h=r&&r.accessToken||this.getTokenKeys().accessToken,u=[];h.forEach(e=>{if(this.accessTokenKeyMatchesFilter(e,d,!0)){let t=this.getAccessTokenCredential(e,a);t&&this.credentialMatchesFilter(t,d)&&u.push(t)}});let p=u.length;return p<1?(this.commonLogger.info("CacheManager:getAccessToken - No token found",a),null):p>1?(this.commonLogger.info("CacheManager:getAccessToken - Multiple access tokens found, clearing them",a),u.forEach(e=>{this.removeAccessToken(this.generateCredentialKey(e),a)}),this.performanceClient.addFields({multiMatchedAT:u.length},a),null):(this.commonLogger.info("CacheManager:getAccessToken - Returning access token",a),u[0])}accessTokenKeyMatchesFilter(e,t,r){let n=e.toLowerCase();if(t.clientId&&-1===n.indexOf(t.clientId.toLowerCase())||t.homeAccountId&&-1===n.indexOf(t.homeAccountId.toLowerCase())||t.realm&&-1===n.indexOf(t.realm.toLowerCase())||t.requestedClaimsHash&&-1===n.indexOf(t.requestedClaimsHash.toLowerCase()))return!1;if(t.target){let e=t.target.asArray();for(let t=0;t<e.length;t++)if(r&&!n.includes(e[t].toLowerCase()))return!1;else if(!r&&n.includes(e[t].toLowerCase()))break}return!0}getAccessTokensByFilter(e,t){let r=this.getTokenKeys(),n=[];return r.accessToken.forEach(r=>{if(!this.accessTokenKeyMatchesFilter(r,e,!0))return;let o=this.getAccessTokenCredential(r,t);o&&this.credentialMatchesFilter(o,e)&&n.push(o)}),n}getRefreshToken(e,t,r,o,i){this.commonLogger.trace("CacheManager - getRefreshToken called");let a=t?n.THE_FAMILY_ID:void 0,s={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:n.CredentialType.REFRESH_TOKEN,clientId:this.clientId,familyId:a},c=o&&o.refreshToken||this.getTokenKeys().refreshToken,l=[];c.forEach(e=>{if(this.refreshTokenKeyMatchesFilter(e,s)){let t=this.getRefreshTokenCredential(e,r);t&&this.credentialMatchesFilter(t,s)&&l.push(t)}});let d=l.length;return d<1?(this.commonLogger.info("CacheManager:getRefreshToken - No refresh token found."),null):(d>1&&i&&r&&i.addFields({multiMatchedRT:d},r),this.commonLogger.info("CacheManager:getRefreshToken - returning refresh token"),l[0])}refreshTokenKeyMatchesFilter(e,t){let r=e.toLowerCase();return(!t.familyId||-1!==r.indexOf(t.familyId.toLowerCase()))&&(!!t.familyId||!t.clientId||-1!==r.indexOf(t.clientId.toLowerCase()))&&(!t.homeAccountId||-1!==r.indexOf(t.homeAccountId.toLowerCase()))}readAppMetadataFromCache(e){let t={environment:e,clientId:this.clientId},r=this.getAppMetadataFilteredBy(t),n=Object.keys(r).map(e=>r[e]),o=n.length;if(o<1)return null;if(o>1)throw(0,s.createClientAuthError)(g.multipleMatchingAppMetadata);return n[0]}isAppMetadataFOCI(e){let t=this.readAppMetadataFromCache(e);return!!(t&&t.familyId===n.THE_FAMILY_ID)}matchHomeAccountId(e,t){return"string"==typeof e.homeAccountId&&t===e.homeAccountId}matchLocalAccountIdFromTokenClaims(e,t){return t===(e.oid||e.sub)}matchLocalAccountIdFromTenantProfile(e,t){return e.localAccountId===t}matchName(e,t){return t.toLowerCase()===e.name?.toLowerCase()}matchUsername(e,t){return!!(e&&"string"==typeof e&&t?.toLowerCase()===e.toLowerCase())}matchUserAssertionHash(e,t){return!!(e.userAssertionHash&&t===e.userAssertionHash)}matchEnvironment(e,t){if(this.staticAuthorityOptions){let r=(0,h.getAliasesFromStaticSources)(this.staticAuthorityOptions,this.commonLogger);if(r.includes(t)&&r.includes(e.environment))return!0}let r=this.getAuthorityMetadataByAlias(t);return!!(r&&r.aliases.indexOf(e.environment)>-1)}matchCredentialType(e,t){return e.credentialType&&t.toLowerCase()===e.credentialType.toLowerCase()}matchClientId(e,t){return!!(e.clientId&&t===e.clientId)}matchFamilyId(e,t){return!!(e.familyId&&t===e.familyId)}matchRealm(e,t){return e.realm?.toLowerCase()===t.toLowerCase()}matchNativeAccountId(e,t){return!!(e.nativeAccountId&&t===e.nativeAccountId)}matchLoginHintFromTokenClaims(e,t){return e.login_hint===t||e.preferred_username===t||e.upn===t}matchSid(e,t){return e.sid===t}matchAuthorityType(e,t){return!!(e.authorityType&&t.toLowerCase()===e.authorityType.toLowerCase())}matchTarget(e,t){return(e.credentialType===n.CredentialType.ACCESS_TOKEN||e.credentialType===n.CredentialType.ACCESS_TOKEN_WITH_AUTH_SCHEME)&&!!e.target&&i.ScopeSet.fromString(e.target).containsScopeSet(t)}matchTokenType(e,t){return!!(e.tokenType&&e.tokenType===t)}matchKeyId(e,t){return!!(e.keyId&&e.keyId===t)}isAppMetadata(e){return -1!==e.indexOf(n.APP_METADATA)}isAuthorityMetadata(e){return -1!==e.indexOf(n.AUTHORITY_METADATA_CONSTANTS.CACHE_KEY)}generateAuthorityMetadataCacheKey(e){return`${n.AUTHORITY_METADATA_CONSTANTS.CACHE_KEY}-${this.clientId}-${e}`}static toObject(e,t){for(let r in t)e[r]=t[r];return e}}class C extends m{async setAccount(){throw(0,s.createClientAuthError)(g.methodNotImplemented)}getAccount(){throw(0,s.createClientAuthError)(g.methodNotImplemented)}async setIdTokenCredential(){throw(0,s.createClientAuthError)(g.methodNotImplemented)}getIdTokenCredential(){throw(0,s.createClientAuthError)(g.methodNotImplemented)}async setAccessTokenCredential(){throw(0,s.createClientAuthError)(g.methodNotImplemented)}getAccessTokenCredential(){throw(0,s.createClientAuthError)(g.methodNotImplemented)}async setRefreshTokenCredential(){throw(0,s.createClientAuthError)(g.methodNotImplemented)}getRefreshTokenCredential(){throw(0,s.createClientAuthError)(g.methodNotImplemented)}setAppMetadata(){throw(0,s.createClientAuthError)(g.methodNotImplemented)}getAppMetadata(){throw(0,s.createClientAuthError)(g.methodNotImplemented)}setServerTelemetry(){throw(0,s.createClientAuthError)(g.methodNotImplemented)}getServerTelemetry(){throw(0,s.createClientAuthError)(g.methodNotImplemented)}setAuthorityMetadata(){throw(0,s.createClientAuthError)(g.methodNotImplemented)}getAuthorityMetadata(){throw(0,s.createClientAuthError)(g.methodNotImplemented)}getAuthorityMetadataKeys(){throw(0,s.createClientAuthError)(g.methodNotImplemented)}setThrottlingCache(){throw(0,s.createClientAuthError)(g.methodNotImplemented)}getThrottlingCache(){throw(0,s.createClientAuthError)(g.methodNotImplemented)}removeItem(){throw(0,s.createClientAuthError)(g.methodNotImplemented)}getKeys(){throw(0,s.createClientAuthError)(g.methodNotImplemented)}getAccountKeys(){throw(0,s.createClientAuthError)(g.methodNotImplemented)}getTokenKeys(){throw(0,s.createClientAuthError)(g.methodNotImplemented)}generateCredentialKey(){throw(0,s.createClientAuthError)(g.methodNotImplemented)}generateAccountKey(){throw(0,s.createClientAuthError)(g.methodNotImplemented)}}}),i("6GdIx",function(t,r){e(t.exports,"ScopeSet",()=>d);var n=o("jYvjz"),i=o("7yP0u"),a=o("anIdE"),s=o("gmw86"),c=o("cmWPH"),l=o("l6ONb");class d{constructor(e){let t=e?i.StringUtils.trimArrayEntries([...e]):[],r=t?i.StringUtils.removeEmptyStringsFromArray(t):[];if(!r||!r.length)throw(0,n.createClientConfigurationError)(c.emptyInputScopesError);this.scopes=new Set,r.forEach(e=>this.scopes.add(e))}static fromString(e){return new d((e||s.Constants.EMPTY_STRING).split(" "))}static createSearchScopes(e){let t=new d(e&&e.length>0?e:[...s.OIDC_DEFAULT_SCOPES]);return t.containsOnlyOIDCScopes()?t.removeScope(s.Constants.OFFLINE_ACCESS_SCOPE):t.removeOIDCScopes(),t}containsScope(e){let t=new d(this.printScopesLowerCase().split(" "));return!!e&&t.scopes.has(e.toLowerCase())}containsScopeSet(e){return!!e&&!(e.scopes.size<=0)&&this.scopes.size>=e.scopes.size&&e.asArray().every(e=>this.containsScope(e))}containsOnlyOIDCScopes(){let e=0;return s.OIDC_SCOPES.forEach(t=>{this.containsScope(t)&&(e+=1)}),this.scopes.size===e}appendScope(e){e&&this.scopes.add(e.trim())}appendScopes(e){try{e.forEach(e=>this.appendScope(e))}catch(e){throw(0,a.createClientAuthError)(l.cannotAppendScopeSet)}}removeScope(e){if(!e)throw(0,a.createClientAuthError)(l.cannotRemoveEmptyScope);this.scopes.delete(e.trim())}removeOIDCScopes(){s.OIDC_SCOPES.forEach(e=>{this.scopes.delete(e)})}unionScopeSets(e){if(!e)throw(0,a.createClientAuthError)(l.emptyInputScopeSet);let t=new Set;return e.scopes.forEach(e=>t.add(e.toLowerCase())),this.scopes.forEach(e=>t.add(e.toLowerCase())),t}intersectingScopeSets(e){if(!e)throw(0,a.createClientAuthError)(l.emptyInputScopeSet);e.containsOnlyOIDCScopes()||e.removeOIDCScopes();let t=this.unionScopeSets(e),r=e.getScopeCount(),n=this.getScopeCount();return t.size<n+r}getScopeCount(){return this.scopes.size}asArray(){let e=[];return this.scopes.forEach(t=>e.push(t)),e}printScopes(){return this.scopes?this.asArray().join(" "):s.Constants.EMPTY_STRING}printScopesLowerCase(){return this.printScopes().toLowerCase()}}}),i("7yP0u",function(t,r){e(t.exports,"StringUtils",()=>n);class n{static isEmptyObj(e){if(e)try{let t=JSON.parse(e);return 0===Object.keys(t).length}catch(e){}return!0}static startsWith(e,t){return 0===e.indexOf(t)}static endsWith(e,t){return e.length>=t.length&&e.lastIndexOf(t)===e.length-t.length}static queryStringToObject(e){let t={},r=e.split("&"),n=e=>decodeURIComponent(e.replace(/\+/g," "));return r.forEach(e=>{if(e.trim()){let[r,o]=e.split(/=(.+)/g,2);r&&o&&(t[n(r)]=n(o))}}),t}static trimArrayEntries(e){return e.map(e=>e.trim())}static removeEmptyStringsFromArray(e){return e.filter(e=>!!e)}static jsonParseHelper(e){try{return JSON.parse(e)}catch(e){return null}}static matchPattern(e,t){return new RegExp(e.replace(/\\/g,"\\\\").replace(/\*/g,"[^ ]*").replace(/\?/g,"\\?")).test(t)}}}),i("4tMCV",function(t,r){e(t.exports,"AccountEntity",()=>u);var n=o("gmw86"),i=o("2n5CL"),a=o("aRYMn"),s=o("anIdE"),c=o("2ZfLX"),l=o("knfgg"),d=o("77Sbs"),h=o("l6ONb");class u{static getAccountInfo(e){return{homeAccountId:e.homeAccountId,environment:e.environment,tenantId:e.realm,username:e.username,localAccountId:e.localAccountId,loginHint:e.loginHint,name:e.name,nativeAccountId:e.nativeAccountId,authorityType:e.authorityType,tenantProfiles:new Map((e.tenantProfiles||[]).map(e=>[e.tenantId,e])),dataBoundary:e.dataBoundary}}isSingleTenant(){return!this.tenantProfiles}static createAccount(e,t,r){let o,p=new u;t.authorityType===c.AuthorityType.Adfs?p.authorityType=n.CacheAccountType.ADFS_ACCOUNT_TYPE:t.protocolMode===d.ProtocolMode.OIDC?p.authorityType=n.CacheAccountType.GENERIC_ACCOUNT_TYPE:p.authorityType=n.CacheAccountType.MSSTS_ACCOUNT_TYPE,e.clientInfo&&r&&(o=(0,i.buildClientInfo)(e.clientInfo,r)).xms_tdbr&&(p.dataBoundary="EU"===o.xms_tdbr?"EU":"None"),p.clientInfo=e.clientInfo,p.homeAccountId=e.homeAccountId,p.nativeAccountId=e.nativeAccountId;let g=e.environment||t&&t.getPreferredCache();if(!g)throw(0,s.createClientAuthError)(h.invalidCacheEnvironment);p.environment=g,p.realm=o?.utid||(0,l.getTenantIdFromIdTokenClaims)(e.idTokenClaims)||"",p.localAccountId=o?.uid||e.idTokenClaims?.oid||e.idTokenClaims?.sub||"";let m=e.idTokenClaims?.preferred_username||e.idTokenClaims?.upn,C=e.idTokenClaims?.emails?e.idTokenClaims.emails[0]:null;if(p.username=m||C||"",p.loginHint=e.idTokenClaims?.login_hint,p.name=e.idTokenClaims?.name||"",p.cloudGraphHostName=e.cloudGraphHostName,p.msGraphHost=e.msGraphHost,e.tenantProfiles)p.tenantProfiles=e.tenantProfiles;else{let t=(0,a.buildTenantProfile)(e.homeAccountId,p.localAccountId,p.realm,e.idTokenClaims);p.tenantProfiles=[t]}return p}static createFromAccountInfo(e,t,r){let o=new u;return o.authorityType=e.authorityType||n.CacheAccountType.GENERIC_ACCOUNT_TYPE,o.homeAccountId=e.homeAccountId,o.localAccountId=e.localAccountId,o.nativeAccountId=e.nativeAccountId,o.realm=e.tenantId,o.environment=e.environment,o.username=e.username,o.name=e.name,o.loginHint=e.loginHint,o.cloudGraphHostName=t,o.msGraphHost=r,o.tenantProfiles=Array.from(e.tenantProfiles?.values()||[]),o.dataBoundary=e.dataBoundary,o}static generateHomeAccountId(e,t,r,n,o){if(t!==c.AuthorityType.Adfs&&t!==c.AuthorityType.Dsts){if(e)try{let t=(0,i.buildClientInfo)(e,n.base64Decode);if(t.uid&&t.utid)return`${t.uid}.${t.utid}`}catch(e){}r.warning("No client info in response")}return o?.sub||""}static isAccountEntity(e){return!!e&&e.hasOwnProperty("homeAccountId")&&e.hasOwnProperty("environment")&&e.hasOwnProperty("realm")&&e.hasOwnProperty("localAccountId")&&e.hasOwnProperty("username")&&e.hasOwnProperty("authorityType")}static accountInfoIsEqual(e,t,r){if(!e||!t)return!1;let n=!0;if(r){let r=e.idTokenClaims||{},o=t.idTokenClaims||{};n=r.iat===o.iat&&r.nonce===o.nonce}return e.homeAccountId===t.homeAccountId&&e.localAccountId===t.localAccountId&&e.username===t.username&&e.tenantId===t.tenantId&&e.loginHint===t.loginHint&&e.environment===t.environment&&e.nativeAccountId===t.nativeAccountId&&n}}}),i("2n5CL",function(t,r){e(t.exports,"buildClientInfo",()=>s),e(t.exports,"buildClientInfoFromHomeAccountId",()=>c);var n=o("anIdE"),i=o("gmw86"),a=o("l6ONb");function s(e,t){if(!e)throw(0,n.createClientAuthError)(a.clientInfoEmptyError);try{let r=t(e);return JSON.parse(r)}catch(e){throw(0,n.createClientAuthError)(a.clientInfoDecodingError)}}function c(e){if(!e)throw(0,n.createClientAuthError)(a.clientInfoDecodingError);let t=e.split(i.Separators.CLIENT_INFO_SEPARATOR,2);return{uid:t[0],utid:t.length<2?i.Constants.EMPTY_STRING:t[1]}}}),i("aRYMn",function(t,r){function n(e,t){return!!e&&!!t&&e===t.split(".")[1]}function o(e,t,r,o){if(!o)return{tenantId:r,localAccountId:t,username:"",isHomeTenant:n(r,e)};{let{oid:t,sub:r,tid:i,name:a,tfp:s,acr:c,preferred_username:l,upn:d,login_hint:h}=o,u=i||s||c||"";return{tenantId:u,localAccountId:t||r||"",name:a,username:l||d||"",loginHint:h,isHomeTenant:n(u,e)}}}function i(e,t,r,n){let i=e;if(t){let{isHomeTenant:r,...n}=t;i={...e,...n}}if(r){let{isHomeTenant:t,...a}=o(e.homeAccountId,e.localAccountId,e.tenantId,r);i={...i,...a,idTokenClaims:r,idToken:n}}return i}e(t.exports,"buildTenantProfile",()=>o),e(t.exports,"updateAccountTenantProfileData",()=>i)}),i("2ZfLX",function(t,r){e(t.exports,"AuthorityType",()=>n);let n={Default:0,Adfs:1,Dsts:2,Ciam:3}}),i("knfgg",function(t,r){e(t.exports,"getTenantIdFromIdTokenClaims",()=>n);function n(e){return e&&(e.tid||e.tfp||e.acr)||null}}),i("77Sbs",function(t,r){e(t.exports,"ProtocolMode",()=>n);let n={AAD:"AAD",OIDC:"OIDC",EAR:"EAR"}}),i("eVKB1",function(t,r){e(t.exports,"extractTokenClaims",()=>a),e(t.exports,"getJWSPayload",()=>c),e(t.exports,"isKmsi",()=>s),e(t.exports,"checkMaxAge",()=>l);var n=o("anIdE"),i=o("l6ONb");function a(e,t){let r=c(e);try{let e=t(r);return JSON.parse(e)}catch(e){throw(0,n.createClientAuthError)(i.tokenParsingError)}}function s(e){if(!e.signin_state)return!1;let t=["kmsi","dvc_dmjd"];return e.signin_state.some(e=>t.includes(e.trim().toLowerCase()))}function c(e){if(!e)throw(0,n.createClientAuthError)(i.nullOrEmptyToken);let t=/^([^\.\s]*)\.([^\.\s]+)\.([^\.\s]*)$/.exec(e);if(!t||t.length<4)throw(0,n.createClientAuthError)(i.tokenParsingError);return t[2]}function l(e,t){if(0===t||Date.now()-3e5>e+t)throw(0,n.createClientAuthError)(i.maxAgeTranspired)}}),i("aNZw2",function(t,r){e(t.exports,"EndpointMetadata",()=>a),e(t.exports,"InstanceDiscoveryMetadataAliases",()=>c),e(t.exports,"getAliasesFromStaticSources",()=>l),e(t.exports,"getCloudDiscoveryMetadataFromNetworkResponse",()=>u),e(t.exports,"getCloudDiscoveryMetadataFromHardcodedValues",()=>h);var n=o("gkKSO"),i=o("gmw86");let a={"login.microsoftonline.com":{token_endpoint:"https://login.microsoftonline.com/{tenantid}/oauth2/v2.0/token",jwks_uri:"https://login.microsoftonline.com/{tenantid}/discovery/v2.0/keys",issuer:"https://login.microsoftonline.com/{tenantid}/v2.0",authorization_endpoint:"https://login.microsoftonline.com/{tenantid}/oauth2/v2.0/authorize",end_session_endpoint:"https://login.microsoftonline.com/{tenantid}/oauth2/v2.0/logout"},"login.chinacloudapi.cn":{token_endpoint:"https://login.chinacloudapi.cn/{tenantid}/oauth2/v2.0/token",jwks_uri:"https://login.chinacloudapi.cn/{tenantid}/discovery/v2.0/keys",issuer:"https://login.partner.microsoftonline.cn/{tenantid}/v2.0",authorization_endpoint:"https://login.chinacloudapi.cn/{tenantid}/oauth2/v2.0/authorize",end_session_endpoint:"https://login.chinacloudapi.cn/{tenantid}/oauth2/v2.0/logout"},"login.microsoftonline.us":{token_endpoint:"https://login.microsoftonline.us/{tenantid}/oauth2/v2.0/token",jwks_uri:"https://login.microsoftonline.us/{tenantid}/discovery/v2.0/keys",issuer:"https://login.microsoftonline.us/{tenantid}/v2.0",authorization_endpoint:"https://login.microsoftonline.us/{tenantid}/oauth2/v2.0/authorize",end_session_endpoint:"https://login.microsoftonline.us/{tenantid}/oauth2/v2.0/logout"}},s=[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}],c=new Set;function l(e,t){let r,o=e.canonicalAuthority;if(o){let a=new(0,n.UrlString)(o).getUrlComponents().HostNameAndPort;r=d(a,e.cloudDiscoveryMetadata?.metadata,i.AuthorityMetadataSource.CONFIG,t)||d(a,s,i.AuthorityMetadataSource.HARDCODED_VALUES,t)||e.knownAuthorities}return r||[]}function d(e,t,r,n){if(n?.trace(`getAliasesFromMetadata called with source: ${r}`),e&&t){let o=u(t,e);if(o)return n?.trace(`getAliasesFromMetadata: found cloud discovery metadata in ${r}, returning aliases`),o.aliases;n?.trace(`getAliasesFromMetadata: did not find cloud discovery metadata in ${r}`)}return null}function h(e){return u(s,e)}function u(e,t){for(let r=0;r<e.length;r++){let n=e[r];if(n.aliases.includes(t))return n}return null}s.forEach(e=>{e.aliases.forEach(e=>{c.add(e)})})}),i("gkKSO",function(t,r){e(t.exports,"UrlString",()=>l);var n=o("jYvjz"),i=o("7yP0u"),a=o("gmw86"),s=o("8S0Fg"),c=o("cmWPH");class l{get urlString(){return this._urlString}constructor(e){if(this._urlString=e,!this._urlString)throw(0,n.createClientConfigurationError)(c.urlEmptyError);e.includes("#")||(this._urlString=l.canonicalizeUri(e))}static canonicalizeUri(e){if(e){let t=e.toLowerCase();return i.StringUtils.endsWith(t,"?")?t=t.slice(0,-1):i.StringUtils.endsWith(t,"?/")&&(t=t.slice(0,-2)),i.StringUtils.endsWith(t,"/")||(t+="/"),t}return e}validateAsUri(){let e;try{e=this.getUrlComponents()}catch(e){throw(0,n.createClientConfigurationError)(c.urlParseError)}if(!e.HostNameAndPort||!e.PathSegments)throw(0,n.createClientConfigurationError)(c.urlParseError);if(!e.Protocol||"https:"!==e.Protocol.toLowerCase())throw(0,n.createClientConfigurationError)(c.authorityUriInsecure)}static appendQueryString(e,t){return t?0>e.indexOf("?")?`${e}?${t}`:`${e}&${t}`:e}static removeHashFromUrl(e){return l.canonicalizeUri(e.split("#")[0])}replaceTenantPath(e){let t=this.getUrlComponents(),r=t.PathSegments;return e&&0!==r.length&&(r[0]===a.AADAuthorityConstants.COMMON||r[0]===a.AADAuthorityConstants.ORGANIZATIONS)&&(r[0]=e),l.constructAuthorityUriFromObject(t)}getUrlComponents(){let e=RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?"),t=this.urlString.match(e);if(!t)throw(0,n.createClientConfigurationError)(c.urlParseError);let r={Protocol:t[1],HostNameAndPort:t[4],AbsolutePath:t[5],QueryString:t[7]},o=r.AbsolutePath.split("/");return r.PathSegments=o=o.filter(e=>e&&e.length>0),r.QueryString&&r.QueryString.endsWith("/")&&(r.QueryString=r.QueryString.substring(0,r.QueryString.length-1)),r}static getDomainFromUrl(e){let t=RegExp("^([^:/?#]+://)?([^/?#]*)"),r=e.match(t);if(!r)throw(0,n.createClientConfigurationError)(c.urlParseError);return r[2]}static getAbsoluteUrl(e,t){if(e[0]===a.Constants.FORWARD_SLASH){let r=new l(t).getUrlComponents();return r.Protocol+"//"+r.HostNameAndPort+e}return e}static constructAuthorityUriFromObject(e){return new l(e.Protocol+"//"+e.HostNameAndPort+"/"+e.PathSegments.join("/"))}static hashContainsKnownProperties(e){return!!(0,s.getDeserializedResponse)(e)}}}),i("8S0Fg",function(t,r){e(t.exports,"stripLeadingHashOrQuery",()=>c),e(t.exports,"getDeserializedResponse",()=>l),e(t.exports,"mapToQueryString",()=>d),e(t.exports,"normalizeUrlForComparison",()=>h);var n=o("anIdE"),i=o("7yP0u"),a=o("l6ONb");function s(e){if(!e)return e;let t=e.toLowerCase();return i.StringUtils.endsWith(t,"?")?t=t.slice(0,-1):i.StringUtils.endsWith(t,"?/")&&(t=t.slice(0,-2)),i.StringUtils.endsWith(t,"/")||(t+="/"),t}function c(e){return e.startsWith("#/")?e.substring(2):e.startsWith("#")||e.startsWith("?")?e.substring(1):e}function l(e){if(!e||0>e.indexOf("="))return null;try{let t=c(e),r=Object.fromEntries(new URLSearchParams(t));if(r.code||r.ear_jwe||r.error||r.error_description||r.state)return r}catch(e){throw(0,n.createClientAuthError)(a.hashNotDeserialized)}return null}function d(e,t=!0,r){let n=[];return e.forEach((e,o)=>{!t&&r&&o in r?n.push(`${o}=${e}`):n.push(`${o}=${encodeURIComponent(e)}`)}),n.join("&")}function h(e){if(!e)return e;let t=e.split("#")[0];try{let e=new URL(t),r=e.origin+e.pathname+e.search;return s(r)}catch(e){return s(t)}}}),i("2eahm",function(t,r){e(t.exports,"CacheError",()=>s),e(t.exports,"createCacheError",()=>c);var n=o("ckDmJ"),i=o("d2Djx");let a={[i.cacheQuotaExceeded]:"Exceeded cache storage capacity.",[i.cacheErrorUnknown]:"Unexpected error occurred when using cache storage."};class s extends n.AuthError{constructor(e,t){let r=t||(a[e]?a[e]:a[i.cacheErrorUnknown]);super(`${e}: ${r}`),Object.setPrototypeOf(this,s.prototype),this.name="CacheError",this.errorCode=e,this.errorMessage=r}}function c(e){return e instanceof Error?"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name||e.message.includes("exceeded the quota")?new s(i.cacheQuotaExceeded):new s(e.name,e.message):new s(i.cacheErrorUnknown)}}),i("d2Djx",function(t,r){e(t.exports,"cacheQuotaExceeded",()=>n),e(t.exports,"cacheErrorUnknown",()=>o);let n="cache_quota_exceeded",o="cache_error_unknown"}),i("e0Klr",function(t,r){e(t.exports,"StubPerformanceClient",()=>a);var n=o("gnfKd");class i{startMeasurement(){}endMeasurement(){}flushMeasurement(){return null}}class a{generateId(){return"callback-id"}startMeasurement(e,t){return{end:()=>null,discard:()=>{},add:()=>{},increment:()=>{},event:{eventId:this.generateId(),status:n.PerformanceEventStatus.InProgress,authority:"",libraryName:"",libraryVersion:"",clientId:"",name:e,startTimeMs:Date.now(),correlationId:t||""},measurement:new i}}startPerformanceMeasurement(){return new i}calculateQueuedTime(){return 0}addQueueMeasurement(){}setPreQueueTime(){}endMeasurement(){return null}discardMeasurements(){}removePerformanceCallback(){return!0}addPerformanceCallback(){return""}emitEvents(){}addFields(){}incrementFields(){}cacheEventByCorrelationId(){}}}),i("gnfKd",function(t,r){e(t.exports,"PerformanceEvents",()=>n),e(t.exports,"PerformanceEventStatus",()=>o);let n={AcquireTokenByCode:"acquireTokenByCode",AcquireTokenByRefreshToken:"acquireTokenByRefreshToken",AcquireTokenSilent:"acquireTokenSilent",AcquireTokenSilentAsync:"acquireTokenSilentAsync",AcquireTokenPopup:"acquireTokenPopup",AcquireTokenPreRedirect:"acquireTokenPreRedirect",AcquireTokenRedirect:"acquireTokenRedirect",CryptoOptsGetPublicKeyThumbprint:"cryptoOptsGetPublicKeyThumbprint",CryptoOptsSignJwt:"cryptoOptsSignJwt",SilentCacheClientAcquireToken:"silentCacheClientAcquireToken",SilentIframeClientAcquireToken:"silentIframeClientAcquireToken",AwaitConcurrentIframe:"awaitConcurrentIframe",SilentRefreshClientAcquireToken:"silentRefreshClientAcquireToken",SsoSilent:"ssoSilent",StandardInteractionClientGetDiscoveredAuthority:"standardInteractionClientGetDiscoveredAuthority",FetchAccountIdWithNativeBroker:"fetchAccountIdWithNativeBroker",NativeInteractionClientAcquireToken:"nativeInteractionClientAcquireToken",BaseClientCreateTokenRequestHeaders:"baseClientCreateTokenRequestHeaders",NetworkClientSendPostRequestAsync:"networkClientSendPostRequestAsync",RefreshTokenClientExecutePostToTokenEndpoint:"refreshTokenClientExecutePostToTokenEndpoint",AuthorizationCodeClientExecutePostToTokenEndpoint:"authorizationCodeClientExecutePostToTokenEndpoint",BrokerHandhshake:"brokerHandshake",AcquireTokenByRefreshTokenInBroker:"acquireTokenByRefreshTokenInBroker",AcquireTokenByBroker:"acquireTokenByBroker",RefreshTokenClientExecuteTokenRequest:"refreshTokenClientExecuteTokenRequest",RefreshTokenClientAcquireToken:"refreshTokenClientAcquireToken",RefreshTokenClientAcquireTokenWithCachedRefreshToken:"refreshTokenClientAcquireTokenWithCachedRefreshToken",RefreshTokenClientAcquireTokenByRefreshToken:"refreshTokenClientAcquireTokenByRefreshToken",RefreshTokenClientCreateTokenRequestBody:"refreshTokenClientCreateTokenRequestBody",AcquireTokenFromCache:"acquireTokenFromCache",SilentFlowClientAcquireCachedToken:"silentFlowClientAcquireCachedToken",SilentFlowClientGenerateResultFromCacheRecord:"silentFlowClientGenerateResultFromCacheRecord",AcquireTokenBySilentIframe:"acquireTokenBySilentIframe",InitializeBaseRequest:"initializeBaseRequest",InitializeSilentRequest:"initializeSilentRequest",InitializeClientApplication:"initializeClientApplication",InitializeCache:"initializeCache",SilentIframeClientTokenHelper:"silentIframeClientTokenHelper",SilentHandlerInitiateAuthRequest:"silentHandlerInitiateAuthRequest",SilentHandlerMonitorIframeForHash:"silentHandlerMonitorIframeForHash",SilentHandlerLoadFrame:"silentHandlerLoadFrame",SilentHandlerLoadFrameSync:"silentHandlerLoadFrameSync",StandardInteractionClientCreateAuthCodeClient:"standardInteractionClientCreateAuthCodeClient",StandardInteractionClientGetClientConfiguration:"standardInteractionClientGetClientConfiguration",StandardInteractionClientInitializeAuthorizationRequest:"standardInteractionClientInitializeAuthorizationRequest",GetAuthCodeUrl:"getAuthCodeUrl",GetStandardParams:"getStandardParams",HandleCodeResponseFromServer:"handleCodeResponseFromServer",HandleCodeResponse:"handleCodeResponse",HandleResponseEar:"handleResponseEar",HandleResponsePlatformBroker:"handleResponsePlatformBroker",HandleResponseCode:"handleResponseCode",UpdateTokenEndpointAuthority:"updateTokenEndpointAuthority",AuthClientAcquireToken:"authClientAcquireToken",AuthClientExecuteTokenRequest:"authClientExecuteTokenRequest",AuthClientCreateTokenRequestBody:"authClientCreateTokenRequestBody",PopTokenGenerateCnf:"popTokenGenerateCnf",PopTokenGenerateKid:"popTokenGenerateKid",HandleServerTokenResponse:"handleServerTokenResponse",DeserializeResponse:"deserializeResponse",AuthorityFactoryCreateDiscoveredInstance:"authorityFactoryCreateDiscoveredInstance",AuthorityResolveEndpointsAsync:"authorityResolveEndpointsAsync",AuthorityResolveEndpointsFromLocalSources:"authorityResolveEndpointsFromLocalSources",AuthorityGetCloudDiscoveryMetadataFromNetwork:"authorityGetCloudDiscoveryMetadataFromNetwork",AuthorityUpdateCloudDiscoveryMetadata:"authorityUpdateCloudDiscoveryMetadata",AuthorityGetEndpointMetadataFromNetwork:"authorityGetEndpointMetadataFromNetwork",AuthorityUpdateEndpointMetadata:"authorityUpdateEndpointMetadata",AuthorityUpdateMetadataWithRegionalInformation:"authorityUpdateMetadataWithRegionalInformation",RegionDiscoveryDetectRegion:"regionDiscoveryDetectRegion",RegionDiscoveryGetRegionFromIMDS:"regionDiscoveryGetRegionFromIMDS",RegionDiscoveryGetCurrentVersion:"regionDiscoveryGetCurrentVersion",AcquireTokenByCodeAsync:"acquireTokenByCodeAsync",GetEndpointMetadataFromNetwork:"getEndpointMetadataFromNetwork",GetCloudDiscoveryMetadataFromNetworkMeasurement:"getCloudDiscoveryMetadataFromNetworkMeasurement",HandleRedirectPromiseMeasurement:"handleRedirectPromise",HandleNativeRedirectPromiseMeasurement:"handleNativeRedirectPromise",UpdateCloudDiscoveryMetadataMeasurement:"updateCloudDiscoveryMetadataMeasurement",UsernamePasswordClientAcquireToken:"usernamePasswordClientAcquireToken",NativeMessageHandlerHandshake:"nativeMessageHandlerHandshake",NativeGenerateAuthResult:"nativeGenerateAuthResult",RemoveHiddenIframe:"removeHiddenIframe",ClearTokensAndKeysWithClaims:"clearTokensAndKeysWithClaims",CacheManagerGetRefreshToken:"cacheManagerGetRefreshToken",ImportExistingCache:"importExistingCache",SetUserData:"setUserData",LocalStorageUpdated:"localStorageUpdated",GeneratePkceCodes:"generatePkceCodes",GenerateCodeVerifier:"generateCodeVerifier",GenerateCodeChallengeFromVerifier:"generateCodeChallengeFromVerifier",Sha256Digest:"sha256Digest",GetRandomValues:"getRandomValues",GenerateHKDF:"generateHKDF",GenerateBaseKey:"generateBaseKey",Base64Decode:"base64Decode",UrlEncodeArr:"urlEncodeArr",Encrypt:"encrypt",Decrypt:"decrypt",GenerateEarKey:"generateEarKey",DecryptEarResponse:"decryptEarResponse"};n.AcquireTokenByCode,n.AcquireTokenByRefreshToken,n.AcquireTokenSilent,n.AcquireTokenSilentAsync,n.AcquireTokenPopup,n.AcquireTokenRedirect,n.CryptoOptsGetPublicKeyThumbprint,n.CryptoOptsSignJwt,n.SilentCacheClientAcquireToken,n.SilentIframeClientAcquireToken,n.SilentRefreshClientAcquireToken,n.SsoSilent,n.StandardInteractionClientGetDiscoveredAuthority,n.FetchAccountIdWithNativeBroker,n.NativeInteractionClientAcquireToken,n.BaseClientCreateTokenRequestHeaders,n.NetworkClientSendPostRequestAsync,n.RefreshTokenClientExecutePostToTokenEndpoint,n.AuthorizationCodeClientExecutePostToTokenEndpoint,n.BrokerHandhshake,n.AcquireTokenByRefreshTokenInBroker,n.AcquireTokenByBroker,n.RefreshTokenClientExecuteTokenRequest,n.RefreshTokenClientAcquireToken,n.RefreshTokenClientAcquireTokenWithCachedRefreshToken,n.RefreshTokenClientAcquireTokenByRefreshToken,n.RefreshTokenClientCreateTokenRequestBody,n.AcquireTokenFromCache,n.SilentFlowClientAcquireCachedToken,n.SilentFlowClientGenerateResultFromCacheRecord,n.AcquireTokenBySilentIframe,n.InitializeBaseRequest,n.InitializeSilentRequest,n.InitializeClientApplication,n.InitializeCache,n.ImportExistingCache,n.SetUserData,n.LocalStorageUpdated,n.SilentIframeClientTokenHelper,n.SilentHandlerInitiateAuthRequest,n.SilentHandlerMonitorIframeForHash,n.SilentHandlerLoadFrame,n.SilentHandlerLoadFrameSync,n.StandardInteractionClientCreateAuthCodeClient,n.StandardInteractionClientGetClientConfiguration,n.StandardInteractionClientInitializeAuthorizationRequest,n.GetAuthCodeUrl,n.HandleCodeResponseFromServer,n.HandleCodeResponse,n.HandleResponseEar,n.HandleResponseCode,n.HandleResponsePlatformBroker,n.UpdateTokenEndpointAuthority,n.AuthClientAcquireToken,n.AuthClientExecuteTokenRequest,n.AuthClientCreateTokenRequestBody,n.PopTokenGenerateCnf,n.PopTokenGenerateKid,n.HandleServerTokenResponse,n.DeserializeResponse,n.AuthorityFactoryCreateDiscoveredInstance,n.AuthorityResolveEndpointsAsync,n.AuthorityResolveEndpointsFromLocalSources,n.AuthorityGetCloudDiscoveryMetadataFromNetwork,n.AuthorityUpdateCloudDiscoveryMetadata,n.AuthorityGetEndpointMetadataFromNetwork,n.AuthorityUpdateEndpointMetadata,n.AuthorityUpdateMetadataWithRegionalInformation,n.RegionDiscoveryDetectRegion,n.RegionDiscoveryGetRegionFromIMDS,n.RegionDiscoveryGetCurrentVersion,n.AcquireTokenByCodeAsync,n.GetEndpointMetadataFromNetwork,n.GetCloudDiscoveryMetadataFromNetworkMeasurement,n.HandleRedirectPromiseMeasurement,n.HandleNativeRedirectPromiseMeasurement,n.UpdateCloudDiscoveryMetadataMeasurement,n.UsernamePasswordClientAcquireToken,n.NativeMessageHandlerHandshake,n.NativeGenerateAuthResult,n.RemoveHiddenIframe,n.ClearTokensAndKeysWithClaims,n.CacheManagerGetRefreshToken,n.GeneratePkceCodes,n.GenerateCodeVerifier,n.GenerateCodeChallengeFromVerifier,n.Sha256Digest,n.GetRandomValues,n.GenerateHKDF,n.GenerateBaseKey,n.Base64Decode,n.UrlEncodeArr,n.Encrypt,n.Decrypt,n.GenerateEarKey,n.DecryptEarResponse;let o={NotStarted:0,InProgress:1,Completed:2}}),i("gzUuE",function(t,r){e(t.exports,"StubbedNetworkModule",()=>a);var n=o("anIdE"),i=o("l6ONb");let a={sendGetRequestAsync:()=>Promise.reject((0,n.createClientAuthError)(i.methodNotImplemented)),sendPostRequestAsync:()=>Promise.reject((0,n.createClientAuthError)(i.methodNotImplemented))}}),i("dp0vd",function(t,r){e(t.exports,"BrowserConstants",()=>s),e(t.exports,"PlatformAuthConstants",()=>c),e(t.exports,"NativeExtensionMethod",()=>l),e(t.exports,"BrowserCacheLocation",()=>d),e(t.exports,"HTTP_REQUEST_TYPE",()=>h),e(t.exports,"INTERACTION_TYPE",()=>u),e(t.exports,"TemporaryCacheKeys",()=>p),e(t.exports,"InMemoryCacheKeys",()=>g),e(t.exports,"ApiId",()=>m),e(t.exports,"InteractionType",()=>i),e(t.exports,"DEFAULT_REQUEST",()=>C),e(t.exports,"KEY_FORMAT_JWK",()=>f),e(t.exports,"DB_NAME",()=>y),e(t.exports,"DB_VERSION",()=>A),e(t.exports,"DB_TABLE_NAME",()=>E),e(t.exports,"CacheLookupPolicy",()=>v),e(t.exports,"iFrameRenewalPolicies",()=>T);var n,i,a=o("gmw86");let s={INVALID_GRANT_ERROR:"invalid_grant",POPUP_WIDTH:483,POPUP_HEIGHT:600,POPUP_NAME_PREFIX:"msal",DEFAULT_POLL_INTERVAL_MS:30,MSAL_SKU:"msal.js.browser"},c={CHANNEL_ID:"53ee284d-920a-4b59-9d30-a60315b26836",PREFERRED_EXTENSION_ID:"ppnbnpeolgkicgegkbkbjmhlideopiji",MATS_TELEMETRY:"MATS",MICROSOFT_ENTRA_BROKERID:"MicrosoftEntra",DOM_API_NAME:"DOM API",PLATFORM_DOM_APIS:"get-token-and-sign-out",PLATFORM_DOM_PROVIDER:"PlatformAuthDOMHandler",PLATFORM_EXTENSION_PROVIDER:"PlatformAuthExtensionHandler"},l={HandshakeRequest:"Handshake",HandshakeResponse:"HandshakeResponse",GetToken:"GetToken",Response:"Response"},d={LocalStorage:"localStorage",SessionStorage:"sessionStorage",MemoryStorage:"memoryStorage"},h={GET:"GET",POST:"POST"},u={SIGNIN:"signin",SIGNOUT:"signout"},p={ORIGIN_URI:"request.origin",URL_HASH:"urlHash",REQUEST_PARAMS:"request.params",VERIFIER:"code.verifier",INTERACTION_STATUS_KEY:"interaction.status",NATIVE_REQUEST:"request.native"},g={WRAPPER_SKU:"wrapper.sku",WRAPPER_VER:"wrapper.version"},m={acquireTokenRedirect:861,acquireTokenPopup:862,ssoSilent:863,acquireTokenSilent_authCode:864,handleRedirectPromise:865,acquireTokenByCode:866,acquireTokenSilent_silentFlow:61,logout:961,logoutPopup:962};(n=i||(i={})).Redirect="redirect",n.Popup="popup",n.Silent="silent",n.None="none";let C={scopes:a.OIDC_DEFAULT_SCOPES},f="jwk",y="msal.db",A=1,E=`${y}.keys`,v={Default:0,AccessToken:1,AccessTokenAndRefreshToken:2,RefreshToken:3,RefreshTokenAndNetwork:4,Skip:5},T=[v.Default,v.Skip,v.RefreshTokenAndNetwork]}),i("lUvW1",function(t,r){e(t.exports,"NavigationClient",()=>a);var n=o("6HXlN"),i=o("4pKco");class a{navigateInternal(e,t){return a.defaultNavigateWindow(e,t)}navigateExternal(e,t){return a.defaultNavigateWindow(e,t)}static defaultNavigateWindow(e,t){return t.noHistory?window.location.replace(e):window.location.assign(e),new Promise((e,r)=>{setTimeout(()=>{r((0,n.createBrowserAuthError)(i.timedOut,"failed_to_redirect"))},t.timeout)})}}}),i("6HXlN",function(t,r){e(t.exports,"BrowserAuthError",()=>c),e(t.exports,"createBrowserAuthError",()=>l);var n=o("ckDmJ"),i=o("4pKco");let a="For more visit: aka.ms/msaljs/browser-errors",s={[i.pkceNotCreated]:"The PKCE code challenge and verifier could not be generated.",[i.earJwkEmpty]:"No EAR encryption key provided. This is unexpected.",[i.earJweEmpty]:"Server response does not contain ear_jwe property. This is unexpected.",[i.cryptoNonExistent]:"The crypto object or function is not available.",[i.emptyNavigateUri]:"Navigation URI is empty. Please check stack trace for more info.",[i.hashEmptyError]:`Hash value cannot be processed because it is empty. Please verify that your redirectUri is not clearing the hash. ${a}`,[i.noStateInHash]:"Hash does not contain state. Please verify that the request originated from msal.",[i.hashDoesNotContainKnownProperties]:`Hash does not contain known properites. Please verify that your redirectUri is not changing the hash.  ${a}`,[i.unableToParseState]:"Unable to parse state. Please verify that the request originated from msal.",[i.stateInteractionTypeMismatch]:"Hash contains state but the interaction type does not match the caller.",[i.interactionInProgress]:`Interaction is currently in progress. Please ensure that this interaction has been completed before calling an interactive API.   ${a}`,[i.popupWindowError]:"Error opening popup window. This can happen if you are using IE or if popups are blocked in the browser.",[i.emptyWindowError]:"window.open returned null or undefined window object.",[i.userCancelled]:"User cancelled the flow.",[i.monitorPopupTimeout]:`Token acquisition in popup failed due to timeout.  ${a}`,[i.monitorWindowTimeout]:`Token acquisition in iframe failed due to timeout.  ${a}`,[i.redirectInIframe]:"Redirects are not supported for iframed or brokered applications. Please ensure you are using MSAL.js in a top frame of the window if using the redirect APIs, or use the popup APIs.",[i.blockIframeReload]:`Request was blocked inside an iframe because MSAL detected an authentication response.  ${a}`,[i.blockNestedPopups]:"Request was blocked inside a popup because MSAL detected it was running in a popup.",[i.iframeClosedPrematurely]:"The iframe being monitored was closed prematurely.",[i.silentLogoutUnsupported]:"Silent logout not supported. Please call logoutRedirect or logoutPopup instead.",[i.noAccountError]:"No account object provided to acquireTokenSilent and no active account has been set. Please call setActiveAccount or provide an account on the request.",[i.silentPromptValueError]:"The value given for the prompt value is not valid for silent requests - must be set to 'none' or 'no_session'.",[i.noTokenRequestCacheError]:"No token request found in cache.",[i.unableToParseTokenRequestCacheError]:"The cached token request could not be parsed.",[i.authRequestNotSetError]:"Auth Request not set. Please ensure initiateAuthRequest was called from the InteractionHandler",[i.invalidCacheType]:"Invalid cache type",[i.nonBrowserEnvironment]:"Login and token requests are not supported in non-browser environments.",[i.databaseNotOpen]:"Database is not open!",[i.noNetworkConnectivity]:"No network connectivity. Check your internet connection.",[i.postRequestFailed]:"Network request failed: If the browser threw a CORS error, check that the redirectUri is registered in the Azure App Portal as type 'SPA'",[i.getRequestFailed]:"Network request failed. Please check the network trace to determine root cause.",[i.failedToParseResponse]:"Failed to parse network response. Check network trace.",[i.unableToLoadToken]:"Error loading token to cache.",[i.cryptoKeyNotFound]:"Cryptographic Key or Keypair not found in browser storage.",[i.authCodeRequired]:"An authorization code must be provided (as the `code` property on the request) to this flow.",[i.authCodeOrNativeAccountIdRequired]:"An authorization code or nativeAccountId must be provided to this flow.",[i.spaCodeAndNativeAccountIdPresent]:"Request cannot contain both spa code and native account id.",[i.databaseUnavailable]:"IndexedDB, which is required for persistent cryptographic key storage, is unavailable. This may be caused by browser privacy features which block persistent storage in third-party contexts.",[i.unableToAcquireTokenFromNativePlatform]:`Unable to acquire token from native platform.  ${a}`,[i.nativeHandshakeTimeout]:"Timed out while attempting to establish connection to browser extension",[i.nativeExtensionNotInstalled]:"Native extension is not installed. If you think this is a mistake call the initialize function.",[i.nativeConnectionNotEstablished]:`Connection to native platform has not been established. Please install a compatible browser extension and run initialize().  ${a}`,[i.uninitializedPublicClientApplication]:`You must call and await the initialize function before attempting to call any other MSAL API.  ${a}`,[i.nativePromptNotSupported]:"The provided prompt is not supported by the native platform. This request should be routed to the web based flow.",[i.invalidBase64String]:"Invalid base64 encoded string.",[i.invalidPopTokenRequest]:"Invalid PoP token request. The request should not have both a popKid value and signPopToken set to true.",[i.failedToBuildHeaders]:"Failed to build request headers object.",[i.failedToParseHeaders]:"Failed to parse response headers",[i.failedToDecryptEarResponse]:"Failed to decrypt ear response",[i.timedOut]:"The request timed out."};i.pkceNotCreated,s[i.pkceNotCreated],i.cryptoNonExistent,s[i.cryptoNonExistent],i.emptyNavigateUri,s[i.emptyNavigateUri],i.hashEmptyError,s[i.hashEmptyError],i.noStateInHash,s[i.noStateInHash],i.hashDoesNotContainKnownProperties,s[i.hashDoesNotContainKnownProperties],i.unableToParseState,s[i.unableToParseState],i.stateInteractionTypeMismatch,s[i.stateInteractionTypeMismatch],i.interactionInProgress,s[i.interactionInProgress],i.popupWindowError,s[i.popupWindowError],i.emptyWindowError,s[i.emptyWindowError],i.userCancelled,s[i.userCancelled],i.monitorPopupTimeout,s[i.monitorPopupTimeout],i.monitorWindowTimeout,s[i.monitorWindowTimeout],i.redirectInIframe,s[i.redirectInIframe],i.blockIframeReload,s[i.blockIframeReload],i.blockNestedPopups,s[i.blockNestedPopups],i.iframeClosedPrematurely,s[i.iframeClosedPrematurely],i.silentLogoutUnsupported,s[i.silentLogoutUnsupported],i.noAccountError,s[i.noAccountError],i.silentPromptValueError,s[i.silentPromptValueError],i.noTokenRequestCacheError,s[i.noTokenRequestCacheError],i.unableToParseTokenRequestCacheError,s[i.unableToParseTokenRequestCacheError],i.authRequestNotSetError,s[i.authRequestNotSetError],i.invalidCacheType,s[i.invalidCacheType],i.nonBrowserEnvironment,s[i.nonBrowserEnvironment],i.databaseNotOpen,s[i.databaseNotOpen],i.noNetworkConnectivity,s[i.noNetworkConnectivity],i.postRequestFailed,s[i.postRequestFailed],i.getRequestFailed,s[i.getRequestFailed],i.failedToParseResponse,s[i.failedToParseResponse],i.unableToLoadToken,s[i.unableToLoadToken],i.cryptoKeyNotFound,s[i.cryptoKeyNotFound],i.authCodeRequired,s[i.authCodeRequired],i.authCodeOrNativeAccountIdRequired,s[i.authCodeOrNativeAccountIdRequired],i.spaCodeAndNativeAccountIdPresent,s[i.spaCodeAndNativeAccountIdPresent],i.databaseUnavailable,s[i.databaseUnavailable],i.unableToAcquireTokenFromNativePlatform,s[i.unableToAcquireTokenFromNativePlatform],i.nativeHandshakeTimeout,s[i.nativeHandshakeTimeout],i.nativeExtensionNotInstalled,s[i.nativeExtensionNotInstalled],i.nativeConnectionNotEstablished,s[i.nativeConnectionNotEstablished],i.uninitializedPublicClientApplication,s[i.uninitializedPublicClientApplication],i.nativePromptNotSupported,s[i.nativePromptNotSupported],i.invalidBase64String,s[i.invalidBase64String],i.invalidPopTokenRequest,s[i.invalidPopTokenRequest];class c extends n.AuthError{constructor(e,t){super(e,s[e],t),Object.setPrototypeOf(this,c.prototype),this.name="BrowserAuthError"}}function l(e,t){return new c(e,t)}}),i("4pKco",function(t,r){e(t.exports,"pkceNotCreated",()=>n),e(t.exports,"earJwkEmpty",()=>o),e(t.exports,"earJweEmpty",()=>i),e(t.exports,"cryptoNonExistent",()=>a),e(t.exports,"emptyNavigateUri",()=>s),e(t.exports,"hashEmptyError",()=>c),e(t.exports,"noStateInHash",()=>l),e(t.exports,"hashDoesNotContainKnownProperties",()=>d),e(t.exports,"unableToParseState",()=>h),e(t.exports,"stateInteractionTypeMismatch",()=>u),e(t.exports,"interactionInProgress",()=>p),e(t.exports,"popupWindowError",()=>g),e(t.exports,"emptyWindowError",()=>m),e(t.exports,"userCancelled",()=>C),e(t.exports,"monitorPopupTimeout",()=>f),e(t.exports,"monitorWindowTimeout",()=>y),e(t.exports,"redirectInIframe",()=>A),e(t.exports,"blockIframeReload",()=>E),e(t.exports,"blockNestedPopups",()=>v),e(t.exports,"iframeClosedPrematurely",()=>T),e(t.exports,"silentLogoutUnsupported",()=>I),e(t.exports,"noAccountError",()=>w),e(t.exports,"silentPromptValueError",()=>S),e(t.exports,"noTokenRequestCacheError",()=>k),e(t.exports,"unableToParseTokenRequestCacheError",()=>R),e(t.exports,"authRequestNotSetError",()=>_),e(t.exports,"invalidCacheType",()=>P),e(t.exports,"nonBrowserEnvironment",()=>b),e(t.exports,"databaseNotOpen",()=>N),e(t.exports,"noNetworkConnectivity",()=>O),e(t.exports,"postRequestFailed",()=>M),e(t.exports,"getRequestFailed",()=>x),e(t.exports,"failedToParseResponse",()=>U),e(t.exports,"unableToLoadToken",()=>D),e(t.exports,"cryptoKeyNotFound",()=>q),e(t.exports,"authCodeRequired",()=>L),e(t.exports,"authCodeOrNativeAccountIdRequired",()=>H),e(t.exports,"spaCodeAndNativeAccountIdPresent",()=>B),e(t.exports,"databaseUnavailable",()=>F),e(t.exports,"unableToAcquireTokenFromNativePlatform",()=>K),e(t.exports,"nativeHandshakeTimeout",()=>G),e(t.exports,"nativeExtensionNotInstalled",()=>z),e(t.exports,"nativeConnectionNotEstablished",()=>V),e(t.exports,"uninitializedPublicClientApplication",()=>Q),e(t.exports,"nativePromptNotSupported",()=>j),e(t.exports,"invalidBase64String",()=>$),e(t.exports,"invalidPopTokenRequest",()=>W),e(t.exports,"failedToBuildHeaders",()=>Y),e(t.exports,"failedToParseHeaders",()=>J),e(t.exports,"failedToDecryptEarResponse",()=>X),e(t.exports,"timedOut",()=>Z);let n="pkce_not_created",o="ear_jwk_empty",i="ear_jwe_empty",a="crypto_nonexistent",s="empty_navigate_uri",c="hash_empty_error",l="no_state_in_hash",d="hash_does_not_contain_known_properties",h="unable_to_parse_state",u="state_interaction_type_mismatch",p="interaction_in_progress",g="popup_window_error",m="empty_window_error",C="user_cancelled",f="monitor_popup_timeout",y="monitor_window_timeout",A="redirect_in_iframe",E="block_iframe_reload",v="block_nested_popups",T="iframe_closed_prematurely",I="silent_logout_unsupported",w="no_account_error",S="silent_prompt_value_error",k="no_token_request_cache_error",R="unable_to_parse_token_request_cache_error",_="auth_request_not_set_error",P="invalid_cache_type",b="non_browser_environment",N="database_not_open",O="no_network_connectivity",M="post_request_failed",x="get_request_failed",U="failed_to_parse_response",D="unable_to_load_token",q="crypto_key_not_found",L="auth_code_required",H="auth_code_or_nativeAccountId_required",B="spa_code_and_nativeAccountId_present",F="database_unavailable",K="unable_to_acquire_token_from_native_platform",G="native_handshake_timeout",z="native_extension_not_installed",V="native_connection_not_established",Q="uninitialized_public_client_application",j="native_prompt_not_supported",$="invalid_base64_string",W="invalid_pop_token_request",Y="failed_to_build_headers",J="failed_to_parse_headers",X="failed_to_decrypt_ear_response",Z="timed_out"}),i("elxln",function(t,r){e(t.exports,"FetchClient",()=>c);var n=o("2ilqe"),i=o("6HXlN"),a=o("dp0vd"),s=o("4pKco");class c{async sendGetRequestAsync(e,t){let r,o={},c=0,h=l(t);try{r=await fetch(e,{method:a.HTTP_REQUEST_TYPE.GET,headers:h})}catch(e){throw(0,n.createNetworkError)((0,i.createBrowserAuthError)(window.navigator.onLine?s.getRequestFailed:s.noNetworkConnectivity),void 0,void 0,e)}o=d(r.headers);try{return c=r.status,{headers:o,body:await r.json(),status:c}}catch(e){throw(0,n.createNetworkError)((0,i.createBrowserAuthError)(s.failedToParseResponse),c,o,e)}}async sendPostRequestAsync(e,t){let r,o=t&&t.body||"",c=l(t),h=0,u={};try{r=await fetch(e,{method:a.HTTP_REQUEST_TYPE.POST,headers:c,body:o})}catch(e){throw(0,n.createNetworkError)((0,i.createBrowserAuthError)(window.navigator.onLine?s.postRequestFailed:s.noNetworkConnectivity),void 0,void 0,e)}u=d(r.headers);try{return h=r.status,{headers:u,body:await r.json(),status:h}}catch(e){throw(0,n.createNetworkError)((0,i.createBrowserAuthError)(s.failedToParseResponse),h,u,e)}}}function l(e){try{let t=new Headers;if(!(e&&e.headers))return t;let r=e.headers;return Object.entries(r).forEach(([e,r])=>{t.append(e,r)}),t}catch(e){throw(0,n.createNetworkError)((0,i.createBrowserAuthError)(s.failedToBuildHeaders),void 0,void 0,e)}}function d(e){try{let t={};return e.forEach((e,r)=>{t[r]=e}),t}catch(e){throw(0,i.createBrowserAuthError)(s.failedToParseHeaders)}}}),i("2ilqe",function(t,r){e(t.exports,"NetworkError",()=>i),e(t.exports,"createNetworkError",()=>a);var n=o("ckDmJ");class i extends n.AuthError{constructor(e,t,r){super(e.errorCode,e.errorMessage,e.subError),Object.setPrototypeOf(this,i.prototype),this.name="NetworkError",this.error=e,this.httpStatus=t,this.responseHeaders=r}}function a(e,t,r,n){return e.errorMessage=`${e.errorMessage}, additionalErrorInfo: error.name:${n?.name}, error.message:${n?.message}`,new i(e,t,r)}}),i("5S1XQ",function(t,r){e(t.exports,"clearHash",()=>u),e(t.exports,"replaceHash",()=>p),e(t.exports,"isInIframe",()=>g),e(t.exports,"getCurrentUri",()=>m),e(t.exports,"getHomepage",()=>C),e(t.exports,"blockNonBrowserEnvironment",()=>f),e(t.exports,"blockAPICallsBeforeInitialize",()=>y),e(t.exports,"preflightCheck",()=>A),e(t.exports,"redirectPreflightCheck",()=>E),e(t.exports,"preconnect",()=>v),e(t.exports,"createGuid",()=>T);var n=o("cnNuz"),i=o("gkKSO"),a=o("6HXlN"),s=o("dp0vd"),c=o("7oR2q"),l=o("3sRdd"),d=o("4pKco"),h=o("4Zp7P");function u(e){e.location.hash="","function"==typeof e.history.replaceState&&e.history.replaceState(null,"",`${e.location.origin}${e.location.pathname}${e.location.search}`)}function p(e){let t=e.split("#");t.shift(),window.location.hash=t.length>0?t.join("#"):""}function g(){return window.parent!==window}function m(){return"undefined"!=typeof window&&window.location?window.location.href.split("?")[0].split("#")[0]:""}function C(){let e=new(0,i.UrlString)(window.location.href).getUrlComponents();return`${e.Protocol}//${e.HostNameAndPort}/`}function f(){if("undefined"==typeof window)throw(0,a.createBrowserAuthError)(d.nonBrowserEnvironment)}function y(e){if(!e)throw(0,a.createBrowserAuthError)(d.uninitializedPublicClientApplication)}function A(e){if(f(),i.UrlString.hashContainsKnownProperties(window.location.hash)&&g())throw(0,a.createBrowserAuthError)(d.blockIframeReload);if("undefined"!=typeof window&&window.opener&&window.opener!==window&&"string"==typeof window.name&&0===window.name.indexOf(`${s.BrowserConstants.POPUP_NAME_PREFIX}.`))throw(0,a.createBrowserAuthError)(d.blockNestedPopups);y(e)}function E(e,t){A(e);var r=t.system.allowRedirectInIframe;if(g()&&!r)throw(0,a.createBrowserAuthError)(d.redirectInIframe);if(t.cache.cacheLocation===s.BrowserCacheLocation.MemoryStorage&&!t.cache.storeAuthStateInCookie)throw(0,l.createBrowserConfigurationAuthError)(h.inMemRedirectUnavailable)}function v(e){let t=document.createElement("link");t.rel="preconnect",t.href=new URL(e).origin,t.crossOrigin="anonymous",document.head.appendChild(t),window.setTimeout(()=>{try{document.head.removeChild(t)}catch{}},1e4)}function T(){return(0,c.createNewGuid)()}n.addClientCapabilitiesToClaims}),i("cnNuz",function(t,r){e(t.exports,"instrumentBrokerParams",()=>l),e(t.exports,"addResponseType",()=>d),e(t.exports,"addResponseMode",()=>h),e(t.exports,"addNativeBroker",()=>u),e(t.exports,"addScopes",()=>p),e(t.exports,"addClientId",()=>g),e(t.exports,"addRedirectUri",()=>m),e(t.exports,"addPostLogoutRedirectUri",()=>C),e(t.exports,"addIdTokenHint",()=>f),e(t.exports,"addDomainHint",()=>y),e(t.exports,"addLoginHint",()=>A),e(t.exports,"addCcsUpn",()=>E),e(t.exports,"addCcsOid",()=>v),e(t.exports,"addSid",()=>T),e(t.exports,"addClaims",()=>I),e(t.exports,"addClientCapabilitiesToClaims",()=>z),e(t.exports,"addCorrelationId",()=>w),e(t.exports,"addLibraryInfo",()=>S),e(t.exports,"addApplicationTelemetry",()=>k),e(t.exports,"addPrompt",()=>R),e(t.exports,"addState",()=>_),e(t.exports,"addNonce",()=>P),e(t.exports,"addCodeChallengeParams",()=>b),e(t.exports,"addAuthorizationCode",()=>N),e(t.exports,"addDeviceCode",()=>O),e(t.exports,"addRefreshToken",()=>M),e(t.exports,"addCodeVerifier",()=>x),e(t.exports,"addClientSecret",()=>U),e(t.exports,"addClientAssertion",()=>D),e(t.exports,"addClientAssertionType",()=>q),e(t.exports,"addOboAssertion",()=>L),e(t.exports,"addRequestTokenUse",()=>H),e(t.exports,"addGrantType",()=>B),e(t.exports,"addClientInfo",()=>F),e(t.exports,"addInstanceAware",()=>K),e(t.exports,"addExtraQueryParameters",()=>G),e(t.exports,"addUsername",()=>V),e(t.exports,"addPassword",()=>Q),e(t.exports,"addPopToken",()=>j),e(t.exports,"addSshJwk",()=>$),e(t.exports,"addServerTelemetry",()=>W),e(t.exports,"addThrottling",()=>Y),e(t.exports,"addLogoutHint",()=>J),e(t.exports,"addBrokerParameters",()=>X),e(t.exports,"addEARParameters",()=>Z),e(t.exports,"addPostBodyParameters",()=>ee);var n=o("gmw86"),i=o("1EdUE"),a=o("6GdIx"),s=o("jYvjz"),c=o("cmWPH");function l(e,t,r){if(!t)return;let n=e.get(i.CLIENT_ID);n&&e.has(i.BROKER_CLIENT_ID)&&r?.addFields({embeddedClientId:n,embeddedRedirectUri:e.get(i.REDIRECT_URI)},t)}function d(e,t){e.set(i.RESPONSE_TYPE,t)}function h(e,t){e.set(i.RESPONSE_MODE,t||n.ResponseMode.QUERY)}function u(e){e.set(i.NATIVE_BROKER,"1")}function p(e,t,r=!0,o=n.OIDC_DEFAULT_SCOPES){!r||o.includes("openid")||t.includes("openid")||o.push("openid");let s=r?[...t||[],...o]:t||[],c=new(0,a.ScopeSet)(s);e.set(i.SCOPE,c.printScopes())}function g(e,t){e.set(i.CLIENT_ID,t)}function m(e,t){e.set(i.REDIRECT_URI,t)}function C(e,t){e.set(i.POST_LOGOUT_URI,t)}function f(e,t){e.set(i.ID_TOKEN_HINT,t)}function y(e,t){e.set(i.DOMAIN_HINT,t)}function A(e,t){e.set(i.LOGIN_HINT,t)}function E(e,t){e.set(n.HeaderNames.CCS_HEADER,`UPN:${t}`)}function v(e,t){e.set(n.HeaderNames.CCS_HEADER,`Oid:${t.uid}@${t.utid}`)}function T(e,t){e.set(i.SID,t)}function I(e,t,r){let n=z(t,r);try{JSON.parse(n)}catch(e){throw(0,s.createClientConfigurationError)(c.invalidClaims)}e.set(i.CLAIMS,n)}function w(e,t){e.set(i.CLIENT_REQUEST_ID,t)}function S(e,t){e.set(i.X_CLIENT_SKU,t.sku),e.set(i.X_CLIENT_VER,t.version),t.os&&e.set(i.X_CLIENT_OS,t.os),t.cpu&&e.set(i.X_CLIENT_CPU,t.cpu)}function k(e,t){t?.appName&&e.set(i.X_APP_NAME,t.appName),t?.appVersion&&e.set(i.X_APP_VER,t.appVersion)}function R(e,t){e.set(i.PROMPT,t)}function _(e,t){t&&e.set(i.STATE,t)}function P(e,t){e.set(i.NONCE,t)}function b(e,t,r){if(t&&r)e.set(i.CODE_CHALLENGE,t),e.set(i.CODE_CHALLENGE_METHOD,r);else throw(0,s.createClientConfigurationError)(c.pkceParamsMissing)}function N(e,t){e.set(i.CODE,t)}function O(e,t){e.set(i.DEVICE_CODE,t)}function M(e,t){e.set(i.REFRESH_TOKEN,t)}function x(e,t){e.set(i.CODE_VERIFIER,t)}function U(e,t){e.set(i.CLIENT_SECRET,t)}function D(e,t){t&&e.set(i.CLIENT_ASSERTION,t)}function q(e,t){t&&e.set(i.CLIENT_ASSERTION_TYPE,t)}function L(e,t){e.set(i.OBO_ASSERTION,t)}function H(e,t){e.set(i.REQUESTED_TOKEN_USE,t)}function B(e,t){e.set(i.GRANT_TYPE,t)}function F(e){e.set(n.CLIENT_INFO,"1")}function K(e){e.has(i.INSTANCE_AWARE)||e.set(i.INSTANCE_AWARE,"true")}function G(e,t){Object.entries(t).forEach(([t,r])=>{!e.has(t)&&r&&e.set(t,r)})}function z(e,t){let r;if(e)try{r=JSON.parse(e)}catch(e){throw(0,s.createClientConfigurationError)(c.invalidClaims)}else r={};return t&&t.length>0&&(r.hasOwnProperty(n.ClaimsRequestKeys.ACCESS_TOKEN)||(r[n.ClaimsRequestKeys.ACCESS_TOKEN]={}),r[n.ClaimsRequestKeys.ACCESS_TOKEN][n.ClaimsRequestKeys.XMS_CC]={values:t}),JSON.stringify(r)}function V(e,t){e.set(n.PasswordGrantConstants.username,t)}function Q(e,t){e.set(n.PasswordGrantConstants.password,t)}function j(e,t){t&&(e.set(i.TOKEN_TYPE,n.AuthenticationScheme.POP),e.set(i.REQ_CNF,t))}function $(e,t){t&&(e.set(i.TOKEN_TYPE,n.AuthenticationScheme.SSH),e.set(i.REQ_CNF,t))}function W(e,t){e.set(i.X_CLIENT_CURR_TELEM,t.generateCurrentRequestHeaderValue()),e.set(i.X_CLIENT_LAST_TELEM,t.generateLastRequestHeaderValue())}function Y(e){e.set(i.X_MS_LIB_CAPABILITY,n.ThrottlingConstants.X_MS_LIB_CAPABILITY_VALUE)}function J(e,t){e.set(i.LOGOUT_HINT,t)}function X(e,t,r){e.has(i.BROKER_CLIENT_ID)||e.set(i.BROKER_CLIENT_ID,t),e.has(i.BROKER_REDIRECT_URI)||e.set(i.BROKER_REDIRECT_URI,r)}function Z(e,t){e.set(i.EAR_JWK,encodeURIComponent(t)),e.set(i.EAR_JWE_CRYPTO,"eyJhbGciOiJkaXIiLCJlbmMiOiJBMjU2R0NNIn0")}function ee(e,t){Object.entries(t).forEach(([t,r])=>{r&&e.set(t,r)})}}),i("1EdUE",function(t,r){e(t.exports,"CLIENT_ID",()=>n),e(t.exports,"REDIRECT_URI",()=>o),e(t.exports,"RESPONSE_TYPE",()=>i),e(t.exports,"RESPONSE_MODE",()=>a),e(t.exports,"GRANT_TYPE",()=>s),e(t.exports,"CLAIMS",()=>c),e(t.exports,"SCOPE",()=>l),e(t.exports,"ERROR",()=>d),e(t.exports,"ERROR_DESCRIPTION",()=>h),e(t.exports,"ACCESS_TOKEN",()=>u),e(t.exports,"ID_TOKEN",()=>p),e(t.exports,"REFRESH_TOKEN",()=>g),e(t.exports,"EXPIRES_IN",()=>m),e(t.exports,"REFRESH_TOKEN_EXPIRES_IN",()=>C),e(t.exports,"STATE",()=>f),e(t.exports,"NONCE",()=>y),e(t.exports,"PROMPT",()=>A),e(t.exports,"SESSION_STATE",()=>E),e(t.exports,"CLIENT_INFO",()=>v),e(t.exports,"CODE",()=>T),e(t.exports,"CODE_CHALLENGE",()=>I),e(t.exports,"CODE_CHALLENGE_METHOD",()=>w),e(t.exports,"CODE_VERIFIER",()=>S),e(t.exports,"CLIENT_REQUEST_ID",()=>k),e(t.exports,"X_CLIENT_SKU",()=>R),e(t.exports,"X_CLIENT_VER",()=>_),e(t.exports,"X_CLIENT_OS",()=>P),e(t.exports,"X_CLIENT_CPU",()=>b),e(t.exports,"X_CLIENT_CURR_TELEM",()=>N),e(t.exports,"X_CLIENT_LAST_TELEM",()=>O),e(t.exports,"X_MS_LIB_CAPABILITY",()=>M),e(t.exports,"X_APP_NAME",()=>x),e(t.exports,"X_APP_VER",()=>U),e(t.exports,"POST_LOGOUT_URI",()=>D),e(t.exports,"ID_TOKEN_HINT",()=>q),e(t.exports,"DEVICE_CODE",()=>L),e(t.exports,"CLIENT_SECRET",()=>H),e(t.exports,"CLIENT_ASSERTION",()=>B),e(t.exports,"CLIENT_ASSERTION_TYPE",()=>F),e(t.exports,"TOKEN_TYPE",()=>K),e(t.exports,"REQ_CNF",()=>G),e(t.exports,"OBO_ASSERTION",()=>z),e(t.exports,"REQUESTED_TOKEN_USE",()=>V),e(t.exports,"ON_BEHALF_OF",()=>Q),e(t.exports,"FOCI",()=>j),e(t.exports,"CCS_HEADER",()=>$),e(t.exports,"RETURN_SPA_CODE",()=>W),e(t.exports,"NATIVE_BROKER",()=>Y),e(t.exports,"LOGOUT_HINT",()=>J),e(t.exports,"SID",()=>X),e(t.exports,"LOGIN_HINT",()=>Z),e(t.exports,"DOMAIN_HINT",()=>ee),e(t.exports,"X_CLIENT_EXTRA_SKU",()=>et),e(t.exports,"BROKER_CLIENT_ID",()=>er),e(t.exports,"BROKER_REDIRECT_URI",()=>en),e(t.exports,"INSTANCE_AWARE",()=>eo),e(t.exports,"EAR_JWK",()=>ei),e(t.exports,"EAR_JWE_CRYPTO",()=>ea);let n="client_id",o="redirect_uri",i="response_type",a="response_mode",s="grant_type",c="claims",l="scope",d="error",h="error_description",u="access_token",p="id_token",g="refresh_token",m="expires_in",C="refresh_token_expires_in",f="state",y="nonce",A="prompt",E="session_state",v="client_info",T="code",I="code_challenge",w="code_challenge_method",S="code_verifier",k="client-request-id",R="x-client-SKU",_="x-client-VER",P="x-client-OS",b="x-client-CPU",N="x-client-current-telemetry",O="x-client-last-telemetry",M="x-ms-lib-capability",x="x-app-name",U="x-app-ver",D="post_logout_redirect_uri",q="id_token_hint",L="device_code",H="client_secret",B="client_assertion",F="client_assertion_type",K="token_type",G="req_cnf",z="assertion",V="requested_token_use",Q="on_behalf_of",j="foci",$="X-AnchorMailbox",W="return_spa_code",Y="nativebroker",J="logout_hint",X="sid",Z="login_hint",ee="domain_hint",et="x-client-xtra-sku",er="brk_client_id",en="brk_redirect_uri",eo="instance_aware",ei="ear_jwk",ea="ear_jwe_crypto"}),i("7oR2q",function(t,r){e(t.exports,"validateCryptoAvailable",()=>A),e(t.exports,"sha256Digest",()=>E),e(t.exports,"getRandomValues",()=>v),e(t.exports,"createNewGuid",()=>I),e(t.exports,"generateKeyPair",()=>w),e(t.exports,"exportJwk",()=>S),e(t.exports,"importJwk",()=>k),e(t.exports,"sign",()=>R),e(t.exports,"generateEarKey",()=>_),e(t.exports,"generateBaseKey",()=>N),e(t.exports,"decryptEarResponse",()=>b),e(t.exports,"generateHKDF",()=>O),e(t.exports,"encrypt",()=>x),e(t.exports,"decrypt",()=>U),e(t.exports,"hashString",()=>D);var n=o("6HXlN"),i=o("gnfKd"),a=o("dp0vd"),s=o("7e5V2"),c=o("cx3ku"),l=o("4pKco");let d="AES-GCM",h="HKDF",u="SHA-256",p=new Uint8Array([1,0,1]),g="0123456789abcdef",m=new Uint32Array(1),C="encrypt",f="decrypt",y={name:"RSASSA-PKCS1-v1_5",hash:u,modulusLength:2048,publicExponent:p};function A(e){if(!window)throw(0,n.createBrowserAuthError)(l.nonBrowserEnvironment);if(!window.crypto)throw(0,n.createBrowserAuthError)(l.cryptoNonExistent);if(!e&&!window.crypto.subtle)throw(0,n.createBrowserAuthError)(l.cryptoNonExistent,"crypto_subtle_undefined")}async function E(e,t,r){t?.addQueueMeasurement(i.PerformanceEvents.Sha256Digest,r);let n=new TextEncoder().encode(e);return window.crypto.subtle.digest(u,n)}function v(e){return window.crypto.getRandomValues(e)}function T(){return window.crypto.getRandomValues(m),m[0]}function I(){let e=Date.now(),t=1024*T()+(1023&T()),r=new Uint8Array(16),n=Math.trunc(t/0x40000000),o=t&0x40000000-1,i=T();r[0]=e/0x10000000000,r[1]=e/0x100000000,r[2]=e/0x1000000,r[3]=e/65536,r[4]=e/256,r[5]=e,r[6]=112|n>>>8,r[7]=n,r[8]=128|o>>>24,r[9]=o>>>16,r[10]=o>>>8,r[11]=o,r[12]=i>>>24,r[13]=i>>>16,r[14]=i>>>8,r[15]=i;let a="";for(let e=0;e<r.length;e++)a+=g.charAt(r[e]>>>4),a+=g.charAt(15&r[e]),(3===e||5===e||7===e||9===e)&&(a+="-");return a}async function w(e,t){return window.crypto.subtle.generateKey(y,e,t)}async function S(e){return window.crypto.subtle.exportKey(a.KEY_FORMAT_JWK,e)}async function k(e,t,r){return window.crypto.subtle.importKey(a.KEY_FORMAT_JWK,e,y,t,r)}async function R(e,t){return window.crypto.subtle.sign(y,e,t)}async function _(){let e=await N(),t=(0,s.urlEncodeArr)(new Uint8Array(e));return(0,s.base64Encode)(JSON.stringify({alg:"dir",kty:"oct",k:t}))}async function P(e){let t=JSON.parse((0,c.base64Decode)(e)).k,r=(0,c.base64DecToArr)(t);return window.crypto.subtle.importKey("raw",r,d,!1,[f])}async function b(e,t){let r=t.split(".");if(5!==r.length)throw(0,n.createBrowserAuthError)(l.failedToDecryptEarResponse,"jwe_length");let o=await P(e).catch(()=>{throw(0,n.createBrowserAuthError)(l.failedToDecryptEarResponse,"import_key")});try{let e=new TextEncoder().encode(r[0]),t=(0,c.base64DecToArr)(r[2]),n=(0,c.base64DecToArr)(r[3]),i=(0,c.base64DecToArr)(r[4]),a=8*i.byteLength,s=new Uint8Array(n.length+i.length);s.set(n),s.set(i,n.length);let l=await window.crypto.subtle.decrypt({name:d,iv:t,tagLength:a,additionalData:e},o,s);return new TextDecoder().decode(l)}catch(e){throw(0,n.createBrowserAuthError)(l.failedToDecryptEarResponse,"decrypt")}}async function N(){let e=await window.crypto.subtle.generateKey({name:d,length:256},!0,[C,f]);return window.crypto.subtle.exportKey("raw",e)}async function O(e){return window.crypto.subtle.importKey("raw",e,h,!1,["deriveKey"])}async function M(e,t,r){return window.crypto.subtle.deriveKey({name:h,salt:t,hash:u,info:new TextEncoder().encode(r)},e,{name:d,length:256},!1,[C,f])}async function x(e,t,r){let n=new TextEncoder().encode(t),o=window.crypto.getRandomValues(new Uint8Array(16)),i=await M(e,o,r),a=await window.crypto.subtle.encrypt({name:d,iv:new Uint8Array(12)},i,n);return{data:(0,s.urlEncodeArr)(new Uint8Array(a)),nonce:(0,s.urlEncodeArr)(o)}}async function U(e,t,r,n){let o=(0,c.base64DecToArr)(n),i=await M(e,(0,c.base64DecToArr)(t),r),a=await window.crypto.subtle.decrypt({name:d,iv:new Uint8Array(12)},i,o);return new TextDecoder().decode(a)}async function D(e){let t=new Uint8Array(await E(e));return(0,s.urlEncodeArr)(t)}}),i("7e5V2",function(t,r){function n(e){return encodeURIComponent(i(e).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"))}function o(e){return a(e).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function i(e){return a(new TextEncoder().encode(e))}function a(e){return btoa(Array.from(e,e=>String.fromCodePoint(e)).join(""))}e(t.exports,"urlEncode",()=>n),e(t.exports,"base64Encode",()=>i),e(t.exports,"urlEncodeArr",()=>o)}),i("cx3ku",function(t,r){e(t.exports,"base64Decode",()=>a),e(t.exports,"base64DecToArr",()=>s);var n=o("6HXlN"),i=o("4pKco");function a(e){return new TextDecoder().decode(s(e))}function s(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw(0,n.createBrowserAuthError)(i.invalidBase64String)}let r=atob(t);return Uint8Array.from(r,e=>e.codePointAt(0)||0)}}),i("3sRdd",function(t,r){e(t.exports,"createBrowserConfigurationAuthError",()=>c);var n=o("ckDmJ"),i=o("4Zp7P");let a={[i.storageNotSupported]:"Given storage configuration option was not supported.",[i.stubbedPublicClientApplicationCalled]:"Stub instance of Public Client Application was called. If using msal-react, please ensure context is not used without a provider. For more visit: aka.ms/msaljs/browser-errors",[i.inMemRedirectUnavailable]:"Redirect cannot be supported. In-memory storage was selected and storeAuthStateInCookie=false, which would cause the library to be unable to handle the incoming hash. If you would like to use the redirect API, please use session/localStorage or set storeAuthStateInCookie=true."};i.storageNotSupported,a[i.storageNotSupported],i.stubbedPublicClientApplicationCalled,a[i.stubbedPublicClientApplicationCalled],i.inMemRedirectUnavailable,a[i.inMemRedirectUnavailable];class s extends n.AuthError{constructor(e,t){super(e,t),this.name="BrowserConfigurationAuthError",Object.setPrototypeOf(this,s.prototype)}}function c(e){return new s(e,a[e])}}),i("4Zp7P",function(t,r){e(t.exports,"storageNotSupported",()=>n),e(t.exports,"stubbedPublicClientApplicationCalled",()=>o),e(t.exports,"inMemRedirectUnavailable",()=>i);let n="storage_not_supported",o="stubbed_public_client_application_called",i="in_mem_redirect_unavailable"}),i("2QnKr",function(t,r){e(t.exports,"name",()=>n),e(t.exports,"version",()=>o);let n="@azure/msal-browser",o="4.26.0"}),i("2wtIk",function(t,r){e(t.exports,"PREFIX",()=>n),e(t.exports,"CACHE_KEY_SEPARATOR",()=>i),e(t.exports,"CREDENTIAL_SCHEMA_VERSION",()=>a),e(t.exports,"ACCOUNT_SCHEMA_VERSION",()=>s),e(t.exports,"LOG_LEVEL_CACHE_KEY",()=>c),e(t.exports,"LOG_PII_CACHE_KEY",()=>l),e(t.exports,"PLATFORM_AUTH_DOM_SUPPORT",()=>d),e(t.exports,"VERSION_CACHE_KEY",()=>h),e(t.exports,"getAccountKeysCacheKey",()=>g),e(t.exports,"getTokenKeysCacheKey",()=>m);let n="msal",o="browser",i="|",a=2,s=2,c=`${n}.${o}.log.level`,l=`${n}.${o}.log.pii`,d=`${n}.${o}.platform.auth.dom`,h=`${n}.version`,u="account.keys",p="token.keys";function g(e=s){return e<1?`${n}.${u}`:`${n}.${e}.${u}`}function m(e,t=a){return t<1?`${n}.${p}.${e}`:`${n}.${t}.${p}.${e}`}}),i("kDILX",function(t,r){e(t.exports,"BridgeProxy",()=>c);var n=o("6NbbE"),i=o("7oR2q"),a=o("dp0vd"),s=o("2QnKr");class c{static async initializeNestedAppAuthBridge(){if(void 0===window)throw Error("window is undefined");if(void 0===window.nestedAppAuthBridge)throw Error("window.nestedAppAuthBridge is undefined");try{window.nestedAppAuthBridge.addEventListener("message",e=>{let t="string"==typeof e?e:e.data,r=JSON.parse(t),n=c.bridgeRequests.find(e=>e.requestId===r.requestId);void 0!==n&&(c.bridgeRequests.splice(c.bridgeRequests.indexOf(n),1),r.success?n.resolve(r):n.reject(r.error))});let e=await new Promise((e,t)=>{let r=c.buildRequest("GetInitContext"),n={requestId:r.requestId,method:r.method,resolve:e,reject:t};c.bridgeRequests.push(n),window.nestedAppAuthBridge.postMessage(JSON.stringify(r))});return c.validateBridgeResultOrThrow(e.initContext)}catch(e){throw window.console.log(e),e}}getTokenInteractive(e){return this.getToken("GetTokenPopup",e)}getTokenSilent(e){return this.getToken("GetToken",e)}async getToken(e,t){let r=await this.sendRequest(e,{tokenParams:t});return{token:c.validateBridgeResultOrThrow(r.token),account:c.validateBridgeResultOrThrow(r.account)}}getHostCapabilities(){return this.capabilities??null}getAccountContext(){return this.accountContext?this.accountContext:null}static buildRequest(e,t){return{messageType:"NestedAppAuthRequest",method:e,requestId:(0,i.createNewGuid)(),sendTime:Date.now(),clientLibrary:a.BrowserConstants.MSAL_SKU,clientLibraryVersion:s.version,...t}}sendRequest(e,t){let r=c.buildRequest(e,t);return new Promise((e,t)=>{let n={requestId:r.requestId,method:r.method,resolve:e,reject:t};c.bridgeRequests.push(n),window.nestedAppAuthBridge.postMessage(JSON.stringify(r))})}static validateBridgeResultOrThrow(e){if(void 0===e)throw{status:n.BridgeStatusCode.NestedAppAuthUnavailable};return e}constructor(e,t,r,n){this.sdkName=e,this.sdkVersion=t,this.accountContext=r,this.capabilities=n}static async create(){let e=await c.initializeNestedAppAuthBridge();return new c(e.sdkName,e.sdkVersion,e.accountContext,e.capabilities)}}c.bridgeRequests=[]}),i("6NbbE",function(t,r){e(t.exports,"BridgeStatusCode",()=>n);let n={UserInteractionRequired:"USER_INTERACTION_REQUIRED",UserCancel:"USER_CANCEL",NoNetwork:"NO_NETWORK",TransientError:"TRANSIENT_ERROR",PersistentError:"PERSISTENT_ERROR",Disabled:"DISABLED",AccountUnavailable:"ACCOUNT_UNAVAILABLE",NestedAppAuthUnavailable:"NESTED_APP_AUTH_UNAVAILABLE"}}),i("apX1A",function(t,r){e(t.exports,"StandardOperatingContext",()=>i);var n=o("6Fz9B");class i extends n.BaseOperatingContext{getModuleName(){return i.MODULE_NAME}getId(){return i.ID}async initialize(){return this.available="undefined"!=typeof window,this.available}}i.MODULE_NAME="",i.ID="StandardOperatingContext"}),i("ar1EH",function(t,r){e(t.exports,"StandardController",()=>F);var n=o("a2Vw9"),i=o("4tMCV"),a=o("ckDmJ"),s=o("eVKB1"),c=o("8xmgF"),l=o("l6ONb"),d=o("gmw86"),h=o("anIdE"),u=o("1OX4r"),p=o("dO1mF"),g=o("dKahV"),m=o("1jH5T"),C=o("9tUvn"),f=o("gnfKd"),y=o("fc6HR"),A=o("cPkCm"),E=o("dp0vd"),v=o("5S1XQ"),T=o("fKG6z"),I=o("6QPkA"),w=o("4Zpbd"),S=o("cx1Eq"),k=o("2rIOI"),R=o("gB1XA"),_=o("jjcbd"),P=o("gzXqV"),b=o("8AToY"),N=o("iUf0j"),O=o("3eqCN"),M=o("6HXlN"),x=o("7oR2q"),U=o("cDkFB"),D=o("lcP17"),q=o("2pUnf"),L=o("5EOT6"),H=o("4pKco");function B(e,t,r){try{(0,v.preflightCheck)(e)}catch(e){throw t.end({success:!1},e,r),e}}class F{constructor(e){this.operatingContext=e,this.isBrowserEnvironment=this.operatingContext.isBrowserEnvironment(),this.config=e.getConfig(),this.initialized=!1,this.logger=this.operatingContext.getLogger(),this.networkClient=this.config.system.networkClient,this.navigationClient=this.config.system.navigationClient,this.redirectResponse=new Map,this.hybridAuthCodeResponses=new Map,this.performanceClient=this.config.telemetry.client,this.browserCrypto=this.isBrowserEnvironment?new(0,n.CryptoOps)(this.logger,this.performanceClient):u.DEFAULT_CRYPTO_IMPLEMENTATION,this.eventHandler=new(0,I.EventHandler)(this.logger),this.browserStorage=this.isBrowserEnvironment?new(0,y.BrowserCacheManager)(this.config.auth.clientId,this.config.cache,this.browserCrypto,this.logger,this.performanceClient,this.eventHandler,(0,c.buildStaticAuthorityOptions)(this.config.auth)):(0,y.DEFAULT_BROWSER_CACHE_MANAGER)(this.config.auth.clientId,this.logger,this.performanceClient,this.eventHandler);let t={cacheLocation:E.BrowserCacheLocation.MemoryStorage,cacheRetentionDays:5,temporaryCacheLocation:E.BrowserCacheLocation.MemoryStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!1,claimsBasedCachingEnabled:!1};this.nativeInternalStorage=new(0,y.BrowserCacheManager)(this.config.auth.clientId,t,this.browserCrypto,this.logger,this.performanceClient,this.eventHandler),this.tokenCache=new(0,_.TokenCache)(this.config,this.browserStorage,this.logger,this.browserCrypto),this.activeSilentTokenRequests=new Map,this.trackPageVisibility=this.trackPageVisibility.bind(this),this.trackPageVisibilityWithMeasurement=this.trackPageVisibilityWithMeasurement.bind(this)}static async createController(e,t){let r=new F(e);return await r.initialize(t),r}trackPageVisibility(e){e&&(this.logger.info("Perf: Visibility change detected"),this.performanceClient.incrementFields({visibilityChangeCount:1},e))}async initialize(e,t){if(this.logger.trace("initialize called"),this.initialized)return void this.logger.info("initialize has already been called, exiting early.");if(!this.isBrowserEnvironment){this.logger.info("in non-browser environment, exiting early."),this.initialized=!0,this.eventHandler.emitEvent(T.EventType.INITIALIZE_END);return}let r=e?.correlationId||this.getRequestCorrelationId(),n=this.config.system.allowPlatformBroker,o=this.performanceClient.startMeasurement(f.PerformanceEvents.InitializeClientApplication,r);if(this.eventHandler.emitEvent(T.EventType.INITIALIZE_START),!t)try{this.logMultipleInstances(o)}catch{}if(await (0,C.invokeAsync)(this.browserStorage.initialize.bind(this.browserStorage),f.PerformanceEvents.InitializeCache,this.logger,this.performanceClient,r)(r),n)try{this.platformAuthProvider=await (0,q.getPlatformAuthProvider)(this.logger,this.performanceClient,r,this.config.system.nativeBrokerHandshakeTimeout)}catch(e){this.logger.verbose(e)}this.config.cache.claimsBasedCachingEnabled||(this.logger.verbose("Claims-based caching is disabled. Clearing the previous cache with claims"),(0,C.invoke)(this.browserStorage.clearTokensAndKeysWithClaims.bind(this.browserStorage),f.PerformanceEvents.ClearTokensAndKeysWithClaims,this.logger,this.performanceClient,r)(r)),this.config.system.asyncPopups&&await this.preGeneratePkceCodes(r),this.initialized=!0,this.eventHandler.emitEvent(T.EventType.INITIALIZE_END),o.end({allowPlatformBroker:n,success:!0})}async handleRedirectPromise(e){if(this.logger.verbose("handleRedirectPromise called"),(0,v.blockAPICallsBeforeInitialize)(this.initialized),this.isBrowserEnvironment){let t=e||"",r=this.redirectResponse.get(t);return void 0===r?(r=this.handleRedirectPromiseInternal(e),this.redirectResponse.set(t,r),this.logger.verbose("handleRedirectPromise has been called for the first time, storing the promise")):this.logger.verbose("handleRedirectPromise has been called previously, returning the result from the first call"),r}return this.logger.verbose("handleRedirectPromise returns null, not browser environment"),null}async handleRedirectPromiseInternal(e){let t,r;if(!this.browserStorage.isInteractionInProgress(!0))return this.logger.info("handleRedirectPromise called but there is no interaction in progress, returning null."),null;if(this.browserStorage.getInteractionInProgress()?.type===E.INTERACTION_TYPE.SIGNOUT)return this.logger.verbose("handleRedirectPromise removing interaction_in_progress flag and returning null after sign-out"),this.browserStorage.setInteractionInProgress(!1),Promise.resolve(null);let n=this.getAllAccounts(),o=this.browserStorage.getCachedNativeRequest(),i=o&&this.platformAuthProvider&&!e;this.eventHandler.emitEvent(T.EventType.HANDLE_REDIRECT_START,E.InteractionType.Redirect);try{if(i&&this.platformAuthProvider){t=this.performanceClient.startMeasurement(f.PerformanceEvents.AcquireTokenRedirect,o?.correlationId||""),this.logger.trace("handleRedirectPromise - acquiring token from native platform"),t.add({isPlatformBrokerRequest:!0});let e=new(0,P.PlatformAuthInteractionClient)(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,E.ApiId.handleRedirectPromise,this.performanceClient,this.platformAuthProvider,o.accountId,this.nativeInternalStorage,o.correlationId);r=(0,C.invokeAsync)(e.handleRedirectPromise.bind(e),f.PerformanceEvents.HandleNativeRedirectPromiseMeasurement,this.logger,this.performanceClient,t.event.correlationId)(this.performanceClient,t.event.correlationId)}else{let[n,o]=this.browserStorage.getCachedRequest(),i=n.correlationId;t=this.performanceClient.startMeasurement(f.PerformanceEvents.AcquireTokenRedirect,i),this.logger.trace("handleRedirectPromise - acquiring token from web flow");let a=this.createRedirectClient(i);r=(0,C.invokeAsync)(a.handleRedirectPromise.bind(a),f.PerformanceEvents.HandleRedirectPromiseMeasurement,this.logger,this.performanceClient,t.event.correlationId)(e,n,o,t)}}catch(e){throw this.browserStorage.resetRequestCache(),e}return r.then(e=>(e?(this.browserStorage.resetRequestCache(),n.length<this.getAllAccounts().length?(this.eventHandler.emitEvent(T.EventType.LOGIN_SUCCESS,E.InteractionType.Redirect,e),this.logger.verbose("handleRedirectResponse returned result, login success")):(this.eventHandler.emitEvent(T.EventType.ACQUIRE_TOKEN_SUCCESS,E.InteractionType.Redirect,e),this.logger.verbose("handleRedirectResponse returned result, acquire token success")),t.end({success:!0},void 0,e.account)):t.event.errorCode?t.end({success:!1},void 0):t.discard(),this.eventHandler.emitEvent(T.EventType.HANDLE_REDIRECT_END,E.InteractionType.Redirect),e)).catch(e=>{throw this.browserStorage.resetRequestCache(),n.length>0?this.eventHandler.emitEvent(T.EventType.ACQUIRE_TOKEN_FAILURE,E.InteractionType.Redirect,null,e):this.eventHandler.emitEvent(T.EventType.LOGIN_FAILURE,E.InteractionType.Redirect,null,e),this.eventHandler.emitEvent(T.EventType.HANDLE_REDIRECT_END,E.InteractionType.Redirect),t.end({success:!1},e),e})}async acquireTokenRedirect(e){let t=this.getRequestCorrelationId(e);this.logger.verbose("acquireTokenRedirect called",t);let r=this.performanceClient.startMeasurement(f.PerformanceEvents.AcquireTokenPreRedirect,t);r.add({scenarioId:e.scenarioId});let n=e.onRedirectNavigate;if(n)e.onRedirectNavigate=t=>{let o="function"==typeof n?n(t):void 0;return r.add({navigateCallbackResult:!1!==o}),r.event=r.end({success:!0},void 0,e.account)||r.event,o};else{let t=this.config.auth.onRedirectNavigate;this.config.auth.onRedirectNavigate=n=>{let o="function"==typeof t?t(n):void 0;return r.add({navigateCallbackResult:!1!==o}),r.event=r.end({success:!0},void 0,e.account)||r.event,o}}let o=this.getAllAccounts().length>0;try{let n;return(0,v.redirectPreflightCheck)(this.initialized,this.config),this.browserStorage.setInteractionInProgress(!0,E.INTERACTION_TYPE.SIGNIN),o?this.eventHandler.emitEvent(T.EventType.ACQUIRE_TOKEN_START,E.InteractionType.Redirect,e):this.eventHandler.emitEvent(T.EventType.LOGIN_START,E.InteractionType.Redirect,e),n=this.platformAuthProvider&&this.canUsePlatformBroker(e)?new(0,P.PlatformAuthInteractionClient)(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,E.ApiId.acquireTokenRedirect,this.performanceClient,this.platformAuthProvider,this.getNativeAccountId(e),this.nativeInternalStorage,t).acquireTokenRedirect(e,r).catch(n=>{if(r.add({brokerErrorName:n.name,brokerErrorCode:n.errorCode}),n instanceof b.NativeAuthError&&(0,b.isFatalNativeAuthError)(n))return this.platformAuthProvider=void 0,this.createRedirectClient(t).acquireToken(e);if(n instanceof g.InteractionRequiredAuthError)return this.logger.verbose("acquireTokenRedirect - Resolving interaction required error thrown by native broker by falling back to web flow"),this.createRedirectClient(t).acquireToken(e);throw n}):this.createRedirectClient(t).acquireToken(e),await n}catch(n){throw this.browserStorage.resetRequestCache(),2===r.event.status?this.performanceClient.startMeasurement(f.PerformanceEvents.AcquireTokenRedirect,t).end({success:!1},n,e.account):r.end({success:!1},n,e.account),o?this.eventHandler.emitEvent(T.EventType.ACQUIRE_TOKEN_FAILURE,E.InteractionType.Redirect,null,n):this.eventHandler.emitEvent(T.EventType.LOGIN_FAILURE,E.InteractionType.Redirect,null,n),n}}acquireTokenPopup(e){let t,r=this.getRequestCorrelationId(e),n=this.performanceClient.startMeasurement(f.PerformanceEvents.AcquireTokenPopup,r);n.add({scenarioId:e.scenarioId});try{this.logger.verbose("acquireTokenPopup called",r),B(this.initialized,n,e.account),this.browserStorage.setInteractionInProgress(!0,E.INTERACTION_TYPE.SIGNIN)}catch(e){return Promise.reject(e)}let o=this.getAllAccounts();o.length>0?this.eventHandler.emitEvent(T.EventType.ACQUIRE_TOKEN_START,E.InteractionType.Popup,e):this.eventHandler.emitEvent(T.EventType.LOGIN_START,E.InteractionType.Popup,e);let i=this.getPreGeneratedPkceCodes(r);return this.canUsePlatformBroker(e)?(n.add({isPlatformBrokerRequest:!0}),t=this.acquireTokenNative({...e,correlationId:r},E.ApiId.acquireTokenPopup).then(e=>(n.end({success:!0},void 0,e.account),e)).catch(t=>{if(n.add({brokerErrorName:t.name,brokerErrorCode:t.errorCode}),t instanceof b.NativeAuthError&&(0,b.isFatalNativeAuthError)(t))return this.platformAuthProvider=void 0,this.createPopupClient(r).acquireToken(e,i);if(t instanceof g.InteractionRequiredAuthError)return this.logger.verbose("acquireTokenPopup - Resolving interaction required error thrown by native broker by falling back to web flow"),this.createPopupClient(r).acquireToken(e,i);throw t})):t=this.createPopupClient(r).acquireToken(e,i),t.then(e=>(o.length<this.getAllAccounts().length?this.eventHandler.emitEvent(T.EventType.LOGIN_SUCCESS,E.InteractionType.Popup,e):this.eventHandler.emitEvent(T.EventType.ACQUIRE_TOKEN_SUCCESS,E.InteractionType.Popup,e),n.end({success:!0,accessTokenSize:e.accessToken.length,idTokenSize:e.idToken.length},void 0,e.account),e)).catch(t=>(o.length>0?this.eventHandler.emitEvent(T.EventType.ACQUIRE_TOKEN_FAILURE,E.InteractionType.Popup,null,t):this.eventHandler.emitEvent(T.EventType.LOGIN_FAILURE,E.InteractionType.Popup,null,t),n.end({success:!1},t,e.account),Promise.reject(t))).finally(async()=>{this.browserStorage.setInteractionInProgress(!1),this.config.system.asyncPopups&&await this.preGeneratePkceCodes(r)})}trackPageVisibilityWithMeasurement(){let e=this.ssoSilentMeasurement||this.acquireTokenByCodeAsyncMeasurement;e&&(this.logger.info("Perf: Visibility change detected in ",e.event.name),e.increment({visibilityChangeCount:1}))}async ssoSilent(e){let t,r=this.getRequestCorrelationId(e),n={...e,prompt:e.prompt,correlationId:r};return this.ssoSilentMeasurement=this.performanceClient.startMeasurement(f.PerformanceEvents.SsoSilent,r),this.ssoSilentMeasurement?.add({scenarioId:e.scenarioId}),B(this.initialized,this.ssoSilentMeasurement,e.account),this.ssoSilentMeasurement?.increment({visibilityChangeCount:0}),document.addEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement),this.logger.verbose("ssoSilent called",r),this.eventHandler.emitEvent(T.EventType.SSO_SILENT_START,E.InteractionType.Silent,n),this.canUsePlatformBroker(n)?(this.ssoSilentMeasurement?.add({isPlatformBrokerRequest:!0}),t=this.acquireTokenNative(n,E.ApiId.ssoSilent).catch(e=>{if(this.ssoSilentMeasurement?.add({brokerErrorName:e.name,brokerErrorCode:e.errorCode}),e instanceof b.NativeAuthError&&(0,b.isFatalNativeAuthError)(e))return this.platformAuthProvider=void 0,this.createSilentIframeClient(n.correlationId).acquireToken(n);throw e})):t=this.createSilentIframeClient(n.correlationId).acquireToken(n),t.then(e=>(this.eventHandler.emitEvent(T.EventType.SSO_SILENT_SUCCESS,E.InteractionType.Silent,e),this.ssoSilentMeasurement?.end({success:!0,accessTokenSize:e.accessToken.length,idTokenSize:e.idToken.length},void 0,e.account),e)).catch(t=>{throw this.eventHandler.emitEvent(T.EventType.SSO_SILENT_FAILURE,E.InteractionType.Silent,null,t),this.ssoSilentMeasurement?.end({success:!1},t,e.account),t}).finally(()=>{document.removeEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement)})}async acquireTokenByCode(e){let t=this.getRequestCorrelationId(e);this.logger.trace("acquireTokenByCode called",t);let r=this.performanceClient.startMeasurement(f.PerformanceEvents.AcquireTokenByCode,t);B(this.initialized,r),this.eventHandler.emitEvent(T.EventType.ACQUIRE_TOKEN_BY_CODE_START,E.InteractionType.Silent,e),r.add({scenarioId:e.scenarioId});try{if(e.code&&e.nativeAccountId)throw(0,M.createBrowserAuthError)(H.spaCodeAndNativeAccountIdPresent);if(e.code){let n=e.code,o=this.hybridAuthCodeResponses.get(n);return o?(this.logger.verbose("Existing acquireTokenByCode request found",t),r.discard()):(this.logger.verbose("Initiating new acquireTokenByCode request",t),o=this.acquireTokenByCodeAsync({...e,correlationId:t}).then(e=>(this.eventHandler.emitEvent(T.EventType.ACQUIRE_TOKEN_BY_CODE_SUCCESS,E.InteractionType.Silent,e),this.hybridAuthCodeResponses.delete(n),r.end({success:!0,accessTokenSize:e.accessToken.length,idTokenSize:e.idToken.length},void 0,e.account),e)).catch(e=>{throw this.hybridAuthCodeResponses.delete(n),this.eventHandler.emitEvent(T.EventType.ACQUIRE_TOKEN_BY_CODE_FAILURE,E.InteractionType.Silent,null,e),r.end({success:!1},e),e}),this.hybridAuthCodeResponses.set(n,o)),await o}if(e.nativeAccountId)if(this.canUsePlatformBroker(e,e.nativeAccountId)){r.add({isPlatformBrokerRequest:!0});let n=await this.acquireTokenNative({...e,correlationId:t},E.ApiId.acquireTokenByCode,e.nativeAccountId).catch(e=>{throw e instanceof b.NativeAuthError&&(0,b.isFatalNativeAuthError)(e)&&(this.platformAuthProvider=void 0),r.add({brokerErrorName:e.name,brokerErrorCode:e.errorCode}),e});return r.end({success:!0},void 0,n.account),n}else throw(0,M.createBrowserAuthError)(H.unableToAcquireTokenFromNativePlatform);else throw(0,M.createBrowserAuthError)(H.authCodeOrNativeAccountIdRequired)}catch(e){throw this.eventHandler.emitEvent(T.EventType.ACQUIRE_TOKEN_BY_CODE_FAILURE,E.InteractionType.Silent,null,e),r.end({success:!1},e),e}}async acquireTokenByCodeAsync(e){this.logger.trace("acquireTokenByCodeAsync called",e.correlationId),this.acquireTokenByCodeAsyncMeasurement=this.performanceClient.startMeasurement(f.PerformanceEvents.AcquireTokenByCodeAsync,e.correlationId),this.acquireTokenByCodeAsyncMeasurement?.increment({visibilityChangeCount:0}),document.addEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement);let t=this.createSilentAuthCodeClient(e.correlationId);return await t.acquireToken(e).then(e=>(this.acquireTokenByCodeAsyncMeasurement?.end({success:!0,fromCache:e.fromCache}),e)).catch(e=>{throw this.acquireTokenByCodeAsyncMeasurement?.end({success:!1},e),e}).finally(()=>{document.removeEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement)})}async acquireTokenFromCache(e,t){switch(this.performanceClient.addQueueMeasurement(f.PerformanceEvents.AcquireTokenFromCache,e.correlationId),t){case E.CacheLookupPolicy.Default:case E.CacheLookupPolicy.AccessToken:case E.CacheLookupPolicy.AccessTokenAndRefreshToken:let r=this.createSilentCacheClient(e.correlationId);return(0,C.invokeAsync)(r.acquireToken.bind(r),f.PerformanceEvents.SilentCacheClientAcquireToken,this.logger,this.performanceClient,e.correlationId)(e);default:throw(0,h.createClientAuthError)(l.tokenRefreshRequired)}}async acquireTokenByRefreshToken(e,t){switch(this.performanceClient.addQueueMeasurement(f.PerformanceEvents.AcquireTokenByRefreshToken,e.correlationId),t){case E.CacheLookupPolicy.Default:case E.CacheLookupPolicy.AccessTokenAndRefreshToken:case E.CacheLookupPolicy.RefreshToken:case E.CacheLookupPolicy.RefreshTokenAndNetwork:let r=this.createSilentRefreshClient(e.correlationId);return(0,C.invokeAsync)(r.acquireToken.bind(r),f.PerformanceEvents.SilentRefreshClientAcquireToken,this.logger,this.performanceClient,e.correlationId)(e);default:throw(0,h.createClientAuthError)(l.tokenRefreshRequired)}}async acquireTokenBySilentIframe(e){this.performanceClient.addQueueMeasurement(f.PerformanceEvents.AcquireTokenBySilentIframe,e.correlationId);let t=this.createSilentIframeClient(e.correlationId);return(0,C.invokeAsync)(t.acquireToken.bind(t),f.PerformanceEvents.SilentIframeClientAcquireToken,this.logger,this.performanceClient,e.correlationId)(e)}async logout(e){let t=this.getRequestCorrelationId(e);return this.logger.warning("logout API is deprecated and will be removed in msal-browser v3.0.0. Use logoutRedirect instead.",t),this.logoutRedirect({correlationId:t,...e})}async logoutRedirect(e){let t=this.getRequestCorrelationId(e);return(0,v.redirectPreflightCheck)(this.initialized,this.config),this.browserStorage.setInteractionInProgress(!0,E.INTERACTION_TYPE.SIGNOUT),this.createRedirectClient(t).logout(e)}logoutPopup(e){try{let t=this.getRequestCorrelationId(e);return(0,v.preflightCheck)(this.initialized),this.browserStorage.setInteractionInProgress(!0,E.INTERACTION_TYPE.SIGNOUT),this.createPopupClient(t).logout(e).finally(()=>{this.browserStorage.setInteractionInProgress(!1)})}catch(e){return Promise.reject(e)}}async clearCache(e){if(!this.isBrowserEnvironment)return void this.logger.info("in non-browser environment, returning early.");let t=this.getRequestCorrelationId(e);return this.createSilentCacheClient(t).logout(e)}getAllAccounts(e){let t=this.getRequestCorrelationId();return(0,A.getAllAccounts)(this.logger,this.browserStorage,this.isBrowserEnvironment,t,e)}getAccount(e){let t=this.getRequestCorrelationId();return(0,A.getAccount)(e,this.logger,this.browserStorage,t)}getAccountByUsername(e){let t=this.getRequestCorrelationId();return(0,A.getAccountByUsername)(e,this.logger,this.browserStorage,t)}getAccountByHomeId(e){let t=this.getRequestCorrelationId();return(0,A.getAccountByHomeId)(e,this.logger,this.browserStorage,t)}getAccountByLocalId(e){let t=this.getRequestCorrelationId();return(0,A.getAccountByLocalId)(e,this.logger,this.browserStorage,t)}setActiveAccount(e){let t=this.getRequestCorrelationId();(0,A.setActiveAccount)(e,this.browserStorage,t)}getActiveAccount(){let e=this.getRequestCorrelationId();return(0,A.getActiveAccount)(this.browserStorage,e)}async hydrateCache(e,t){this.logger.verbose("hydrateCache called");let r=i.AccountEntity.createFromAccountInfo(e.account,e.cloudGraphHostName,e.msGraphHost);return(await this.browserStorage.setAccount(r,e.correlationId,s.isKmsi(e.idTokenClaims)),e.fromNativeBroker)?(this.logger.verbose("Response was from native broker, storing in-memory"),this.nativeInternalStorage.hydrateCache(e,t)):this.browserStorage.hydrateCache(e,t)}async acquireTokenNative(e,t,r,n){if(this.logger.trace("acquireTokenNative called"),!this.platformAuthProvider)throw(0,M.createBrowserAuthError)(H.nativeConnectionNotEstablished);return new(0,P.PlatformAuthInteractionClient)(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,t,this.performanceClient,this.platformAuthProvider,r||this.getNativeAccountId(e),this.nativeInternalStorage,e.correlationId).acquireToken(e,n)}canUsePlatformBroker(e,t){if(this.logger.trace("canUsePlatformBroker called"),!this.platformAuthProvider)return this.logger.trace("canUsePlatformBroker: platform broker unavilable, returning false"),!1;if(!(0,q.isPlatformAuthAllowed)(this.config,this.logger,this.platformAuthProvider,e.authenticationScheme))return this.logger.trace("canUsePlatformBroker: isBrokerAvailable returned false, returning false"),!1;if(e.prompt)switch(e.prompt){case d.PromptValue.NONE:case d.PromptValue.CONSENT:case d.PromptValue.LOGIN:case d.PromptValue.SELECT_ACCOUNT:this.logger.trace("canUsePlatformBroker: prompt is compatible with platform broker flow");break;default:return this.logger.trace(`canUsePlatformBroker: prompt = ${e.prompt} is not compatible with platform broker flow, returning false`),!1}return!!t||!!this.getNativeAccountId(e)||(this.logger.trace("canUsePlatformBroker: nativeAccountId is not available, returning false"),!1)}getNativeAccountId(e){let t=e.account||this.getAccount({loginHint:e.loginHint,sid:e.sid})||this.getActiveAccount();return t&&t.nativeAccountId||""}createPopupClient(e){return new(0,w.PopupClient)(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeInternalStorage,this.platformAuthProvider,e)}createRedirectClient(e){return new(0,S.RedirectClient)(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeInternalStorage,this.platformAuthProvider,e)}createSilentIframeClient(e){return new(0,k.SilentIframeClient)(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,E.ApiId.ssoSilent,this.performanceClient,this.nativeInternalStorage,this.platformAuthProvider,e)}createSilentCacheClient(e){return new(0,N.SilentCacheClient)(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.platformAuthProvider,e)}createSilentRefreshClient(e){return new(0,R.SilentRefreshClient)(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.platformAuthProvider,e)}createSilentAuthCodeClient(e){return new(0,O.SilentAuthCodeClient)(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,E.ApiId.acquireTokenByCode,this.performanceClient,this.platformAuthProvider,e)}addEventCallback(e,t){return this.eventHandler.addEventCallback(e,t)}removeEventCallback(e){this.eventHandler.removeEventCallback(e)}addPerformanceCallback(e){return(0,v.blockNonBrowserEnvironment)(),this.performanceClient.addPerformanceCallback(e)}removePerformanceCallback(e){return this.performanceClient.removePerformanceCallback(e)}enableAccountStorageEvents(){this.config.cache.cacheLocation!==E.BrowserCacheLocation.LocalStorage?this.logger.info("Account storage events are only available when cacheLocation is set to localStorage"):this.eventHandler.subscribeCrossTab()}disableAccountStorageEvents(){this.config.cache.cacheLocation!==E.BrowserCacheLocation.LocalStorage?this.logger.info("Account storage events are only available when cacheLocation is set to localStorage"):this.eventHandler.unsubscribeCrossTab()}getTokenCache(){return this.tokenCache}getLogger(){return this.logger}setLogger(e){this.logger=e}initializeWrapperLibrary(e,t){this.browserStorage.setWrapperMetadata(e,t)}setNavigationClient(e){this.navigationClient=e}getConfiguration(){return this.config}getPerformanceClient(){return this.performanceClient}isBrowserEnv(){return this.isBrowserEnvironment}getRequestCorrelationId(e){return e?.correlationId?e.correlationId:this.isBrowserEnvironment?(0,x.createNewGuid)():d.Constants.EMPTY_STRING}async loginRedirect(e){let t=this.getRequestCorrelationId(e);return this.logger.verbose("loginRedirect called",t),this.acquireTokenRedirect({correlationId:t,...e||E.DEFAULT_REQUEST})}loginPopup(e){let t=this.getRequestCorrelationId(e);return this.logger.verbose("loginPopup called",t),this.acquireTokenPopup({correlationId:t,...e||E.DEFAULT_REQUEST})}async acquireTokenSilent(e){let t=this.getRequestCorrelationId(e),r=this.performanceClient.startMeasurement(f.PerformanceEvents.AcquireTokenSilent,t);r.add({cacheLookupPolicy:e.cacheLookupPolicy,scenarioId:e.scenarioId}),B(this.initialized,r,e.account),this.logger.verbose("acquireTokenSilent called",t);let n=e.account||this.getActiveAccount();if(!n)throw(0,M.createBrowserAuthError)(H.noAccountError);return this.acquireTokenSilentDeduped(e,n,t).then(n=>(r.end({success:!0,fromCache:n.fromCache,accessTokenSize:n.accessToken.length,idTokenSize:n.idToken.length},void 0,n.account),{...n,state:e.state,correlationId:t})).catch(e=>{throw e instanceof a.AuthError&&e.setCorrelationId(t),r.end({success:!1},e,n),e})}async acquireTokenSilentDeduped(e,t,r){let n=JSON.stringify((0,p.getRequestThumbprint)(this.config.auth.clientId,{...e,authority:e.authority||this.config.auth.authority,correlationId:r},t.homeAccountId)),o=this.activeSilentTokenRequests.get(n);if(void 0!==o)return this.logger.verbose("acquireTokenSilent has been called previously, returning the result from the first call",r),this.performanceClient.addFields({deduped:!0},r),o;{this.logger.verbose("acquireTokenSilent called for the first time, storing active request",r),this.performanceClient.addFields({deduped:!1},r);let o=(0,C.invokeAsync)(this.acquireTokenSilentAsync.bind(this),f.PerformanceEvents.AcquireTokenSilentAsync,this.logger,this.performanceClient,r)({...e,correlationId:r},t);return this.activeSilentTokenRequests.set(n,o),o.finally(()=>{this.activeSilentTokenRequests.delete(n)})}}async acquireTokenSilentAsync(e,t){let r=()=>this.trackPageVisibility(e.correlationId);this.performanceClient.addQueueMeasurement(f.PerformanceEvents.AcquireTokenSilentAsync,e.correlationId),this.eventHandler.emitEvent(T.EventType.ACQUIRE_TOKEN_START,E.InteractionType.Silent,e),e.correlationId&&this.performanceClient.incrementFields({visibilityChangeCount:0},e.correlationId),document.addEventListener("visibilitychange",r);let n=await (0,C.invokeAsync)(U.initializeSilentRequest,f.PerformanceEvents.InitializeSilentRequest,this.logger,this.performanceClient,e.correlationId)(e,t,this.config,this.performanceClient,this.logger),o=e.cacheLookupPolicy||E.CacheLookupPolicy.Default;return this.acquireTokenSilentNoIframe(n,o).catch(async e=>{var t,r;let i,a,s,c;if(t=e,r=o,i=!(t instanceof g.InteractionRequiredAuthError&&t.subError!==m.badToken),a=t.errorCode===E.BrowserConstants.INVALID_GRANT_ERROR||t.errorCode===l.tokenRefreshRequired,s=i&&a||t.errorCode===m.noTokensFound||t.errorCode===m.refreshTokenExpired,c=E.iFrameRenewalPolicies.includes(r),s&&c)if(this.activeIframeRequest)if(o===E.CacheLookupPolicy.Skip)return this.logger.warning("Another iframe request is currently in progress and CacheLookupPolicy is set to Skip. This may result in degraded performance and/or reliability for both calls. Please consider changing the CacheLookupPolicy to take advantage of request queuing and token cache.",n.correlationId),(0,C.invokeAsync)(this.acquireTokenBySilentIframe.bind(this),f.PerformanceEvents.AcquireTokenBySilentIframe,this.logger,this.performanceClient,n.correlationId)(n);else{let[t,r]=this.activeIframeRequest;this.logger.verbose(`Iframe request is already in progress, awaiting resolution for request with correlationId: ${r}`,n.correlationId);let i=this.performanceClient.startMeasurement(f.PerformanceEvents.AwaitConcurrentIframe,n.correlationId);i.add({awaitIframeCorrelationId:r});let a=await t;if(i.end({success:a}),a)return this.logger.verbose(`Parallel iframe request with correlationId: ${r} succeeded. Retrying cache and/or RT redemption`,n.correlationId),this.acquireTokenSilentNoIframe(n,o);throw this.logger.info(`Iframe request with correlationId: ${r} failed. Interaction is required.`),e}else{let e;return this.activeIframeRequest=[new Promise(t=>{e=t}),n.correlationId],this.logger.verbose("Refresh token expired/invalid or CacheLookupPolicy is set to Skip, attempting acquire token by iframe.",n.correlationId),(0,C.invokeAsync)(this.acquireTokenBySilentIframe.bind(this),f.PerformanceEvents.AcquireTokenBySilentIframe,this.logger,this.performanceClient,n.correlationId)(n).then(t=>(e(!0),t)).catch(t=>{throw e(!1),t}).finally(()=>{this.activeIframeRequest=void 0})}throw e}).then(t=>(this.eventHandler.emitEvent(T.EventType.ACQUIRE_TOKEN_SUCCESS,E.InteractionType.Silent,t),this.performanceClient.addFields({fromCache:t.fromCache},e.correlationId),t)).catch(e=>{throw this.eventHandler.emitEvent(T.EventType.ACQUIRE_TOKEN_FAILURE,E.InteractionType.Silent,null,e),e}).finally(()=>{document.removeEventListener("visibilitychange",r)})}async acquireTokenSilentNoIframe(e,t){return(0,q.isPlatformAuthAllowed)(this.config,this.logger,this.platformAuthProvider,e.authenticationScheme)&&e.account.nativeAccountId?(this.logger.verbose("acquireTokenSilent - attempting to acquire token from native platform"),this.performanceClient.addFields({isPlatformBrokerRequest:!0},e.correlationId),this.acquireTokenNative(e,E.ApiId.acquireTokenSilent_silentFlow,e.account.nativeAccountId,t).catch(async t=>{if(this.performanceClient.addFields({brokerErrorName:t.name,brokerErrorCode:t.errorCode},e.correlationId),t instanceof b.NativeAuthError&&(0,b.isFatalNativeAuthError)(t))throw this.logger.verbose("acquireTokenSilent - native platform unavailable, falling back to web flow"),this.platformAuthProvider=void 0,(0,h.createClientAuthError)(l.tokenRefreshRequired);throw t})):(this.logger.verbose("acquireTokenSilent - attempting to acquire token from web flow"),t===E.CacheLookupPolicy.AccessToken&&this.logger.verbose("acquireTokenSilent - cache lookup policy set to AccessToken, attempting to acquire token from local cache"),(0,C.invokeAsync)(this.acquireTokenFromCache.bind(this),f.PerformanceEvents.AcquireTokenFromCache,this.logger,this.performanceClient,e.correlationId)(e,t).catch(r=>{if(t===E.CacheLookupPolicy.AccessToken)throw r;return this.eventHandler.emitEvent(T.EventType.ACQUIRE_TOKEN_NETWORK_START,E.InteractionType.Silent,e),(0,C.invokeAsync)(this.acquireTokenByRefreshToken.bind(this),f.PerformanceEvents.AcquireTokenByRefreshToken,this.logger,this.performanceClient,e.correlationId)(e,t)}))}async preGeneratePkceCodes(e){return this.logger.verbose("Generating new PKCE codes"),this.pkceCode=await (0,C.invokeAsync)(D.generatePkceCodes,f.PerformanceEvents.GeneratePkceCodes,this.logger,this.performanceClient,e)(this.performanceClient,this.logger,e),Promise.resolve()}getPreGeneratedPkceCodes(e){this.logger.verbose("Attempting to pick up pre-generated PKCE codes");let t=this.pkceCode?{...this.pkceCode}:void 0;return this.pkceCode=void 0,this.logger.verbose(`${t?"Found":"Did not find"} pre-generated PKCE codes`),this.performanceClient.addFields({usePreGeneratedPkce:!!t},e),t}logMultipleInstances(e){let t=this.config.auth.clientId;window&&(window.msal=window.msal||{},window.msal.clientIds=window.msal.clientIds||[],window.msal.clientIds.length>0&&this.logger.verbose("There is already an instance of MSAL.js in the window."),window.msal.clientIds.push(t),(0,L.collectInstanceStats)(t,e,this.logger))}}}),i("a2Vw9",function(t,r){e(t.exports,"CryptoOps",()=>g);var n=o("l6ONb"),i=o("anIdE"),a=o("ltqhv"),s=o("gnfKd"),c=o("7e5V2"),l=o("cx3ku"),d=o("7oR2q"),h=o("6HXlN"),u=o("eaBRL"),p=o("4pKco");class g{constructor(e,t,r){this.logger=e,(0,d.validateCryptoAvailable)(r??!1),this.cache=new(0,u.AsyncMemoryStorage)(this.logger),this.performanceClient=t}createNewGuid(){return(0,d.createNewGuid)()}base64Encode(e){return(0,c.base64Encode)(e)}base64Decode(e){return(0,l.base64Decode)(e)}base64UrlEncode(e){return(0,c.urlEncode)(e)}encodeKid(e){return this.base64UrlEncode(JSON.stringify({kid:e}))}async getPublicKeyThumbprint(e){let t=this.performanceClient?.startMeasurement(s.PerformanceEvents.CryptoOptsGetPublicKeyThumbprint,e.correlationId),r=await (0,d.generateKeyPair)(g.EXTRACTABLE,g.POP_KEY_USAGES),n=await (0,d.exportJwk)(r.publicKey),o=m({e:n.e,kty:n.kty,n:n.n}),i=await this.hashString(o),a=await (0,d.exportJwk)(r.privateKey),c=await (0,d.importJwk)(a,!1,["sign"]);return await this.cache.setItem(i,{privateKey:c,publicKey:r.publicKey,requestMethod:e.resourceRequestMethod,requestUri:e.resourceRequestUri}),t&&t.end({success:!0}),i}async removeTokenBindingKey(e){if(await this.cache.removeItem(e),await this.cache.containsKey(e))throw(0,i.createClientAuthError)(n.bindingKeyNotRemoved)}async clearKeystore(){this.cache.clearInMemory();try{return await this.cache.clearPersistent(),!0}catch(e){return e instanceof Error?this.logger.error(`Clearing keystore failed with error: ${e.message}`):this.logger.error("Clearing keystore failed with unknown error"),!1}}async signJwt(e,t,r,n){let o=this.performanceClient?.startMeasurement(s.PerformanceEvents.CryptoOptsSignJwt,n),i=await this.cache.getItem(t);if(!i)throw(0,h.createBrowserAuthError)(p.cryptoKeyNotFound);let l=await (0,d.exportJwk)(i.publicKey),u=m(l),g=(0,c.urlEncode)(JSON.stringify({kid:t})),C=a.JoseHeader.getShrHeaderString({...r?.header,alg:l.alg,kid:g}),f=(0,c.urlEncode)(C);e.cnf={jwk:JSON.parse(u)};let y=(0,c.urlEncode)(JSON.stringify(e)),A=`${f}.${y}`,E=new TextEncoder().encode(A),v=await (0,d.sign)(i.privateKey,E),T=(0,c.urlEncodeArr)(new Uint8Array(v)),I=`${A}.${T}`;return o&&o.end({success:!0}),I}async hashString(e){return(0,d.hashString)(e)}}function m(e){return JSON.stringify(e,Object.keys(e).sort())}g.POP_KEY_USAGES=["sign","verify"],g.EXTRACTABLE=!0}),i("ltqhv",function(t,r){e(t.exports,"JoseHeader",()=>s);var n=o("insxD"),i=o("gmw86"),a=o("e9JCU");class s{constructor(e){this.typ=e.typ,this.alg=e.alg,this.kid=e.kid}static getShrHeaderString(e){if(!e.kid)throw(0,n.createJoseHeaderError)(a.missingKidError);if(!e.alg)throw(0,n.createJoseHeaderError)(a.missingAlgError);return JSON.stringify(new s({typ:e.typ||i.JsonWebTokenTypes.Pop,kid:e.kid,alg:e.alg}))}}}),i("insxD",function(t,r){e(t.exports,"createJoseHeaderError",()=>c);var n=o("ckDmJ"),i=o("e9JCU");let a={[i.missingKidError]:"The JOSE Header for the requested JWT, JWS or JWK object requires a keyId to be configured as the 'kid' header claim. No 'kid' value was provided.",[i.missingAlgError]:"The JOSE Header for the requested JWT, JWS or JWK object requires an algorithm to be specified as the 'alg' header claim. No 'alg' value was provided."};class s extends n.AuthError{constructor(e,t){super(e,t),this.name="JoseHeaderError",Object.setPrototypeOf(this,s.prototype)}}function c(e){return new s(e,a[e])}}),i("e9JCU",function(t,r){e(t.exports,"missingKidError",()=>n),e(t.exports,"missingAlgError",()=>o);let n="missing_kid_error",o="missing_alg_error"}),i("eaBRL",function(t,r){e(t.exports,"AsyncMemoryStorage",()=>c);var n=o("6HXlN"),i=o("7zCv5"),a=o("2cRj3"),s=o("4pKco");class c{constructor(e){this.inMemoryCache=new(0,a.MemoryStorage),this.indexedDBCache=new(0,i.DatabaseStorage),this.logger=e}handleDatabaseAccessError(e){if(e instanceof n.BrowserAuthError&&e.errorCode===s.databaseUnavailable)this.logger.error("Could not access persistent storage. This may be caused by browser privacy features which block persistent storage in third-party contexts.");else throw e}async getItem(e){let t=this.inMemoryCache.getItem(e);if(!t)try{return this.logger.verbose("Queried item not found in in-memory cache, now querying persistent storage."),await this.indexedDBCache.getItem(e)}catch(e){this.handleDatabaseAccessError(e)}return t}async setItem(e,t){this.inMemoryCache.setItem(e,t);try{await this.indexedDBCache.setItem(e,t)}catch(e){this.handleDatabaseAccessError(e)}}async removeItem(e){this.inMemoryCache.removeItem(e);try{await this.indexedDBCache.removeItem(e)}catch(e){this.handleDatabaseAccessError(e)}}async getKeys(){let e=this.inMemoryCache.getKeys();if(0===e.length)try{return this.logger.verbose("In-memory cache is empty, now querying persistent storage."),await this.indexedDBCache.getKeys()}catch(e){this.handleDatabaseAccessError(e)}return e}async containsKey(e){let t=this.inMemoryCache.containsKey(e);if(!t)try{return this.logger.verbose("Key not found in in-memory cache, now querying persistent storage."),await this.indexedDBCache.containsKey(e)}catch(e){this.handleDatabaseAccessError(e)}return t}clearInMemory(){this.logger.verbose("Deleting in-memory keystore"),this.inMemoryCache.clear(),this.logger.verbose("In-memory keystore deleted")}async clearPersistent(){try{this.logger.verbose("Deleting persistent keystore");let e=await this.indexedDBCache.deleteDatabase();return e&&this.logger.verbose("Persistent keystore deleted"),e}catch(e){return this.handleDatabaseAccessError(e),!1}}}}),i("7zCv5",function(t,r){e(t.exports,"DatabaseStorage",()=>s);var n=o("6HXlN"),i=o("dp0vd"),a=o("4pKco");class s{constructor(){this.dbName=i.DB_NAME,this.version=i.DB_VERSION,this.tableName=i.DB_TABLE_NAME,this.dbOpen=!1}async open(){return new Promise((e,t)=>{let r=window.indexedDB.open(this.dbName,this.version);r.addEventListener("upgradeneeded",e=>{e.target.result.createObjectStore(this.tableName)}),r.addEventListener("success",t=>{this.db=t.target.result,this.dbOpen=!0,e()}),r.addEventListener("error",()=>t((0,n.createBrowserAuthError)(a.databaseUnavailable)))})}closeConnection(){let e=this.db;e&&this.dbOpen&&(e.close(),this.dbOpen=!1)}async validateDbIsOpen(){if(!this.dbOpen)return this.open()}async getItem(e){return await this.validateDbIsOpen(),new Promise((t,r)=>{if(!this.db)return r((0,n.createBrowserAuthError)(a.databaseNotOpen));let o=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).get(e);o.addEventListener("success",e=>{this.closeConnection(),t(e.target.result)}),o.addEventListener("error",e=>{this.closeConnection(),r(e)})})}async setItem(e,t){return await this.validateDbIsOpen(),new Promise((r,o)=>{if(!this.db)return o((0,n.createBrowserAuthError)(a.databaseNotOpen));let i=this.db.transaction([this.tableName],"readwrite").objectStore(this.tableName).put(t,e);i.addEventListener("success",()=>{this.closeConnection(),r()}),i.addEventListener("error",e=>{this.closeConnection(),o(e)})})}async removeItem(e){return await this.validateDbIsOpen(),new Promise((t,r)=>{if(!this.db)return r((0,n.createBrowserAuthError)(a.databaseNotOpen));let o=this.db.transaction([this.tableName],"readwrite").objectStore(this.tableName).delete(e);o.addEventListener("success",()=>{this.closeConnection(),t()}),o.addEventListener("error",e=>{this.closeConnection(),r(e)})})}async getKeys(){return await this.validateDbIsOpen(),new Promise((e,t)=>{if(!this.db)return t((0,n.createBrowserAuthError)(a.databaseNotOpen));let r=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).getAllKeys();r.addEventListener("success",t=>{this.closeConnection(),e(t.target.result)}),r.addEventListener("error",e=>{this.closeConnection(),t(e)})})}async containsKey(e){return await this.validateDbIsOpen(),new Promise((t,r)=>{if(!this.db)return r((0,n.createBrowserAuthError)(a.databaseNotOpen));let o=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).count(e);o.addEventListener("success",e=>{this.closeConnection(),t(1===e.target.result)}),o.addEventListener("error",e=>{this.closeConnection(),r(e)})})}async deleteDatabase(){return this.db&&this.dbOpen&&this.closeConnection(),new Promise((e,t)=>{let r=window.indexedDB.deleteDatabase(i.DB_NAME),n=setTimeout(()=>t(!1),200);r.addEventListener("success",()=>(clearTimeout(n),e(!0))),r.addEventListener("blocked",()=>(clearTimeout(n),e(!0))),r.addEventListener("error",()=>(clearTimeout(n),t(!1)))})}}}),i("2cRj3",function(t,r){e(t.exports,"MemoryStorage",()=>n);class n{constructor(){this.cache=new Map}async initialize(){}getItem(e){return this.cache.get(e)||null}getUserData(e){return this.getItem(e)}setItem(e,t){this.cache.set(e,t)}async setUserData(e,t){this.setItem(e,t)}removeItem(e){this.cache.delete(e)}getKeys(){let e=[];return this.cache.forEach((t,r)=>{e.push(r)}),e}containsKey(e){return this.cache.has(e)}clear(){this.cache.clear()}decryptData(){return Promise.resolve(null)}}}),i("8xmgF",function(t,r){e(t.exports,"Authority",()=>T),e(t.exports,"getTenantFromAuthorityString",()=>I),e(t.exports,"formatAuthorityUri",()=>w),e(t.exports,"buildStaticAuthorityOptions",()=>S);var n=o("2ZfLX"),i=o("8gu3k"),a=o("gkKSO"),s=o("anIdE"),c=o("gmw86"),l=o("aNZw2"),d=o("jYvjz"),h=o("77Sbs"),u=o("fh6Ng"),p=o("gylC1"),g=o("dQ44y"),m=o("1ecae"),C=o("ckDmJ"),f=o("gnfKd"),y=o("9tUvn"),A=o("jvdrJ"),E=o("l6ONb"),v=o("cmWPH");class T{constructor(e,t,r,n,o,i,a,s){this.canonicalAuthority=e,this._canonicalAuthority.validateAsUri(),this.networkInterface=t,this.cacheManager=r,this.authorityOptions=n,this.regionDiscoveryMetadata={region_used:void 0,region_source:void 0,region_outcome:void 0},this.logger=o,this.performanceClient=a,this.correlationId=i,this.managedIdentity=s||!1,this.regionDiscovery=new(0,m.RegionDiscovery)(t,this.logger,this.performanceClient,this.correlationId)}getAuthorityType(e){if(e.HostNameAndPort.endsWith(c.Constants.CIAM_AUTH_URL))return n.AuthorityType.Ciam;let t=e.PathSegments;if(t.length)switch(t[0].toLowerCase()){case c.Constants.ADFS:return n.AuthorityType.Adfs;case c.Constants.DSTS:return n.AuthorityType.Dsts}return n.AuthorityType.Default}get authorityType(){return this.getAuthorityType(this.canonicalAuthorityUrlComponents)}get protocolMode(){return this.authorityOptions.protocolMode}get options(){return this.authorityOptions}get canonicalAuthority(){return this._canonicalAuthority.urlString}set canonicalAuthority(e){this._canonicalAuthority=new(0,a.UrlString)(e),this._canonicalAuthority.validateAsUri(),this._canonicalAuthorityUrlComponents=null}get canonicalAuthorityUrlComponents(){return this._canonicalAuthorityUrlComponents||(this._canonicalAuthorityUrlComponents=this._canonicalAuthority.getUrlComponents()),this._canonicalAuthorityUrlComponents}get hostnameAndPort(){return this.canonicalAuthorityUrlComponents.HostNameAndPort.toLowerCase()}get tenant(){return this.canonicalAuthorityUrlComponents.PathSegments[0]}get authorizationEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.authorization_endpoint);throw(0,s.createClientAuthError)(E.endpointResolutionError)}get tokenEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.token_endpoint);throw(0,s.createClientAuthError)(E.endpointResolutionError)}get deviceCodeEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.token_endpoint.replace("/token","/devicecode"));throw(0,s.createClientAuthError)(E.endpointResolutionError)}get endSessionEndpoint(){if(this.discoveryComplete()){if(!this.metadata.end_session_endpoint)throw(0,s.createClientAuthError)(E.endSessionEndpointNotSupported);return this.replacePath(this.metadata.end_session_endpoint)}throw(0,s.createClientAuthError)(E.endpointResolutionError)}get selfSignedJwtAudience(){if(this.discoveryComplete())return this.replacePath(this.metadata.issuer);throw(0,s.createClientAuthError)(E.endpointResolutionError)}get jwksUri(){if(this.discoveryComplete())return this.replacePath(this.metadata.jwks_uri);throw(0,s.createClientAuthError)(E.endpointResolutionError)}canReplaceTenant(e){return 1===e.PathSegments.length&&!T.reservedTenantDomains.has(e.PathSegments[0])&&this.getAuthorityType(e)===n.AuthorityType.Default&&this.protocolMode!==h.ProtocolMode.OIDC}replaceTenant(e){return e.replace(/{tenant}|{tenantid}/g,this.tenant)}replacePath(e){let t=e,r=new(0,a.UrlString)(this.metadata.canonical_authority).getUrlComponents(),n=r.PathSegments;return this.canonicalAuthorityUrlComponents.PathSegments.forEach((e,o)=>{let i=n[o];if(0===o&&this.canReplaceTenant(r)){let e=new(0,a.UrlString)(this.metadata.authorization_endpoint).getUrlComponents().PathSegments[0];i!==e&&(this.logger.verbose(`Replacing tenant domain name ${i} with id ${e}`),i=e)}e!==i&&(t=t.replace(`/${i}/`,`/${e}/`))}),this.replaceTenant(t)}get defaultOpenIdConfigurationEndpoint(){let e=this.hostnameAndPort;return this.canonicalAuthority.endsWith("v2.0/")||this.authorityType===n.AuthorityType.Adfs||this.protocolMode===h.ProtocolMode.OIDC&&!this.isAliasOfKnownMicrosoftAuthority(e)?`${this.canonicalAuthority}.well-known/openid-configuration`:`${this.canonicalAuthority}v2.0/.well-known/openid-configuration`}discoveryComplete(){return!!this.metadata}async resolveEndpointsAsync(){this.performanceClient?.addQueueMeasurement(f.PerformanceEvents.AuthorityResolveEndpointsAsync,this.correlationId);let e=this.getCurrentMetadataEntity(),t=await (0,y.invokeAsync)(this.updateCloudDiscoveryMetadata.bind(this),f.PerformanceEvents.AuthorityUpdateCloudDiscoveryMetadata,this.logger,this.performanceClient,this.correlationId)(e);this.canonicalAuthority=this.canonicalAuthority.replace(this.hostnameAndPort,e.preferred_network);let r=await (0,y.invokeAsync)(this.updateEndpointMetadata.bind(this),f.PerformanceEvents.AuthorityUpdateEndpointMetadata,this.logger,this.performanceClient,this.correlationId)(e);this.updateCachedMetadata(e,t,{source:r}),this.performanceClient?.addFields({cloudDiscoverySource:t,authorityEndpointSource:r},this.correlationId)}getCurrentMetadataEntity(){let e=this.cacheManager.getAuthorityMetadataByAlias(this.hostnameAndPort);return e||(e={aliases:[],preferred_cache:this.hostnameAndPort,preferred_network:this.hostnameAndPort,canonical_authority:this.canonicalAuthority,authorization_endpoint:"",token_endpoint:"",end_session_endpoint:"",issuer:"",aliasesFromNetwork:!1,endpointsFromNetwork:!1,expiresAt:(0,A.generateAuthorityMetadataExpiresAt)(),jwks_uri:""}),e}updateCachedMetadata(e,t,r){t!==c.AuthorityMetadataSource.CACHE&&r?.source!==c.AuthorityMetadataSource.CACHE&&(e.expiresAt=(0,A.generateAuthorityMetadataExpiresAt)(),e.canonical_authority=this.canonicalAuthority);let n=this.cacheManager.generateAuthorityMetadataCacheKey(e.preferred_cache);this.cacheManager.setAuthorityMetadata(n,e),this.metadata=e}async updateEndpointMetadata(e){this.performanceClient?.addQueueMeasurement(f.PerformanceEvents.AuthorityUpdateEndpointMetadata,this.correlationId);let t=this.updateEndpointMetadataFromLocalSources(e);if(t){if(t.source===c.AuthorityMetadataSource.HARDCODED_VALUES&&this.authorityOptions.azureRegionConfiguration?.azureRegion&&t.metadata){let r=await (0,y.invokeAsync)(this.updateMetadataWithRegionalInformation.bind(this),f.PerformanceEvents.AuthorityUpdateMetadataWithRegionalInformation,this.logger,this.performanceClient,this.correlationId)(t.metadata);(0,A.updateAuthorityEndpointMetadata)(e,r,!1),e.canonical_authority=this.canonicalAuthority}return t.source}let r=await (0,y.invokeAsync)(this.getEndpointMetadataFromNetwork.bind(this),f.PerformanceEvents.AuthorityGetEndpointMetadataFromNetwork,this.logger,this.performanceClient,this.correlationId)();if(r)return this.authorityOptions.azureRegionConfiguration?.azureRegion&&(r=await (0,y.invokeAsync)(this.updateMetadataWithRegionalInformation.bind(this),f.PerformanceEvents.AuthorityUpdateMetadataWithRegionalInformation,this.logger,this.performanceClient,this.correlationId)(r)),(0,A.updateAuthorityEndpointMetadata)(e,r,!0),c.AuthorityMetadataSource.NETWORK;throw(0,s.createClientAuthError)(E.openIdConfigError,this.defaultOpenIdConfigurationEndpoint)}updateEndpointMetadataFromLocalSources(e){this.logger.verbose("Attempting to get endpoint metadata from authority configuration");let t=this.getEndpointMetadataFromConfig();if(t)return this.logger.verbose("Found endpoint metadata in authority configuration"),(0,A.updateAuthorityEndpointMetadata)(e,t,!1),{source:c.AuthorityMetadataSource.CONFIG};if(this.logger.verbose("Did not find endpoint metadata in the config... Attempting to get endpoint metadata from the hardcoded values."),this.authorityOptions.skipAuthorityMetadataCache)this.logger.verbose("Skipping hardcoded metadata cache since skipAuthorityMetadataCache is set to true. Attempting to get endpoint metadata from the network metadata cache.");else{let t=this.getEndpointMetadataFromHardcodedValues();if(t)return(0,A.updateAuthorityEndpointMetadata)(e,t,!1),{source:c.AuthorityMetadataSource.HARDCODED_VALUES,metadata:t};this.logger.verbose("Did not find endpoint metadata in hardcoded values... Attempting to get endpoint metadata from the network metadata cache.")}let r=(0,A.isAuthorityMetadataExpired)(e);return this.isAuthoritySameType(e)&&e.endpointsFromNetwork&&!r?(this.logger.verbose("Found endpoint metadata in the cache."),{source:c.AuthorityMetadataSource.CACHE}):(r&&this.logger.verbose("The metadata entity is expired."),null)}isAuthoritySameType(e){return new(0,a.UrlString)(e.canonical_authority).getUrlComponents().PathSegments.length===this.canonicalAuthorityUrlComponents.PathSegments.length}getEndpointMetadataFromConfig(){if(this.authorityOptions.authorityMetadata)try{return JSON.parse(this.authorityOptions.authorityMetadata)}catch(e){throw(0,d.createClientConfigurationError)(v.invalidAuthorityMetadata)}return null}async getEndpointMetadataFromNetwork(){this.performanceClient?.addQueueMeasurement(f.PerformanceEvents.AuthorityGetEndpointMetadataFromNetwork,this.correlationId);let e=this.defaultOpenIdConfigurationEndpoint;this.logger.verbose(`Authority.getEndpointMetadataFromNetwork: attempting to retrieve OAuth endpoints from ${e}`);try{let t=await this.networkInterface.sendGetRequestAsync(e,{});if((0,i.isOpenIdConfigResponse)(t.body))return t.body;return this.logger.verbose("Authority.getEndpointMetadataFromNetwork: could not parse response as OpenID configuration"),null}catch(e){return this.logger.verbose(`Authority.getEndpointMetadataFromNetwork: ${e}`),null}}getEndpointMetadataFromHardcodedValues(){return this.hostnameAndPort in l.EndpointMetadata?l.EndpointMetadata[this.hostnameAndPort]:null}async updateMetadataWithRegionalInformation(e){this.performanceClient?.addQueueMeasurement(f.PerformanceEvents.AuthorityUpdateMetadataWithRegionalInformation,this.correlationId);let t=this.authorityOptions.azureRegionConfiguration?.azureRegion;if(t){if(t!==c.Constants.AZURE_REGION_AUTO_DISCOVER_FLAG)return this.regionDiscoveryMetadata.region_outcome=c.RegionDiscoveryOutcomes.CONFIGURED_NO_AUTO_DETECTION,this.regionDiscoveryMetadata.region_used=t,T.replaceWithRegionalInformation(e,t);let r=await (0,y.invokeAsync)(this.regionDiscovery.detectRegion.bind(this.regionDiscovery),f.PerformanceEvents.RegionDiscoveryDetectRegion,this.logger,this.performanceClient,this.correlationId)(this.authorityOptions.azureRegionConfiguration?.environmentRegion,this.regionDiscoveryMetadata);if(r)return this.regionDiscoveryMetadata.region_outcome=c.RegionDiscoveryOutcomes.AUTO_DETECTION_REQUESTED_SUCCESSFUL,this.regionDiscoveryMetadata.region_used=r,T.replaceWithRegionalInformation(e,r);this.regionDiscoveryMetadata.region_outcome=c.RegionDiscoveryOutcomes.AUTO_DETECTION_REQUESTED_FAILED}return e}async updateCloudDiscoveryMetadata(e){this.performanceClient?.addQueueMeasurement(f.PerformanceEvents.AuthorityUpdateCloudDiscoveryMetadata,this.correlationId);let t=this.updateCloudDiscoveryMetadataFromLocalSources(e);if(t)return t;let r=await (0,y.invokeAsync)(this.getCloudDiscoveryMetadataFromNetwork.bind(this),f.PerformanceEvents.AuthorityGetCloudDiscoveryMetadataFromNetwork,this.logger,this.performanceClient,this.correlationId)();if(r)return(0,A.updateCloudDiscoveryMetadata)(e,r,!0),c.AuthorityMetadataSource.NETWORK;throw(0,d.createClientConfigurationError)(v.untrustedAuthority)}updateCloudDiscoveryMetadataFromLocalSources(e){this.logger.verbose("Attempting to get cloud discovery metadata  from authority configuration"),this.logger.verbosePii(`Known Authorities: ${this.authorityOptions.knownAuthorities||c.Constants.NOT_APPLICABLE}`),this.logger.verbosePii(`Authority Metadata: ${this.authorityOptions.authorityMetadata||c.Constants.NOT_APPLICABLE}`),this.logger.verbosePii(`Canonical Authority: ${e.canonical_authority||c.Constants.NOT_APPLICABLE}`);let t=this.getCloudDiscoveryMetadataFromConfig();if(t)return this.logger.verbose("Found cloud discovery metadata in authority configuration"),(0,A.updateCloudDiscoveryMetadata)(e,t,!1),c.AuthorityMetadataSource.CONFIG;if(this.logger.verbose("Did not find cloud discovery metadata in the config... Attempting to get cloud discovery metadata from the hardcoded values."),this.options.skipAuthorityMetadataCache)this.logger.verbose("Skipping hardcoded cloud discovery metadata cache since skipAuthorityMetadataCache is set to true. Attempting to get cloud discovery metadata from the network metadata cache.");else{let t=(0,l.getCloudDiscoveryMetadataFromHardcodedValues)(this.hostnameAndPort);if(t)return this.logger.verbose("Found cloud discovery metadata from hardcoded values."),(0,A.updateCloudDiscoveryMetadata)(e,t,!1),c.AuthorityMetadataSource.HARDCODED_VALUES;this.logger.verbose("Did not find cloud discovery metadata in hardcoded values... Attempting to get cloud discovery metadata from the network metadata cache.")}let r=(0,A.isAuthorityMetadataExpired)(e);return this.isAuthoritySameType(e)&&e.aliasesFromNetwork&&!r?(this.logger.verbose("Found cloud discovery metadata in the cache."),c.AuthorityMetadataSource.CACHE):(r&&this.logger.verbose("The metadata entity is expired."),null)}getCloudDiscoveryMetadataFromConfig(){if(this.authorityType===n.AuthorityType.Ciam)return this.logger.verbose("CIAM authorities do not support cloud discovery metadata, generate the aliases from authority host."),T.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort);if(this.authorityOptions.cloudDiscoveryMetadata){this.logger.verbose("The cloud discovery metadata has been provided as a network response, in the config.");try{this.logger.verbose("Attempting to parse the cloud discovery metadata.");let e=JSON.parse(this.authorityOptions.cloudDiscoveryMetadata),t=(0,l.getCloudDiscoveryMetadataFromNetworkResponse)(e.metadata,this.hostnameAndPort);if(this.logger.verbose("Parsed the cloud discovery metadata."),t)return this.logger.verbose("There is returnable metadata attached to the parsed cloud discovery metadata."),t;this.logger.verbose("There is no metadata attached to the parsed cloud discovery metadata.")}catch(e){throw this.logger.verbose("Unable to parse the cloud discovery metadata. Throwing Invalid Cloud Discovery Metadata Error."),(0,d.createClientConfigurationError)(v.invalidCloudDiscoveryMetadata)}}return this.isInKnownAuthorities()?(this.logger.verbose("The host is included in knownAuthorities. Creating new cloud discovery metadata from the host."),T.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort)):null}async getCloudDiscoveryMetadataFromNetwork(){this.performanceClient?.addQueueMeasurement(f.PerformanceEvents.AuthorityGetCloudDiscoveryMetadataFromNetwork,this.correlationId);let e=`${c.Constants.AAD_INSTANCE_DISCOVERY_ENDPT}${this.canonicalAuthority}oauth2/v2.0/authorize`,t=null;try{let r,n,o=await this.networkInterface.sendGetRequestAsync(e,{});if((0,p.isCloudInstanceDiscoveryResponse)(o.body))n=(r=o.body).metadata,this.logger.verbosePii(`tenant_discovery_endpoint is: ${r.tenant_discovery_endpoint}`);else{if(!(0,g.isCloudInstanceDiscoveryErrorResponse)(o.body))return this.logger.error("AAD did not return a CloudInstanceDiscoveryResponse or CloudInstanceDiscoveryErrorResponse"),null;if(this.logger.warning(`A CloudInstanceDiscoveryErrorResponse was returned. The cloud instance discovery network request's status code is: ${o.status}`),(r=o.body).error===c.Constants.INVALID_INSTANCE)return this.logger.error("The CloudInstanceDiscoveryErrorResponse error is invalid_instance."),null;this.logger.warning(`The CloudInstanceDiscoveryErrorResponse error is ${r.error}`),this.logger.warning(`The CloudInstanceDiscoveryErrorResponse error description is ${r.error_description}`),this.logger.warning("Setting the value of the CloudInstanceDiscoveryMetadata (returned from the network) to []"),n=[]}this.logger.verbose("Attempting to find a match between the developer's authority and the CloudInstanceDiscoveryMetadata returned from the network request."),t=(0,l.getCloudDiscoveryMetadataFromNetworkResponse)(n,this.hostnameAndPort)}catch(e){return e instanceof C.AuthError?this.logger.error(`There was a network error while attempting to get the cloud discovery instance metadata.
Error: ${e.errorCode}
Error Description: ${e.errorMessage}`):this.logger.error(`A non-MSALJS error was thrown while attempting to get the cloud instance discovery metadata.
Error: ${e.name}
Error Description: ${e.message}`),null}return t||(this.logger.warning("The developer's authority was not found within the CloudInstanceDiscoveryMetadata returned from the network request."),this.logger.verbose("Creating custom Authority for custom domain scenario."),t=T.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort)),t}isInKnownAuthorities(){return this.authorityOptions.knownAuthorities.filter(e=>e&&a.UrlString.getDomainFromUrl(e).toLowerCase()===this.hostnameAndPort).length>0}static generateAuthority(e,t){let r;if(t&&t.azureCloudInstance!==u.AzureCloudInstance.None){let e=t.tenant?t.tenant:c.Constants.DEFAULT_COMMON_TENANT;r=`${t.azureCloudInstance}/${e}/`}return r||e}static createCloudDiscoveryMetadataFromHost(e){return{preferred_network:e,preferred_cache:e,aliases:[e]}}getPreferredCache(){if(this.managedIdentity)return c.Constants.DEFAULT_AUTHORITY_HOST;if(this.discoveryComplete())return this.metadata.preferred_cache;throw(0,s.createClientAuthError)(E.endpointResolutionError)}isAlias(e){return this.metadata.aliases.indexOf(e)>-1}isAliasOfKnownMicrosoftAuthority(e){return l.InstanceDiscoveryMetadataAliases.has(e)}static isPublicCloudAuthority(e){return c.Constants.KNOWN_PUBLIC_CLOUDS.indexOf(e)>=0}static buildRegionalAuthorityString(e,t,r){let n=new(0,a.UrlString)(e);n.validateAsUri();let o=n.getUrlComponents(),i=`${t}.${o.HostNameAndPort}`;this.isPublicCloudAuthority(o.HostNameAndPort)&&(i=`${t}.${c.Constants.REGIONAL_AUTH_PUBLIC_CLOUD_SUFFIX}`);let s=a.UrlString.constructAuthorityUriFromObject({...n.getUrlComponents(),HostNameAndPort:i}).urlString;return r?`${s}?${r}`:s}static replaceWithRegionalInformation(e,t){let r={...e};return r.authorization_endpoint=T.buildRegionalAuthorityString(r.authorization_endpoint,t),r.token_endpoint=T.buildRegionalAuthorityString(r.token_endpoint,t),r.end_session_endpoint&&(r.end_session_endpoint=T.buildRegionalAuthorityString(r.end_session_endpoint,t)),r}static transformCIAMAuthority(e){let t=e,r=new(0,a.UrlString)(e).getUrlComponents();if(0===r.PathSegments.length&&r.HostNameAndPort.endsWith(c.Constants.CIAM_AUTH_URL)){let e=r.HostNameAndPort.split(".")[0];t=`${t}${e}${c.Constants.AAD_TENANT_DOMAIN_SUFFIX}`}return t}}function I(e){let t=new(0,a.UrlString)(e).getUrlComponents(),r=t.PathSegments.slice(-1)[0]?.toLowerCase();switch(r){case c.AADAuthorityConstants.COMMON:case c.AADAuthorityConstants.ORGANIZATIONS:case c.AADAuthorityConstants.CONSUMERS:return;default:return r}}function w(e){return e.endsWith(c.Constants.FORWARD_SLASH)?e:`${e}${c.Constants.FORWARD_SLASH}`}function S(e){let t,r=e.cloudDiscoveryMetadata;if(r)try{t=JSON.parse(r)}catch(e){throw(0,d.createClientConfigurationError)(v.invalidCloudDiscoveryMetadata)}return{canonicalAuthority:e.authority?w(e.authority):void 0,knownAuthorities:e.knownAuthorities,cloudDiscoveryMetadata:t}}T.reservedTenantDomains=new Set(["{tenant}","{tenantid}",c.AADAuthorityConstants.COMMON,c.AADAuthorityConstants.CONSUMERS,c.AADAuthorityConstants.ORGANIZATIONS])}),i("8gu3k",function(t,r){e(t.exports,"isOpenIdConfigResponse",()=>n);function n(e){return e.hasOwnProperty("authorization_endpoint")&&e.hasOwnProperty("token_endpoint")&&e.hasOwnProperty("issuer")&&e.hasOwnProperty("jwks_uri")}}),i("gylC1",function(t,r){e(t.exports,"isCloudInstanceDiscoveryResponse",()=>n);function n(e){return e.hasOwnProperty("tenant_discovery_endpoint")&&e.hasOwnProperty("metadata")}}),i("dQ44y",function(t,r){e(t.exports,"isCloudInstanceDiscoveryErrorResponse",()=>n);function n(e){return e.hasOwnProperty("error")&&e.hasOwnProperty("error_description")}}),i("1ecae",function(t,r){e(t.exports,"RegionDiscovery",()=>s);var n=o("gmw86"),i=o("gnfKd"),a=o("9tUvn");class s{constructor(e,t,r,n){this.networkInterface=e,this.logger=t,this.performanceClient=r,this.correlationId=n}async detectRegion(e,t){this.performanceClient?.addQueueMeasurement(i.PerformanceEvents.RegionDiscoveryDetectRegion,this.correlationId);let r=e;if(r)t.region_source=n.RegionDiscoverySources.ENVIRONMENT_VARIABLE;else{let e=s.IMDS_OPTIONS;try{let o=await (0,a.invokeAsync)(this.getRegionFromIMDS.bind(this),i.PerformanceEvents.RegionDiscoveryGetRegionFromIMDS,this.logger,this.performanceClient,this.correlationId)(n.Constants.IMDS_VERSION,e);if(o.status===n.HttpStatus.SUCCESS&&(r=o.body,t.region_source=n.RegionDiscoverySources.IMDS),o.status===n.HttpStatus.BAD_REQUEST){let o=await (0,a.invokeAsync)(this.getCurrentVersion.bind(this),i.PerformanceEvents.RegionDiscoveryGetCurrentVersion,this.logger,this.performanceClient,this.correlationId)(e);if(!o)return t.region_source=n.RegionDiscoverySources.FAILED_AUTO_DETECTION,null;let s=await (0,a.invokeAsync)(this.getRegionFromIMDS.bind(this),i.PerformanceEvents.RegionDiscoveryGetRegionFromIMDS,this.logger,this.performanceClient,this.correlationId)(o,e);s.status===n.HttpStatus.SUCCESS&&(r=s.body,t.region_source=n.RegionDiscoverySources.IMDS)}}catch(e){return t.region_source=n.RegionDiscoverySources.FAILED_AUTO_DETECTION,null}}return r||(t.region_source=n.RegionDiscoverySources.FAILED_AUTO_DETECTION),r||null}async getRegionFromIMDS(e,t){return this.performanceClient?.addQueueMeasurement(i.PerformanceEvents.RegionDiscoveryGetRegionFromIMDS,this.correlationId),this.networkInterface.sendGetRequestAsync(`${n.Constants.IMDS_ENDPOINT}?api-version=${e}&format=text`,t,n.Constants.IMDS_TIMEOUT)}async getCurrentVersion(e){this.performanceClient?.addQueueMeasurement(i.PerformanceEvents.RegionDiscoveryGetCurrentVersion,this.correlationId);try{let t=await this.networkInterface.sendGetRequestAsync(`${n.Constants.IMDS_ENDPOINT}?format=json`,e);if(t.status===n.HttpStatus.BAD_REQUEST&&t.body&&t.body["newest-versions"]&&t.body["newest-versions"].length>0)return t.body["newest-versions"][0];return null}catch(e){return null}}}s.IMDS_OPTIONS={headers:{Metadata:"true"}}}),i("9tUvn",function(t,r){e(t.exports,"invoke",()=>n),e(t.exports,"invokeAsync",()=>o);let n=(e,t,r,n,o)=>(...i)=>{r.trace(`Executing function ${t}`);let a=n?.startMeasurement(t,o);o&&n?.incrementFields({[t+"CallCount"]:1},o);try{let n=e(...i);return a?.end({success:!0}),r.trace(`Returning result from ${t}`),n}catch(e){r.trace(`Error occurred in ${t}`);try{r.trace(JSON.stringify(e))}catch(e){r.trace("Unable to print error message.")}throw a?.end({success:!1},e),e}},o=(e,t,r,n,o)=>(...i)=>{r.trace(`Executing function ${t}`);let a=n?.startMeasurement(t,o);return o&&n?.incrementFields({[t+"CallCount"]:1},o),n?.setPreQueueTime(t,o),e(...i).then(e=>(r.trace(`Returning result from ${t}`),a?.end({success:!0}),e)).catch(e=>{r.trace(`Error occurred in ${t}`);try{r.trace(JSON.stringify(e))}catch(e){r.trace("Unable to print error message.")}throw a?.end({success:!1},e),e})}}),i("jvdrJ",function(t,r){e(t.exports,"createIdTokenEntity",()=>l),e(t.exports,"createAccessTokenEntity",()=>d),e(t.exports,"createRefreshTokenEntity",()=>h),e(t.exports,"isCredentialEntity",()=>u),e(t.exports,"isAccessTokenEntity",()=>p),e(t.exports,"isIdTokenEntity",()=>g),e(t.exports,"isRefreshTokenEntity",()=>m),e(t.exports,"isServerTelemetryEntity",()=>C),e(t.exports,"isThrottlingEntity",()=>f),e(t.exports,"generateAppMetadataKey",()=>y),e(t.exports,"isAppMetadataEntity",()=>A),e(t.exports,"isAuthorityMetadataEntity",()=>E),e(t.exports,"generateAuthorityMetadataExpiresAt",()=>v),e(t.exports,"updateAuthorityEndpointMetadata",()=>T),e(t.exports,"updateCloudDiscoveryMetadata",()=>I),e(t.exports,"isAuthorityMetadataExpired",()=>w);var n=o("eVKB1"),i=o("anIdE"),a=o("gmw86"),s=o("jl1FD"),c=o("l6ONb");function l(e,t,r,n,o){return{credentialType:a.CredentialType.ID_TOKEN,homeAccountId:e,environment:t,clientId:n,secret:r,realm:o,lastUpdatedAt:Date.now().toString()}}function d(e,t,r,o,l,d,h,u,p,g,m,C,f,y,A){let E={homeAccountId:e,credentialType:a.CredentialType.ACCESS_TOKEN,secret:r,cachedAt:(0,s.nowSeconds)().toString(),expiresOn:h.toString(),extendedExpiresOn:u.toString(),environment:t,clientId:o,realm:l,target:d,tokenType:m||a.AuthenticationScheme.BEARER,lastUpdatedAt:Date.now().toString()};if(C&&(E.userAssertionHash=C),g&&(E.refreshOn=g.toString()),y&&(E.requestedClaims=y,E.requestedClaimsHash=A),E.tokenType?.toLowerCase()!==a.AuthenticationScheme.BEARER.toLowerCase())switch(E.credentialType=a.CredentialType.ACCESS_TOKEN_WITH_AUTH_SCHEME,E.tokenType){case a.AuthenticationScheme.POP:let v=(0,n.extractTokenClaims)(r,p);if(!v?.cnf?.kid)throw(0,i.createClientAuthError)(c.tokenClaimsCnfRequiredForSignedJwt);E.keyId=v.cnf.kid;break;case a.AuthenticationScheme.SSH:E.keyId=f}return E}function h(e,t,r,n,o,i,s){let c={credentialType:a.CredentialType.REFRESH_TOKEN,homeAccountId:e,environment:t,clientId:n,secret:r,lastUpdatedAt:Date.now().toString()};return i&&(c.userAssertionHash=i),o&&(c.familyId=o),s&&(c.expiresOn=s.toString()),c}function u(e){return e.hasOwnProperty("homeAccountId")&&e.hasOwnProperty("environment")&&e.hasOwnProperty("credentialType")&&e.hasOwnProperty("clientId")&&e.hasOwnProperty("secret")}function p(e){return!!e&&u(e)&&e.hasOwnProperty("realm")&&e.hasOwnProperty("target")&&(e.credentialType===a.CredentialType.ACCESS_TOKEN||e.credentialType===a.CredentialType.ACCESS_TOKEN_WITH_AUTH_SCHEME)}function g(e){return!!e&&u(e)&&e.hasOwnProperty("realm")&&e.credentialType===a.CredentialType.ID_TOKEN}function m(e){return!!e&&u(e)&&e.credentialType===a.CredentialType.REFRESH_TOKEN}function C(e,t){let r=0===e.indexOf(a.SERVER_TELEM_CONSTANTS.CACHE_KEY),n=!0;return t&&(n=t.hasOwnProperty("failedRequests")&&t.hasOwnProperty("errors")&&t.hasOwnProperty("cacheHits")),r&&n}function f(e,t){let r=!1;e&&(r=0===e.indexOf(a.ThrottlingConstants.THROTTLING_PREFIX));let n=!0;return t&&(n=t.hasOwnProperty("throttleTime")),r&&n}function y({environment:e,clientId:t}){return[a.APP_METADATA,e,t].join(a.Separators.CACHE_KEY_SEPARATOR).toLowerCase()}function A(e,t){return!!t&&0===e.indexOf(a.APP_METADATA)&&t.hasOwnProperty("clientId")&&t.hasOwnProperty("environment")}function E(e,t){return!!t&&0===e.indexOf(a.AUTHORITY_METADATA_CONSTANTS.CACHE_KEY)&&t.hasOwnProperty("aliases")&&t.hasOwnProperty("preferred_cache")&&t.hasOwnProperty("preferred_network")&&t.hasOwnProperty("canonical_authority")&&t.hasOwnProperty("authorization_endpoint")&&t.hasOwnProperty("token_endpoint")&&t.hasOwnProperty("issuer")&&t.hasOwnProperty("aliasesFromNetwork")&&t.hasOwnProperty("endpointsFromNetwork")&&t.hasOwnProperty("expiresAt")&&t.hasOwnProperty("jwks_uri")}function v(){return(0,s.nowSeconds)()+a.AUTHORITY_METADATA_CONSTANTS.REFRESH_TIME_SECONDS}function T(e,t,r){e.authorization_endpoint=t.authorization_endpoint,e.token_endpoint=t.token_endpoint,e.end_session_endpoint=t.end_session_endpoint,e.issuer=t.issuer,e.endpointsFromNetwork=r,e.jwks_uri=t.jwks_uri}function I(e,t,r){e.aliases=t.aliases,e.preferred_cache=t.preferred_cache,e.preferred_network=t.preferred_network,e.aliasesFromNetwork=r}function w(e){return e.expiresAt<=(0,s.nowSeconds)()}}),i("jl1FD",function(t,r){function n(){return Math.round(new Date().getTime()/1e3)}function o(e){return e.getTime()/1e3}function i(e){return e?new Date(1e3*Number(e)):new Date}function a(e,t){let r=Number(e)||0;return n()+t>r}function s(e,t){let r=Number(e)+864e5*t;return Date.now()>r}function c(e){return Number(e)>n()}function l(e,t){return new Promise(r=>setTimeout(()=>r(t),e))}e(t.exports,"nowSeconds",()=>n),e(t.exports,"toSecondsFromDate",()=>o),e(t.exports,"toDateFromSeconds",()=>i),e(t.exports,"isTokenExpired",()=>a),e(t.exports,"isCacheExpired",()=>s),e(t.exports,"wasClockTurnedBack",()=>c),e(t.exports,"delay",()=>l)}),i("dO1mF",function(t,r){e(t.exports,"getRequestThumbprint",()=>n);function n(e,t,r){return{clientId:e,authority:t.authority,scopes:t.scopes,homeAccountIdentifier:r,claims:t.claims,authenticationScheme:t.authenticationScheme,resourceRequestMethod:t.resourceRequestMethod,resourceRequestUri:t.resourceRequestUri,shrClaims:t.shrClaims,sshKid:t.sshKid,embeddedClientId:t.embeddedClientId||t.tokenBodyParameters?.clientId}}}),i("dKahV",function(t,r){e(t.exports,"InteractionRequiredAuthError",()=>d),e(t.exports,"isInteractionRequiredError",()=>h),e(t.exports,"createInteractionRequiredAuthError",()=>u);var n=o("gmw86"),i=o("ckDmJ"),a=o("1jH5T");let s=[a.interactionRequired,a.consentRequired,a.loginRequired,a.badToken,a.uxNotAllowed],c=["message_only","additional_action","basic_action","user_password_expired","consent_required","bad_token"],l={[a.noTokensFound]:"No refresh token found in the cache. Please sign-in.",[a.nativeAccountUnavailable]:"The requested account is not available in the native broker. It may have been deleted or logged out. Please sign-in again using an interactive API.",[a.refreshTokenExpired]:"Refresh token has expired.",[a.badToken]:"Identity provider returned bad_token due to an expired or invalid refresh token. Please invoke an interactive API to resolve.",[a.uxNotAllowed]:"`canShowUI` flag in Edge was set to false. User interaction required on web page. Please invoke an interactive API to resolve."};a.noTokensFound,l[a.noTokensFound],a.nativeAccountUnavailable,l[a.nativeAccountUnavailable],a.badToken,l[a.badToken];class d extends i.AuthError{constructor(e,t,r,o,i,a,s,c){super(e,t,r),Object.setPrototypeOf(this,d.prototype),this.timestamp=o||n.Constants.EMPTY_STRING,this.traceId=i||n.Constants.EMPTY_STRING,this.correlationId=a||n.Constants.EMPTY_STRING,this.claims=s||n.Constants.EMPTY_STRING,this.name="InteractionRequiredAuthError",this.errorNo=c}}function h(e,t,r){let n=!!e&&s.indexOf(e)>-1,o=!!r&&c.indexOf(r)>-1,i=!!t&&s.some(e=>t.indexOf(e)>-1);return n||i||o}function u(e){return new d(e,l[e])}}),i("1jH5T",function(t,r){e(t.exports,"noTokensFound",()=>n),e(t.exports,"nativeAccountUnavailable",()=>o),e(t.exports,"refreshTokenExpired",()=>i),e(t.exports,"uxNotAllowed",()=>a),e(t.exports,"interactionRequired",()=>s),e(t.exports,"consentRequired",()=>c),e(t.exports,"loginRequired",()=>l),e(t.exports,"badToken",()=>d);let n="no_tokens_found",o="native_account_unavailable",i="refresh_token_expired",a="ux_not_allowed",s="interaction_required",c="consent_required",l="login_required",d="bad_token"}),i("fc6HR",function(t,r){e(t.exports,"BrowserCacheManager",()=>x),e(t.exports,"DEFAULT_BROWSER_CACHE_MANAGER",()=>D);var n=o("4tMCV"),i=o("gmw86"),a=o("eVKB1"),s=o("aRYMn"),c=o("2eahm"),l=o("d2Djx"),d=o("jvdrJ"),h=o("fzx9Z"),u=o("1OX4r"),p=o("knfgg"),g=o("9tUvn"),m=o("gnfKd"),C=o("7yP0u"),f=o("jl1FD"),y=o("6HXlN"),A=o("dp0vd"),E=o("2wtIk"),v=o("dbZkI"),T=o("44vvC"),I=o("2cRj3"),w=o("cx3ku"),S=o("7e5V2"),k=o("1GrlD"),R=o("7v4ap"),_=o("fKG6z"),P=o("5S1XQ"),b=o("2QnKr"),N=o("heg4K"),O=o("dovbF"),M=o("4pKco");class x extends h.CacheManager{constructor(e,t,r,n,o,i,a){super(e,r,n,o,a),this.cacheConfig=t,this.logger=n,this.internalStorage=new(0,I.MemoryStorage),this.browserStorage=U(e,t.cacheLocation,n,o),this.temporaryCacheStorage=U(e,t.temporaryCacheLocation,n,o),this.cookieStorage=new(0,k.CookieStorage),this.eventHandler=i}async initialize(e){this.performanceClient.addFields({cacheLocation:this.cacheConfig.cacheLocation,cacheRetentionDays:this.cacheConfig.cacheRetentionDays},e),await this.browserStorage.initialize(e),await this.migrateExistingCache(e),this.trackVersionChanges(e)}async migrateExistingCache(e){let t=(0,R.getAccountKeys)(this.browserStorage),r=(0,R.getTokenKeys)(this.clientId,this.browserStorage);this.performanceClient.addFields({preMigrateAcntCount:t.length,preMigrateATCount:r.accessToken.length,preMigrateITCount:r.idToken.length,preMigrateRTCount:r.refreshToken.length},e);for(let t=0;t<E.ACCOUNT_SCHEMA_VERSION;t++){let r=t;await this.removeStaleAccounts(t,r,e)}for(let t=0;t<E.CREDENTIAL_SCHEMA_VERSION;t++){let r=t;await this.migrateIdTokens(t,r,e)}let n=this.getKMSIValues();for(let t=0;t<E.CREDENTIAL_SCHEMA_VERSION;t++)await this.migrateAccessTokens(t,n,e),await this.migrateRefreshTokens(t,n,e);t=(0,R.getAccountKeys)(this.browserStorage),r=(0,R.getTokenKeys)(this.clientId,this.browserStorage),this.performanceClient.addFields({postMigrateAcntCount:t.length,postMigrateATCount:r.accessToken.length,postMigrateITCount:r.idToken.length,postMigrateRTCount:r.refreshToken.length},e)}async updateOldEntry(e,t){let r=this.browserStorage.getItem(e),n=this.validateAndParseJson(r||"");if(!n)return this.browserStorage.removeItem(e),null;if(n.lastUpdatedAt){if(f.isCacheExpired(n.lastUpdatedAt,this.cacheConfig.cacheRetentionDays))return this.browserStorage.removeItem(e),this.performanceClient.incrementFields({expiredCacheRemovedCount:1},t),null}else n.lastUpdatedAt=Date.now().toString(),this.setItem(e,JSON.stringify(n),t);let o=(0,O.isEncrypted)(n)?await this.browserStorage.decryptData(e,n,t):n;return o&&d.isCredentialEntity(o)?(d.isAccessTokenEntity(o)||d.isRefreshTokenEntity(o))&&o.expiresOn&&f.isTokenExpired(o.expiresOn,i.DEFAULT_TOKEN_RENEWAL_OFFSET_SEC)?(this.browserStorage.removeItem(e),this.performanceClient.incrementFields({expiredCacheRemovedCount:1},t),null):o:(this.performanceClient.incrementFields({invalidCacheCount:1},t),null)}async removeStaleAccounts(e,t,r){let n=(0,R.getAccountKeys)(this.browserStorage,e);if(0!==n.length){for(let e of[...n]){this.performanceClient.incrementFields({oldAcntCount:1},r);let o=this.browserStorage.getItem(e),i=this.validateAndParseJson(o||"");if(!i){(0,N.removeElementFromArray)(n,e);continue}if(i.lastUpdatedAt)f.isCacheExpired(i.lastUpdatedAt,this.cacheConfig.cacheRetentionDays)&&(await this.removeAccountOldSchema(e,i,t,r),(0,N.removeElementFromArray)(n,e));else{i.lastUpdatedAt=Date.now().toString(),this.setItem(e,JSON.stringify(i),r);continue}}this.setAccountKeys(n,r,e)}}async removeAccountOldSchema(e,t,r,n){let o=(0,O.isEncrypted)(t)?await this.browserStorage.decryptData(e,t,n):t,i=o?.homeAccountId;if(i){let e=this.getTokenKeys(r);[...e.idToken].filter(e=>e.includes(i)).forEach(t=>{this.browserStorage.removeItem(t),(0,N.removeElementFromArray)(e.idToken,t)}),[...e.accessToken].filter(e=>e.includes(i)).forEach(t=>{this.browserStorage.removeItem(t),(0,N.removeElementFromArray)(e.accessToken,t)}),[...e.refreshToken].filter(e=>e.includes(i)).forEach(t=>{this.browserStorage.removeItem(t),(0,N.removeElementFromArray)(e.refreshToken,t)}),this.setTokenKeys(e,n,r)}this.performanceClient.incrementFields({expiredAcntRemovedCount:1},n),this.browserStorage.removeItem(e)}getKMSIValues(){let e={};for(let t of this.getTokenKeys().idToken){let r=this.browserStorage.getUserData(t);if(r){let t=JSON.parse(r),n=a.extractTokenClaims(t.secret,w.base64Decode);n&&(e[t.homeAccountId]=a.isKmsi(n))}}return e}async migrateIdTokens(e,t,r){let o=(0,R.getTokenKeys)(this.clientId,this.browserStorage,e);if(0===o.idToken.length)return;let i=(0,R.getTokenKeys)(this.clientId,this.browserStorage,E.CREDENTIAL_SCHEMA_VERSION),c=(0,R.getAccountKeys)(this.browserStorage),l=(0,R.getAccountKeys)(this.browserStorage,t);for(let e of[...o.idToken]){this.performanceClient.incrementFields({oldITCount:1},r);let t=await this.updateOldEntry(e,r);if(!t){(0,N.removeElementFromArray)(o.idToken,e);continue}let d=c.find(e=>e.includes(t.homeAccountId)),h=l.find(e=>e.includes(t.homeAccountId)),u=null;if(d)u=this.getAccount(d,r);else if(h){let e=this.browserStorage.getItem(h),t=this.validateAndParseJson(e||"");u=t&&(0,O.isEncrypted)(t)?await this.browserStorage.decryptData(h,t,r):t}if(!u){this.performanceClient.incrementFields({skipITMigrateCount:1},r);continue}let g=a.extractTokenClaims(t.secret,w.base64Decode),m=this.generateCredentialKey(t),C=this.getIdTokenCredential(m,r),f=Object.keys(g).includes("signin_state"),y=C&&Object.keys(a.extractTokenClaims(C.secret,w.base64Decode)||{}).includes("signin_state");if(!C||t.lastUpdatedAt>C.lastUpdatedAt&&(f||!y)){let e=u.tenantProfiles||[],o=(0,p.getTenantIdFromIdTokenClaims)(g)||u.realm;if(o&&!e.find(e=>e.tenantId===o)){let t=(0,s.buildTenantProfile)(u.homeAccountId,u.localAccountId,o,g);e.push(t)}u.tenantProfiles=e;let l=this.generateAccountKey(n.AccountEntity.getAccountInfo(u)),d=a.isKmsi(g);await this.setUserData(l,JSON.stringify(u),r,u.lastUpdatedAt,d),c.includes(l)||c.push(l),await this.setUserData(m,JSON.stringify(t),r,t.lastUpdatedAt,d),this.performanceClient.incrementFields({migratedITCount:1},r),i.idToken.push(m)}}this.setTokenKeys(o,r,e),this.setTokenKeys(i,r),this.setAccountKeys(c,r)}async migrateAccessTokens(e,t,r){let n=(0,R.getTokenKeys)(this.clientId,this.browserStorage,e);if(0===n.accessToken.length)return;let o=(0,R.getTokenKeys)(this.clientId,this.browserStorage,E.CREDENTIAL_SCHEMA_VERSION);for(let e of[...n.accessToken]){this.performanceClient.incrementFields({oldATCount:1},r);let i=await this.updateOldEntry(e,r);if(!i){(0,N.removeElementFromArray)(n.accessToken,e);continue}if(!Object.keys(t).includes(i.homeAccountId)){this.performanceClient.incrementFields({skipATMigrateCount:1},r);continue}let a=this.generateCredentialKey(i),s=t[i.homeAccountId];if(o.accessToken.includes(a)){let e=this.getAccessTokenCredential(a,r);(!e||i.lastUpdatedAt>e.lastUpdatedAt)&&(await this.setUserData(a,JSON.stringify(i),r,i.lastUpdatedAt,s),this.performanceClient.incrementFields({migratedATCount:1},r))}else await this.setUserData(a,JSON.stringify(i),r,i.lastUpdatedAt,s),this.performanceClient.incrementFields({migratedATCount:1},r),o.accessToken.push(a)}this.setTokenKeys(n,r,e),this.setTokenKeys(o,r)}async migrateRefreshTokens(e,t,r){let n=(0,R.getTokenKeys)(this.clientId,this.browserStorage,e);if(0===n.refreshToken.length)return;let o=(0,R.getTokenKeys)(this.clientId,this.browserStorage,E.CREDENTIAL_SCHEMA_VERSION);for(let e of[...n.refreshToken]){this.performanceClient.incrementFields({oldRTCount:1},r);let i=await this.updateOldEntry(e,r);if(!i){(0,N.removeElementFromArray)(n.refreshToken,e);continue}if(!Object.keys(t).includes(i.homeAccountId)){this.performanceClient.incrementFields({skipRTMigrateCount:1},r);continue}let a=this.generateCredentialKey(i),s=t[i.homeAccountId];if(o.refreshToken.includes(a)){let e=this.getRefreshTokenCredential(a,r);(!e||i.lastUpdatedAt>e.lastUpdatedAt)&&(await this.setUserData(a,JSON.stringify(i),r,i.lastUpdatedAt,s),this.performanceClient.incrementFields({migratedRTCount:1},r))}else await this.setUserData(a,JSON.stringify(i),r,i.lastUpdatedAt,s),this.performanceClient.incrementFields({migratedRTCount:1},r),o.refreshToken.push(a)}this.setTokenKeys(n,r,e),this.setTokenKeys(o,r)}trackVersionChanges(e){let t=this.browserStorage.getItem(E.VERSION_CACHE_KEY);t&&(this.logger.info(`MSAL.js was last initialized by version: ${t}`),this.performanceClient.addFields({previousLibraryVersion:t},e)),t!==b.version&&this.setItem(E.VERSION_CACHE_KEY,b.version,e)}validateAndParseJson(e){if(!e)return null;try{let t=JSON.parse(e);return t&&"object"==typeof t?t:null}catch(e){return null}}setItem(e,t,r){let n=Array(E.CREDENTIAL_SCHEMA_VERSION+1).fill(0),o=[];for(let i=0;i<=20;i++)try{if(this.browserStorage.setItem(e,t),i>0)for(let e=0;e<=E.CREDENTIAL_SCHEMA_VERSION;e++){let t=n.slice(0,e).reduce((e,t)=>e+t,0);if(t>=i)break;let a=i>t+n[e]?t+n[e]:i;i>t&&n[e]>0&&this.removeAccessTokenKeys(o.slice(t,a),r,e)}break}catch(s){let a=(0,c.createCacheError)(s);if(a.errorCode===l.cacheQuotaExceeded&&i<20){if(!o.length)for(let r=0;r<=E.CREDENTIAL_SCHEMA_VERSION;r++)if(e===(0,E.getTokenKeysCacheKey)(this.clientId,r)){let e=JSON.parse(t).accessToken;o.push(...e),n[r]=e.length}else{let e=this.getTokenKeys(r).accessToken;o.push(...e),n[r]=e.length}if(o.length<=i)throw a;this.removeAccessToken(o[i],r,!1)}else throw a}}async setUserData(e,t,r,n,o){let i=Array(E.CREDENTIAL_SCHEMA_VERSION+1).fill(0),a=[];for(let s=0;s<=20;s++)try{if(await (0,g.invokeAsync)(this.browserStorage.setUserData.bind(this.browserStorage),m.PerformanceEvents.SetUserData,this.logger,this.performanceClient)(e,t,r,n,o),s>0)for(let e=0;e<=E.CREDENTIAL_SCHEMA_VERSION;e++){let t=i.slice(0,e).reduce((e,t)=>e+t,0);if(t>=s)break;let n=s>t+i[e]?t+i[e]:s;s>t&&i[e]>0&&this.removeAccessTokenKeys(a.slice(t,n),r,e)}break}catch(t){let e=(0,c.createCacheError)(t);if(e.errorCode===l.cacheQuotaExceeded&&s<20){if(!a.length)for(let e=0;e<=E.CREDENTIAL_SCHEMA_VERSION;e++){let t=this.getTokenKeys(e).accessToken;a.push(...t),i[e]=t.length}if(a.length<=s)throw e;this.removeAccessToken(a[s],r,!1)}else throw e}}getAccount(e,t){this.logger.trace("BrowserCacheManager.getAccount called");let r=this.browserStorage.getUserData(e);if(!r)return this.removeAccountKeyFromMap(e,t),null;let o=this.validateAndParseJson(r);return o&&n.AccountEntity.isAccountEntity(o)?h.CacheManager.toObject(new(0,n.AccountEntity),o):null}async setAccount(e,t,r){this.logger.trace("BrowserCacheManager.setAccount called");let o=this.generateAccountKey(n.AccountEntity.getAccountInfo(e)),i=Date.now().toString();e.lastUpdatedAt=i,await this.setUserData(o,JSON.stringify(e),t,i,r);let a=this.addAccountKeyToMap(o,t);this.performanceClient.addFields({kmsi:r},t),this.cacheConfig.cacheLocation===A.BrowserCacheLocation.LocalStorage&&a&&this.eventHandler.emitEvent(_.EventType.ACCOUNT_ADDED,void 0,n.AccountEntity.getAccountInfo(e))}getAccountKeys(){return(0,R.getAccountKeys)(this.browserStorage)}setAccountKeys(e,t,r=E.ACCOUNT_SCHEMA_VERSION){0===e.length?this.removeItem((0,E.getAccountKeysCacheKey)(r)):this.setItem((0,E.getAccountKeysCacheKey)(r),JSON.stringify(e),t)}addAccountKeyToMap(e,t){this.logger.trace("BrowserCacheManager.addAccountKeyToMap called"),this.logger.tracePii(`BrowserCacheManager.addAccountKeyToMap called with key: ${e}`);let r=this.getAccountKeys();return -1===r.indexOf(e)?(r.push(e),this.setItem((0,E.getAccountKeysCacheKey)(),JSON.stringify(r),t),this.logger.verbose("BrowserCacheManager.addAccountKeyToMap account key added"),!0):(this.logger.verbose("BrowserCacheManager.addAccountKeyToMap account key already exists in map"),!1)}removeAccountKeyFromMap(e,t){this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap called"),this.logger.tracePii(`BrowserCacheManager.removeAccountKeyFromMap called with key: ${e}`);let r=this.getAccountKeys(),n=r.indexOf(e);n>-1?(r.splice(n,1),this.setAccountKeys(r,t),this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap account key removed")):this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap key not found in existing map")}removeAccount(e,t){let r=this.getActiveAccount(t);r?.homeAccountId===e.homeAccountId&&r?.environment===e.environment&&this.setActiveAccount(null,t),super.removeAccount(e,t),this.removeAccountKeyFromMap(this.generateAccountKey(e),t),this.browserStorage.getKeys().forEach(t=>{t.includes(e.homeAccountId)&&t.includes(e.environment)&&this.browserStorage.removeItem(t)}),this.cacheConfig.cacheLocation===A.BrowserCacheLocation.LocalStorage&&this.eventHandler.emitEvent(_.EventType.ACCOUNT_REMOVED,void 0,e)}removeIdToken(e,t){super.removeIdToken(e,t);let r=this.getTokenKeys(),n=r.idToken.indexOf(e);n>-1&&(this.logger.info("idToken removed from tokenKeys map"),r.idToken.splice(n,1),this.setTokenKeys(r,t))}removeAccessToken(e,t,r=!0){super.removeAccessToken(e,t),r&&this.removeAccessTokenKeys([e],t)}removeAccessTokenKeys(e,t,r=E.CREDENTIAL_SCHEMA_VERSION){this.logger.trace("removeAccessTokenKey called");let n=this.getTokenKeys(r),o=0;if(e.forEach(e=>{let t=n.accessToken.indexOf(e);t>-1&&(n.accessToken.splice(t,1),o++)}),o>0){this.logger.info(`removed ${o} accessToken keys from tokenKeys map`),this.setTokenKeys(n,t,r);return}}removeRefreshToken(e,t){super.removeRefreshToken(e,t);let r=this.getTokenKeys(),n=r.refreshToken.indexOf(e);n>-1&&(this.logger.info("refreshToken removed from tokenKeys map"),r.refreshToken.splice(n,1),this.setTokenKeys(r,t))}getTokenKeys(e=E.CREDENTIAL_SCHEMA_VERSION){return(0,R.getTokenKeys)(this.clientId,this.browserStorage,e)}setTokenKeys(e,t,r=E.CREDENTIAL_SCHEMA_VERSION){0===e.idToken.length&&0===e.accessToken.length&&0===e.refreshToken.length?this.removeItem((0,E.getTokenKeysCacheKey)(this.clientId,r)):this.setItem((0,E.getTokenKeysCacheKey)(this.clientId,r),JSON.stringify(e),t)}getIdTokenCredential(e,t){let r=this.browserStorage.getUserData(e);if(!r)return this.logger.trace("BrowserCacheManager.getIdTokenCredential: called, no cache hit"),this.removeIdToken(e,t),null;let n=this.validateAndParseJson(r);return n&&d.isIdTokenEntity(n)?(this.logger.trace("BrowserCacheManager.getIdTokenCredential: cache hit"),n):(this.logger.trace("BrowserCacheManager.getIdTokenCredential: called, no cache hit"),null)}async setIdTokenCredential(e,t,r){this.logger.trace("BrowserCacheManager.setIdTokenCredential called");let n=this.generateCredentialKey(e),o=Date.now().toString();e.lastUpdatedAt=o,await this.setUserData(n,JSON.stringify(e),t,o,r);let i=this.getTokenKeys();-1===i.idToken.indexOf(n)&&(this.logger.info("BrowserCacheManager: addTokenKey - idToken added to map"),i.idToken.push(n),this.setTokenKeys(i,t))}getAccessTokenCredential(e,t){let r=this.browserStorage.getUserData(e);if(!r)return this.logger.trace("BrowserCacheManager.getAccessTokenCredential: called, no cache hit"),this.removeAccessTokenKeys([e],t),null;let n=this.validateAndParseJson(r);return n&&d.isAccessTokenEntity(n)?(this.logger.trace("BrowserCacheManager.getAccessTokenCredential: cache hit"),n):(this.logger.trace("BrowserCacheManager.getAccessTokenCredential: called, no cache hit"),null)}async setAccessTokenCredential(e,t,r){this.logger.trace("BrowserCacheManager.setAccessTokenCredential called");let n=this.generateCredentialKey(e),o=Date.now().toString();e.lastUpdatedAt=o,await this.setUserData(n,JSON.stringify(e),t,o,r);let i=this.getTokenKeys(),a=i.accessToken.indexOf(n);-1!==a&&i.accessToken.splice(a,1),this.logger.trace(`access token ${-1===a?"added to":"updated in"} map`),i.accessToken.push(n),this.setTokenKeys(i,t)}getRefreshTokenCredential(e,t){let r=this.browserStorage.getUserData(e);if(!r)return this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: called, no cache hit"),this.removeRefreshToken(e,t),null;let n=this.validateAndParseJson(r);return n&&d.isRefreshTokenEntity(n)?(this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: cache hit"),n):(this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: called, no cache hit"),null)}async setRefreshTokenCredential(e,t,r){this.logger.trace("BrowserCacheManager.setRefreshTokenCredential called");let n=this.generateCredentialKey(e),o=Date.now().toString();e.lastUpdatedAt=o,await this.setUserData(n,JSON.stringify(e),t,o,r);let i=this.getTokenKeys();-1===i.refreshToken.indexOf(n)&&(this.logger.info("BrowserCacheManager: addTokenKey - refreshToken added to map"),i.refreshToken.push(n),this.setTokenKeys(i,t))}getAppMetadata(e){let t=this.browserStorage.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getAppMetadata: called, no cache hit"),null;let r=this.validateAndParseJson(t);return r&&d.isAppMetadataEntity(e,r)?(this.logger.trace("BrowserCacheManager.getAppMetadata: cache hit"),r):(this.logger.trace("BrowserCacheManager.getAppMetadata: called, no cache hit"),null)}setAppMetadata(e,t){this.logger.trace("BrowserCacheManager.setAppMetadata called");let r=d.generateAppMetadataKey(e);this.setItem(r,JSON.stringify(e),t)}getServerTelemetry(e){let t=this.browserStorage.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getServerTelemetry: called, no cache hit"),null;let r=this.validateAndParseJson(t);return r&&d.isServerTelemetryEntity(e,r)?(this.logger.trace("BrowserCacheManager.getServerTelemetry: cache hit"),r):(this.logger.trace("BrowserCacheManager.getServerTelemetry: called, no cache hit"),null)}setServerTelemetry(e,t,r){this.logger.trace("BrowserCacheManager.setServerTelemetry called"),this.setItem(e,JSON.stringify(t),r)}getAuthorityMetadata(e){let t=this.internalStorage.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getAuthorityMetadata: called, no cache hit"),null;let r=this.validateAndParseJson(t);return r&&d.isAuthorityMetadataEntity(e,r)?(this.logger.trace("BrowserCacheManager.getAuthorityMetadata: cache hit"),r):null}getAuthorityMetadataKeys(){return this.internalStorage.getKeys().filter(e=>this.isAuthorityMetadata(e))}setWrapperMetadata(e,t){this.internalStorage.setItem(A.InMemoryCacheKeys.WRAPPER_SKU,e),this.internalStorage.setItem(A.InMemoryCacheKeys.WRAPPER_VER,t)}getWrapperMetadata(){return[this.internalStorage.getItem(A.InMemoryCacheKeys.WRAPPER_SKU)||i.Constants.EMPTY_STRING,this.internalStorage.getItem(A.InMemoryCacheKeys.WRAPPER_VER)||i.Constants.EMPTY_STRING]}setAuthorityMetadata(e,t){this.logger.trace("BrowserCacheManager.setAuthorityMetadata called"),this.internalStorage.setItem(e,JSON.stringify(t))}getActiveAccount(e){let t=this.generateCacheKey(i.PersistentCacheKeys.ACTIVE_ACCOUNT_FILTERS),r=this.browserStorage.getItem(t);if(!r)return this.logger.trace("BrowserCacheManager.getActiveAccount: No active account filters found"),null;let n=this.validateAndParseJson(r);return n?(this.logger.trace("BrowserCacheManager.getActiveAccount: Active account filters schema found"),this.getAccountInfoFilteredBy({homeAccountId:n.homeAccountId,localAccountId:n.localAccountId,tenantId:n.tenantId},e)):(this.logger.trace("BrowserCacheManager.getActiveAccount: No active account found"),null)}setActiveAccount(e,t){let r=this.generateCacheKey(i.PersistentCacheKeys.ACTIVE_ACCOUNT_FILTERS);if(e){this.logger.verbose("setActiveAccount: Active account set");let n={homeAccountId:e.homeAccountId,localAccountId:e.localAccountId,tenantId:e.tenantId,lastUpdatedAt:f.nowSeconds().toString()};this.setItem(r,JSON.stringify(n),t)}else this.logger.verbose("setActiveAccount: No account passed, active account not set"),this.browserStorage.removeItem(r);this.eventHandler.emitEvent(_.EventType.ACTIVE_ACCOUNT_CHANGED)}getThrottlingCache(e){let t=this.browserStorage.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getThrottlingCache: called, no cache hit"),null;let r=this.validateAndParseJson(t);return r&&d.isThrottlingEntity(e,r)?(this.logger.trace("BrowserCacheManager.getThrottlingCache: cache hit"),r):(this.logger.trace("BrowserCacheManager.getThrottlingCache: called, no cache hit"),null)}setThrottlingCache(e,t,r){this.logger.trace("BrowserCacheManager.setThrottlingCache called"),this.setItem(e,JSON.stringify(t),r)}getTemporaryCache(e,t){let r=t?this.generateCacheKey(e):e;if(this.cacheConfig.storeAuthStateInCookie){let e=this.cookieStorage.getItem(r);if(e)return this.logger.trace("BrowserCacheManager.getTemporaryCache: storeAuthStateInCookies set to true, retrieving from cookies"),e}let n=this.temporaryCacheStorage.getItem(r);if(!n){if(this.cacheConfig.cacheLocation===A.BrowserCacheLocation.LocalStorage){let e=this.browserStorage.getItem(r);if(e)return this.logger.trace("BrowserCacheManager.getTemporaryCache: Temporary cache item found in local storage"),e}return this.logger.trace("BrowserCacheManager.getTemporaryCache: No cache item found in local storage"),null}return this.logger.trace("BrowserCacheManager.getTemporaryCache: Temporary cache item returned"),n}setTemporaryCache(e,t,r){let n=r?this.generateCacheKey(e):e;this.temporaryCacheStorage.setItem(n,t),this.cacheConfig.storeAuthStateInCookie&&(this.logger.trace("BrowserCacheManager.setTemporaryCache: storeAuthStateInCookie set to true, setting item cookie"),this.cookieStorage.setItem(n,t,void 0,this.cacheConfig.secureCookies))}removeItem(e){this.browserStorage.removeItem(e)}removeTemporaryItem(e){this.temporaryCacheStorage.removeItem(e),this.cacheConfig.storeAuthStateInCookie&&(this.logger.trace("BrowserCacheManager.removeItem: storeAuthStateInCookie is true, clearing item cookie"),this.cookieStorage.removeItem(e))}getKeys(){return this.browserStorage.getKeys()}clear(e){this.removeAllAccounts(e),this.removeAppMetadata(e),this.temporaryCacheStorage.getKeys().forEach(e=>{(-1!==e.indexOf(E.PREFIX)||-1!==e.indexOf(this.clientId))&&this.removeTemporaryItem(e)}),this.browserStorage.getKeys().forEach(e=>{(-1!==e.indexOf(E.PREFIX)||-1!==e.indexOf(this.clientId))&&this.browserStorage.removeItem(e)}),this.internalStorage.clear()}clearTokensAndKeysWithClaims(e){this.performanceClient.addQueueMeasurement(m.PerformanceEvents.ClearTokensAndKeysWithClaims,e);let t=this.getTokenKeys(),r=0;t.accessToken.forEach(t=>{let n=this.getAccessTokenCredential(t,e);n?.requestedClaimsHash&&t.includes(n.requestedClaimsHash.toLowerCase())&&(this.removeAccessToken(t,e),r++)}),r>0&&this.logger.warning(`${r} access tokens with claims in the cache keys have been removed from the cache.`)}generateCacheKey(e){return C.StringUtils.startsWith(e,E.PREFIX)?e:`${E.PREFIX}.${this.clientId}.${e}`}generateCredentialKey(e){let t=e.credentialType===i.CredentialType.REFRESH_TOKEN&&e.familyId||e.clientId,r=e.tokenType&&e.tokenType.toLowerCase()!==i.AuthenticationScheme.BEARER.toLowerCase()?e.tokenType.toLowerCase():"";return[`${E.PREFIX}.${E.CREDENTIAL_SCHEMA_VERSION}`,e.homeAccountId,e.environment,e.credentialType,t,e.realm||"",e.target||"",e.requestedClaimsHash||"",r].join(E.CACHE_KEY_SEPARATOR).toLowerCase()}generateAccountKey(e){let t=e.homeAccountId.split(".")[1];return[`${E.PREFIX}.${E.ACCOUNT_SCHEMA_VERSION}`,e.homeAccountId,e.environment,t||e.tenantId||""].join(E.CACHE_KEY_SEPARATOR).toLowerCase()}resetRequestCache(){this.logger.trace("BrowserCacheManager.resetRequestCache called"),this.removeTemporaryItem(this.generateCacheKey(A.TemporaryCacheKeys.REQUEST_PARAMS)),this.removeTemporaryItem(this.generateCacheKey(A.TemporaryCacheKeys.VERIFIER)),this.removeTemporaryItem(this.generateCacheKey(A.TemporaryCacheKeys.ORIGIN_URI)),this.removeTemporaryItem(this.generateCacheKey(A.TemporaryCacheKeys.URL_HASH)),this.removeTemporaryItem(this.generateCacheKey(A.TemporaryCacheKeys.NATIVE_REQUEST)),this.setInteractionInProgress(!1)}cacheAuthorizeRequest(e,t){this.logger.trace("BrowserCacheManager.cacheAuthorizeRequest called");let r=(0,S.base64Encode)(JSON.stringify(e));if(this.setTemporaryCache(A.TemporaryCacheKeys.REQUEST_PARAMS,r,!0),t){let e=(0,S.base64Encode)(t);this.setTemporaryCache(A.TemporaryCacheKeys.VERIFIER,e,!0)}}getCachedRequest(){let e;this.logger.trace("BrowserCacheManager.getCachedRequest called");let t=this.getTemporaryCache(A.TemporaryCacheKeys.REQUEST_PARAMS,!0);if(!t)throw(0,y.createBrowserAuthError)(M.noTokenRequestCacheError);let r=this.getTemporaryCache(A.TemporaryCacheKeys.VERIFIER,!0),n="";try{e=JSON.parse((0,w.base64Decode)(t)),r&&(n=(0,w.base64Decode)(r))}catch(e){throw this.logger.errorPii(`Attempted to parse: ${t}`),this.logger.error(`Parsing cached token request threw with error: ${e}`),(0,y.createBrowserAuthError)(M.unableToParseTokenRequestCacheError)}return[e,n]}getCachedNativeRequest(){this.logger.trace("BrowserCacheManager.getCachedNativeRequest called");let e=this.getTemporaryCache(A.TemporaryCacheKeys.NATIVE_REQUEST,!0);if(!e)return this.logger.trace("BrowserCacheManager.getCachedNativeRequest: No cached native request found"),null;let t=this.validateAndParseJson(e);return t||(this.logger.error("BrowserCacheManager.getCachedNativeRequest: Unable to parse native request"),null)}isInteractionInProgress(e){let t=this.getInteractionInProgress()?.clientId;return e?t===this.clientId:!!t}getInteractionInProgress(){let e=`${E.PREFIX}.${A.TemporaryCacheKeys.INTERACTION_STATUS_KEY}`,t=this.getTemporaryCache(e,!1);try{return t?JSON.parse(t):null}catch(t){return this.logger.error("Cannot parse interaction status. Removing temporary cache items and clearing url hash. Retrying interaction should fix the error"),this.removeTemporaryItem(e),this.resetRequestCache(),(0,P.clearHash)(window),null}}setInteractionInProgress(e,t=A.INTERACTION_TYPE.SIGNIN){let r=`${E.PREFIX}.${A.TemporaryCacheKeys.INTERACTION_STATUS_KEY}`;if(e)if(this.getInteractionInProgress())throw(0,y.createBrowserAuthError)(M.interactionInProgress);else this.setTemporaryCache(r,JSON.stringify({clientId:this.clientId,type:t}),!1);else e||this.getInteractionInProgress()?.clientId!==this.clientId||this.removeTemporaryItem(r)}async hydrateCache(e,t){let r,n=d.createIdTokenEntity(e.account?.homeAccountId,e.account?.environment,e.idToken,this.clientId,e.tenantId);t.claims&&(r=await this.cryptoImpl.hashString(t.claims));let o=d.createAccessTokenEntity(e.account?.homeAccountId,e.account.environment,e.accessToken,this.clientId,e.tenantId,e.scopes.join(" "),e.expiresOn?f.toSecondsFromDate(e.expiresOn):0,e.extExpiresOn?f.toSecondsFromDate(e.extExpiresOn):0,w.base64Decode,void 0,e.tokenType,void 0,t.sshKid,t.claims,r);return this.saveCacheRecord({idToken:n,accessToken:o},e.correlationId,a.isKmsi(a.extractTokenClaims(e.idToken,w.base64Decode)))}async saveCacheRecord(e,t,r,n){try{await super.saveCacheRecord(e,t,r,n)}catch(e){if(e instanceof c.CacheError&&this.performanceClient&&t)try{let e=this.getTokenKeys();this.performanceClient.addFields({cacheRtCount:e.refreshToken.length,cacheIdCount:e.idToken.length,cacheAtCount:e.accessToken.length},t)}catch(e){}throw e}}}function U(e,t,r,n){try{switch(t){case A.BrowserCacheLocation.LocalStorage:return new(0,v.LocalStorage)(e,r,n);case A.BrowserCacheLocation.SessionStorage:return new(0,T.SessionStorage);case A.BrowserCacheLocation.MemoryStorage:}}catch(e){r.error(e)}return new(0,I.MemoryStorage)}let D=(e,t,r,n)=>new x(e,{cacheLocation:A.BrowserCacheLocation.MemoryStorage,cacheRetentionDays:5,temporaryCacheLocation:A.BrowserCacheLocation.MemoryStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!1,claimsBasedCachingEnabled:!1},u.DEFAULT_CRYPTO_IMPLEMENTATION,t,r,n)}),i("dbZkI",function(t,r){e(t.exports,"LocalStorage",()=>A);var n=o("9tUvn"),i=o("gnfKd"),a=o("7oR2q"),s=o("cx3ku"),c=o("7e5V2"),l=o("6HXlN"),d=o("3sRdd"),h=o("1GrlD"),u=o("2cRj3"),p=o("7v4ap"),g=o("2wtIk"),m=o("dovbF"),C=o("4Zp7P"),f=o("4pKco");let y="msal.cache.encryption";class A{constructor(e,t,r){if(!window.localStorage)throw(0,d.createBrowserConfigurationAuthError)(C.storageNotSupported);this.memoryStorage=new(0,u.MemoryStorage),this.initialized=!1,this.clientId=e,this.logger=t,this.performanceClient=r,this.broadcast=new BroadcastChannel("msal.broadcast.cache")}async initialize(e){let t=new(0,h.CookieStorage),r=t.getItem(y),o={key:"",id:""};if(r)try{o=JSON.parse(r)}catch(e){}if(o.key&&o.id){let t=(0,n.invoke)(s.base64DecToArr,i.PerformanceEvents.Base64Decode,this.logger,this.performanceClient,e)(o.key);this.encryptionCookie={id:o.id,key:await (0,n.invokeAsync)(a.generateHKDF,i.PerformanceEvents.GenerateHKDF,this.logger,this.performanceClient,e)(t)}}else{let r=(0,a.createNewGuid)(),o=await (0,n.invokeAsync)(a.generateBaseKey,i.PerformanceEvents.GenerateBaseKey,this.logger,this.performanceClient,e)(),s=(0,n.invoke)(c.urlEncodeArr,i.PerformanceEvents.UrlEncodeArr,this.logger,this.performanceClient,e)(new Uint8Array(o));this.encryptionCookie={id:r,key:await (0,n.invokeAsync)(a.generateHKDF,i.PerformanceEvents.GenerateHKDF,this.logger,this.performanceClient,e)(o)},t.setItem(y,JSON.stringify({id:r,key:s}),0,!0,h.SameSiteOptions.None)}await (0,n.invokeAsync)(this.importExistingCache.bind(this),i.PerformanceEvents.ImportExistingCache,this.logger,this.performanceClient,e)(e),this.broadcast.addEventListener("message",this.updateCache.bind(this)),this.initialized=!0}getItem(e){return window.localStorage.getItem(e)}getUserData(e){if(!this.initialized)throw(0,l.createBrowserAuthError)(f.uninitializedPublicClientApplication);return this.memoryStorage.getItem(e)}async decryptData(e,t,r){if(!this.initialized||!this.encryptionCookie)throw(0,l.createBrowserAuthError)(f.uninitializedPublicClientApplication);if(t.id!==this.encryptionCookie.id)return this.performanceClient.incrementFields({encryptedCacheExpiredCount:1},r),null;let o=await (0,n.invokeAsync)(a.decrypt,i.PerformanceEvents.Decrypt,this.logger,this.performanceClient,r)(this.encryptionCookie.key,t.nonce,this.getContext(e),t.data);if(!o)return null;try{return{...JSON.parse(o),lastUpdatedAt:t.lastUpdatedAt}}catch(e){return this.performanceClient.incrementFields({encryptedCacheCorruptionCount:1},r),null}}setItem(e,t){window.localStorage.setItem(e,t)}async setUserData(e,t,r,o,s){if(!this.initialized||!this.encryptionCookie)throw(0,l.createBrowserAuthError)(f.uninitializedPublicClientApplication);if(s)this.setItem(e,t);else{let{data:s,nonce:c}=await (0,n.invokeAsync)(a.encrypt,i.PerformanceEvents.Encrypt,this.logger,this.performanceClient,r)(this.encryptionCookie.key,t,this.getContext(e)),l={id:this.encryptionCookie.id,nonce:c,data:s,lastUpdatedAt:o};this.setItem(e,JSON.stringify(l))}this.memoryStorage.setItem(e,t),this.broadcast.postMessage({key:e,value:t,context:this.getContext(e)})}removeItem(e){this.memoryStorage.containsKey(e)&&(this.memoryStorage.removeItem(e),this.broadcast.postMessage({key:e,value:null,context:this.getContext(e)})),window.localStorage.removeItem(e)}getKeys(){return Object.keys(window.localStorage)}containsKey(e){return window.localStorage.hasOwnProperty(e)}clear(){this.memoryStorage.clear(),(0,p.getAccountKeys)(this).forEach(e=>this.removeItem(e));let e=(0,p.getTokenKeys)(this.clientId,this);e.idToken.forEach(e=>this.removeItem(e)),e.accessToken.forEach(e=>this.removeItem(e)),e.refreshToken.forEach(e=>this.removeItem(e)),this.getKeys().forEach(e=>{(e.startsWith(g.PREFIX)||-1!==e.indexOf(this.clientId))&&this.removeItem(e)})}async importExistingCache(e){if(!this.encryptionCookie)return;let t=(0,p.getAccountKeys)(this);(t=await this.importArray(t,e)).length?this.setItem((0,g.getAccountKeysCacheKey)(),JSON.stringify(t)):this.removeItem((0,g.getAccountKeysCacheKey)());let r=(0,p.getTokenKeys)(this.clientId,this);r.idToken=await this.importArray(r.idToken,e),r.accessToken=await this.importArray(r.accessToken,e),r.refreshToken=await this.importArray(r.refreshToken,e),r.idToken.length||r.accessToken.length||r.refreshToken.length?this.setItem((0,g.getTokenKeysCacheKey)(this.clientId),JSON.stringify(r)):this.removeItem((0,g.getTokenKeysCacheKey)(this.clientId))}async getItemFromEncryptedCache(e,t){let r;if(!this.encryptionCookie)return null;let o=this.getItem(e);if(!o)return null;try{r=JSON.parse(o)}catch(e){return null}return(0,m.isEncrypted)(r)?r.id!==this.encryptionCookie.id?(this.performanceClient.incrementFields({encryptedCacheExpiredCount:1},t),null):(this.performanceClient.incrementFields({encryptedCacheCount:1},t),(0,n.invokeAsync)(a.decrypt,i.PerformanceEvents.Decrypt,this.logger,this.performanceClient,t)(this.encryptionCookie.key,r.nonce,this.getContext(e),r.data)):(this.performanceClient.incrementFields({unencryptedCacheCount:1},t),o)}async importArray(e,t){let r=[],n=[];return e.forEach(e=>{let o=this.getItemFromEncryptedCache(e,t).then(t=>{t?(this.memoryStorage.setItem(e,t),r.push(e)):this.removeItem(e)});n.push(o)}),await Promise.all(n),r}getContext(e){let t="";return e.includes(this.clientId)&&(t=this.clientId),t}updateCache(e){this.logger.trace("Updating internal cache from broadcast event");let t=this.performanceClient.startMeasurement(i.PerformanceEvents.LocalStorageUpdated);t.add({isBackground:!0});let{key:r,value:n,context:o}=e.data;if(!r){this.logger.error("Broadcast event missing key"),t.end({success:!1,errorCode:"noKey"});return}if(o&&o!==this.clientId){this.logger.trace(`Ignoring broadcast event from clientId: ${o}`),t.end({success:!1,errorCode:"contextMismatch"});return}n?(this.memoryStorage.setItem(r,n),this.logger.verbose("Updated item in internal cache")):(this.memoryStorage.removeItem(r),this.logger.verbose("Removed item from internal cache")),t.end({success:!0})}}}),i("1GrlD",function(t,r){e(t.exports,"SameSiteOptions",()=>a),e(t.exports,"CookieStorage",()=>s);var n=o("l6ONb"),i=o("anIdE");let a={Lax:"Lax",None:"None"};class s{initialize(){return Promise.resolve()}getItem(e){let t=`${encodeURIComponent(e)}`,r=document.cookie.split(";");for(let e=0;e<r.length;e++){let[n,...o]=decodeURIComponent(r[e]).trim().split("="),i=o.join("=");if(n===t)return i}return""}getUserData(){throw(0,i.createClientAuthError)(n.methodNotImplemented)}setItem(e,t,r,n=!0,o=a.Lax){let i=`${encodeURIComponent(e)}=${encodeURIComponent(t)};path=/;SameSite=${o};`;if(r){var s;let e=(s=r,new Date(new Date().getTime()+864e5*s).toUTCString());i+=`expires=${e};`}(n||o===a.None)&&(i+="Secure;"),document.cookie=i}async setUserData(){return Promise.reject((0,i.createClientAuthError)(n.methodNotImplemented))}removeItem(e){this.setItem(e,"",-1)}getKeys(){let e=document.cookie.split(";"),t=[];return e.forEach(e=>{let r=decodeURIComponent(e).trim().split("=");t.push(r[0])}),t}containsKey(e){return this.getKeys().includes(e)}decryptData(){return Promise.resolve(null)}}}),i("7v4ap",function(t,r){e(t.exports,"getAccountKeys",()=>i),e(t.exports,"getTokenKeys",()=>a);var n=o("2wtIk");function i(e,t){let r=e.getItem((0,n.getAccountKeysCacheKey)(t));return r?JSON.parse(r):[]}function a(e,t,r){let o=t.getItem((0,n.getTokenKeysCacheKey)(e,r));if(o){let e=JSON.parse(o);if(e&&e.hasOwnProperty("idToken")&&e.hasOwnProperty("accessToken")&&e.hasOwnProperty("refreshToken"))return e}return{idToken:[],accessToken:[],refreshToken:[]}}}),i("dovbF",function(t,r){e(t.exports,"isEncrypted",()=>n);function n(e){return e.hasOwnProperty("id")&&e.hasOwnProperty("nonce")&&e.hasOwnProperty("data")}}),i("44vvC",function(t,r){e(t.exports,"SessionStorage",()=>a);var n=o("3sRdd"),i=o("4Zp7P");class a{constructor(){if(!window.sessionStorage)throw(0,n.createBrowserConfigurationAuthError)(i.storageNotSupported)}async initialize(){}getItem(e){return window.sessionStorage.getItem(e)}getUserData(e){return this.getItem(e)}setItem(e,t){window.sessionStorage.setItem(e,t)}async setUserData(e,t){this.setItem(e,t)}removeItem(e){window.sessionStorage.removeItem(e)}getKeys(){return Object.keys(window.sessionStorage)}containsKey(e){return window.sessionStorage.hasOwnProperty(e)}decryptData(){return Promise.resolve(null)}}}),i("fKG6z",function(t,r){e(t.exports,"EventType",()=>n);let n={INITIALIZE_START:"msal:initializeStart",INITIALIZE_END:"msal:initializeEnd",ACCOUNT_ADDED:"msal:accountAdded",ACCOUNT_REMOVED:"msal:accountRemoved",ACTIVE_ACCOUNT_CHANGED:"msal:activeAccountChanged",LOGIN_START:"msal:loginStart",LOGIN_SUCCESS:"msal:loginSuccess",LOGIN_FAILURE:"msal:loginFailure",ACQUIRE_TOKEN_START:"msal:acquireTokenStart",ACQUIRE_TOKEN_SUCCESS:"msal:acquireTokenSuccess",ACQUIRE_TOKEN_FAILURE:"msal:acquireTokenFailure",ACQUIRE_TOKEN_NETWORK_START:"msal:acquireTokenFromNetworkStart",SSO_SILENT_START:"msal:ssoSilentStart",SSO_SILENT_SUCCESS:"msal:ssoSilentSuccess",SSO_SILENT_FAILURE:"msal:ssoSilentFailure",ACQUIRE_TOKEN_BY_CODE_START:"msal:acquireTokenByCodeStart",ACQUIRE_TOKEN_BY_CODE_SUCCESS:"msal:acquireTokenByCodeSuccess",ACQUIRE_TOKEN_BY_CODE_FAILURE:"msal:acquireTokenByCodeFailure",HANDLE_REDIRECT_START:"msal:handleRedirectStart",HANDLE_REDIRECT_END:"msal:handleRedirectEnd",POPUP_OPENED:"msal:popupOpened",LOGOUT_START:"msal:logoutStart",LOGOUT_SUCCESS:"msal:logoutSuccess",LOGOUT_FAILURE:"msal:logoutFailure",LOGOUT_END:"msal:logoutEnd",RESTORE_FROM_BFCACHE:"msal:restoreFromBFCache",BROKER_CONNECTION_ESTABLISHED:"msal:brokerConnectionEstablished"}}),i("heg4K",function(t,r){e(t.exports,"removeElementFromArray",()=>n);function n(e,t){let r=e.indexOf(t);r>-1&&e.splice(r,1)}}),i("cPkCm",function(t,r){function n(e,t,r,n,o){return e.verbose("getAllAccounts called"),r?t.getAllAccounts(o||{},n):[]}function o(e,t,r,n){let o=r.getAccountInfoFilteredBy(e,n);return o?(t.verbose("getAccount: Account matching provided filter found, returning"),o):(t.verbose("getAccount: No matching account found, returning null"),null)}function i(e,t,r,n){if(t.trace("getAccountByUsername called"),!e)return t.warning("getAccountByUsername: No username provided"),null;let o=r.getAccountInfoFilteredBy({username:e},n);return o?(t.verbose("getAccountByUsername: Account matching username found, returning"),t.verbosePii(`getAccountByUsername: Returning signed-in accounts matching username: ${e}`),o):(t.verbose("getAccountByUsername: No matching account found, returning null"),null)}function a(e,t,r,n){if(t.trace("getAccountByHomeId called"),!e)return t.warning("getAccountByHomeId: No homeAccountId provided"),null;let o=r.getAccountInfoFilteredBy({homeAccountId:e},n);return o?(t.verbose("getAccountByHomeId: Account matching homeAccountId found, returning"),t.verbosePii(`getAccountByHomeId: Returning signed-in accounts matching homeAccountId: ${e}`),o):(t.verbose("getAccountByHomeId: No matching account found, returning null"),null)}function s(e,t,r,n){if(t.trace("getAccountByLocalId called"),!e)return t.warning("getAccountByLocalId: No localAccountId provided"),null;let o=r.getAccountInfoFilteredBy({localAccountId:e},n);return o?(t.verbose("getAccountByLocalId: Account matching localAccountId found, returning"),t.verbosePii(`getAccountByLocalId: Returning signed-in accounts matching localAccountId: ${e}`),o):(t.verbose("getAccountByLocalId: No matching account found, returning null"),null)}function c(e,t,r){t.setActiveAccount(e,r)}function l(e,t){return e.getActiveAccount(t)}e(t.exports,"getAllAccounts",()=>n),e(t.exports,"getAccount",()=>o),e(t.exports,"getAccountByUsername",()=>i),e(t.exports,"getAccountByHomeId",()=>a),e(t.exports,"getAccountByLocalId",()=>s),e(t.exports,"setActiveAccount",()=>c),e(t.exports,"getActiveAccount",()=>l)}),i("6QPkA",function(t,r){e(t.exports,"EventHandler",()=>s);var n=o("lxp2N"),i=o("fKG6z"),a=o("5S1XQ");class s{constructor(e){this.eventCallbacks=new Map,this.logger=e||new(0,n.Logger)({}),"undefined"!=typeof BroadcastChannel&&(this.broadcastChannel=new BroadcastChannel("msal.broadcast.event")),this.invokeCrossTabCallbacks=this.invokeCrossTabCallbacks.bind(this)}addEventCallback(e,t,r){if("undefined"!=typeof window){let n=r||(0,a.createGuid)();return this.eventCallbacks.has(n)?(this.logger.error(`Event callback with id: ${n} is already registered. Please provide a unique id or remove the existing callback and try again.`),null):(this.eventCallbacks.set(n,[e,t||[]]),this.logger.verbose(`Event callback registered with id: ${n}`),n)}return null}removeEventCallback(e){this.eventCallbacks.delete(e),this.logger.verbose(`Event callback ${e} removed.`)}emitEvent(e,t,r,n){let o={eventType:e,interactionType:t||null,payload:r||null,error:n||null,timestamp:Date.now()};switch(e){case i.EventType.ACCOUNT_ADDED:case i.EventType.ACCOUNT_REMOVED:case i.EventType.ACTIVE_ACCOUNT_CHANGED:this.broadcastChannel?.postMessage(o);break;default:this.invokeCallbacks(o)}}invokeCallbacks(e){this.eventCallbacks.forEach(([t,r],n)=>{(0===r.length||r.includes(e.eventType))&&(this.logger.verbose(`Emitting event to callback ${n}: ${e.eventType}`),t.apply(null,[e]))})}invokeCrossTabCallbacks(e){let t=e.data;this.invokeCallbacks(t)}subscribeCrossTab(){this.broadcastChannel?.addEventListener("message",this.invokeCrossTabCallbacks)}unsubscribeCrossTab(){this.broadcastChannel?.removeEventListener("message",this.invokeCrossTabCallbacks)}}}),i("4Zpbd",function(t,r){e(t.exports,"PopupClient",()=>T);var n=o("ckDmJ"),i=o("gmw86"),a=o("9tUvn"),s=o("gnfKd"),c=o("77Sbs"),l=o("gkKSO"),d=o("5glYQ"),h=o("fKG6z"),u=o("dp0vd"),p=o("5S1XQ"),g=o("6HXlN"),m=o("29emz"),C=o("1cQ8k"),f=o("lcP17"),y=o("2pUnf"),A=o("7oR2q"),E=o("cDkFB"),v=o("4pKco");class T extends d.StandardInteractionClient{constructor(e,t,r,n,o,i,a,s,c,l){super(e,t,r,n,o,i,a,c,l),this.unloadWindow=this.unloadWindow.bind(this),this.nativeStorage=s,this.eventHandler=o}acquireToken(e,t){let r;try{if(r={popupName:this.generatePopupName(e.scopes||i.OIDC_DEFAULT_SCOPES,e.authority||this.config.auth.authority),popupWindowAttributes:e.popupWindowAttributes||{},popupWindowParent:e.popupWindowParent??window},this.performanceClient.addFields({isAsyncPopup:this.config.system.asyncPopups},this.correlationId),this.config.system.asyncPopups)return this.logger.verbose("asyncPopups set to true, acquiring token"),this.acquireTokenPopupAsync(e,r,t);{let n={...e,httpMethod:(0,E.validateRequestMethod)(e,this.config.auth.protocolMode)};return this.logger.verbose("asyncPopup set to false, opening popup before acquiring token"),r.popup=this.openSizedPopup("about:blank",r),this.acquireTokenPopupAsync(n,r,t)}}catch(e){return Promise.reject(e)}}logout(e){try{this.logger.verbose("logoutPopup called");let t=this.initializeLogoutRequest(e),r={popupName:this.generateLogoutPopupName(t),popupWindowAttributes:e?.popupWindowAttributes||{},popupWindowParent:e?.popupWindowParent??window},n=e&&e.authority,o=e&&e.mainWindowRedirectUri;if(this.config.system.asyncPopups)return this.logger.verbose("asyncPopups set to true"),this.logoutPopupAsync(t,r,n,o);return this.logger.verbose("asyncPopup set to false, opening popup"),r.popup=this.openSizedPopup("about:blank",r),this.logoutPopupAsync(t,r,n,o)}catch(e){return Promise.reject(e)}}async acquireTokenPopupAsync(e,t,r){this.logger.verbose("acquireTokenPopupAsync called");let n=await (0,a.invokeAsync)(this.initializeAuthorizationRequest.bind(this),s.PerformanceEvents.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,this.correlationId)(e,u.InteractionType.Popup);return(t.popup&&(0,p.preconnect)(n.authority),n.platformBroker=(0,y.isPlatformAuthAllowed)(this.config,this.logger,this.platformAuthProvider,e.authenticationScheme),this.config.auth.protocolMode===c.ProtocolMode.EAR)?this.executeEarFlow(n,t):this.executeCodeFlow(n,t,r)}async executeCodeFlow(e,t,r){let o=e.correlationId,c=this.initializeServerTelemetryManager(u.ApiId.acquireTokenPopup),l=r||await (0,a.invokeAsync)(f.generatePkceCodes,s.PerformanceEvents.GeneratePkceCodes,this.logger,this.performanceClient,o)(this.performanceClient,this.logger,o),d={...e,codeChallenge:l.challenge};try{let r=await (0,a.invokeAsync)(this.createAuthCodeClient.bind(this),s.PerformanceEvents.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,o)({serverTelemetryManager:c,requestAuthority:d.authority,requestAzureCloudOptions:d.azureCloudOptions,requestExtraQueryParameters:d.extraQueryParameters,account:d.account});if(d.httpMethod===i.HttpMethod.POST)return await this.executeCodeFlowWithPost(d,t,r,l.verifier);{let n=await (0,a.invokeAsync)(C.getAuthCodeRequestUrl,s.PerformanceEvents.GetAuthCodeUrl,this.logger,this.performanceClient,o)(this.config,r.authority,d,this.logger,this.performanceClient),i=this.initiateAuthRequest(n,t);this.eventHandler.emitEvent(h.EventType.POPUP_OPENED,u.InteractionType.Popup,{popupWindow:i},null);let c=await this.monitorPopupForHash(i,t.popupWindowParent),p=(0,a.invoke)(m.deserializeResponse,s.PerformanceEvents.DeserializeResponse,this.logger,this.performanceClient,this.correlationId)(c,this.config.auth.OIDCOptions.serverResponseType,this.logger);return await (0,a.invokeAsync)(C.handleResponseCode,s.PerformanceEvents.HandleResponseCode,this.logger,this.performanceClient,o)(e,p,l.verifier,u.ApiId.acquireTokenPopup,this.config,r,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}}catch(e){throw t.popup?.close(),e instanceof n.AuthError&&(e.setCorrelationId(this.correlationId),c.cacheFailedRequest(e)),e}}async executeEarFlow(e,t){let r=e.correlationId,n=await (0,a.invokeAsync)(this.getDiscoveredAuthority.bind(this),s.PerformanceEvents.StandardInteractionClientGetDiscoveredAuthority,this.logger,this.performanceClient,r)({requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account}),o=await (0,a.invokeAsync)(A.generateEarKey,s.PerformanceEvents.GenerateEarKey,this.logger,this.performanceClient,r)(),i={...e,earJwk:o},c=t.popup||this.openPopup("about:blank",t);(await (0,C.getEARForm)(c.document,this.config,n,i,this.logger,this.performanceClient)).submit();let l=await (0,a.invokeAsync)(this.monitorPopupForHash.bind(this),s.PerformanceEvents.SilentHandlerMonitorIframeForHash,this.logger,this.performanceClient,r)(c,t.popupWindowParent),d=(0,a.invoke)(m.deserializeResponse,s.PerformanceEvents.DeserializeResponse,this.logger,this.performanceClient,this.correlationId)(l,this.config.auth.OIDCOptions.serverResponseType,this.logger);return(0,a.invokeAsync)(C.handleResponseEAR,s.PerformanceEvents.HandleResponseEar,this.logger,this.performanceClient,r)(i,d,u.ApiId.acquireTokenPopup,this.config,n,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}async executeCodeFlowWithPost(e,t,r,n){let o=e.correlationId,i=await (0,a.invokeAsync)(this.getDiscoveredAuthority.bind(this),s.PerformanceEvents.StandardInteractionClientGetDiscoveredAuthority,this.logger,this.performanceClient,o)({requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account}),c=t.popup||this.openPopup("about:blank",t);(await (0,C.getCodeForm)(c.document,this.config,i,e,this.logger,this.performanceClient)).submit();let l=await (0,a.invokeAsync)(this.monitorPopupForHash.bind(this),s.PerformanceEvents.SilentHandlerMonitorIframeForHash,this.logger,this.performanceClient,o)(c,t.popupWindowParent),d=(0,a.invoke)(m.deserializeResponse,s.PerformanceEvents.DeserializeResponse,this.logger,this.performanceClient,this.correlationId)(l,this.config.auth.OIDCOptions.serverResponseType,this.logger);return(0,a.invokeAsync)(C.handleResponseCode,s.PerformanceEvents.HandleResponseCode,this.logger,this.performanceClient,o)(e,d,n,u.ApiId.acquireTokenPopup,this.config,r,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}async logoutPopupAsync(e,t,r,o){this.logger.verbose("logoutPopupAsync called"),this.eventHandler.emitEvent(h.EventType.LOGOUT_START,u.InteractionType.Popup,e);let i=this.initializeServerTelemetryManager(u.ApiId.logoutPopup);try{await this.clearCacheOnLogout(this.correlationId,e.account);let n=await (0,a.invokeAsync)(this.createAuthCodeClient.bind(this),s.PerformanceEvents.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:i,requestAuthority:r,account:e.account||void 0});try{n.authority.endSessionEndpoint}catch{if(e.account?.homeAccountId&&e.postLogoutRedirectUri&&n.authority.protocolMode===c.ProtocolMode.OIDC){if(this.eventHandler.emitEvent(h.EventType.LOGOUT_SUCCESS,u.InteractionType.Popup,e),o){let e={apiId:u.ApiId.logoutPopup,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},t=l.UrlString.getAbsoluteUrl(o,(0,p.getCurrentUri)());await this.navigationClient.navigateInternal(t,e)}t.popup?.close();return}}let d=n.getLogoutUri(e);this.eventHandler.emitEvent(h.EventType.LOGOUT_SUCCESS,u.InteractionType.Popup,e);let g=this.openPopup(d,t);if(this.eventHandler.emitEvent(h.EventType.POPUP_OPENED,u.InteractionType.Popup,{popupWindow:g},null),await this.monitorPopupForHash(g,t.popupWindowParent).catch(()=>{}),o){let e={apiId:u.ApiId.logoutPopup,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},t=l.UrlString.getAbsoluteUrl(o,(0,p.getCurrentUri)());this.logger.verbose("Redirecting main window to url specified in the request"),this.logger.verbosePii(`Redirecting main window to: ${t}`),await this.navigationClient.navigateInternal(t,e)}else this.logger.verbose("No main window navigation requested")}catch(e){throw t.popup?.close(),e instanceof n.AuthError&&(e.setCorrelationId(this.correlationId),i.cacheFailedRequest(e)),this.eventHandler.emitEvent(h.EventType.LOGOUT_FAILURE,u.InteractionType.Popup,null,e),this.eventHandler.emitEvent(h.EventType.LOGOUT_END,u.InteractionType.Popup),e}this.eventHandler.emitEvent(h.EventType.LOGOUT_END,u.InteractionType.Popup)}initiateAuthRequest(e,t){if(e)return this.logger.infoPii(`Navigate to: ${e}`),this.openPopup(e,t);throw this.logger.error("Navigate url is empty"),(0,g.createBrowserAuthError)(v.emptyNavigateUri)}monitorPopupForHash(e,t){return new Promise((t,r)=>{this.logger.verbose("PopupHandler.monitorPopupForHash - polling started");let n=setInterval(()=>{if(e.closed){this.logger.error("PopupHandler.monitorPopupForHash - window closed"),clearInterval(n),r((0,g.createBrowserAuthError)(v.userCancelled));return}let o="";try{o=e.location.href}catch(e){}if(!o||"about:blank"===o)return;clearInterval(n);let a="",s=this.config.auth.OIDCOptions.serverResponseType;e&&(a=s===i.ServerResponseType.QUERY?e.location.search:e.location.hash),this.logger.verbose("PopupHandler.monitorPopupForHash - popup window is on same origin as caller"),t(a)},this.config.system.pollIntervalMilliseconds)}).finally(()=>{this.cleanPopup(e,t)})}openPopup(e,t){try{let r;if(t.popup?(r=t.popup,this.logger.verbosePii(`Navigating popup window to: ${e}`),r.location.assign(e)):void 0===t.popup&&(this.logger.verbosePii(`Opening popup window to: ${e}`),r=this.openSizedPopup(e,t)),!r)throw(0,g.createBrowserAuthError)(v.emptyWindowError);return r.focus&&r.focus(),this.currentWindow=r,t.popupWindowParent.addEventListener("beforeunload",this.unloadWindow),r}catch(e){throw this.logger.error("error opening popup "+e.message),(0,g.createBrowserAuthError)(v.popupWindowError)}}openSizedPopup(e,{popupName:t,popupWindowAttributes:r,popupWindowParent:n}){let o=n.screenLeft?n.screenLeft:n.screenX,i=n.screenTop?n.screenTop:n.screenY,a=n.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,s=n.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,c=r.popupSize?.width,l=r.popupSize?.height,d=r.popupPosition?.top,h=r.popupPosition?.left;return(!c||c<0||c>a)&&(this.logger.verbose("Default popup window width used. Window width not configured or invalid."),c=u.BrowserConstants.POPUP_WIDTH),(!l||l<0||l>s)&&(this.logger.verbose("Default popup window height used. Window height not configured or invalid."),l=u.BrowserConstants.POPUP_HEIGHT),(!d||d<0||d>s)&&(this.logger.verbose("Default popup window top position used. Window top not configured or invalid."),d=Math.max(0,s/2-u.BrowserConstants.POPUP_HEIGHT/2+i)),(!h||h<0||h>a)&&(this.logger.verbose("Default popup window left position used. Window left not configured or invalid."),h=Math.max(0,a/2-u.BrowserConstants.POPUP_WIDTH/2+o)),n.open(e,t,`width=${c}, height=${l}, top=${d}, left=${h}, scrollbars=yes`)}unloadWindow(e){this.currentWindow&&this.currentWindow.close(),e.preventDefault()}cleanPopup(e,t){e.close(),t.removeEventListener("beforeunload",this.unloadWindow)}generatePopupName(e,t){return`${u.BrowserConstants.POPUP_NAME_PREFIX}.${this.config.auth.clientId}.${e.join("-")}.${t}.${this.correlationId}`}generateLogoutPopupName(e){let t=e.account&&e.account.homeAccountId;return`${u.BrowserConstants.POPUP_NAME_PREFIX}.${this.config.auth.clientId}.${t}.${this.correlationId}`}}}),i("5glYQ",function(t,r){e(t.exports,"StandardInteractionClient",()=>C);var n=o("gMTsE"),i=o("gmw86"),a=o("9tUvn"),s=o("gnfKd"),c=o("1Fwao"),l=o("gkKSO"),d=o("24aK6"),h=o("dp0vd"),u=o("2QnKr"),p=o("5S1XQ"),g=o("7oR2q"),m=o("cDkFB");class C extends d.BaseInteractionClient{initializeLogoutRequest(e){this.logger.verbose("initializeLogoutRequest called",e?.correlationId);let t={correlationId:this.correlationId||(0,g.createNewGuid)(),...e};if(e)if(e.logoutHint)this.logger.verbose("logoutHint has already been set in logoutRequest");else if(e.account){let r=this.getLogoutHintFromIdTokenClaims(e.account);r&&(this.logger.verbose("Setting logoutHint to login_hint ID Token Claim value for the account provided"),t.logoutHint=r)}else this.logger.verbose("logoutHint was not set and account was not passed into logout request, logoutHint will not be set");else this.logger.verbose("logoutHint will not be set since no logout request was configured");return e&&null===e.postLogoutRedirectUri?this.logger.verbose("postLogoutRedirectUri passed as null, not setting post logout redirect uri",t.correlationId):e&&e.postLogoutRedirectUri?(this.logger.verbose("Setting postLogoutRedirectUri to uri set on logout request",t.correlationId),t.postLogoutRedirectUri=l.UrlString.getAbsoluteUrl(e.postLogoutRedirectUri,(0,p.getCurrentUri)())):null===this.config.auth.postLogoutRedirectUri?this.logger.verbose("postLogoutRedirectUri configured as null and no uri set on request, not passing post logout redirect",t.correlationId):this.config.auth.postLogoutRedirectUri?(this.logger.verbose("Setting postLogoutRedirectUri to configured uri",t.correlationId),t.postLogoutRedirectUri=l.UrlString.getAbsoluteUrl(this.config.auth.postLogoutRedirectUri,(0,p.getCurrentUri)())):(this.logger.verbose("Setting postLogoutRedirectUri to current page",t.correlationId),t.postLogoutRedirectUri=l.UrlString.getAbsoluteUrl((0,p.getCurrentUri)(),(0,p.getCurrentUri)())),t}getLogoutHintFromIdTokenClaims(e){let t=e.idTokenClaims;if(t)if(t.login_hint)return t.login_hint;else this.logger.verbose("The ID Token Claims tied to the provided account do not contain a login_hint claim, logoutHint will not be added to logout request");else this.logger.verbose("The provided account does not contain ID Token Claims, logoutHint will not be added to logout request");return null}async createAuthCodeClient(e){this.performanceClient.addQueueMeasurement(s.PerformanceEvents.StandardInteractionClientCreateAuthCodeClient,this.correlationId);let t=await (0,a.invokeAsync)(this.getClientConfiguration.bind(this),s.PerformanceEvents.StandardInteractionClientGetClientConfiguration,this.logger,this.performanceClient,this.correlationId)(e);return new(0,n.AuthorizationCodeClient)(t,this.performanceClient)}async getClientConfiguration(e){let{serverTelemetryManager:t,requestAuthority:r,requestAzureCloudOptions:n,requestExtraQueryParameters:o,account:c}=e;this.performanceClient.addQueueMeasurement(s.PerformanceEvents.StandardInteractionClientGetClientConfiguration,this.correlationId);let l=await (0,a.invokeAsync)(this.getDiscoveredAuthority.bind(this),s.PerformanceEvents.StandardInteractionClientGetDiscoveredAuthority,this.logger,this.performanceClient,this.correlationId)({requestAuthority:r,requestAzureCloudOptions:n,requestExtraQueryParameters:o,account:c}),d=this.config.system.loggerOptions;return{authOptions:{clientId:this.config.auth.clientId,authority:l,clientCapabilities:this.config.auth.clientCapabilities,redirectUri:this.config.auth.redirectUri},systemOptions:{tokenRenewalOffsetSeconds:this.config.system.tokenRenewalOffsetSeconds,preventCorsPreflight:!0},loggerOptions:{loggerCallback:d.loggerCallback,piiLoggingEnabled:d.piiLoggingEnabled,logLevel:d.logLevel,correlationId:this.correlationId},cacheOptions:{claimsBasedCachingEnabled:this.config.cache.claimsBasedCachingEnabled},cryptoInterface:this.browserCrypto,networkInterface:this.networkClient,storageInterface:this.browserStorage,serverTelemetryManager:t,libraryInfo:{sku:h.BrowserConstants.MSAL_SKU,version:u.version,cpu:i.Constants.EMPTY_STRING,os:i.Constants.EMPTY_STRING},telemetry:this.config.telemetry}}async initializeAuthorizationRequest(e,t){this.performanceClient.addQueueMeasurement(s.PerformanceEvents.StandardInteractionClientInitializeAuthorizationRequest,this.correlationId);let r=this.getRedirectUri(e.redirectUri),n=c.ProtocolUtils.setRequestState(this.browserCrypto,e&&e.state||i.Constants.EMPTY_STRING,{interactionType:t}),o={...await (0,a.invokeAsync)(m.initializeBaseRequest,s.PerformanceEvents.InitializeBaseRequest,this.logger,this.performanceClient,this.correlationId)({...e,correlationId:this.correlationId},this.config,this.performanceClient,this.logger),redirectUri:r,state:n,nonce:e.nonce||(0,g.createNewGuid)(),responseMode:this.config.auth.OIDCOptions.serverResponseType},l={...o,httpMethod:(0,m.validateRequestMethod)(o,this.config.auth.protocolMode)};if(e.loginHint||e.sid)return l;let d=e.account||this.browserStorage.getActiveAccount(this.correlationId);return d&&(this.logger.verbose("Setting validated request account",this.correlationId),this.logger.verbosePii(`Setting validated request account: ${d.homeAccountId}`,this.correlationId),l.account=d),l}}}),i("gMTsE",function(t,r){e(t.exports,"AuthorizationCodeClient",()=>S);var n=o("fV1L4"),i=o("cnNuz"),a=o("8S0Fg"),s=o("gmw86"),c=o("1EdUE"),l=o("cnTdK"),d=o("aomzz"),h=o("7yP0u"),u=o("anIdE"),p=o("gkKSO"),g=o("8B0BQ"),m=o("jl1FD"),C=o("2n5CL"),f=o("gXRij"),y=o("jYvjz"),A=o("gnfKd"),E=o("9tUvn"),v=o("hpubR"),T=o("dO1mF"),I=o("l6ONb"),w=o("cmWPH");class S extends n.BaseClient{constructor(e,t){super(e,t),this.includeRedirectUri=!0,this.oidcDefaultScopes=this.config.authOptions.authority.options.OIDCOptions?.defaultScopes}async acquireToken(e,t){if(this.performanceClient?.addQueueMeasurement(A.PerformanceEvents.AuthClientAcquireToken,e.correlationId),!e.code)throw(0,u.createClientAuthError)(I.requestCannotBeMade);let r=(0,m.nowSeconds)(),n=await (0,E.invokeAsync)(this.executeTokenRequest.bind(this),A.PerformanceEvents.AuthClientExecuteTokenRequest,this.logger,this.performanceClient,e.correlationId)(this.authority,e),o=n.headers?.[s.HeaderNames.X_MS_REQUEST_ID],i=new(0,d.ResponseHandler)(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,this.config.serializableCache,this.config.persistencePlugin,this.performanceClient);return i.validateTokenResponse(n.body),(0,E.invokeAsync)(i.handleServerTokenResponse.bind(i),A.PerformanceEvents.HandleServerTokenResponse,this.logger,this.performanceClient,e.correlationId)(n.body,this.authority,r,e,t,void 0,void 0,void 0,o)}getLogoutUri(e){if(!e)throw(0,y.createClientConfigurationError)(w.logoutRequestEmpty);let t=this.createLogoutUrlQueryString(e);return p.UrlString.appendQueryString(this.authority.endSessionEndpoint,t)}async executeTokenRequest(e,t){let r;this.performanceClient?.addQueueMeasurement(A.PerformanceEvents.AuthClientExecuteTokenRequest,t.correlationId);let n=this.createTokenQueryParameters(t),o=p.UrlString.appendQueryString(e.tokenEndpoint,n),i=await (0,E.invokeAsync)(this.createTokenRequestBody.bind(this),A.PerformanceEvents.AuthClientCreateTokenRequestBody,this.logger,this.performanceClient,t.correlationId)(t);if(t.clientInfo)try{let e=(0,C.buildClientInfo)(t.clientInfo,this.cryptoUtils.base64Decode);r={credential:`${e.uid}${s.Separators.CLIENT_INFO_SEPARATOR}${e.utid}`,type:f.CcsCredentialType.HOME_ACCOUNT_ID}}catch(e){this.logger.verbose("Could not parse client info for CCS Header: "+e)}let a=this.createTokenRequestHeaders(r||t.ccsCredential),c=(0,T.getRequestThumbprint)(this.config.authOptions.clientId,t);return(0,E.invokeAsync)(this.executePostToTokenEndpoint.bind(this),A.PerformanceEvents.AuthorizationCodeClientExecutePostToTokenEndpoint,this.logger,this.performanceClient,t.correlationId)(o,i,a,c,t.correlationId,A.PerformanceEvents.AuthorizationCodeClientExecutePostToTokenEndpoint)}async createTokenRequestBody(e){let t;this.performanceClient?.addQueueMeasurement(A.PerformanceEvents.AuthClientCreateTokenRequestBody,e.correlationId);let r=new Map;if((0,i.addClientId)(r,e.embeddedClientId||e.tokenBodyParameters?.[c.CLIENT_ID]||this.config.authOptions.clientId),this.includeRedirectUri)(0,i.addRedirectUri)(r,e.redirectUri);else if(!e.redirectUri)throw(0,y.createClientConfigurationError)(w.redirectUriEmpty);if((0,i.addScopes)(r,e.scopes,!0,this.oidcDefaultScopes),(0,i.addAuthorizationCode)(r,e.code),(0,i.addLibraryInfo)(r,this.config.libraryInfo),(0,i.addApplicationTelemetry)(r,this.config.telemetry.application),(0,i.addThrottling)(r),this.serverTelemetryManager&&!(0,l.isOidcProtocolMode)(this.config)&&(0,i.addServerTelemetry)(r,this.serverTelemetryManager),e.codeVerifier&&(0,i.addCodeVerifier)(r,e.codeVerifier),this.config.clientCredentials.clientSecret&&(0,i.addClientSecret)(r,this.config.clientCredentials.clientSecret),this.config.clientCredentials.clientAssertion){let t=this.config.clientCredentials.clientAssertion;(0,i.addClientAssertion)(r,await (0,v.getClientAssertion)(t.assertion,this.config.authOptions.clientId,e.resourceRequestUri)),(0,i.addClientAssertionType)(r,t.assertionType)}if((0,i.addGrantType)(r,s.GrantType.AUTHORIZATION_CODE_GRANT),(0,i.addClientInfo)(r),e.authenticationScheme===s.AuthenticationScheme.POP){let t,n=new(0,g.PopTokenGenerator)(this.cryptoUtils,this.performanceClient);t=e.popKid?this.cryptoUtils.encodeKid(e.popKid):(await (0,E.invokeAsync)(n.generateCnf.bind(n),A.PerformanceEvents.PopTokenGenerateCnf,this.logger,this.performanceClient,e.correlationId)(e,this.logger)).reqCnfString,(0,i.addPopToken)(r,t)}else if(e.authenticationScheme===s.AuthenticationScheme.SSH)if(e.sshJwk)(0,i.addSshJwk)(r,e.sshJwk);else throw(0,y.createClientConfigurationError)(w.missingSshJwk);if((!h.StringUtils.isEmptyObj(e.claims)||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&(0,i.addClaims)(r,e.claims,this.config.authOptions.clientCapabilities),e.clientInfo)try{let r=(0,C.buildClientInfo)(e.clientInfo,this.cryptoUtils.base64Decode);t={credential:`${r.uid}${s.Separators.CLIENT_INFO_SEPARATOR}${r.utid}`,type:f.CcsCredentialType.HOME_ACCOUNT_ID}}catch(e){this.logger.verbose("Could not parse client info for CCS Header: "+e)}else t=e.ccsCredential;if(this.config.systemOptions.preventCorsPreflight&&t)switch(t.type){case f.CcsCredentialType.HOME_ACCOUNT_ID:try{let e=(0,C.buildClientInfoFromHomeAccountId)(t.credential);(0,i.addCcsOid)(r,e)}catch(e){this.logger.verbose("Could not parse home account ID for CCS Header: "+e)}break;case f.CcsCredentialType.UPN:(0,i.addCcsUpn)(r,t.credential)}return e.embeddedClientId&&(0,i.addBrokerParameters)(r,this.config.authOptions.clientId,this.config.authOptions.redirectUri),e.tokenBodyParameters&&(0,i.addExtraQueryParameters)(r,e.tokenBodyParameters),!e.enableSpaAuthorizationCode||e.tokenBodyParameters&&e.tokenBodyParameters[c.RETURN_SPA_CODE]||(0,i.addExtraQueryParameters)(r,{[c.RETURN_SPA_CODE]:"1"}),(0,i.instrumentBrokerParams)(r,e.correlationId,this.performanceClient),(0,a.mapToQueryString)(r)}createLogoutUrlQueryString(e){let t=new Map;return e.postLogoutRedirectUri&&(0,i.addPostLogoutRedirectUri)(t,e.postLogoutRedirectUri),e.correlationId&&(0,i.addCorrelationId)(t,e.correlationId),e.idTokenHint&&(0,i.addIdTokenHint)(t,e.idTokenHint),e.state&&(0,i.addState)(t,e.state),e.logoutHint&&(0,i.addLogoutHint)(t,e.logoutHint),e.extraQueryParameters&&(0,i.addExtraQueryParameters)(t,e.extraQueryParameters),this.config.authOptions.instanceAware&&(0,i.addInstanceAware)(t),(0,a.mapToQueryString)(t,this.config.authOptions.encodeExtraQueryParams,e.extraQueryParameters)}}}),i("fV1L4",function(t,r){e(t.exports,"BaseClient",()=>E);var n=o("cnTdK"),i=o("lxp2N"),a=o("gmw86"),s=o("6r4FB"),c=o("gXRij"),l=o("2n5CL"),d=o("cnNuz"),h=o("8S0Fg"),u=o("lBejK"),p=o("gnfKd"),g=o("lCa4q"),m=o("ckDmJ"),C=o("anIdE"),f=o("2ilqe"),y=o("9tUvn"),A=o("l6ONb");class E{constructor(e,t){this.config=(0,n.buildClientConfiguration)(e),this.logger=new(0,i.Logger)(this.config.loggerOptions,s.name,s.version),this.cryptoUtils=this.config.cryptoInterface,this.cacheManager=this.config.storageInterface,this.networkClient=this.config.networkInterface,this.serverTelemetryManager=this.config.serverTelemetryManager,this.authority=this.config.authOptions.authority,this.performanceClient=t}createTokenRequestHeaders(e){let t={};if(t[a.HeaderNames.CONTENT_TYPE]=a.Constants.URL_FORM_CONTENT_TYPE,!this.config.systemOptions.preventCorsPreflight&&e)switch(e.type){case c.CcsCredentialType.HOME_ACCOUNT_ID:try{let r=(0,l.buildClientInfoFromHomeAccountId)(e.credential);t[a.HeaderNames.CCS_HEADER]=`Oid:${r.uid}@${r.utid}`}catch(e){this.logger.verbose("Could not parse home account ID for CCS Header: "+e)}break;case c.CcsCredentialType.UPN:t[a.HeaderNames.CCS_HEADER]=`UPN: ${e.credential}`}return t}async executePostToTokenEndpoint(e,t,r,n,o,i){i&&this.performanceClient?.addQueueMeasurement(i,o);let a=await this.sendPostRequest(n,e,{body:t,headers:r},o);return this.config.serverTelemetryManager&&a.status<500&&429!==a.status&&this.config.serverTelemetryManager.clearTelemetryCache(),a}async sendPostRequest(e,t,r,n){let o;g.ThrottlingUtils.preProcess(this.cacheManager,e,n);try{let e=(o=await (0,y.invokeAsync)(this.networkClient.sendPostRequestAsync.bind(this.networkClient),p.PerformanceEvents.NetworkClientSendPostRequestAsync,this.logger,this.performanceClient,n)(t,r)).headers||{};this.performanceClient?.addFields({refreshTokenSize:o.body.refresh_token?.length||0,httpVerToken:e[a.HeaderNames.X_MS_HTTP_VERSION]||"",requestId:e[a.HeaderNames.X_MS_REQUEST_ID]||""},n)}catch(e){if(e instanceof f.NetworkError){let t=e.responseHeaders;throw t&&this.performanceClient?.addFields({httpVerToken:t[a.HeaderNames.X_MS_HTTP_VERSION]||"",requestId:t[a.HeaderNames.X_MS_REQUEST_ID]||"",contentTypeHeader:t[a.HeaderNames.CONTENT_TYPE]||void 0,contentLengthHeader:t[a.HeaderNames.CONTENT_LENGTH]||void 0,httpStatus:e.httpStatus},n),e.error}if(e instanceof m.AuthError)throw e;throw(0,C.createClientAuthError)(A.networkError)}return g.ThrottlingUtils.postProcess(this.cacheManager,e,o,n),o}async updateAuthority(e,t){this.performanceClient?.addQueueMeasurement(p.PerformanceEvents.UpdateTokenEndpointAuthority,t);let r=`https://${e}/${this.authority.tenant}/`,n=await (0,u.createDiscoveredInstance)(r,this.networkClient,this.cacheManager,this.authority.options,this.logger,t,this.performanceClient);this.authority=n}createTokenQueryParameters(e){let t=new Map;return e.embeddedClientId&&(0,d.addBrokerParameters)(t,this.config.authOptions.clientId,this.config.authOptions.redirectUri),e.tokenQueryParameters&&(0,d.addExtraQueryParameters)(t,e.tokenQueryParameters),(0,d.addCorrelationId)(t,e.correlationId),(0,d.instrumentBrokerParams)(t,e.correlationId,this.performanceClient),(0,h.mapToQueryString)(t)}}}),i("gXRij",function(t,r){e(t.exports,"CcsCredentialType",()=>n);let n={HOME_ACCOUNT_ID:"home_account_id",UPN:"UPN"}}),i("lBejK",function(t,r){e(t.exports,"createDiscoveredInstance",()=>l);var n=o("8xmgF"),i=o("anIdE"),a=o("gnfKd"),s=o("9tUvn"),c=o("l6ONb");async function l(e,t,r,o,l,d,h){h?.addQueueMeasurement(a.PerformanceEvents.AuthorityFactoryCreateDiscoveredInstance,d);let u=n.Authority.transformCIAMAuthority((0,n.formatAuthorityUri)(e)),p=new(0,n.Authority)(u,t,r,o,l,d,h);try{return await (0,s.invokeAsync)(p.resolveEndpointsAsync.bind(p),a.PerformanceEvents.AuthorityResolveEndpointsAsync,l,h,d)(),p}catch(e){throw(0,i.createClientAuthError)(c.endpointResolutionError)}}}),i("lCa4q",function(t,r){e(t.exports,"ThrottlingUtils",()=>s);var n=o("gmw86"),i=o("dVST2"),a=o("dO1mF");class s{static generateThrottlingStorageKey(e){return`${n.ThrottlingConstants.THROTTLING_PREFIX}.${JSON.stringify(e)}`}static preProcess(e,t,r){let o=s.generateThrottlingStorageKey(t),a=e.getThrottlingCache(o);if(a){if(a.throttleTime<Date.now())return void e.removeItem(o,r);throw new(0,i.ServerError)(a.errorCodes?.join(" ")||n.Constants.EMPTY_STRING,a.errorMessage,a.subError)}}static postProcess(e,t,r,o){if(s.checkResponseStatus(r)||s.checkResponseForRetryAfter(r)){let i={throttleTime:s.calculateThrottleTime(parseInt(r.headers[n.HeaderNames.RETRY_AFTER])),error:r.body.error,errorCodes:r.body.error_codes,errorMessage:r.body.error_description,subError:r.body.suberror};e.setThrottlingCache(s.generateThrottlingStorageKey(t),i,o)}}static checkResponseStatus(e){return 429===e.status||e.status>=500&&e.status<600}static checkResponseForRetryAfter(e){return!!e.headers&&e.headers.hasOwnProperty(n.HeaderNames.RETRY_AFTER)&&(e.status<200||e.status>=300)}static calculateThrottleTime(e){let t=Date.now()/1e3;return Math.floor(1e3*Math.min(t+((e<=0?0:e)||n.ThrottlingConstants.DEFAULT_THROTTLE_TIME_SECONDS),t+n.ThrottlingConstants.DEFAULT_MAX_THROTTLE_TIME_SECONDS))}static removeThrottle(e,t,r,n){let o=(0,a.getRequestThumbprint)(t,r,n),i=this.generateThrottlingStorageKey(o);e.removeItem(i,r.correlationId)}}}),i("dVST2",function(t,r){e(t.exports,"ServerError",()=>i);var n=o("ckDmJ");class i extends n.AuthError{constructor(e,t,r,n,o){super(e,t,r),this.name="ServerError",this.errorNo=n,this.status=o,Object.setPrototypeOf(this,i.prototype)}}}),i("aomzz",function(t,r){e(t.exports,"ResponseHandler",()=>E),e(t.exports,"buildAccountToCache",()=>v);var n=o("anIdE"),i=o("dVST2"),a=o("6GdIx"),s=o("4tMCV"),c=o("dKahV"),l=o("1Fwao"),d=o("gmw86"),h=o("8B0BQ"),u=o("ftjRB"),p=o("gnfKd"),g=o("eVKB1"),m=o("knfgg"),C=o("aRYMn"),f=o("jvdrJ"),y=o("jl1FD"),A=o("l6ONb");class E{constructor(e,t,r,n,o,i,a){this.clientId=e,this.cacheStorage=t,this.cryptoObj=r,this.logger=n,this.serializableCache=o,this.persistencePlugin=i,this.performanceClient=a}validateTokenResponse(e,t){if(e.error||e.error_description||e.suberror){let r=`Error(s): ${e.error_codes||d.Constants.NOT_AVAILABLE} - Timestamp: ${e.timestamp||d.Constants.NOT_AVAILABLE} - Description: ${e.error_description||d.Constants.NOT_AVAILABLE} - Correlation ID: ${e.correlation_id||d.Constants.NOT_AVAILABLE} - Trace ID: ${e.trace_id||d.Constants.NOT_AVAILABLE}`,n=e.error_codes?.length?e.error_codes[0]:void 0,o=new(0,i.ServerError)(e.error,r,e.suberror,n,e.status);if(t&&e.status&&e.status>=d.HttpStatus.SERVER_ERROR_RANGE_START&&e.status<=d.HttpStatus.SERVER_ERROR_RANGE_END)return void this.logger.warning(`executeTokenRequest:validateTokenResponse - AAD is currently unavailable and the access token is unable to be refreshed.
${o}`);if(t&&e.status&&e.status>=d.HttpStatus.CLIENT_ERROR_RANGE_START&&e.status<=d.HttpStatus.CLIENT_ERROR_RANGE_END)return void this.logger.warning(`executeTokenRequest:validateTokenResponse - AAD is currently available but is unable to refresh the access token.
${o}`);if((0,c.isInteractionRequiredError)(e.error,e.error_description,e.suberror))throw new(0,c.InteractionRequiredAuthError)(e.error,e.error_description,e.suberror,e.timestamp||d.Constants.EMPTY_STRING,e.trace_id||d.Constants.EMPTY_STRING,e.correlation_id||d.Constants.EMPTY_STRING,e.claims||d.Constants.EMPTY_STRING,n);throw o}}async handleServerTokenResponse(e,t,r,o,i,a,c,h,m){let C,f,y;if(this.performanceClient?.addQueueMeasurement(p.PerformanceEvents.HandleServerTokenResponse,e.correlation_id),e.id_token){if(C=(0,g.extractTokenClaims)(e.id_token||d.Constants.EMPTY_STRING,this.cryptoObj.base64Decode),i&&i.nonce&&C.nonce!==i.nonce)throw(0,n.createClientAuthError)(A.nonceMismatch);if(o.maxAge||0===o.maxAge){let e=C.auth_time;if(!e)throw(0,n.createClientAuthError)(A.authTimeNotFound);(0,g.checkMaxAge)(e,o.maxAge)}}this.homeAccountIdentifier=s.AccountEntity.generateHomeAccountId(e.client_info||d.Constants.EMPTY_STRING,t.authorityType,this.logger,this.cryptoObj,C),i&&i.state&&(f=l.ProtocolUtils.parseRequestState(this.cryptoObj,i.state)),e.key_id=e.key_id||o.sshKid||void 0;let v=this.generateCacheRecord(e,t,r,o,C,a,i);try{if(this.persistencePlugin&&this.serializableCache&&(this.logger.verbose("Persistence enabled, calling beforeCacheAccess"),y=new(0,u.TokenCacheContext)(this.serializableCache,!0),await this.persistencePlugin.beforeCacheAccess(y)),c&&!h&&v.account){let e=this.cacheStorage.generateAccountKey(s.AccountEntity.getAccountInfo(v.account));if(!this.cacheStorage.getAccount(e,o.correlationId))return this.logger.warning("Account used to refresh tokens not in persistence, refreshed tokens will not be stored in the cache"),await E.generateAuthenticationResult(this.cryptoObj,t,v,!1,o,C,f,void 0,m)}await this.cacheStorage.saveCacheRecord(v,o.correlationId,(0,g.isKmsi)(C||{}),o.storeInCache)}finally{this.persistencePlugin&&this.serializableCache&&y&&(this.logger.verbose("Persistence enabled, calling afterCacheAccess"),await this.persistencePlugin.afterCacheAccess(y))}return E.generateAuthenticationResult(this.cryptoObj,t,v,!1,o,C,f,e,m)}generateCacheRecord(e,t,r,o,i,s,c){let l,d,h=t.getPreferredCache();if(!h)throw(0,n.createClientAuthError)(A.invalidCacheEnvironment);let u=(0,m.getTenantIdFromIdTokenClaims)(i);e.id_token&&i&&(l=(0,f.createIdTokenEntity)(this.homeAccountIdentifier,h,e.id_token,this.clientId,u||""),d=v(this.cacheStorage,t,this.homeAccountIdentifier,this.cryptoObj.base64Decode,o.correlationId,i,e.client_info,h,u,c,void 0,this.logger));let p=null;if(e.access_token){let n=e.scope?a.ScopeSet.fromString(e.scope):new(0,a.ScopeSet)(o.scopes||[]),i=("string"==typeof e.expires_in?parseInt(e.expires_in,10):e.expires_in)||0,c=("string"==typeof e.ext_expires_in?parseInt(e.ext_expires_in,10):e.ext_expires_in)||0,l=("string"==typeof e.refresh_in?parseInt(e.refresh_in,10):e.refresh_in)||void 0,d=r+i;p=(0,f.createAccessTokenEntity)(this.homeAccountIdentifier,h,e.access_token,this.clientId,u||t.tenant||"",n.printScopes(),d,d+c,this.cryptoObj.base64Decode,l&&l>0?r+l:void 0,e.token_type,s,e.key_id,o.claims,o.requestedClaimsHash)}let g=null;if(e.refresh_token){let t;e.refresh_token_expires_in&&(t=r+("string"==typeof e.refresh_token_expires_in?parseInt(e.refresh_token_expires_in,10):e.refresh_token_expires_in)),g=(0,f.createRefreshTokenEntity)(this.homeAccountIdentifier,h,e.refresh_token,this.clientId,e.foci,s,t)}let C=null;return e.foci&&(C={clientId:this.clientId,environment:h,familyId:e.foci}),{account:d,idToken:l,accessToken:p,refreshToken:g,appMetadata:C}}static async generateAuthenticationResult(e,t,r,o,i,c,l,u,p){let g,m,f=d.Constants.EMPTY_STRING,E=[],v=null,T=d.Constants.EMPTY_STRING;if(r.accessToken){if(r.accessToken.tokenType!==d.AuthenticationScheme.POP||i.popKid)f=r.accessToken.secret;else{let t=new(0,h.PopTokenGenerator)(e),{secret:o,keyId:a}=r.accessToken;if(!a)throw(0,n.createClientAuthError)(A.keyIdMissing);f=await t.signPopToken(o,a,i)}E=a.ScopeSet.fromString(r.accessToken.target).asArray(),v=(0,y.toDateFromSeconds)(r.accessToken.expiresOn),g=(0,y.toDateFromSeconds)(r.accessToken.extendedExpiresOn),r.accessToken.refreshOn&&(m=(0,y.toDateFromSeconds)(r.accessToken.refreshOn))}r.appMetadata&&(T=r.appMetadata.familyId===d.THE_FAMILY_ID?d.THE_FAMILY_ID:"");let I=c?.oid||c?.sub||"",w=c?.tid||"";u?.spa_accountid&&r.account&&(r.account.nativeAccountId=u?.spa_accountid);let S=r.account?(0,C.updateAccountTenantProfileData)(s.AccountEntity.getAccountInfo(r.account),void 0,c,r.idToken?.secret):null;return{authority:t.canonicalAuthority,uniqueId:I,tenantId:w,scopes:E,account:S,idToken:r?.idToken?.secret||"",idTokenClaims:c||{},accessToken:f,fromCache:o,expiresOn:v,extExpiresOn:g,refreshOn:m,correlationId:i.correlationId,requestId:p||d.Constants.EMPTY_STRING,familyId:T,tokenType:r.accessToken?.tokenType||d.Constants.EMPTY_STRING,state:l?l.userRequestState:d.Constants.EMPTY_STRING,cloudGraphHostName:r.account?.cloudGraphHostName||d.Constants.EMPTY_STRING,msGraphHost:r.account?.msGraphHost||d.Constants.EMPTY_STRING,code:u?.spa_code,fromNativeBroker:!1}}}function v(e,t,r,n,o,i,a,c,l,d,h,u){u?.verbose("setCachedAccount called");let p=e.getAccountKeys().find(e=>e.startsWith(r)),g=null;p&&(g=e.getAccount(p,o));let m=g||s.AccountEntity.createAccount({homeAccountId:r,idTokenClaims:i,clientInfo:a,environment:c,cloudGraphHostName:d?.cloud_graph_host_name,msGraphHost:d?.msgraph_host,nativeAccountId:h},t,n),f=m.tenantProfiles||[],y=l||m.realm;if(y&&!f.find(e=>e.tenantId===y)){let e=(0,C.buildTenantProfile)(r,m.localAccountId,y,i);f.push(e)}return m.tenantProfiles=f,m}}),i("1Fwao",function(t,r){e(t.exports,"ProtocolUtils",()=>s);var n=o("gmw86"),i=o("anIdE"),a=o("l6ONb");class s{static setRequestState(e,t,r){let o=s.generateLibraryState(e,r);return t?`${o}${n.Constants.RESOURCE_DELIM}${t}`:o}static generateLibraryState(e,t){if(!e)throw(0,i.createClientAuthError)(a.noCryptoObject);let r={id:e.createNewGuid()};t&&(r.meta=t);let n=JSON.stringify(r);return e.base64Encode(n)}static parseRequestState(e,t){if(!e)throw(0,i.createClientAuthError)(a.noCryptoObject);if(!t)throw(0,i.createClientAuthError)(a.invalidState);try{let r=t.split(n.Constants.RESOURCE_DELIM),o=r[0],i=r.length>1?r.slice(1).join(n.Constants.RESOURCE_DELIM):n.Constants.EMPTY_STRING,a=e.base64Decode(o),s=JSON.parse(a);return{userRequestState:i||n.Constants.EMPTY_STRING,libraryState:s}}catch(e){throw(0,i.createClientAuthError)(a.invalidState)}}}}),i("8B0BQ",function(t,r){e(t.exports,"PopTokenGenerator",()=>c);var n=o("jl1FD"),i=o("gkKSO"),a=o("gnfKd"),s=o("9tUvn");class c{constructor(e,t){this.cryptoUtils=e,this.performanceClient=t}async generateCnf(e,t){this.performanceClient?.addQueueMeasurement(a.PerformanceEvents.PopTokenGenerateCnf,e.correlationId);let r=await (0,s.invokeAsync)(this.generateKid.bind(this),a.PerformanceEvents.PopTokenGenerateCnf,t,this.performanceClient,e.correlationId)(e),n=this.cryptoUtils.base64UrlEncode(JSON.stringify(r));return{kid:r.kid,reqCnfString:n}}async generateKid(e){return this.performanceClient?.addQueueMeasurement(a.PerformanceEvents.PopTokenGenerateKid,e.correlationId),{kid:await this.cryptoUtils.getPublicKeyThumbprint(e),xms_ksl:"sw"}}async signPopToken(e,t,r){return this.signPayload(e,t,r)}async signPayload(e,t,r,o){let{resourceRequestMethod:a,resourceRequestUri:s,shrClaims:c,shrNonce:l,shrOptions:d}=r,h=s?new(0,i.UrlString)(s):void 0,u=h?.getUrlComponents();return this.cryptoUtils.signJwt({at:e,ts:(0,n.nowSeconds)(),m:a?.toUpperCase(),u:u?.HostNameAndPort,nonce:l||this.cryptoUtils.createNewGuid(),p:u?.AbsolutePath,q:u?.QueryString?[[],u.QueryString]:void 0,client_claims:c||void 0,...o},t,d,r.correlationId)}}}),i("ftjRB",function(t,r){e(t.exports,"TokenCacheContext",()=>n);class n{constructor(e,t){this.cache=e,this.hasChanged=t}get cacheHasChanged(){return this.hasChanged}get tokenCache(){return this.cache}}}),i("hpubR",function(t,r){e(t.exports,"getClientAssertion",()=>n);async function n(e,t,r){return"string"==typeof e?e:e({clientId:t,tokenEndpoint:r})}}),i("24aK6",function(t,r){e(t.exports,"BaseInteractionClient",()=>C);var n=o("8xmgF"),i=o("lBejK"),a=o("cmWPH"),s=o("jYvjz"),c=o("9tUvn"),l=o("gnfKd"),d=o("kZUNn"),h=o("gkKSO"),u=o("2QnKr"),p=o("dp0vd"),g=o("5S1XQ"),m=o("7oR2q");class C{constructor(e,t,r,n,o,i,a,s,c){this.config=e,this.browserStorage=t,this.browserCrypto=r,this.networkClient=this.config.system.networkClient,this.eventHandler=o,this.navigationClient=i,this.platformAuthProvider=s,this.correlationId=c||(0,m.createNewGuid)(),this.logger=n.clone(p.BrowserConstants.MSAL_SKU,u.version,this.correlationId),this.performanceClient=a}async clearCacheOnLogout(e,t){if(t)try{this.browserStorage.removeAccount(t,e),this.logger.verbose("Cleared cache items belonging to the account provided in the logout request.")}catch(e){this.logger.error("Account provided in logout request was not found. Local cache unchanged.")}else try{this.logger.verbose("No account provided in logout request, clearing all cache items.",this.correlationId),this.browserStorage.clear(e),await this.browserCrypto.clearKeystore()}catch(e){this.logger.error("Attempted to clear all MSAL cache items and failed. Local cache unchanged.")}}getRedirectUri(e){this.logger.verbose("getRedirectUri called");let t=e||this.config.auth.redirectUri;return h.UrlString.getAbsoluteUrl(t,(0,g.getCurrentUri)())}initializeServerTelemetryManager(e,t){this.logger.verbose("initializeServerTelemetryManager called");let r={clientId:this.config.auth.clientId,correlationId:this.correlationId,apiId:e,forceRefresh:t||!1,wrapperSKU:this.browserStorage.getWrapperMetadata()[0],wrapperVer:this.browserStorage.getWrapperMetadata()[1]};return new(0,d.ServerTelemetryManager)(r,this.browserStorage)}async getDiscoveredAuthority(e){let{account:t}=e,r=e.requestExtraQueryParameters&&e.requestExtraQueryParameters.hasOwnProperty("instance_aware")?e.requestExtraQueryParameters.instance_aware:void 0;this.performanceClient.addQueueMeasurement(l.PerformanceEvents.StandardInteractionClientGetDiscoveredAuthority,this.correlationId);let o={protocolMode:this.config.auth.protocolMode,OIDCOptions:this.config.auth.OIDCOptions,knownAuthorities:this.config.auth.knownAuthorities,cloudDiscoveryMetadata:this.config.auth.cloudDiscoveryMetadata,authorityMetadata:this.config.auth.authorityMetadata,skipAuthorityMetadataCache:this.config.auth.skipAuthorityMetadataCache},d=e.requestAuthority||this.config.auth.authority,u=r?.length?"true"===r:this.config.auth.instanceAware,p=t&&u?this.config.auth.authority.replace(h.UrlString.getDomainFromUrl(d),t.environment):d,g=n.Authority.generateAuthority(p,e.requestAzureCloudOptions||this.config.auth.azureCloudOptions),m=await (0,c.invokeAsync)(i.createDiscoveredInstance,l.PerformanceEvents.AuthorityFactoryCreateDiscoveredInstance,this.logger,this.performanceClient,this.correlationId)(g,this.config.system.networkClient,this.browserStorage,o,this.logger,this.correlationId,this.performanceClient);if(t&&!m.isAlias(t.environment))throw(0,s.createClientConfigurationError)(a.authorityMismatch);return m}}}),i("kZUNn",function(t,r){e(t.exports,"ServerTelemetryManager",()=>a);var n=o("gmw86"),i=o("ckDmJ");class a{constructor(e,t){this.cacheOutcome=n.CacheOutcome.NOT_APPLICABLE,this.cacheManager=t,this.apiId=e.apiId,this.correlationId=e.correlationId,this.wrapperSKU=e.wrapperSKU||n.Constants.EMPTY_STRING,this.wrapperVer=e.wrapperVer||n.Constants.EMPTY_STRING,this.telemetryCacheKey=n.SERVER_TELEM_CONSTANTS.CACHE_KEY+n.Separators.CACHE_KEY_SEPARATOR+e.clientId}generateCurrentRequestHeaderValue(){let e=`${this.apiId}${n.SERVER_TELEM_CONSTANTS.VALUE_SEPARATOR}${this.cacheOutcome}`,t=[this.wrapperSKU,this.wrapperVer],r=this.getNativeBrokerErrorCode();r?.length&&t.push(`broker_error=${r}`);let o=t.join(n.SERVER_TELEM_CONSTANTS.VALUE_SEPARATOR),i=[e,this.getRegionDiscoveryFields()].join(n.SERVER_TELEM_CONSTANTS.VALUE_SEPARATOR);return[n.SERVER_TELEM_CONSTANTS.SCHEMA_VERSION,i,o].join(n.SERVER_TELEM_CONSTANTS.CATEGORY_SEPARATOR)}generateLastRequestHeaderValue(){let e=this.getLastRequests(),t=a.maxErrorsToSend(e),r=e.failedRequests.slice(0,2*t).join(n.SERVER_TELEM_CONSTANTS.VALUE_SEPARATOR),o=e.errors.slice(0,t).join(n.SERVER_TELEM_CONSTANTS.VALUE_SEPARATOR),i=e.errors.length,s=t<i?n.SERVER_TELEM_CONSTANTS.OVERFLOW_TRUE:n.SERVER_TELEM_CONSTANTS.OVERFLOW_FALSE,c=[i,s].join(n.SERVER_TELEM_CONSTANTS.VALUE_SEPARATOR);return[n.SERVER_TELEM_CONSTANTS.SCHEMA_VERSION,e.cacheHits,r,o,c].join(n.SERVER_TELEM_CONSTANTS.CATEGORY_SEPARATOR)}cacheFailedRequest(e){let t=this.getLastRequests();t.errors.length>=n.SERVER_TELEM_CONSTANTS.MAX_CACHED_ERRORS&&(t.failedRequests.shift(),t.failedRequests.shift(),t.errors.shift()),t.failedRequests.push(this.apiId,this.correlationId),e instanceof Error&&e&&e.toString()?e instanceof i.AuthError?e.subError?t.errors.push(e.subError):e.errorCode?t.errors.push(e.errorCode):t.errors.push(e.toString()):t.errors.push(e.toString()):t.errors.push(n.SERVER_TELEM_CONSTANTS.UNKNOWN_ERROR),this.cacheManager.setServerTelemetry(this.telemetryCacheKey,t,this.correlationId)}incrementCacheHits(){let e=this.getLastRequests();return e.cacheHits+=1,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,e,this.correlationId),e.cacheHits}getLastRequests(){return this.cacheManager.getServerTelemetry(this.telemetryCacheKey)||{failedRequests:[],errors:[],cacheHits:0}}clearTelemetryCache(){let e=this.getLastRequests(),t=a.maxErrorsToSend(e);if(t===e.errors.length)this.cacheManager.removeItem(this.telemetryCacheKey,this.correlationId);else{let r={failedRequests:e.failedRequests.slice(2*t),errors:e.errors.slice(t),cacheHits:0};this.cacheManager.setServerTelemetry(this.telemetryCacheKey,r,this.correlationId)}}static maxErrorsToSend(e){let t,r=0,o=0,i=e.errors.length;for(t=0;t<i;t++){let i=e.failedRequests[2*t]||n.Constants.EMPTY_STRING,a=e.failedRequests[2*t+1]||n.Constants.EMPTY_STRING,s=e.errors[t]||n.Constants.EMPTY_STRING;if((o+=i.toString().length+a.toString().length+s.length+3)<n.SERVER_TELEM_CONSTANTS.MAX_LAST_HEADER_BYTES)r+=1;else break}return r}getRegionDiscoveryFields(){let e=[];return e.push(this.regionUsed||n.Constants.EMPTY_STRING),e.push(this.regionSource||n.Constants.EMPTY_STRING),e.push(this.regionOutcome||n.Constants.EMPTY_STRING),e.join(",")}updateRegionDiscoveryMetadata(e){this.regionUsed=e.region_used,this.regionSource=e.region_source,this.regionOutcome=e.region_outcome}setCacheOutcome(e){this.cacheOutcome=e}setNativeBrokerErrorCode(e){let t=this.getLastRequests();t.nativeBrokerErrorCode=e,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,t,this.correlationId)}getNativeBrokerErrorCode(){return this.getLastRequests().nativeBrokerErrorCode}clearNativeBrokerErrorCode(){let e=this.getLastRequests();delete e.nativeBrokerErrorCode,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,e,this.correlationId)}static makeExtraSkuString(e){return function(e){let{skus:t,libraryName:r,libraryVersion:n,extensionName:o,extensionVersion:i}=e,a=new Map([[0,[r,n]],[2,[o,i]]]),s=[];if(t?.length){if((s=t.split(",")).length<4)return t}else s=Array.from({length:4},()=>"|");return a.forEach((e,t)=>{2===e.length&&e[0]?.length&&e[1]?.length&&function(e){let{skuArr:t,index:r,skuName:n,skuVersion:o}=e;r>=t.length||(t[r]=[n,o].join("|"))}({skuArr:s,index:t,skuName:e[0],skuVersion:e[1]})}),s.join(",")}(e)}}}),i("cDkFB",function(t,r){e(t.exports,"initializeBaseRequest",()=>u),e(t.exports,"initializeSilentRequest",()=>p),e(t.exports,"validateRequestMethod",()=>g);var n=o("gmw86"),i=o("cmWPH"),a=o("jYvjz"),s=o("9tUvn"),c=o("gnfKd"),l=o("77Sbs"),d=o("7yP0u"),h=o("7oR2q");async function u(e,t,r,o){r.addQueueMeasurement(c.PerformanceEvents.InitializeBaseRequest,e.correlationId);let s=e.authority||t.auth.authority,l=[...e&&e.scopes||[]],u={...e,correlationId:e.correlationId,authority:s,scopes:l};if(u.authenticationScheme){if(u.authenticationScheme===n.AuthenticationScheme.SSH){if(!e.sshJwk)throw(0,a.createClientConfigurationError)(i.missingSshJwk);if(!e.sshKid)throw(0,a.createClientConfigurationError)(i.missingSshKid)}o.verbose(`Authentication Scheme set to "${u.authenticationScheme}" as configured in Auth request`)}else u.authenticationScheme=n.AuthenticationScheme.BEARER,o.verbose('Authentication Scheme wasn\'t explicitly set in request, defaulting to "Bearer" request');return t.cache.claimsBasedCachingEnabled&&e.claims&&!d.StringUtils.isEmptyObj(e.claims)&&(u.requestedClaimsHash=await (0,h.hashString)(e.claims)),u}async function p(e,t,r,n,o){n.addQueueMeasurement(c.PerformanceEvents.InitializeSilentRequest,e.correlationId);let i=await (0,s.invokeAsync)(u,c.PerformanceEvents.InitializeBaseRequest,o,n,e.correlationId)(e,r,n,o);return{...e,...i,account:t,forceRefresh:e.forceRefresh||!1}}function g(e,t){let r,o=e.httpMethod;if(t===l.ProtocolMode.EAR){if((r=o||n.HttpMethod.POST)!==n.HttpMethod.POST)throw(0,a.createClientConfigurationError)(i.invalidRequestMethodForEAR)}else r=o||n.HttpMethod.GET;if(e.authorizePostBodyParameters&&r!==n.HttpMethod.POST)throw(0,a.createClientConfigurationError)(i.invalidAuthorizePostBodyParameters);return r}}),i("29emz",function(t,r){e(t.exports,"deserializeResponse",()=>c),e(t.exports,"validateInteractionType",()=>l);var n=o("8S0Fg"),i=o("6HXlN"),a=o("jLF17"),s=o("4pKco");function c(e,t,r){let o=n.getDeserializedResponse(e);if(!o)if(n.stripLeadingHashOrQuery(e))throw r.error(`A ${t} is present in the iframe but it does not contain known properties. It's likely that the ${t} has been replaced by code running on the redirectUri page.`),r.errorPii(`The ${t} detected is: ${e}`),(0,i.createBrowserAuthError)(s.hashDoesNotContainKnownProperties);else throw r.error(`The request has returned to the redirectUri but a ${t} is not present. It's likely that the ${t} has been removed or the page has been redirected by code running on the redirectUri page.`),(0,i.createBrowserAuthError)(s.hashEmptyError);return o}function l(e,t,r){if(!e.state)throw(0,i.createBrowserAuthError)(s.noStateInHash);let n=(0,a.extractBrowserRequestState)(t,e.state);if(!n)throw(0,i.createBrowserAuthError)(s.unableToParseState);if(n.interactionType!==r)throw(0,i.createBrowserAuthError)(s.stateInteractionTypeMismatch)}}),i("jLF17",function(t,r){e(t.exports,"extractBrowserRequestState",()=>s);var n=o("l6ONb"),i=o("anIdE"),a=o("1Fwao");function s(e,t){if(!t)return null;try{return a.ProtocolUtils.parseRequestState(e,t).libraryState.meta}catch(e){throw(0,i.createClientAuthError)(n.invalidState)}}}),i("1cQ8k",function(t,r){e(t.exports,"getAuthCodeRequestUrl",()=>k),e(t.exports,"getEARForm",()=>R),e(t.exports,"getCodeForm",()=>_),e(t.exports,"handleResponseCode",()=>N),e(t.exports,"handleResponseEAR",()=>O);var n=o("gmw86"),i=o("8tVXa"),a=o("cmWPH"),s=o("jYvjz"),c=o("9tUvn"),l=o("gnfKd"),d=o("8B0BQ"),h=o("77Sbs"),u=o("1Fwao"),p=o("cnNuz"),g=o("aomzz"),m=o("lCa4q"),C=o("jl1FD"),f=o("dp0vd"),y=o("2QnKr"),A=o("a2Vw9"),E=o("6HXlN"),v=o("7HXbt"),T=o("gzXqV"),I=o("7oR2q"),w=o("4pKco");async function S(e,t,r,o,a){let s=i.getStandardAuthorizeRequestParameters({...e.auth,authority:t},r,o,a);if(p.addLibraryInfo(s,{sku:f.BrowserConstants.MSAL_SKU,version:y.version,os:"",cpu:""}),e.auth.protocolMode!==h.ProtocolMode.OIDC&&p.addApplicationTelemetry(s,e.telemetry.application),r.platformBroker&&(p.addNativeBroker(s),a.addFields({isPlatformAuthorizeRequest:!0},r.correlationId),r.authenticationScheme===n.AuthenticationScheme.POP)){let e,t=new(0,A.CryptoOps)(o,a),n=new(0,d.PopTokenGenerator)(t);e=r.popKid?t.encodeKid(r.popKid):(await (0,c.invokeAsync)(n.generateCnf.bind(n),l.PerformanceEvents.PopTokenGenerateCnf,o,a,r.correlationId)(r,o)).reqCnfString,p.addPopToken(s,e)}return p.instrumentBrokerParams(s,r.correlationId,a),s}async function k(e,t,r,o,d){if(!r.codeChallenge)throw(0,s.createClientConfigurationError)(a.pkceParamsMissing);let h=await (0,c.invokeAsync)(S,l.PerformanceEvents.GetStandardParams,o,d,r.correlationId)(e,t,r,o,d);return p.addResponseType(h,n.OAuthResponseType.CODE),p.addCodeChallengeParams(h,r.codeChallenge,n.Constants.S256_CODE_CHALLENGE_METHOD),p.addExtraQueryParameters(h,r.extraQueryParameters||{}),i.getAuthorizeUrl(t,h,e.auth.encodeExtraQueryParams,r.extraQueryParameters)}async function R(e,t,r,o,a,s){if(!o.earJwk)throw(0,E.createBrowserAuthError)(w.earJwkEmpty);let c=await S(t,r,o,a,s);p.addResponseType(c,n.OAuthResponseType.IDTOKEN_TOKEN_REFRESHTOKEN),p.addEARParameters(c,o.earJwk);let l=new Map;return p.addExtraQueryParameters(l,o.extraQueryParameters||{}),P(e,i.getAuthorizeUrl(r,l,t.auth.encodeExtraQueryParams,o.extraQueryParameters),c)}async function _(e,t,r,o,a,s){let c=await S(t,r,o,a,s);p.addResponseType(c,n.OAuthResponseType.CODE),p.addCodeChallengeParams(c,o.codeChallenge,o.codeChallengeMethod||n.Constants.S256_CODE_CHALLENGE_METHOD),p.addPostBodyParameters(c,o.authorizePostBodyParameters||{});let l=new Map;return p.addExtraQueryParameters(l,o.extraQueryParameters||{}),P(e,i.getAuthorizeUrl(r,l,t.auth.encodeExtraQueryParams,o.extraQueryParameters),c)}function P(e,t,r){let n=e.createElement("form");return n.method="post",n.action=t,r.forEach((t,r)=>{let o=e.createElement("input");o.hidden=!0,o.name=r,o.value=t,n.appendChild(o)}),e.body.appendChild(n),n}async function b(e,t,r,n,o,i,a,s,d,h){if(s.verbose("Account id found, calling WAM for token"),!h)throw(0,E.createBrowserAuthError)(w.nativeConnectionNotEstablished);let p=new(0,A.CryptoOps)(s,d),g=new(0,T.PlatformAuthInteractionClient)(n,o,p,s,a,n.system.navigationClient,r,d,h,t,i,e.correlationId),{userRequestState:m}=u.ProtocolUtils.parseRequestState(p,e.state);return(0,c.invokeAsync)(g.acquireToken.bind(g),l.PerformanceEvents.NativeInteractionClientAcquireToken,s,d,e.correlationId)({...e,state:m,prompt:void 0})}async function N(e,t,r,n,o,i,a,s,d,h,u,p){if(m.ThrottlingUtils.removeThrottle(a,o.auth.clientId,e),t.accountId)return(0,c.invokeAsync)(b,l.PerformanceEvents.HandleResponsePlatformBroker,h,u,e.correlationId)(e,t.accountId,n,o,a,s,d,h,u,p);let g={...e,code:t.code||"",codeVerifier:r},C=new(0,v.InteractionHandler)(i,a,g,h,u);return await (0,c.invokeAsync)(C.handleCodeResponse.bind(C),l.PerformanceEvents.HandleCodeResponse,h,u,e.correlationId)(t,e)}async function O(e,t,r,n,o,a,s,d,h,u,p){if(m.ThrottlingUtils.removeThrottle(a,n.auth.clientId,e),i.validateAuthorizationResponse(t,e.state),!t.ear_jwe)throw(0,E.createBrowserAuthError)(w.earJweEmpty);if(!e.earJwk)throw(0,E.createBrowserAuthError)(w.earJwkEmpty);let f=JSON.parse(await (0,c.invokeAsync)(I.decryptEarResponse,l.PerformanceEvents.DecryptEarResponse,h,u,e.correlationId)(e.earJwk,t.ear_jwe));if(f.accountId)return(0,c.invokeAsync)(b,l.PerformanceEvents.HandleResponsePlatformBroker,h,u,e.correlationId)(e,f.accountId,r,n,a,s,d,h,u,p);let y=new(0,g.ResponseHandler)(n.auth.clientId,a,new(0,A.CryptoOps)(h,u),h,null,null,u);y.validateTokenResponse(f);let v={code:"",state:e.state,nonce:e.nonce,client_info:f.client_info,cloud_graph_host_name:f.cloud_graph_host_name,cloud_instance_host_name:f.cloud_instance_host_name,cloud_instance_name:f.cloud_instance_name,msgraph_host:f.msgraph_host};return await (0,c.invokeAsync)(y.handleServerTokenResponse.bind(y),l.PerformanceEvents.HandleServerTokenResponse,h,u,e.correlationId)(f,o,C.nowSeconds(),e,v,void 0,void 0,void 0,void 0)}}),i("8tVXa",function(t,r){e(t.exports,"getStandardAuthorizeRequestParameters",()=>g),e(t.exports,"getAuthorizeUrl",()=>m),e(t.exports,"getAuthorizationCodePayload",()=>C),e(t.exports,"validateAuthorizationResponse",()=>f);var n=o("cnNuz"),i=o("1EdUE"),a=o("gmw86"),s=o("2n5CL"),c=o("8S0Fg"),l=o("gkKSO"),d=o("anIdE"),h=o("dKahV"),u=o("dVST2"),p=o("l6ONb");function g(e,t,r,o){let c=t.correlationId,l=new Map;(0,n.addClientId)(l,t.embeddedClientId||t.extraQueryParameters?.[i.CLIENT_ID]||e.clientId);let d=[...t.scopes||[],...t.extraScopesToConsent||[]];if((0,n.addScopes)(l,d,!0,e.authority.options.OIDCOptions?.defaultScopes),(0,n.addRedirectUri)(l,t.redirectUri),(0,n.addCorrelationId)(l,c),(0,n.addResponseMode)(l,t.responseMode),(0,n.addClientInfo)(l),t.prompt&&((0,n.addPrompt)(l,t.prompt),o?.addFields({prompt:t.prompt},c)),t.domainHint&&((0,n.addDomainHint)(l,t.domainHint),o?.addFields({domainHintFromRequest:!0},c)),t.prompt!==a.PromptValue.SELECT_ACCOUNT)if(t.sid&&t.prompt===a.PromptValue.NONE)r.verbose("createAuthCodeUrlQueryString: Prompt is none, adding sid from request"),(0,n.addSid)(l,t.sid),o?.addFields({sidFromRequest:!0},c);else if(t.account){var h,u;let e=(h=t.account,h.idTokenClaims?.sid||null),i=(u=t.account).loginHint||u.idTokenClaims?.login_hint||null;if(i&&t.domainHint&&(r.warning('AuthorizationCodeClient.createAuthCodeUrlQueryString: "domainHint" param is set, skipping opaque "login_hint" claim. Please consider not passing domainHint'),i=null),i){r.verbose("createAuthCodeUrlQueryString: login_hint claim present on account"),(0,n.addLoginHint)(l,i),o?.addFields({loginHintFromClaim:!0},c);try{let e=(0,s.buildClientInfoFromHomeAccountId)(t.account.homeAccountId);(0,n.addCcsOid)(l,e)}catch(e){r.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}else if(e&&t.prompt===a.PromptValue.NONE){r.verbose("createAuthCodeUrlQueryString: Prompt is none, adding sid from account"),(0,n.addSid)(l,e),o?.addFields({sidFromClaim:!0},c);try{let e=(0,s.buildClientInfoFromHomeAccountId)(t.account.homeAccountId);(0,n.addCcsOid)(l,e)}catch(e){r.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}else if(t.loginHint)r.verbose("createAuthCodeUrlQueryString: Adding login_hint from request"),(0,n.addLoginHint)(l,t.loginHint),(0,n.addCcsUpn)(l,t.loginHint),o?.addFields({loginHintFromRequest:!0},c);else if(t.account.username){r.verbose("createAuthCodeUrlQueryString: Adding login_hint from account"),(0,n.addLoginHint)(l,t.account.username),o?.addFields({loginHintFromUpn:!0},c);try{let e=(0,s.buildClientInfoFromHomeAccountId)(t.account.homeAccountId);(0,n.addCcsOid)(l,e)}catch(e){r.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}}else t.loginHint&&(r.verbose("createAuthCodeUrlQueryString: No account, adding login_hint from request"),(0,n.addLoginHint)(l,t.loginHint),(0,n.addCcsUpn)(l,t.loginHint),o?.addFields({loginHintFromRequest:!0},c));else r.verbose("createAuthCodeUrlQueryString: Prompt is select_account, ignoring account hints");return t.nonce&&(0,n.addNonce)(l,t.nonce),t.state&&(0,n.addState)(l,t.state),(t.claims||e.clientCapabilities&&e.clientCapabilities.length>0)&&(0,n.addClaims)(l,t.claims,e.clientCapabilities),t.embeddedClientId&&(0,n.addBrokerParameters)(l,e.clientId,e.redirectUri),!e.instanceAware||t.extraQueryParameters&&Object.keys(t.extraQueryParameters).includes(i.INSTANCE_AWARE)||(0,n.addInstanceAware)(l),l}function m(e,t,r,n){let o=(0,c.mapToQueryString)(t,r,n);return l.UrlString.appendQueryString(e.authorizationEndpoint,o)}function C(e,t){if(f(e,t),!e.code)throw(0,d.createClientAuthError)(p.authorizationCodeMissingFromServerResponse);return e}function f(e,t){let r,n;if(!e.state||!t)throw e.state?(0,d.createClientAuthError)(p.stateNotFound,"Cached State"):(0,d.createClientAuthError)(p.stateNotFound,"Server State");try{r=decodeURIComponent(e.state)}catch(t){throw(0,d.createClientAuthError)(p.invalidState,e.state)}try{n=decodeURIComponent(t)}catch(t){throw(0,d.createClientAuthError)(p.invalidState,e.state)}if(r!==n)throw(0,d.createClientAuthError)(p.stateMismatch);if(e.error||e.error_description||e.suberror){var o;let t,r,n=(o=e,t="code=",(r=o.error_uri?.lastIndexOf(t))&&r>=0?o.error_uri?.substring(r+t.length):void 0);if((0,h.isInteractionRequiredError)(e.error,e.error_description,e.suberror))throw new(0,h.InteractionRequiredAuthError)(e.error||"",e.error_description,e.suberror,e.timestamp||"",e.trace_id||"",e.correlation_id||"",e.claims||"",n);throw new(0,u.ServerError)(e.error||"",e.error_description,e.suberror,n)}}}),i("7HXbt",function(t,r){e(t.exports,"InteractionHandler",()=>h);var n=o("8tVXa"),i=o("gXRij"),a=o("9tUvn"),s=o("gnfKd"),c=o("dVST2"),l=o("6HXlN"),d=o("4pKco");class h{constructor(e,t,r,n,o){this.authModule=e,this.browserStorage=t,this.authCodeRequest=r,this.logger=n,this.performanceClient=o}async handleCodeResponse(e,t){let r;this.performanceClient.addQueueMeasurement(s.PerformanceEvents.HandleCodeResponse,t.correlationId);try{r=n.getAuthorizationCodePayload(e,t.state)}catch(e){if(e instanceof c.ServerError&&e.subError===d.userCancelled)throw(0,l.createBrowserAuthError)(d.userCancelled);throw e}return(0,a.invokeAsync)(this.handleCodeResponseFromServer.bind(this),s.PerformanceEvents.HandleCodeResponseFromServer,this.logger,this.performanceClient,t.correlationId)(r,t)}async handleCodeResponseFromServer(e,t,r=!0){if(this.performanceClient.addQueueMeasurement(s.PerformanceEvents.HandleCodeResponseFromServer,t.correlationId),this.logger.trace("InteractionHandler.handleCodeResponseFromServer called"),this.authCodeRequest.code=e.code,e.cloud_instance_host_name&&await (0,a.invokeAsync)(this.authModule.updateAuthority.bind(this.authModule),s.PerformanceEvents.UpdateTokenEndpointAuthority,this.logger,this.performanceClient,t.correlationId)(e.cloud_instance_host_name,t.correlationId),r&&(e.nonce=t.nonce||void 0),e.state=t.state,e.client_info)this.authCodeRequest.clientInfo=e.client_info;else{let e=this.createCcsCredentials(t);e&&(this.authCodeRequest.ccsCredential=e)}return await (0,a.invokeAsync)(this.authModule.acquireToken.bind(this.authModule),s.PerformanceEvents.AuthClientAcquireToken,this.logger,this.performanceClient,t.correlationId)(this.authCodeRequest,e)}createCcsCredentials(e){return e.account?{credential:e.account.homeAccountId,type:i.CcsCredentialType.HOME_ACCOUNT_ID}:e.loginHint?{credential:e.loginHint,type:i.CcsCredentialType.UPN}:null}}}),i("gzXqV",function(t,r){e(t.exports,"PlatformAuthInteractionClient",()=>b);var n=o("1EdUE"),i=o("4tMCV"),a=o("gmw86"),s=o("2ZfLX"),c=o("eVKB1"),l=o("aomzz"),d=o("jvdrJ"),h=o("l6ONb"),u=o("anIdE"),p=o("9tUvn"),g=o("gnfKd"),m=o("8B0BQ"),C=o("6GdIx"),f=o("kZUNn"),y=o("jl1FD"),A=o("aRYMn"),E=o("gkKSO"),v=o("24aK6"),T=o("dp0vd"),I=o("8AToY"),w=o("6HXlN"),S=o("iUf0j"),k=o("cx3ku"),R=o("2QnKr"),_=o("4pKco"),P=o("dBYPQ");class b extends v.BaseInteractionClient{constructor(e,t,r,n,o,i,a,s,c,l,d,h){super(e,t,r,n,o,i,s,c,h),this.apiId=a,this.accountId=l,this.platformAuthProvider=c,this.nativeStorageManager=d,this.silentCacheClient=new(0,S.SilentCacheClient)(e,this.nativeStorageManager,r,n,o,i,s,c,h);let u=this.platformAuthProvider.getExtensionName();this.skus=f.ServerTelemetryManager.makeExtraSkuString({libraryName:T.BrowserConstants.MSAL_SKU,libraryVersion:R.version,extensionName:u,extensionVersion:this.platformAuthProvider.getExtensionVersion()})}addRequestSKUs(e){e.extraParameters={...e.extraParameters,[n.X_CLIENT_EXTRA_SKU]:this.skus}}async acquireToken(e,t){this.performanceClient.addQueueMeasurement(g.PerformanceEvents.NativeInteractionClientAcquireToken,this.correlationId),this.logger.trace("NativeInteractionClient - acquireToken called.");let r=this.performanceClient.startMeasurement(g.PerformanceEvents.NativeInteractionClientAcquireToken,this.correlationId),n=y.nowSeconds(),o=this.initializeServerTelemetryManager(this.apiId);try{let i=await this.initializeNativeRequest(e);try{let e=await this.acquireTokensFromCache(this.accountId,i);return r.end({success:!0,isNativeBroker:!1,fromCache:!0}),e}catch(e){if(t===T.CacheLookupPolicy.AccessToken)throw this.logger.info("MSAL internal Cache does not contain tokens, return error as per cache policy"),r.end({success:!1,brokerErrorCode:"cache_request_failed"}),e;this.logger.info("MSAL internal Cache does not contain tokens, proceed to make a native call")}let a=await this.platformAuthProvider.sendMessage(i);return await this.handleNativeResponse(a,i,n).then(e=>(r.end({success:!0,isNativeBroker:!0,requestId:e.requestId}),o.clearNativeBrokerErrorCode(),e)).catch(e=>{throw r.end({success:!1,errorCode:e.errorCode,subErrorCode:e.subError}),e})}catch(e){throw e instanceof I.NativeAuthError&&o.setNativeBrokerErrorCode(e.errorCode),r.end({success:!1}),e}}createSilentCacheRequest(e,t){return{authority:e.authority,correlationId:this.correlationId,scopes:C.ScopeSet.fromString(e.scope).asArray(),account:t,forceRefresh:!1}}async acquireTokensFromCache(e,t){if(!e)throw this.logger.warning("NativeInteractionClient:acquireTokensFromCache - No nativeAccountId provided"),(0,u.createClientAuthError)(h.noAccountFound);let r=this.browserStorage.getBaseAccountInfo({nativeAccountId:e},this.correlationId);if(!r)throw(0,u.createClientAuthError)(h.noAccountFound);try{let e=this.createSilentCacheRequest(t,r),n=await this.silentCacheClient.acquireToken(e),o={...r,idTokenClaims:n?.idTokenClaims,idToken:n?.idToken};return{...n,account:o}}catch(e){throw e}}async acquireTokenRedirect(e,t){this.logger.trace("NativeInteractionClient - acquireTokenRedirect called.");let{...r}=e;delete r.onRedirectNavigate;let n=await this.initializeNativeRequest(r);try{await this.platformAuthProvider.sendMessage(n)}catch(e){if(e instanceof I.NativeAuthError&&(this.initializeServerTelemetryManager(this.apiId).setNativeBrokerErrorCode(e.errorCode),(0,I.isFatalNativeAuthError)(e)))throw e}this.browserStorage.setTemporaryCache(T.TemporaryCacheKeys.NATIVE_REQUEST,JSON.stringify(n),!0);let o={apiId:T.ApiId.acquireTokenRedirect,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},i=this.config.auth.navigateToLoginRequestUrl?window.location.href:this.getRedirectUri(e.redirectUri);t.end({success:!0}),await this.navigationClient.navigateExternal(i,o)}async handleRedirectPromise(e,t){if(this.logger.trace("NativeInteractionClient - handleRedirectPromise called."),!this.browserStorage.isInteractionInProgress(!0))return this.logger.info("handleRedirectPromise called but there is no interaction in progress, returning null."),null;let r=this.browserStorage.getCachedNativeRequest();if(!r)return this.logger.verbose("NativeInteractionClient - handleRedirectPromise called but there is no cached request, returning null."),e&&t&&e?.addFields({errorCode:"no_cached_request"},t),null;let{prompt:n,...o}=r;n&&this.logger.verbose("NativeInteractionClient - handleRedirectPromise called and prompt was included in the original request, removing prompt from cached request to prevent second interaction with native broker window."),this.browserStorage.removeItem(this.browserStorage.generateCacheKey(T.TemporaryCacheKeys.NATIVE_REQUEST));let i=y.nowSeconds();try{this.logger.verbose("NativeInteractionClient - handleRedirectPromise sending message to native broker.");let t=await this.platformAuthProvider.sendMessage(o),r=await this.handleNativeResponse(t,o,i);return this.initializeServerTelemetryManager(this.apiId).clearNativeBrokerErrorCode(),e&&this.correlationId&&this.performanceClient.addFields({isNativeBroker:!0},this.correlationId),r}catch(e){throw e}}logout(){return this.logger.trace("NativeInteractionClient - logout called."),Promise.reject("Logout not implemented yet")}async handleNativeResponse(e,t,r){this.logger.trace("NativeInteractionClient - handleNativeResponse called.");let n=c.extractTokenClaims(e.id_token,k.base64Decode),o=this.createHomeAccountIdentifier(e,n),i=this.browserStorage.getAccountInfoFilteredBy({nativeAccountId:t.accountId},this.correlationId)?.homeAccountId;if(t.extraParameters?.child_client_id&&e.account.id!==t.accountId)this.logger.info("handleNativeServerResponse: Double broker flow detected, ignoring accountId mismatch");else if(o!==i&&e.account.id!==t.accountId)throw(0,I.createNativeAuthError)(P.userSwitch);let a=await this.getDiscoveredAuthority({requestAuthority:t.authority}),s=(0,l.buildAccountToCache)(this.browserStorage,a,o,k.base64Decode,this.correlationId,n,e.client_info,void 0,n.tid,void 0,e.account.id,this.logger);e.expires_in=Number(e.expires_in);let d=await this.generateAuthenticationResult(e,t,n,s,a.canonicalAuthority,r);return await this.cacheAccount(s,this.correlationId,c.isKmsi(n)),await this.cacheNativeTokens(e,t,o,n,e.access_token,d.tenantId,r),d}createHomeAccountIdentifier(e,t){return i.AccountEntity.generateHomeAccountId(e.client_info||a.Constants.EMPTY_STRING,s.AuthorityType.Default,this.logger,this.browserCrypto,t)}generateScopes(e,t){return t?C.ScopeSet.fromString(t):C.ScopeSet.fromString(e)}async generatePopAccessToken(e,t){if(t.tokenType!==a.AuthenticationScheme.POP||!t.signPopToken)return e.access_token;{if(e.shr)return this.logger.trace("handleNativeServerResponse: SHR is enabled in native layer"),e.shr;let r=new(0,m.PopTokenGenerator)(this.browserCrypto),n={resourceRequestMethod:t.resourceRequestMethod,resourceRequestUri:t.resourceRequestUri,shrClaims:t.shrClaims,shrNonce:t.shrNonce};if(!t.keyId)throw(0,u.createClientAuthError)(h.keyIdMissing);return r.signPopToken(e.access_token,t.keyId,n)}}async generateAuthenticationResult(e,t,r,n,o,s){let c=this.addTelemetryFromNativeResponse(e.properties.MATS),l=this.generateScopes(t.scope,e.scope),d=e.account.properties||{},h=d.UID||r.oid||r.sub||a.Constants.EMPTY_STRING,u=d.TenantId||r.tid||a.Constants.EMPTY_STRING,p=(0,A.updateAccountTenantProfileData)(i.AccountEntity.getAccountInfo(n),void 0,r,e.id_token);p.nativeAccountId!==e.account.id&&(p.nativeAccountId=e.account.id);let g=await this.generatePopAccessToken(e,t),m=t.tokenType===a.AuthenticationScheme.POP?a.AuthenticationScheme.POP:a.AuthenticationScheme.BEARER;return{authority:o,uniqueId:h,tenantId:u,scopes:l.asArray(),account:p,idToken:e.id_token,idTokenClaims:r,accessToken:g,fromCache:!!c&&this.isResponseFromCache(c),expiresOn:y.toDateFromSeconds(s+e.expires_in),tokenType:m,correlationId:this.correlationId,state:e.state,fromNativeBroker:!0}}async cacheAccount(e,t,r){await this.browserStorage.setAccount(e,this.correlationId,r),this.browserStorage.removeAccountContext(i.AccountEntity.getAccountInfo(e),t)}cacheNativeTokens(e,t,r,n,o,i,s){let l=d.createIdTokenEntity(r,t.authority,e.id_token||"",t.clientId,n.tid||""),h=t.tokenType===a.AuthenticationScheme.POP?a.Constants.SHR_NONCE_VALIDITY:("string"==typeof e.expires_in?parseInt(e.expires_in,10):e.expires_in)||0,u=this.generateScopes(e.scope,t.scope),p=d.createAccessTokenEntity(r,t.authority,o,t.clientId,n.tid||i,u.printScopes(),s+h,0,k.base64Decode,void 0,t.tokenType,void 0,t.keyId);return this.nativeStorageManager.saveCacheRecord({idToken:l,accessToken:p},this.correlationId,c.isKmsi(n),t.storeInCache)}getExpiresInValue(e,t){return e===a.AuthenticationScheme.POP?a.Constants.SHR_NONCE_VALIDITY:("string"==typeof t?parseInt(t,10):t)||0}addTelemetryFromNativeResponse(e){let t=this.getMATSFromResponse(e);return t?(this.performanceClient.addFields({extensionId:this.platformAuthProvider.getExtensionId(),extensionVersion:this.platformAuthProvider.getExtensionVersion(),matsBrokerVersion:t.broker_version,matsAccountJoinOnStart:t.account_join_on_start,matsAccountJoinOnEnd:t.account_join_on_end,matsDeviceJoin:t.device_join,matsPromptBehavior:t.prompt_behavior,matsApiErrorCode:t.api_error_code,matsUiVisible:t.ui_visible,matsSilentCode:t.silent_code,matsSilentBiSubCode:t.silent_bi_sub_code,matsSilentMessage:t.silent_message,matsSilentStatus:t.silent_status,matsHttpStatus:t.http_status,matsHttpEventCount:t.http_event_count},this.correlationId),t):null}getMATSFromResponse(e){if(e)try{return JSON.parse(e)}catch(e){this.logger.error("NativeInteractionClient - Error parsing MATS telemetry, returning null instead")}return null}isResponseFromCache(e){return void 0===e.is_cached?(this.logger.verbose("NativeInteractionClient - MATS telemetry does not contain field indicating if response was served from cache. Returning false."),!1):!!e.is_cached}async initializeNativeRequest(e){this.logger.trace("NativeInteractionClient - initializeNativeRequest called");let t=await this.getCanonicalAuthority(e),{scopes:r,...n}=e,o=new(0,C.ScopeSet)(r||[]);o.appendScopes(a.OIDC_DEFAULT_SCOPES);let i={...n,accountId:this.accountId,clientId:this.config.auth.clientId,authority:t.urlString,scope:o.printScopes(),redirectUri:this.getRedirectUri(e.redirectUri),prompt:this.getPrompt(e.prompt),correlationId:this.correlationId,tokenType:e.authenticationScheme,windowTitleSubstring:document.title,extraParameters:{...e.extraQueryParameters,...e.tokenQueryParameters},extendedExpiryToken:!1,keyId:e.popKid};if(i.signPopToken&&e.popKid)throw(0,w.createBrowserAuthError)(_.invalidPopTokenRequest);if(this.handleExtraBrokerParams(i),i.extraParameters=i.extraParameters||{},i.extraParameters.telemetry=T.PlatformAuthConstants.MATS_TELEMETRY,e.authenticationScheme===a.AuthenticationScheme.POP){let t,r={resourceRequestUri:e.resourceRequestUri,resourceRequestMethod:e.resourceRequestMethod,shrClaims:e.shrClaims,shrNonce:e.shrNonce},n=new(0,m.PopTokenGenerator)(this.browserCrypto);if(i.keyId)t=this.browserCrypto.base64UrlEncode(JSON.stringify({kid:i.keyId})),i.signPopToken=!1;else{let e=await (0,p.invokeAsync)(n.generateCnf.bind(n),g.PerformanceEvents.PopTokenGenerateCnf,this.logger,this.performanceClient,this.correlationId)(r,this.logger);t=e.reqCnfString,i.keyId=e.kid,i.signPopToken=!0}i.reqCnf=t}return this.addRequestSKUs(i),i}async getCanonicalAuthority(e){let t=e.authority||this.config.auth.authority;e.account&&await this.getDiscoveredAuthority({requestAuthority:t,requestAzureCloudOptions:e.azureCloudOptions,account:e.account});let r=new(0,E.UrlString)(t);return r.validateAsUri(),r}getPrompt(e){switch(this.apiId){case T.ApiId.ssoSilent:case T.ApiId.acquireTokenSilent_silentFlow:return this.logger.trace("initializeNativeRequest: silent request sets prompt to none"),a.PromptValue.NONE}if(!e)return void this.logger.trace("initializeNativeRequest: prompt was not provided");switch(e){case a.PromptValue.NONE:case a.PromptValue.CONSENT:case a.PromptValue.LOGIN:case a.PromptValue.SELECT_ACCOUNT:return this.logger.trace("initializeNativeRequest: prompt is compatible with native flow"),e;default:throw this.logger.trace(`initializeNativeRequest: prompt = ${e} is not compatible with native flow`),(0,w.createBrowserAuthError)(_.nativePromptNotSupported)}}handleExtraBrokerParams(e){let t=e.extraParameters&&e.extraParameters.hasOwnProperty(n.BROKER_CLIENT_ID)&&e.extraParameters.hasOwnProperty(n.BROKER_REDIRECT_URI)&&e.extraParameters.hasOwnProperty(n.CLIENT_ID);if(!e.embeddedClientId&&!t)return;let r="",o=e.redirectUri;e.embeddedClientId?(e.redirectUri=this.config.auth.redirectUri,r=e.embeddedClientId):e.extraParameters&&(e.redirectUri=e.extraParameters[n.BROKER_REDIRECT_URI],r=e.extraParameters[n.CLIENT_ID]),e.extraParameters={child_client_id:r,child_redirect_uri:o},this.performanceClient?.addFields({embeddedClientId:r,embeddedRedirectUri:o},this.correlationId)}}}),i("8AToY",function(t,r){e(t.exports,"NativeAuthError",()=>u),e(t.exports,"isFatalNativeAuthError",()=>p),e(t.exports,"createNativeAuthError",()=>g);var n=o("ckDmJ"),i=o("dKahV"),a=o("1jH5T"),s=o("6HXlN"),c=o("dBYPQ"),l=o("i1CkQ"),d=o("4pKco");let h={[c.userSwitch]:"User attempted to switch accounts in the native broker, which is not allowed. All new accounts must sign-in through the standard web flow first, please try again."};class u extends n.AuthError{constructor(e,t,r){super(e,t),Object.setPrototypeOf(this,u.prototype),this.name="NativeAuthError",this.ext=r}}function p(e){if(e.ext&&e.ext.status&&e.ext.status===l.DISABLED||e.ext&&e.ext.error&&-0x7ffb78ff===e.ext.error)return!0;switch(e.errorCode){case c.contentError:case c.pageException:return!0;default:return!1}}function g(e,t,r){if(r&&r.status)switch(r.status){case l.ACCOUNT_UNAVAILABLE:return(0,i.createInteractionRequiredAuthError)(a.nativeAccountUnavailable);case l.USER_INTERACTION_REQUIRED:return new(0,i.InteractionRequiredAuthError)(e,t);case l.USER_CANCEL:return(0,s.createBrowserAuthError)(d.userCancelled);case l.NO_NETWORK:return(0,s.createBrowserAuthError)(d.noNetworkConnectivity);case l.UX_NOT_ALLOWED:return(0,i.createInteractionRequiredAuthError)(a.uxNotAllowed)}return new u(e,h[e]||t,r)}}),i("dBYPQ",function(t,r){e(t.exports,"contentError",()=>n),e(t.exports,"pageException",()=>o),e(t.exports,"userSwitch",()=>i);let n="ContentError",o="PageException",i="user_switch"}),i("i1CkQ",function(t,r){e(t.exports,"USER_INTERACTION_REQUIRED",()=>n),e(t.exports,"USER_CANCEL",()=>o),e(t.exports,"NO_NETWORK",()=>i),e(t.exports,"DISABLED",()=>a),e(t.exports,"ACCOUNT_UNAVAILABLE",()=>s),e(t.exports,"UX_NOT_ALLOWED",()=>c);let n="USER_INTERACTION_REQUIRED",o="USER_CANCEL",i="NO_NETWORK",a="DISABLED",s="ACCOUNT_UNAVAILABLE",c="UX_NOT_ALLOWED"}),i("iUf0j",function(t,r){e(t.exports,"SilentCacheClient",()=>h);var n=o("5glYQ"),i=o("9tUvn"),a=o("gnfKd"),s=o("33v0a"),c=o("dp0vd"),l=o("6HXlN"),d=o("4pKco");class h extends n.StandardInteractionClient{async acquireToken(e){this.performanceClient.addQueueMeasurement(a.PerformanceEvents.SilentCacheClientAcquireToken,e.correlationId);let t=this.initializeServerTelemetryManager(c.ApiId.acquireTokenSilent_silentFlow),r=await (0,i.invokeAsync)(this.getClientConfiguration.bind(this),a.PerformanceEvents.StandardInteractionClientGetClientConfiguration,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:t,requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,account:e.account}),n=new(0,s.SilentFlowClient)(r,this.performanceClient);this.logger.verbose("Silent auth client created");try{let t=(await (0,i.invokeAsync)(n.acquireCachedToken.bind(n),a.PerformanceEvents.SilentFlowClientAcquireCachedToken,this.logger,this.performanceClient,e.correlationId)(e))[0];return this.performanceClient.addFields({fromCache:!0},e.correlationId),t}catch(e){throw e instanceof l.BrowserAuthError&&e.errorCode===d.cryptoKeyNotFound&&this.logger.verbose("Signing keypair for bound access token not found. Refreshing bound access token and generating a new crypto keypair."),e}}logout(e){this.logger.verbose("logoutRedirect called");let t=this.initializeLogoutRequest(e);return this.clearCacheOnLogout(t.correlationId,t?.account)}}}),i("33v0a",function(t,r){e(t.exports,"SilentFlowClient",()=>m);var n=o("fV1L4"),i=o("jl1FD"),a=o("anIdE"),s=o("aomzz"),c=o("gmw86"),l=o("7yP0u"),d=o("eVKB1"),h=o("gnfKd"),u=o("9tUvn"),p=o("8xmgF"),g=o("l6ONb");class m extends n.BaseClient{constructor(e,t){super(e,t)}async acquireCachedToken(e){this.performanceClient?.addQueueMeasurement(h.PerformanceEvents.SilentFlowClientAcquireCachedToken,e.correlationId);let t=c.CacheOutcome.NOT_APPLICABLE;if(e.forceRefresh||!this.config.cacheOptions.claimsBasedCachingEnabled&&!l.StringUtils.isEmptyObj(e.claims))throw this.setCacheOutcome(c.CacheOutcome.FORCE_REFRESH_OR_CLAIMS,e.correlationId),(0,a.createClientAuthError)(g.tokenRefreshRequired);if(!e.account)throw(0,a.createClientAuthError)(g.noAccountInSilentRequest);let r=e.account.tenantId||(0,p.getTenantFromAuthorityString)(e.authority),n=this.cacheManager.getTokenKeys(),o=this.cacheManager.getAccessToken(e.account,e,n,r);if(o)if((0,i.wasClockTurnedBack)(o.cachedAt)||(0,i.isTokenExpired)(o.expiresOn,this.config.systemOptions.tokenRenewalOffsetSeconds))throw this.setCacheOutcome(c.CacheOutcome.CACHED_ACCESS_TOKEN_EXPIRED,e.correlationId),(0,a.createClientAuthError)(g.tokenRefreshRequired);else o.refreshOn&&(0,i.isTokenExpired)(o.refreshOn,0)&&(t=c.CacheOutcome.PROACTIVELY_REFRESHED);else throw this.setCacheOutcome(c.CacheOutcome.NO_CACHED_ACCESS_TOKEN,e.correlationId),(0,a.createClientAuthError)(g.tokenRefreshRequired);let s=e.authority||this.authority.getPreferredCache(),d={account:this.cacheManager.getAccount(this.cacheManager.generateAccountKey(e.account),e.correlationId),accessToken:o,idToken:this.cacheManager.getIdToken(e.account,e.correlationId,n,r,this.performanceClient),refreshToken:null,appMetadata:this.cacheManager.readAppMetadataFromCache(s)};return this.setCacheOutcome(t,e.correlationId),this.config.serverTelemetryManager&&this.config.serverTelemetryManager.incrementCacheHits(),[await (0,u.invokeAsync)(this.generateResultFromCacheRecord.bind(this),h.PerformanceEvents.SilentFlowClientGenerateResultFromCacheRecord,this.logger,this.performanceClient,e.correlationId)(d,e),t]}setCacheOutcome(e,t){this.serverTelemetryManager?.setCacheOutcome(e),this.performanceClient?.addFields({cacheOutcome:e},t),e!==c.CacheOutcome.NOT_APPLICABLE&&this.logger.info(`Token refresh is required due to cache outcome: ${e}`)}async generateResultFromCacheRecord(e,t){let r;if(this.performanceClient?.addQueueMeasurement(h.PerformanceEvents.SilentFlowClientGenerateResultFromCacheRecord,t.correlationId),e.idToken&&(r=(0,d.extractTokenClaims)(e.idToken.secret,this.config.cryptoInterface.base64Decode)),t.maxAge||0===t.maxAge){let e=r?.auth_time;if(!e)throw(0,a.createClientAuthError)(g.authTimeNotFound);(0,d.checkMaxAge)(e,t.maxAge)}return s.ResponseHandler.generateAuthenticationResult(this.cryptoUtils,this.authority,e,!0,t,r)}}}),i("lcP17",function(t,r){e(t.exports,"generatePkceCodes",()=>d);var n=o("9tUvn"),i=o("gnfKd"),a=o("6HXlN"),s=o("7e5V2"),c=o("7oR2q"),l=o("4pKco");async function d(e,t,r){e.addQueueMeasurement(i.PerformanceEvents.GeneratePkceCodes,r);let o=(0,n.invoke)(h,i.PerformanceEvents.GenerateCodeVerifier,t,e,r)(e,t,r),a=await (0,n.invokeAsync)(u,i.PerformanceEvents.GenerateCodeChallengeFromVerifier,t,e,r)(o,e,t,r);return{verifier:o,challenge:a}}function h(e,t,r){try{let o=new Uint8Array(32);return(0,n.invoke)(c.getRandomValues,i.PerformanceEvents.GetRandomValues,t,e,r)(o),(0,s.urlEncodeArr)(o)}catch(e){throw(0,a.createBrowserAuthError)(l.pkceNotCreated)}}async function u(e,t,r,o){t.addQueueMeasurement(i.PerformanceEvents.GenerateCodeChallengeFromVerifier,o);try{let a=await (0,n.invokeAsync)(c.sha256Digest,i.PerformanceEvents.Sha256Digest,r,t,o)(e,t,o);return(0,s.urlEncodeArr)(new Uint8Array(a))}catch(e){throw(0,a.createBrowserAuthError)(l.pkceNotCreated)}}}),i("2pUnf",function(t,r){e(t.exports,"getPlatformAuthProvider",()=>d),e(t.exports,"isPlatformAuthAllowed",()=>h);var n=o("gmw86");o("lxp2N"),o("e0Klr"),o("2QnKr");var i=o("f7l91"),a=o("hsDOC"),s=o("58Q0O");o("7oR2q");var c=o("dp0vd"),l=o("2wtIk");async function d(e,t,r,n){let o;e.trace("getPlatformAuthProvider called",r);let d=function(){let e;try{return e=window[c.BrowserCacheLocation.SessionStorage],e?.getItem(l.PLATFORM_AUTH_DOM_SUPPORT)==="true"}catch(e){return!1}}();e.trace("Has client allowed platform auth via DOM API: "+d);try{d&&(o=await s.PlatformAuthDOMHandler.createProvider(e,t,r)),o||(e.trace("Platform auth via DOM API not available, checking for extension"),o=await a.PlatformAuthExtensionHandler.createProvider(e,n||i.DEFAULT_NATIVE_BROKER_HANDSHAKE_TIMEOUT_MS,t))}catch(t){e.trace("Platform auth not available",t)}return o}function h(e,t,r,o){if(t.trace("isPlatformAuthAllowed called"),!e.system.allowPlatformBroker)return t.trace("isPlatformAuthAllowed: allowPlatformBroker is not enabled, returning false"),!1;if(!r)return t.trace("isPlatformAuthAllowed: Platform auth provider is not initialized, returning false"),!1;if(o)switch(o){case n.AuthenticationScheme.BEARER:case n.AuthenticationScheme.POP:t.trace("isPlatformAuthAllowed: authenticationScheme is supported, returning true");break;default:return t.trace("isPlatformAuthAllowed: authenticationScheme is not supported, returning false"),!1}return!0}}),i("hsDOC",function(t,r){e(t.exports,"PlatformAuthExtensionHandler",()=>u);var n=o("dp0vd"),i=o("4vd0U"),a=o("ckDmJ"),s=o("gnfKd"),c=o("8AToY"),l=o("6HXlN"),d=o("7oR2q"),h=o("4pKco");class u{constructor(e,t,r,o){this.logger=e,this.handshakeTimeoutMs=t,this.extensionId=o,this.resolvers=new Map,this.handshakeResolvers=new Map,this.messageChannel=new MessageChannel,this.windowListener=this.onWindowMessage.bind(this),this.performanceClient=r,this.handshakeEvent=r.startMeasurement(s.PerformanceEvents.NativeMessageHandlerHandshake),this.platformAuthType=n.PlatformAuthConstants.PLATFORM_EXTENSION_PROVIDER}async sendMessage(e){this.logger.trace(this.platformAuthType+" - sendMessage called.");let t={method:n.NativeExtensionMethod.GetToken,request:e},r={channel:n.PlatformAuthConstants.CHANNEL_ID,extensionId:this.extensionId,responseId:(0,d.createNewGuid)(),body:t};this.logger.trace(this.platformAuthType+" - Sending request to browser extension"),this.logger.tracePii(this.platformAuthType+` - Sending request to browser extension: ${JSON.stringify(r)}`),this.messageChannel.port1.postMessage(r);let o=await new Promise((e,t)=>{this.resolvers.set(r.responseId,{resolve:e,reject:t})});return this.validatePlatformBrokerResponse(o)}static async createProvider(e,t,r){e.trace("PlatformAuthExtensionHandler - createProvider called.");try{let o=new u(e,t,r,n.PlatformAuthConstants.PREFERRED_EXTENSION_ID);return await o.sendHandshakeRequest(),o}catch(o){let n=new u(e,t,r);return await n.sendHandshakeRequest(),n}}async sendHandshakeRequest(){this.logger.trace(this.platformAuthType+" - sendHandshakeRequest called."),window.addEventListener("message",this.windowListener,!1);let e={channel:n.PlatformAuthConstants.CHANNEL_ID,extensionId:this.extensionId,responseId:(0,d.createNewGuid)(),body:{method:n.NativeExtensionMethod.HandshakeRequest}};return this.handshakeEvent.add({extensionId:this.extensionId,extensionHandshakeTimeoutMs:this.handshakeTimeoutMs}),this.messageChannel.port1.onmessage=e=>{this.onChannelMessage(e)},window.postMessage(e,window.origin,[this.messageChannel.port2]),new Promise((t,r)=>{this.handshakeResolvers.set(e.responseId,{resolve:t,reject:r}),this.timeoutId=window.setTimeout(()=>{window.removeEventListener("message",this.windowListener,!1),this.messageChannel.port1.close(),this.messageChannel.port2.close(),this.handshakeEvent.end({extensionHandshakeTimedOut:!0,success:!1}),r((0,l.createBrowserAuthError)(h.nativeHandshakeTimeout)),this.handshakeResolvers.delete(e.responseId)},this.handshakeTimeoutMs)})}onWindowMessage(e){if(this.logger.trace(this.platformAuthType+" - onWindowMessage called"),e.source!==window)return;let t=e.data;if(t.channel&&t.channel===n.PlatformAuthConstants.CHANNEL_ID&&(!t.extensionId||t.extensionId===this.extensionId)&&t.body.method===n.NativeExtensionMethod.HandshakeRequest){let e=this.handshakeResolvers.get(t.responseId);if(!e)return void this.logger.trace(this.platformAuthType+`.onWindowMessage - resolver can't be found for request ${t.responseId}`);this.logger.verbose(t.extensionId?`Extension with id: ${t.extensionId} not installed`:"No extension installed"),clearTimeout(this.timeoutId),this.messageChannel.port1.close(),this.messageChannel.port2.close(),window.removeEventListener("message",this.windowListener,!1),this.handshakeEvent.end({success:!1,extensionInstalled:!1}),e.reject((0,l.createBrowserAuthError)(h.nativeExtensionNotInstalled))}}onChannelMessage(e){this.logger.trace(this.platformAuthType+" - onChannelMessage called.");let t=e.data,r=this.resolvers.get(t.responseId),o=this.handshakeResolvers.get(t.responseId);try{let e=t.body.method;if(e===n.NativeExtensionMethod.Response){if(!r)return;let e=t.body.response;if(this.logger.trace(this.platformAuthType+" - Received response from browser extension"),this.logger.tracePii(this.platformAuthType+` - Received response from browser extension: ${JSON.stringify(e)}`),"Success"!==e.status)r.reject((0,c.createNativeAuthError)(e.code,e.description,e.ext));else if(e.result)e.result.code&&e.result.description?r.reject((0,c.createNativeAuthError)(e.result.code,e.result.description,e.result.ext)):r.resolve(e.result);else throw(0,a.createAuthError)(i.unexpectedError,"Event does not contain result.");this.resolvers.delete(t.responseId)}else if(e===n.NativeExtensionMethod.HandshakeResponse){if(!o)return void this.logger.trace(this.platformAuthType+`.onChannelMessage - resolver can't be found for request ${t.responseId}`);clearTimeout(this.timeoutId),window.removeEventListener("message",this.windowListener,!1),this.extensionId=t.extensionId,this.extensionVersion=t.body.version,this.logger.verbose(this.platformAuthType+` - Received HandshakeResponse from extension: ${this.extensionId}`),this.handshakeEvent.end({extensionInstalled:!0,success:!0}),o.resolve(),this.handshakeResolvers.delete(t.responseId)}}catch(t){this.logger.error("Error parsing response from WAM Extension"),this.logger.errorPii(`Error parsing response from WAM Extension: ${t}`),this.logger.errorPii(`Unable to parse ${e}`),r?r.reject(t):o&&o.reject(t)}}validatePlatformBrokerResponse(e){if(e.hasOwnProperty("access_token")&&e.hasOwnProperty("id_token")&&e.hasOwnProperty("client_info")&&e.hasOwnProperty("account")&&e.hasOwnProperty("scope")&&e.hasOwnProperty("expires_in"))return e;throw(0,a.createAuthError)(i.unexpectedError,"Response missing expected properties.")}getExtensionId(){return this.extensionId}getExtensionVersion(){return this.extensionVersion}getExtensionName(){return this.getExtensionId()===n.PlatformAuthConstants.PREFERRED_EXTENSION_ID?"chrome":this.getExtensionId()?.length?"unknown":void 0}}}),i("58Q0O",function(t,r){e(t.exports,"PlatformAuthDOMHandler",()=>c);var n=o("4vd0U"),i=o("ckDmJ"),a=o("dp0vd"),s=o("8AToY");class c{constructor(e,t,r){this.logger=e,this.performanceClient=t,this.correlationId=r,this.platformAuthType=a.PlatformAuthConstants.PLATFORM_DOM_PROVIDER}static async createProvider(e,t,r){if(e.trace("PlatformAuthDOMHandler: createProvider called"),window.navigator?.platformAuthentication){let n=await window.navigator.platformAuthentication.getSupportedContracts(a.PlatformAuthConstants.MICROSOFT_ENTRA_BROKERID);if(n?.includes(a.PlatformAuthConstants.PLATFORM_DOM_APIS))return e.trace("Platform auth api available in DOM"),new c(e,t,r)}}getExtensionId(){return a.PlatformAuthConstants.MICROSOFT_ENTRA_BROKERID}getExtensionVersion(){return""}getExtensionName(){return a.PlatformAuthConstants.DOM_API_NAME}async sendMessage(e){this.logger.trace(this.platformAuthType+" - Sending request to browser DOM API");try{let t=this.initializePlatformDOMRequest(e),r=await window.navigator.platformAuthentication.executeGetToken(t);return this.validatePlatformBrokerResponse(r)}catch(e){throw this.logger.error(this.platformAuthType+" - executeGetToken DOM API error"),e}}initializePlatformDOMRequest(e){this.logger.trace(this.platformAuthType+" - initializeNativeDOMRequest called");let{accountId:t,clientId:r,authority:n,scope:o,redirectUri:i,correlationId:a,state:s,storeInCache:c,embeddedClientId:l,extraParameters:d,...h}=e,u=this.getDOMExtraParams(h);return{accountId:t,brokerId:this.getExtensionId(),authority:n,clientId:r,correlationId:a||this.correlationId,extraParameters:{...d,...u},isSecurityTokenService:!1,redirectUri:i,scope:o,state:s,storeInCache:c,embeddedClientId:l}}validatePlatformBrokerResponse(e){if(e.hasOwnProperty("isSuccess")){if(e.hasOwnProperty("accessToken")&&e.hasOwnProperty("idToken")&&e.hasOwnProperty("clientInfo")&&e.hasOwnProperty("account")&&e.hasOwnProperty("scopes")&&e.hasOwnProperty("expiresIn"))return this.logger.trace(this.platformAuthType+" - platform broker returned successful and valid response"),this.convertToPlatformBrokerResponse(e);else if(e.hasOwnProperty("error")&&!1===e.isSuccess&&e.error&&e.error.code)throw this.logger.trace(this.platformAuthType+" - platform broker returned error response"),(0,s.createNativeAuthError)(e.error.code,e.error.description,{error:parseInt(e.error.errorCode),protocol_error:e.error.protocolError,status:e.error.status,properties:e.error.properties})}throw(0,i.createAuthError)(n.unexpectedError,"Response missing expected properties.")}convertToPlatformBrokerResponse(e){return this.logger.trace(this.platformAuthType+" - convertToNativeResponse called"),{access_token:e.accessToken,id_token:e.idToken,client_info:e.clientInfo,account:e.account,expires_in:e.expiresIn,scope:e.scopes,state:e.state||"",properties:e.properties||{},extendedLifetimeToken:e.extendedLifetimeToken??!1,shr:e.proofOfPossessionPayload}}getDOMExtraParams(e){return{...Object.entries(e).reduce((e,[t,r])=>(e[t]=String(r),e),{})}}}}),i("cx1Eq",function(t,r){e(t.exports,"RedirectClient",()=>T);var n=o("ckDmJ"),i=o("gmw86"),a=o("9tUvn"),s=o("gnfKd"),c=o("77Sbs"),l=o("gkKSO"),d=o("8S0Fg"),h=o("5glYQ"),u=o("dp0vd"),p=o("5S1XQ"),g=o("fKG6z"),m=o("6HXlN"),C=o("29emz"),f=o("1cQ8k"),y=o("lcP17"),A=o("2pUnf"),E=o("7oR2q"),v=o("4pKco");class T extends h.StandardInteractionClient{constructor(e,t,r,n,o,i,a,s,c,l){super(e,t,r,n,o,i,a,c,l),this.nativeStorage=s}async acquireToken(e){let t=await (0,a.invokeAsync)(this.initializeAuthorizationRequest.bind(this),s.PerformanceEvents.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,this.correlationId)(e,u.InteractionType.Redirect);t.platformBroker=(0,A.isPlatformAuthAllowed)(this.config,this.logger,this.platformAuthProvider,e.authenticationScheme);let r=e=>{e.persisted&&(this.logger.verbose("Page was restored from back/forward cache. Clearing temporary cache."),this.browserStorage.resetRequestCache(),this.eventHandler.emitEvent(g.EventType.RESTORE_FROM_BFCACHE,u.InteractionType.Redirect))},o=this.getRedirectStartPage(e.redirectStartPage);this.logger.verbosePii(`Redirect start page: ${o}`),this.browserStorage.setTemporaryCache(u.TemporaryCacheKeys.ORIGIN_URI,o,!0),window.addEventListener("pageshow",r);try{this.config.auth.protocolMode===c.ProtocolMode.EAR?await this.executeEarFlow(t):await this.executeCodeFlow(t,e.onRedirectNavigate)}catch(e){throw e instanceof n.AuthError&&e.setCorrelationId(this.correlationId),window.removeEventListener("pageshow",r),e}}async executeCodeFlow(e,t){let r=e.correlationId,o=this.initializeServerTelemetryManager(u.ApiId.acquireTokenRedirect),c=await (0,a.invokeAsync)(y.generatePkceCodes,s.PerformanceEvents.GeneratePkceCodes,this.logger,this.performanceClient,r)(this.performanceClient,this.logger,r),l={...e,codeChallenge:c.challenge};this.browserStorage.cacheAuthorizeRequest(l,c.verifier);try{if(l.httpMethod===i.HttpMethod.POST)return await this.executeCodeFlowWithPost(l);{let r=await (0,a.invokeAsync)(this.createAuthCodeClient.bind(this),s.PerformanceEvents.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:o,requestAuthority:l.authority,requestAzureCloudOptions:l.azureCloudOptions,requestExtraQueryParameters:l.extraQueryParameters,account:l.account}),n=await (0,a.invokeAsync)(f.getAuthCodeRequestUrl,s.PerformanceEvents.GetAuthCodeUrl,this.logger,this.performanceClient,e.correlationId)(this.config,r.authority,l,this.logger,this.performanceClient);return await this.initiateAuthRequest(n,t)}}catch(e){throw e instanceof n.AuthError&&(e.setCorrelationId(this.correlationId),o.cacheFailedRequest(e)),e}}async executeEarFlow(e){let t=e.correlationId,r=await (0,a.invokeAsync)(this.getDiscoveredAuthority.bind(this),s.PerformanceEvents.StandardInteractionClientGetDiscoveredAuthority,this.logger,this.performanceClient,t)({requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account}),n=await (0,a.invokeAsync)(E.generateEarKey,s.PerformanceEvents.GenerateEarKey,this.logger,this.performanceClient,t)(),o={...e,earJwk:n};return this.browserStorage.cacheAuthorizeRequest(o),(await (0,f.getEARForm)(document,this.config,r,o,this.logger,this.performanceClient)).submit(),new Promise((e,t)=>{setTimeout(()=>{t((0,m.createBrowserAuthError)(v.timedOut,"failed_to_redirect"))},this.config.system.redirectNavigationTimeout)})}async executeCodeFlowWithPost(e){let t=e.correlationId,r=await (0,a.invokeAsync)(this.getDiscoveredAuthority.bind(this),s.PerformanceEvents.StandardInteractionClientGetDiscoveredAuthority,this.logger,this.performanceClient,t)({requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account});return this.browserStorage.cacheAuthorizeRequest(e),(await (0,f.getCodeForm)(document,this.config,r,e,this.logger,this.performanceClient)).submit(),new Promise((e,t)=>{setTimeout(()=>{t((0,m.createBrowserAuthError)(v.timedOut,"failed_to_redirect"))},this.config.system.redirectNavigationTimeout)})}async handleRedirectPromise(e="",t,r,o){let a=this.initializeServerTelemetryManager(u.ApiId.handleRedirectPromise);try{let[n,s]=this.getRedirectResponse(e||"");if(!n)return this.logger.info("handleRedirectPromise did not detect a response as a result of a redirect. Cleaning temporary cache."),this.browserStorage.resetRequestCache(),"back_forward"!==function(){if("undefined"==typeof window||void 0===window.performance||"function"!=typeof window.performance.getEntriesByType)return;let e=window.performance.getEntriesByType("navigation"),t=e.length?e[0]:void 0;return t?.type}()?o.event.errorCode="no_server_response":this.logger.verbose("Back navigation event detected. Muting no_server_response error"),null;let c=this.browserStorage.getTemporaryCache(u.TemporaryCacheKeys.ORIGIN_URI,!0)||i.Constants.EMPTY_STRING,l=d.normalizeUrlForComparison(c),h=d.normalizeUrlForComparison(window.location.href);if(l===h&&this.config.auth.navigateToLoginRequestUrl)return this.logger.verbose("Current page is loginRequestUrl, handling response"),c.indexOf("#")>-1&&(0,p.replaceHash)(c),await this.handleResponse(n,t,r,a);if(!this.config.auth.navigateToLoginRequestUrl)return this.logger.verbose("NavigateToLoginRequestUrl set to false, handling response"),await this.handleResponse(n,t,r,a);if(!(0,p.isInIframe)()||this.config.system.allowRedirectInIframe){this.browserStorage.setTemporaryCache(u.TemporaryCacheKeys.URL_HASH,s,!0);let e={apiId:u.ApiId.handleRedirectPromise,timeout:this.config.system.redirectNavigationTimeout,noHistory:!0},o=!0;if(c&&"null"!==c)this.logger.verbose(`Navigating to loginRequestUrl: ${c}`),o=await this.navigationClient.navigateInternal(c,e);else{let t=(0,p.getHomepage)();this.browserStorage.setTemporaryCache(u.TemporaryCacheKeys.ORIGIN_URI,t,!0),this.logger.warning("Unable to get valid login request url from cache, redirecting to home page"),o=await this.navigationClient.navigateInternal(t,e)}if(!o)return await this.handleResponse(n,t,r,a)}return null}catch(e){throw e instanceof n.AuthError&&(e.setCorrelationId(this.correlationId),a.cacheFailedRequest(e)),e}}getRedirectResponse(e){this.logger.verbose("getRedirectResponseHash called");let t=e;t||(t=this.config.auth.OIDCOptions.serverResponseType===i.ServerResponseType.QUERY?window.location.search:window.location.hash);let r=d.getDeserializedResponse(t);if(r){try{(0,C.validateInteractionType)(r,this.browserCrypto,u.InteractionType.Redirect)}catch(e){return e instanceof n.AuthError&&this.logger.error(`Interaction type validation failed due to ${e.errorCode}: ${e.errorMessage}`),[null,""]}return(0,p.clearHash)(window),this.logger.verbose("Hash contains known properties, returning response hash"),[r,t]}let o=this.browserStorage.getTemporaryCache(u.TemporaryCacheKeys.URL_HASH,!0);return(this.browserStorage.removeItem(this.browserStorage.generateCacheKey(u.TemporaryCacheKeys.URL_HASH)),o&&(r=d.getDeserializedResponse(o)))?(this.logger.verbose("Hash does not contain known properties, returning cached hash"),[r,o]):[null,""]}async handleResponse(e,t,r,n){if(!e.state)throw(0,m.createBrowserAuthError)(v.noStateInHash);if(e.ear_jwe){let r=await (0,a.invokeAsync)(this.getDiscoveredAuthority.bind(this),s.PerformanceEvents.StandardInteractionClientGetDiscoveredAuthority,this.logger,this.performanceClient,t.correlationId)({requestAuthority:t.authority,requestAzureCloudOptions:t.azureCloudOptions,requestExtraQueryParameters:t.extraQueryParameters,account:t.account});return(0,a.invokeAsync)(f.handleResponseEAR,s.PerformanceEvents.HandleResponseEar,this.logger,this.performanceClient,t.correlationId)(t,e,u.ApiId.acquireTokenRedirect,this.config,r,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}let o=await (0,a.invokeAsync)(this.createAuthCodeClient.bind(this),s.PerformanceEvents.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:n,requestAuthority:t.authority});return(0,a.invokeAsync)(f.handleResponseCode,s.PerformanceEvents.HandleResponseCode,this.logger,this.performanceClient,t.correlationId)(t,e,r,u.ApiId.acquireTokenRedirect,this.config,o,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}async initiateAuthRequest(e,t){if(this.logger.verbose("RedirectHandler.initiateAuthRequest called"),e){this.logger.infoPii(`RedirectHandler.initiateAuthRequest: Navigate to: ${e}`);let r={apiId:u.ApiId.acquireTokenRedirect,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},n=t||this.config.auth.onRedirectNavigate;if("function"==typeof n)return(this.logger.verbose("RedirectHandler.initiateAuthRequest: Invoking onRedirectNavigate callback"),!1===n(e))?void this.logger.verbose("RedirectHandler.initiateAuthRequest: onRedirectNavigate returned false, stopping navigation"):(this.logger.verbose("RedirectHandler.initiateAuthRequest: onRedirectNavigate did not return false, navigating"),await this.navigationClient.navigateExternal(e,r),void 0);return this.logger.verbose("RedirectHandler.initiateAuthRequest: Navigating window to navigate url"),await this.navigationClient.navigateExternal(e,r),void 0}throw this.logger.info("RedirectHandler.initiateAuthRequest: Navigate url is empty"),(0,m.createBrowserAuthError)(v.emptyNavigateUri)}async logout(e){this.logger.verbose("logoutRedirect called");let t=this.initializeLogoutRequest(e),r=this.initializeServerTelemetryManager(u.ApiId.logout);try{this.eventHandler.emitEvent(g.EventType.LOGOUT_START,u.InteractionType.Redirect,e),await this.clearCacheOnLogout(this.correlationId,t.account);let n={apiId:u.ApiId.logout,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},o=await (0,a.invokeAsync)(this.createAuthCodeClient.bind(this),s.PerformanceEvents.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:r,requestAuthority:e&&e.authority,requestExtraQueryParameters:e?.extraQueryParameters,account:e&&e.account||void 0});if(o.authority.protocolMode===c.ProtocolMode.OIDC)try{o.authority.endSessionEndpoint}catch{if(t.account?.homeAccountId)return void this.eventHandler.emitEvent(g.EventType.LOGOUT_SUCCESS,u.InteractionType.Redirect,t)}let i=o.getLogoutUri(t);if(this.eventHandler.emitEvent(g.EventType.LOGOUT_SUCCESS,u.InteractionType.Redirect,t),e&&"function"==typeof e.onRedirectNavigate){let t=e.onRedirectNavigate(i);if(!1!==t){this.logger.verbose("Logout onRedirectNavigate did not return false, navigating"),this.browserStorage.getInteractionInProgress()||this.browserStorage.setInteractionInProgress(!0,u.INTERACTION_TYPE.SIGNOUT),await this.navigationClient.navigateExternal(i,n);return}this.browserStorage.setInteractionInProgress(!1),this.logger.verbose("Logout onRedirectNavigate returned false, stopping navigation")}else{this.browserStorage.getInteractionInProgress()||this.browserStorage.setInteractionInProgress(!0,u.INTERACTION_TYPE.SIGNOUT),await this.navigationClient.navigateExternal(i,n);return}}catch(e){throw e instanceof n.AuthError&&(e.setCorrelationId(this.correlationId),r.cacheFailedRequest(e)),this.eventHandler.emitEvent(g.EventType.LOGOUT_FAILURE,u.InteractionType.Redirect,null,e),this.eventHandler.emitEvent(g.EventType.LOGOUT_END,u.InteractionType.Redirect),e}this.eventHandler.emitEvent(g.EventType.LOGOUT_END,u.InteractionType.Redirect)}getRedirectStartPage(e){let t=e||window.location.href;return l.UrlString.getAbsoluteUrl(t,(0,p.getCurrentUri)())}}}),i("2rIOI",function(t,r){e(t.exports,"SilentIframeClient",()=>E);var n=o("ckDmJ"),i=o("gmw86"),a=o("9tUvn"),s=o("gnfKd"),c=o("77Sbs"),l=o("5glYQ"),d=o("6HXlN"),h=o("dp0vd"),u=o("iNmFL"),p=o("5S1XQ"),g=o("29emz"),m=o("1cQ8k"),C=o("lcP17"),f=o("2pUnf"),y=o("7oR2q"),A=o("4pKco");class E extends l.StandardInteractionClient{constructor(e,t,r,n,o,i,a,s,c,l,d){super(e,t,r,n,o,i,s,l,d),this.apiId=a,this.nativeStorage=c}async acquireToken(e){this.performanceClient.addQueueMeasurement(s.PerformanceEvents.SilentIframeClientAcquireToken,e.correlationId),e.loginHint||e.sid||e.account&&e.account.username||this.logger.warning("No user hint provided. The authorization server may need more information to complete this request.");let t={...e};t.prompt?t.prompt!==i.PromptValue.NONE&&t.prompt!==i.PromptValue.NO_SESSION&&(this.logger.warning(`SilentIframeClient. Replacing invalid prompt ${t.prompt} with ${i.PromptValue.NONE}`),t.prompt=i.PromptValue.NONE):t.prompt=i.PromptValue.NONE;let r=await (0,a.invokeAsync)(this.initializeAuthorizationRequest.bind(this),s.PerformanceEvents.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,e.correlationId)(t,h.InteractionType.Silent);return(r.platformBroker=(0,f.isPlatformAuthAllowed)(this.config,this.logger,this.platformAuthProvider,r.authenticationScheme),(0,p.preconnect)(r.authority),this.config.auth.protocolMode===c.ProtocolMode.EAR)?this.executeEarFlow(r):this.executeCodeFlow(r)}async executeCodeFlow(e){let t,r=this.initializeServerTelemetryManager(this.apiId);try{return t=await (0,a.invokeAsync)(this.createAuthCodeClient.bind(this),s.PerformanceEvents.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,e.correlationId)({serverTelemetryManager:r,requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account}),await (0,a.invokeAsync)(this.silentTokenHelper.bind(this),s.PerformanceEvents.SilentIframeClientTokenHelper,this.logger,this.performanceClient,e.correlationId)(t,e)}catch(o){if(o instanceof n.AuthError&&(o.setCorrelationId(this.correlationId),r.cacheFailedRequest(o)),!t||!(o instanceof n.AuthError)||o.errorCode!==h.BrowserConstants.INVALID_GRANT_ERROR)throw o;return this.performanceClient.addFields({retryError:o.errorCode},this.correlationId),await (0,a.invokeAsync)(this.silentTokenHelper.bind(this),s.PerformanceEvents.SilentIframeClientTokenHelper,this.logger,this.performanceClient,this.correlationId)(t,e)}}async executeEarFlow(e){let t=e.correlationId,r=await (0,a.invokeAsync)(this.getDiscoveredAuthority.bind(this),s.PerformanceEvents.StandardInteractionClientGetDiscoveredAuthority,this.logger,this.performanceClient,t)({requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account}),n=await (0,a.invokeAsync)(y.generateEarKey,s.PerformanceEvents.GenerateEarKey,this.logger,this.performanceClient,t)(),o={...e,earJwk:n},i=await (0,a.invokeAsync)(u.initiateEarRequest,s.PerformanceEvents.SilentHandlerInitiateAuthRequest,this.logger,this.performanceClient,t)(this.config,r,o,this.logger,this.performanceClient),c=this.config.auth.OIDCOptions.serverResponseType,l=await (0,a.invokeAsync)(u.monitorIframeForHash,s.PerformanceEvents.SilentHandlerMonitorIframeForHash,this.logger,this.performanceClient,t)(i,this.config.system.iframeHashTimeout,this.config.system.pollIntervalMilliseconds,this.performanceClient,this.logger,t,c),d=(0,a.invoke)(g.deserializeResponse,s.PerformanceEvents.DeserializeResponse,this.logger,this.performanceClient,t)(l,c,this.logger);return(0,a.invokeAsync)(m.handleResponseEAR,s.PerformanceEvents.HandleResponseEar,this.logger,this.performanceClient,t)(o,d,this.apiId,this.config,r,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}logout(){return Promise.reject((0,d.createBrowserAuthError)(A.silentLogoutUnsupported))}async silentTokenHelper(e,t){let r,n=t.correlationId;this.performanceClient.addQueueMeasurement(s.PerformanceEvents.SilentIframeClientTokenHelper,n);let o=await (0,a.invokeAsync)(C.generatePkceCodes,s.PerformanceEvents.GeneratePkceCodes,this.logger,this.performanceClient,n)(this.performanceClient,this.logger,n),c={...t,codeChallenge:o.challenge};if(t.httpMethod===i.HttpMethod.POST)r=await (0,a.invokeAsync)(u.initiateCodeFlowWithPost,s.PerformanceEvents.SilentHandlerInitiateAuthRequest,this.logger,this.performanceClient,n)(this.config,e.authority,c,this.logger,this.performanceClient);else{let t=await (0,a.invokeAsync)(m.getAuthCodeRequestUrl,s.PerformanceEvents.GetAuthCodeUrl,this.logger,this.performanceClient,n)(this.config,e.authority,c,this.logger,this.performanceClient);r=await (0,a.invokeAsync)(u.initiateCodeRequest,s.PerformanceEvents.SilentHandlerInitiateAuthRequest,this.logger,this.performanceClient,n)(t,this.performanceClient,this.logger,n,this.config.system.navigateFrameWait)}let l=this.config.auth.OIDCOptions.serverResponseType,d=await (0,a.invokeAsync)(u.monitorIframeForHash,s.PerformanceEvents.SilentHandlerMonitorIframeForHash,this.logger,this.performanceClient,n)(r,this.config.system.iframeHashTimeout,this.config.system.pollIntervalMilliseconds,this.performanceClient,this.logger,n,l),h=(0,a.invoke)(g.deserializeResponse,s.PerformanceEvents.DeserializeResponse,this.logger,this.performanceClient,n)(d,l,this.logger);return(0,a.invokeAsync)(m.handleResponseCode,s.PerformanceEvents.HandleResponseCode,this.logger,this.performanceClient,n)(t,h,o.verifier,this.apiId,this.config,e,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}}}),i("iNmFL",function(t,r){e(t.exports,"initiateCodeRequest",()=>h),e(t.exports,"initiateCodeFlowWithPost",()=>u),e(t.exports,"initiateEarRequest",()=>p),e(t.exports,"monitorIframeForHash",()=>g);var n=o("9tUvn"),i=o("gnfKd"),a=o("gmw86"),s=o("6HXlN"),c=o("f7l91"),l=o("1cQ8k"),d=o("4pKco");async function h(e,t,r,o,a){if(t.addQueueMeasurement(i.PerformanceEvents.SilentHandlerInitiateAuthRequest,o),!e)throw r.info("Navigate url is empty"),(0,s.createBrowserAuthError)(d.emptyNavigateUri);return a?(0,n.invokeAsync)(m,i.PerformanceEvents.SilentHandlerLoadFrame,r,t,o)(e,a,t,o):(0,n.invoke)(C,i.PerformanceEvents.SilentHandlerLoadFrameSync,r,t,o)(e)}async function u(e,t,r,n,o){let i=f();if(!i.contentDocument)throw"No document associated with iframe!";return(await (0,l.getCodeForm)(i.contentDocument,e,t,r,n,o)).submit(),i}async function p(e,t,r,n,o){let i=f();if(!i.contentDocument)throw"No document associated with iframe!";return(await (0,l.getEARForm)(i.contentDocument,e,t,r,n,o)).submit(),i}async function g(e,t,r,o,l,h,u){return o.addQueueMeasurement(i.PerformanceEvents.SilentHandlerMonitorIframeForHash,h),new Promise((n,o)=>{t<c.DEFAULT_IFRAME_TIMEOUT_MS&&l.warning(`system.loadFrameTimeout or system.iframeHashTimeout set to lower (${t}ms) than the default (${c.DEFAULT_IFRAME_TIMEOUT_MS}ms). This may result in timeouts.`);let i=window.setTimeout(()=>{window.clearInterval(h),o((0,s.createBrowserAuthError)(d.monitorWindowTimeout))},t),h=window.setInterval(()=>{let t="",r=e.contentWindow;try{t=r?r.location.href:""}catch(e){}if(!t||"about:blank"===t)return;let o="";r&&(o=u===a.ServerResponseType.QUERY?r.location.search:r.location.hash),window.clearTimeout(i),window.clearInterval(h),n(o)},r)}).finally(()=>{(0,n.invoke)(y,i.PerformanceEvents.RemoveHiddenIframe,l,o,h)(e)})}function m(e,t,r,n){return r.addQueueMeasurement(i.PerformanceEvents.SilentHandlerLoadFrame,n),new Promise((r,n)=>{let o=f();window.setTimeout(()=>{o?(o.src=e,r(o)):n("Unable to load iframe")},t)})}function C(e){let t=f();return t.src=e,t}function f(){let e=document.createElement("iframe");return e.className="msalSilentIframe",e.style.visibility="hidden",e.style.position="absolute",e.style.width=e.style.height="0",e.style.border="0",e.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms"),document.body.appendChild(e),e}function y(e){document.body===e.parentNode&&document.body.removeChild(e)}}),i("gB1XA",function(t,r){e(t.exports,"SilentRefreshClient",()=>u);var n=o("5glYQ"),i=o("9tUvn"),a=o("gnfKd"),s=o("hpJ8n"),c=o("dp0vd"),l=o("6HXlN"),d=o("cDkFB"),h=o("4pKco");class u extends n.StandardInteractionClient{async acquireToken(e){this.performanceClient.addQueueMeasurement(a.PerformanceEvents.SilentRefreshClientAcquireToken,e.correlationId);let t=await (0,i.invokeAsync)(d.initializeBaseRequest,a.PerformanceEvents.InitializeBaseRequest,this.logger,this.performanceClient,e.correlationId)(e,this.config,this.performanceClient,this.logger),r={...e,...t};e.redirectUri&&(r.redirectUri=this.getRedirectUri(e.redirectUri));let n=this.initializeServerTelemetryManager(c.ApiId.acquireTokenSilent_silentFlow),o=await this.createRefreshTokenClient({serverTelemetryManager:n,authorityUrl:r.authority,azureCloudOptions:r.azureCloudOptions,account:r.account});return(0,i.invokeAsync)(o.acquireTokenByRefreshToken.bind(o),a.PerformanceEvents.RefreshTokenClientAcquireTokenByRefreshToken,this.logger,this.performanceClient,e.correlationId)(r).catch(e=>{throw e.setCorrelationId(this.correlationId),n.cacheFailedRequest(e),e})}logout(){return Promise.reject((0,l.createBrowserAuthError)(h.silentLogoutUnsupported))}async createRefreshTokenClient(e){let t=await (0,i.invokeAsync)(this.getClientConfiguration.bind(this),a.PerformanceEvents.StandardInteractionClientGetClientConfiguration,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:e.serverTelemetryManager,requestAuthority:e.authorityUrl,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account});return new(0,s.RefreshTokenClient)(t,this.performanceClient)}}}),i("hpJ8n",function(t,r){e(t.exports,"RefreshTokenClient",()=>_);var n=o("cnTdK"),i=o("fV1L4"),a=o("cnNuz"),s=o("8S0Fg"),c=o("gmw86"),l=o("1EdUE"),d=o("aomzz"),h=o("8B0BQ"),u=o("7yP0u"),p=o("jYvjz"),g=o("anIdE"),m=o("dVST2"),C=o("jl1FD"),f=o("gkKSO"),y=o("gXRij"),A=o("2n5CL"),E=o("dKahV"),v=o("gnfKd"),T=o("9tUvn"),I=o("hpubR"),w=o("dO1mF"),S=o("1jH5T"),k=o("cmWPH"),R=o("l6ONb");class _ extends i.BaseClient{constructor(e,t){super(e,t)}async acquireToken(e){this.performanceClient?.addQueueMeasurement(v.PerformanceEvents.RefreshTokenClientAcquireToken,e.correlationId);let t=(0,C.nowSeconds)(),r=await (0,T.invokeAsync)(this.executeTokenRequest.bind(this),v.PerformanceEvents.RefreshTokenClientExecuteTokenRequest,this.logger,this.performanceClient,e.correlationId)(e,this.authority),n=r.headers?.[c.HeaderNames.X_MS_REQUEST_ID],o=new(0,d.ResponseHandler)(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,this.config.serializableCache,this.config.persistencePlugin);return o.validateTokenResponse(r.body),(0,T.invokeAsync)(o.handleServerTokenResponse.bind(o),v.PerformanceEvents.HandleServerTokenResponse,this.logger,this.performanceClient,e.correlationId)(r.body,this.authority,t,e,void 0,void 0,!0,e.forceCache,n)}async acquireTokenByRefreshToken(e){if(!e)throw(0,p.createClientConfigurationError)(k.tokenRequestEmpty);if(this.performanceClient?.addQueueMeasurement(v.PerformanceEvents.RefreshTokenClientAcquireTokenByRefreshToken,e.correlationId),!e.account)throw(0,g.createClientAuthError)(R.noAccountInSilentRequest);if(this.cacheManager.isAppMetadataFOCI(e.account.environment))try{return await (0,T.invokeAsync)(this.acquireTokenWithCachedRefreshToken.bind(this),v.PerformanceEvents.RefreshTokenClientAcquireTokenWithCachedRefreshToken,this.logger,this.performanceClient,e.correlationId)(e,!0)}catch(r){let e=r instanceof E.InteractionRequiredAuthError&&r.errorCode===S.noTokensFound,t=r instanceof m.ServerError&&r.errorCode===c.Errors.INVALID_GRANT_ERROR&&r.subError===c.Errors.CLIENT_MISMATCH_ERROR;if(e||t);else throw r}return(0,T.invokeAsync)(this.acquireTokenWithCachedRefreshToken.bind(this),v.PerformanceEvents.RefreshTokenClientAcquireTokenWithCachedRefreshToken,this.logger,this.performanceClient,e.correlationId)(e,!1)}async acquireTokenWithCachedRefreshToken(e,t){this.performanceClient?.addQueueMeasurement(v.PerformanceEvents.RefreshTokenClientAcquireTokenWithCachedRefreshToken,e.correlationId);let r=(0,T.invoke)(this.cacheManager.getRefreshToken.bind(this.cacheManager),v.PerformanceEvents.CacheManagerGetRefreshToken,this.logger,this.performanceClient,e.correlationId)(e.account,t,e.correlationId,void 0,this.performanceClient);if(!r)throw(0,E.createInteractionRequiredAuthError)(S.noTokensFound);if(r.expiresOn&&(0,C.isTokenExpired)(r.expiresOn,e.refreshTokenExpirationOffsetSeconds||300))throw this.performanceClient?.addFields({rtExpiresOnMs:Number(r.expiresOn)},e.correlationId),(0,E.createInteractionRequiredAuthError)(S.refreshTokenExpired);let n={...e,refreshToken:r.secret,authenticationScheme:e.authenticationScheme||c.AuthenticationScheme.BEARER,ccsCredential:{credential:e.account.homeAccountId,type:y.CcsCredentialType.HOME_ACCOUNT_ID}};try{return await (0,T.invokeAsync)(this.acquireToken.bind(this),v.PerformanceEvents.RefreshTokenClientAcquireToken,this.logger,this.performanceClient,e.correlationId)(n)}catch(t){if(t instanceof E.InteractionRequiredAuthError&&(this.performanceClient?.addFields({rtExpiresOnMs:Number(r.expiresOn)},e.correlationId),t.subError===S.badToken)){this.logger.verbose("acquireTokenWithRefreshToken: bad refresh token, removing from cache");let t=this.cacheManager.generateCredentialKey(r);this.cacheManager.removeRefreshToken(t,e.correlationId)}throw t}}async executeTokenRequest(e,t){this.performanceClient?.addQueueMeasurement(v.PerformanceEvents.RefreshTokenClientExecuteTokenRequest,e.correlationId);let r=this.createTokenQueryParameters(e),n=f.UrlString.appendQueryString(t.tokenEndpoint,r),o=await (0,T.invokeAsync)(this.createTokenRequestBody.bind(this),v.PerformanceEvents.RefreshTokenClientCreateTokenRequestBody,this.logger,this.performanceClient,e.correlationId)(e),i=this.createTokenRequestHeaders(e.ccsCredential),a=(0,w.getRequestThumbprint)(this.config.authOptions.clientId,e);return(0,T.invokeAsync)(this.executePostToTokenEndpoint.bind(this),v.PerformanceEvents.RefreshTokenClientExecutePostToTokenEndpoint,this.logger,this.performanceClient,e.correlationId)(n,o,i,a,e.correlationId,v.PerformanceEvents.RefreshTokenClientExecutePostToTokenEndpoint)}async createTokenRequestBody(e){this.performanceClient?.addQueueMeasurement(v.PerformanceEvents.RefreshTokenClientCreateTokenRequestBody,e.correlationId);let t=new Map;if((0,a.addClientId)(t,e.embeddedClientId||e.tokenBodyParameters?.[l.CLIENT_ID]||this.config.authOptions.clientId),e.redirectUri&&(0,a.addRedirectUri)(t,e.redirectUri),(0,a.addScopes)(t,e.scopes,!0,this.config.authOptions.authority.options.OIDCOptions?.defaultScopes),(0,a.addGrantType)(t,c.GrantType.REFRESH_TOKEN_GRANT),(0,a.addClientInfo)(t),(0,a.addLibraryInfo)(t,this.config.libraryInfo),(0,a.addApplicationTelemetry)(t,this.config.telemetry.application),(0,a.addThrottling)(t),this.serverTelemetryManager&&!(0,n.isOidcProtocolMode)(this.config)&&(0,a.addServerTelemetry)(t,this.serverTelemetryManager),(0,a.addRefreshToken)(t,e.refreshToken),this.config.clientCredentials.clientSecret&&(0,a.addClientSecret)(t,this.config.clientCredentials.clientSecret),this.config.clientCredentials.clientAssertion){let r=this.config.clientCredentials.clientAssertion;(0,a.addClientAssertion)(t,await (0,I.getClientAssertion)(r.assertion,this.config.authOptions.clientId,e.resourceRequestUri)),(0,a.addClientAssertionType)(t,r.assertionType)}if(e.authenticationScheme===c.AuthenticationScheme.POP){let r,n=new(0,h.PopTokenGenerator)(this.cryptoUtils,this.performanceClient);r=e.popKid?this.cryptoUtils.encodeKid(e.popKid):(await (0,T.invokeAsync)(n.generateCnf.bind(n),v.PerformanceEvents.PopTokenGenerateCnf,this.logger,this.performanceClient,e.correlationId)(e,this.logger)).reqCnfString,(0,a.addPopToken)(t,r)}else if(e.authenticationScheme===c.AuthenticationScheme.SSH)if(e.sshJwk)(0,a.addSshJwk)(t,e.sshJwk);else throw(0,p.createClientConfigurationError)(k.missingSshJwk);if((!u.StringUtils.isEmptyObj(e.claims)||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&(0,a.addClaims)(t,e.claims,this.config.authOptions.clientCapabilities),this.config.systemOptions.preventCorsPreflight&&e.ccsCredential)switch(e.ccsCredential.type){case y.CcsCredentialType.HOME_ACCOUNT_ID:try{let r=(0,A.buildClientInfoFromHomeAccountId)(e.ccsCredential.credential);(0,a.addCcsOid)(t,r)}catch(e){this.logger.verbose("Could not parse home account ID for CCS Header: "+e)}break;case y.CcsCredentialType.UPN:(0,a.addCcsUpn)(t,e.ccsCredential.credential)}return e.embeddedClientId&&(0,a.addBrokerParameters)(t,this.config.authOptions.clientId,this.config.authOptions.redirectUri),e.tokenBodyParameters&&(0,a.addExtraQueryParameters)(t,e.tokenBodyParameters),(0,a.instrumentBrokerParams)(t,e.correlationId,this.performanceClient),(0,s.mapToQueryString)(t)}}}),i("jjcbd",function(t,r){e(t.exports,"TokenCache",()=>m);var n=o("4tMCV"),i=o("8xmgF"),a=o("eVKB1"),s=o("aomzz"),c=o("jvdrJ"),l=o("6GdIx"),d=o("jl1FD"),h=o("6HXlN"),u=o("cx3ku"),p=o("7oR2q"),g=o("4pKco");class m{constructor(e,t,r,n){this.isBrowserEnvironment="undefined"!=typeof window,this.config=e,this.storage=t,this.logger=r,this.cryptoObj=n}async loadExternalTokens(e,t,r){if(!this.isBrowserEnvironment)throw(0,h.createBrowserAuthError)(g.nonBrowserEnvironment);let n=e.correlationId||(0,p.createNewGuid)(),o=t.id_token?a.extractTokenClaims(t.id_token,u.base64Decode):void 0,s=a.isKmsi(o||{}),c={protocolMode:this.config.auth.protocolMode,knownAuthorities:this.config.auth.knownAuthorities,cloudDiscoveryMetadata:this.config.auth.cloudDiscoveryMetadata,authorityMetadata:this.config.auth.authorityMetadata,skipAuthorityMetadataCache:this.config.auth.skipAuthorityMetadataCache},l=e.authority?new(0,i.Authority)(i.Authority.generateAuthority(e.authority,e.azureCloudOptions),this.config.system.networkClient,this.storage,c,this.logger,e.correlationId||(0,p.createNewGuid)()):void 0,d=await this.loadAccount(e,r.clientInfo||t.client_info||"",n,o,l),m=await this.loadIdToken(t,d.homeAccountId,d.environment,d.realm,n,s),C=await this.loadAccessToken(e,t,d.homeAccountId,d.environment,d.realm,r,n,s),f=await this.loadRefreshToken(t,d.homeAccountId,d.environment,n,s);return this.generateAuthenticationResult(e,{account:d,idToken:m,accessToken:C,refreshToken:f},o,l)}async loadAccount(e,t,r,o,i){if(this.logger.verbose("TokenCache - loading account"),e.account){let t=n.AccountEntity.createFromAccountInfo(e.account);return await this.storage.setAccount(t,r,a.isKmsi(o||{})),t}if(!i||!t&&!o)throw this.logger.error("TokenCache - if an account is not provided on the request, authority and either clientInfo or idToken must be provided instead."),(0,h.createBrowserAuthError)(g.unableToLoadToken);let c=n.AccountEntity.generateHomeAccountId(t,i.authorityType,this.logger,this.cryptoObj,o),l=o?.tid,d=(0,s.buildAccountToCache)(this.storage,i,c,u.base64Decode,r,o,t,i.hostnameAndPort,l,void 0,void 0,this.logger);return await this.storage.setAccount(d,r,a.isKmsi(o||{})),d}async loadIdToken(e,t,r,n,o,i){if(!e.id_token)return this.logger.verbose("TokenCache - no id token found in response"),null;this.logger.verbose("TokenCache - loading id token");let a=c.createIdTokenEntity(t,r,e.id_token,this.config.auth.clientId,n);return await this.storage.setIdTokenCredential(a,o,i),a}async loadAccessToken(e,t,r,n,o,i,a,s){if(!t.access_token)return this.logger.verbose("TokenCache - no access token found in response"),null;if(!t.expires_in)return this.logger.error("TokenCache - no expiration set on the access token. Cannot add it to the cache."),null;if(!t.scope&&(!e.scopes||!e.scopes.length))return this.logger.error("TokenCache - scopes not specified in the request or response. Cannot add token to the cache."),null;this.logger.verbose("TokenCache - loading access token");let h=t.scope?l.ScopeSet.fromString(t.scope):new(0,l.ScopeSet)(e.scopes),p=i.expiresOn||t.expires_in+d.nowSeconds(),g=i.extendedExpiresOn||(t.ext_expires_in||t.expires_in)+d.nowSeconds(),m=c.createAccessTokenEntity(r,n,t.access_token,this.config.auth.clientId,o,h.printScopes(),p,g,u.base64Decode);return await this.storage.setAccessTokenCredential(m,a,s),m}async loadRefreshToken(e,t,r,n,o){if(!e.refresh_token)return this.logger.verbose("TokenCache - no refresh token found in response"),null;this.logger.verbose("TokenCache - loading refresh token");let i=c.createRefreshTokenEntity(t,r,e.refresh_token,this.config.auth.clientId,e.foci,void 0,e.refresh_token_expires_in);return await this.storage.setRefreshTokenCredential(i,n,o),i}generateAuthenticationResult(e,t,r,o){let i,a="",s=[],c=null;t?.accessToken&&(a=t.accessToken.secret,s=l.ScopeSet.fromString(t.accessToken.target).asArray(),c=d.toDateFromSeconds(t.accessToken.expiresOn),i=d.toDateFromSeconds(t.accessToken.extendedExpiresOn));let h=t.account;return{authority:o?o.canonicalAuthority:"",uniqueId:t.account.localAccountId,tenantId:t.account.realm,scopes:s,account:n.AccountEntity.getAccountInfo(h),idToken:t.idToken?.secret||"",idTokenClaims:r||{},accessToken:a,fromCache:!0,expiresOn:c,correlationId:e.correlationId||"",requestId:"",extExpiresOn:i,familyId:t.refreshToken?.familyId||"",tokenType:t?.accessToken?.tokenType||"",state:e.state||"",cloudGraphHostName:h.cloudGraphHostName||"",msGraphHost:h.msGraphHost||"",fromNativeBroker:!1}}}}),i("3eqCN",function(t,r){e(t.exports,"SilentAuthCodeClient",()=>p);var n=o("ckDmJ"),i=o("9tUvn"),a=o("gnfKd"),s=o("5glYQ"),c=o("6HXlN"),l=o("dp0vd"),d=o("aW6xu"),h=o("7HXbt"),u=o("4pKco");class p extends s.StandardInteractionClient{constructor(e,t,r,n,o,i,a,s,c,l){super(e,t,r,n,o,i,s,c,l),this.apiId=a}async acquireToken(e){if(!e.code)throw(0,c.createBrowserAuthError)(u.authCodeRequired);let t=await (0,i.invokeAsync)(this.initializeAuthorizationRequest.bind(this),a.PerformanceEvents.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,e.correlationId)(e,l.InteractionType.Silent),r=this.initializeServerTelemetryManager(this.apiId);try{let n={...t,code:e.code},o=await (0,i.invokeAsync)(this.getClientConfiguration.bind(this),a.PerformanceEvents.StandardInteractionClientGetClientConfiguration,this.logger,this.performanceClient,e.correlationId)({serverTelemetryManager:r,requestAuthority:t.authority,requestAzureCloudOptions:t.azureCloudOptions,requestExtraQueryParameters:t.extraQueryParameters,account:t.account}),s=new(0,d.HybridSpaAuthorizationCodeClient)(o);this.logger.verbose("Auth code client created");let c=new(0,h.InteractionHandler)(s,this.browserStorage,n,this.logger,this.performanceClient);return await (0,i.invokeAsync)(c.handleCodeResponseFromServer.bind(c),a.PerformanceEvents.HandleCodeResponseFromServer,this.logger,this.performanceClient,e.correlationId)({code:e.code,msgraph_host:e.msGraphHost,cloud_graph_host_name:e.cloudGraphHostName,cloud_instance_host_name:e.cloudInstanceHostName},t,!1)}catch(e){throw e instanceof n.AuthError&&(e.setCorrelationId(this.correlationId),r.cacheFailedRequest(e)),e}}logout(){return Promise.reject((0,c.createBrowserAuthError)(u.silentLogoutUnsupported))}}}),i("aW6xu",function(t,r){e(t.exports,"HybridSpaAuthorizationCodeClient",()=>i);var n=o("gMTsE");class i extends n.AuthorizationCodeClient{constructor(e){super(e),this.includeRedirectUri=!1}}}),i("5EOT6",function(t,r){e(t.exports,"collectInstanceStats",()=>n);function n(e,t,r){let n=window.msal?.clientIds||[],o=n.length,i=n.filter(t=>t===e).length;i>1&&r.warning("There is already an instance of MSAL.js in the window with the same client id."),t.add({msalInstanceCount:o,sameClientIdInstanceCount:i})}}),i("3OSZj",function(t,r){e(t.exports,"NestedAppAuthController",()=>v);var n=o("4tMCV"),i=o("ckDmJ"),a=o("eVKB1"),s=o("8xmgF"),c=o("1OX4r"),l=o("gmw86"),d=o("gnfKd"),h=o("jl1FD"),u=o("dp0vd"),p=o("a2Vw9"),g=o("11j1R"),m=o("1w8EJ"),C=o("6QPkA"),f=o("fKG6z"),y=o("fc6HR"),A=o("cPkCm"),E=o("7oR2q");class v{constructor(e){this.operatingContext=e;let t=this.operatingContext.getBridgeProxy();if(void 0!==t)this.bridgeProxy=t;else throw Error("unexpected: bridgeProxy is undefined");this.config=e.getConfig(),this.logger=this.operatingContext.getLogger(),this.performanceClient=this.config.telemetry.client,this.browserCrypto=e.isBrowserEnvironment()?new(0,p.CryptoOps)(this.logger,this.performanceClient,!0):c.DEFAULT_CRYPTO_IMPLEMENTATION,this.eventHandler=new(0,C.EventHandler)(this.logger),this.browserStorage=this.operatingContext.isBrowserEnvironment()?new(0,y.BrowserCacheManager)(this.config.auth.clientId,this.config.cache,this.browserCrypto,this.logger,this.performanceClient,this.eventHandler,(0,s.buildStaticAuthorityOptions)(this.config.auth)):(0,y.DEFAULT_BROWSER_CACHE_MANAGER)(this.config.auth.clientId,this.logger,this.performanceClient,this.eventHandler),this.nestedAppAuthAdapter=new(0,g.NestedAppAuthAdapter)(this.config.auth.clientId,this.config.auth.clientCapabilities,this.browserCrypto,this.logger);let r=this.bridgeProxy.getAccountContext();this.currentAccountContext=r||null}static async createController(e){return Promise.resolve(new v(e))}async initialize(e,t){let r=e?.correlationId||(0,E.createNewGuid)();return await this.browserStorage.initialize(r),Promise.resolve()}ensureValidRequest(e){return e?.correlationId?e:{...e,correlationId:this.browserCrypto.createNewGuid()}}async acquireTokenInteractive(e){let t=this.ensureValidRequest(e);this.eventHandler.emitEvent(f.EventType.ACQUIRE_TOKEN_START,u.InteractionType.Popup,t);let r=this.performanceClient.startMeasurement(d.PerformanceEvents.AcquireTokenPopup,t.correlationId);r.add({nestedAppAuthRequest:!0});try{let n=this.nestedAppAuthAdapter.toNaaTokenRequest(t),o=h.nowSeconds(),i=await this.bridgeProxy.getTokenInteractive(n),a={...this.nestedAppAuthAdapter.fromNaaTokenResponse(n,i,o)};try{await this.hydrateCache(a,e)}catch(e){this.logger.warningPii(`Failed to hydrate cache. Error: ${e}`,t.correlationId)}return this.currentAccountContext={homeAccountId:a.account.homeAccountId,environment:a.account.environment,tenantId:a.account.tenantId},this.eventHandler.emitEvent(f.EventType.ACQUIRE_TOKEN_SUCCESS,u.InteractionType.Popup,a),r.add({accessTokenSize:a.accessToken.length,idTokenSize:a.idToken.length}),r.end({success:!0,requestId:a.requestId},void 0,a.account),a}catch(n){let t=n instanceof i.AuthError?n:this.nestedAppAuthAdapter.fromBridgeError(n);throw this.eventHandler.emitEvent(f.EventType.ACQUIRE_TOKEN_FAILURE,u.InteractionType.Popup,null,n),r.end({success:!1},n,e.account),t}}async acquireTokenSilentInternal(e){let t=this.ensureValidRequest(e);this.eventHandler.emitEvent(f.EventType.ACQUIRE_TOKEN_START,u.InteractionType.Silent,t);let r=await this.acquireTokenFromCache(t);if(r)return this.eventHandler.emitEvent(f.EventType.ACQUIRE_TOKEN_SUCCESS,u.InteractionType.Silent,r),r;let n=this.performanceClient.startMeasurement(d.PerformanceEvents.SsoSilent,t.correlationId);n.increment({visibilityChangeCount:0}),n.add({nestedAppAuthRequest:!0});try{let r=this.nestedAppAuthAdapter.toNaaTokenRequest(t);r.forceRefresh=t.forceRefresh;let o=h.nowSeconds(),i=await this.bridgeProxy.getTokenSilent(r),a=this.nestedAppAuthAdapter.fromNaaTokenResponse(r,i,o);try{await this.hydrateCache(a,e)}catch(e){this.logger.warningPii(`Failed to hydrate cache. Error: ${e}`,t.correlationId)}return this.currentAccountContext={homeAccountId:a.account.homeAccountId,environment:a.account.environment,tenantId:a.account.tenantId},this.eventHandler.emitEvent(f.EventType.ACQUIRE_TOKEN_SUCCESS,u.InteractionType.Silent,a),n?.add({accessTokenSize:a.accessToken.length,idTokenSize:a.idToken.length}),n?.end({success:!0,requestId:a.requestId},void 0,a.account),a}catch(r){let t=r instanceof i.AuthError?r:this.nestedAppAuthAdapter.fromBridgeError(r);throw this.eventHandler.emitEvent(f.EventType.ACQUIRE_TOKEN_FAILURE,u.InteractionType.Silent,null,r),n?.end({success:!1},r,e.account),t}}async acquireTokenFromCache(e){let t=this.performanceClient.startMeasurement(d.PerformanceEvents.AcquireTokenSilent,e.correlationId);if(t?.add({nestedAppAuthRequest:!0}),e.claims)return this.logger.verbose("Claims are present in the request, skipping cache lookup"),null;if(e.forceRefresh)return this.logger.verbose("forceRefresh is set to true, skipping cache lookup"),null;let r=null;switch(!e.cacheLookupPolicy&&(e.cacheLookupPolicy=u.CacheLookupPolicy.Default),e.cacheLookupPolicy){case u.CacheLookupPolicy.Default:case u.CacheLookupPolicy.AccessToken:case u.CacheLookupPolicy.AccessTokenAndRefreshToken:r=await this.acquireTokenFromCacheInternal(e);break;default:return null}return r?(this.eventHandler.emitEvent(f.EventType.ACQUIRE_TOKEN_SUCCESS,u.InteractionType.Silent,r),t.add({accessTokenSize:r.accessToken.length,idTokenSize:r.idToken.length}),t.end({success:!0},void 0,r.account),r):(this.logger.warning("Cached tokens are not found for the account, proceeding with silent token request."),this.eventHandler.emitEvent(f.EventType.ACQUIRE_TOKEN_FAILURE,u.InteractionType.Silent,null),t.end({success:!1},void 0,e.account),null)}async acquireTokenFromCacheInternal(e){let t=this.bridgeProxy.getAccountContext()||this.currentAccountContext,r=null,n=e.correlationId||this.browserCrypto.createNewGuid();if(t&&(r=(0,A.getAccount)(t,this.logger,this.browserStorage,n)),!r)return this.logger.verbose("No active account found, falling back to the host"),Promise.resolve(null);this.logger.verbose("active account found, attempting to acquire token silently");let o={...e,correlationId:e.correlationId||this.browserCrypto.createNewGuid(),authority:e.authority||r.environment,scopes:e.scopes?.length?e.scopes:[...l.OIDC_DEFAULT_SCOPES]},i=this.browserStorage.getTokenKeys(),a=this.browserStorage.getAccessToken(r,o,i,r.tenantId);if(!a)return this.logger.verbose("No cached access token found"),Promise.resolve(null);if(h.wasClockTurnedBack(a.cachedAt)||h.isTokenExpired(a.expiresOn,this.config.system.tokenRenewalOffsetSeconds))return this.logger.verbose("Cached access token has expired"),Promise.resolve(null);let s=this.browserStorage.getIdToken(r,o.correlationId,i,r.tenantId,this.performanceClient);return s?this.nestedAppAuthAdapter.toAuthenticationResultFromCache(r,s,a,o,o.correlationId):(this.logger.verbose("No cached id token found"),Promise.resolve(null))}async acquireTokenPopup(e){return this.acquireTokenInteractive(e)}acquireTokenRedirect(e){throw m.NestedAppAuthError.createUnsupportedError()}async acquireTokenSilent(e){return this.acquireTokenSilentInternal(e)}acquireTokenByCode(e){throw m.NestedAppAuthError.createUnsupportedError()}acquireTokenNative(e,t,r){throw m.NestedAppAuthError.createUnsupportedError()}acquireTokenByRefreshToken(e,t){throw m.NestedAppAuthError.createUnsupportedError()}addEventCallback(e,t){return this.eventHandler.addEventCallback(e,t)}removeEventCallback(e){this.eventHandler.removeEventCallback(e)}addPerformanceCallback(e){throw m.NestedAppAuthError.createUnsupportedError()}removePerformanceCallback(e){throw m.NestedAppAuthError.createUnsupportedError()}enableAccountStorageEvents(){throw m.NestedAppAuthError.createUnsupportedError()}disableAccountStorageEvents(){throw m.NestedAppAuthError.createUnsupportedError()}getAllAccounts(e){let t=this.browserCrypto.createNewGuid();return(0,A.getAllAccounts)(this.logger,this.browserStorage,this.isBrowserEnv(),t,e)}getAccount(e){let t=this.browserCrypto.createNewGuid();return(0,A.getAccount)(e,this.logger,this.browserStorage,t)}getAccountByUsername(e){let t=this.browserCrypto.createNewGuid();return(0,A.getAccountByUsername)(e,this.logger,this.browserStorage,t)}getAccountByHomeId(e){let t=this.browserCrypto.createNewGuid();return(0,A.getAccountByHomeId)(e,this.logger,this.browserStorage,t)}getAccountByLocalId(e){let t=this.browserCrypto.createNewGuid();return(0,A.getAccountByLocalId)(e,this.logger,this.browserStorage,t)}setActiveAccount(e){let t=this.browserCrypto.createNewGuid();return(0,A.setActiveAccount)(e,this.browserStorage,t)}getActiveAccount(){let e=this.browserCrypto.createNewGuid();return(0,A.getActiveAccount)(this.browserStorage,e)}handleRedirectPromise(e){return Promise.resolve(null)}loginPopup(e){return this.acquireTokenInteractive(e||u.DEFAULT_REQUEST)}loginRedirect(e){throw m.NestedAppAuthError.createUnsupportedError()}logout(e){throw m.NestedAppAuthError.createUnsupportedError()}logoutRedirect(e){throw m.NestedAppAuthError.createUnsupportedError()}logoutPopup(e){throw m.NestedAppAuthError.createUnsupportedError()}ssoSilent(e){return this.acquireTokenSilentInternal(e)}getTokenCache(){throw m.NestedAppAuthError.createUnsupportedError()}getLogger(){return this.logger}setLogger(e){this.logger=e}initializeWrapperLibrary(e,t){}setNavigationClient(e){this.logger.warning("setNavigationClient is not supported in nested app auth")}getConfiguration(){return this.config}isBrowserEnv(){return this.operatingContext.isBrowserEnvironment()}getBrowserCrypto(){return this.browserCrypto}getPerformanceClient(){throw m.NestedAppAuthError.createUnsupportedError()}getRedirectResponse(){throw m.NestedAppAuthError.createUnsupportedError()}async clearCache(e){throw m.NestedAppAuthError.createUnsupportedError()}async hydrateCache(e,t){this.logger.verbose("hydrateCache called");let r=n.AccountEntity.createFromAccountInfo(e.account,e.cloudGraphHostName,e.msGraphHost);return await this.browserStorage.setAccount(r,e.correlationId,a.isKmsi(e.idTokenClaims)),this.browserStorage.hydrateCache(e,t)}}}),i("11j1R",function(t,r){e(t.exports,"NestedAppAuthAdapter",()=>f);var n=o("gmw86"),i=o("ckDmJ"),a=o("eVKB1"),s=o("aRYMn"),c=o("anIdE"),l=o("l6ONb"),d=o("dKahV"),h=o("cnNuz"),u=o("dVST2"),p=o("7yP0u"),g=o("jl1FD"),m=o("67Azo"),C=o("6NbbE");class f{constructor(e,t,r,n){this.clientId=e,this.clientCapabilities=t,this.crypto=r,this.logger=n}toNaaTokenRequest(e){let t;t=void 0===e.extraQueryParameters?new Map:new Map(Object.entries(e.extraQueryParameters));let r=e.correlationId||this.crypto.createNewGuid(),o=h.addClientCapabilitiesToClaims(e.claims,this.clientCapabilities),i=e.scopes||n.OIDC_DEFAULT_SCOPES;return{platformBrokerId:e.account?.homeAccountId,clientId:this.clientId,authority:e.authority,scope:i.join(" "),correlationId:r,claims:p.StringUtils.isEmptyObj(o)?void 0:o,state:e.state,authenticationScheme:e.authenticationScheme||n.AuthenticationScheme.BEARER,extraParameters:t}}fromNaaTokenResponse(e,t,r){if(!t.token.id_token||!t.token.access_token)throw(0,c.createClientAuthError)(l.nullOrEmptyToken);let o=g.toDateFromSeconds(r+(t.token.expires_in||0)),i=a.extractTokenClaims(t.token.id_token,this.crypto.base64Decode),s=this.fromNaaAccountInfo(t.account,t.token.id_token,i),d=t.token.scope||e.scope;return{authority:t.token.authority||s.environment,uniqueId:s.localAccountId,tenantId:s.tenantId,scopes:d.split(" "),account:s,idToken:t.token.id_token,idTokenClaims:i,accessToken:t.token.access_token,fromCache:!1,expiresOn:o,tokenType:e.authenticationScheme||n.AuthenticationScheme.BEARER,correlationId:e.correlationId,extExpiresOn:o,state:e.state}}fromNaaAccountInfo(e,t,r){let n=r||e.idTokenClaims,o=e.localAccountId||n?.oid||n?.sub||"",i=e.tenantId||n?.tid||"",a=e.homeAccountId||`${o}.${i}`,c=e.username||n?.preferred_username||"",l=e.name||n?.name,d=e.loginHint||n?.login_hint,h=new Map,u=(0,s.buildTenantProfile)(a,o,i,n);return h.set(i,u),{homeAccountId:a,environment:e.environment,tenantId:i,username:c,localAccountId:o,name:l,loginHint:d,idToken:t,idTokenClaims:n,tenantProfiles:h}}fromBridgeError(e){if(!(0,m.isBridgeError)(e))return new(0,i.AuthError)("unknown_error","An unknown error occurred");switch(e.status){case C.BridgeStatusCode.UserCancel:return new(0,c.ClientAuthError)(l.userCanceled);case C.BridgeStatusCode.NoNetwork:return new(0,c.ClientAuthError)(l.noNetworkConnectivity);case C.BridgeStatusCode.AccountUnavailable:return new(0,c.ClientAuthError)(l.noAccountFound);case C.BridgeStatusCode.Disabled:return new(0,c.ClientAuthError)(l.nestedAppAuthBridgeDisabled);case C.BridgeStatusCode.NestedAppAuthUnavailable:return new(0,c.ClientAuthError)(e.code||l.nestedAppAuthBridgeDisabled,e.description);case C.BridgeStatusCode.TransientError:case C.BridgeStatusCode.PersistentError:return new(0,u.ServerError)(e.code,e.description);case C.BridgeStatusCode.UserInteractionRequired:return new(0,d.InteractionRequiredAuthError)(e.code,e.description);default:return new(0,i.AuthError)(e.code,e.description)}}toAuthenticationResultFromCache(e,t,r,o,i){if(!t||!r)throw(0,c.createClientAuthError)(l.nullOrEmptyToken);let s=a.extractTokenClaims(t.secret,this.crypto.base64Decode),d=r.target||o.scopes.join(" ");return{authority:r.environment||e.environment,uniqueId:e.localAccountId,tenantId:e.tenantId,scopes:d.split(" "),account:e,idToken:t.secret,idTokenClaims:s||{},accessToken:r.secret,fromCache:!0,expiresOn:g.toDateFromSeconds(r.expiresOn),extExpiresOn:g.toDateFromSeconds(r.extendedExpiresOn),tokenType:o.authenticationScheme||n.AuthenticationScheme.BEARER,correlationId:i,state:o.state}}}}),i("67Azo",function(t,r){e(t.exports,"isBridgeError",()=>n);function n(e){return void 0!==e.status}}),i("1w8EJ",function(t,r){e(t.exports,"NestedAppAuthError",()=>s);var n=o("ckDmJ");let i="unsupported_method",a="This method is not supported in nested app environment.";class s extends n.AuthError{constructor(e,t){super(e,t),Object.setPrototypeOf(this,s.prototype),this.name="NestedAppAuthError"}static createUnsupportedError(){return new s(i,a)}}});var a={};(function(e){function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function r(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function n(e,t,r){if(a())return Reflect.construct.apply(null,arguments);var n=[null];return n.push.apply(n,t),new(e.bind.apply(e,n))}function o(e,t,r){return t&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t);if("object"!=typeof n)return n;throw TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e,"string");return"symbol"==typeof t?t:t+""}(n.key),n)}}(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function i(e,r){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,r){if(e){if("string"==typeof e)return t(e,void 0);var n=({}).toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?t(e,void 0):void 0}}(e))||r){n&&(e=n);var o=0,i=function(){};return{s:i,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:i}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){c=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(c)throw a}}}}function a(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(a=function(){return!!e})()}function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){var r=function(e){for(var t=e.split(/([.#])/),r="",n="",o=1;o<t.length;o+=2)switch(t[o]){case".":r+=" ".concat(t[o+1]);break;case"#":n=t[o+1]}return{className:r.trim(),tag:t[0]||"div",id:n}}(e),n=r.tag,o=r.id,i=r.className,a=t?document.createElementNS(t,n):document.createElement(n);return o&&(a.id=o),i&&(t?a.setAttribute("class",i):a.className=i),a}function l(e){for(var t,r=s(e),o=arguments.length,i=Array(o>1?o-1:0),a=1;a<o;a++)i[a-1]=arguments[a];if("string"===r)t=c(e);else if("function"===r)t=n(e,i);else throw Error("At least one argument required");return w(k(t),i,!0),t}function d(e,t){var r=t,n=k(e),o=k(r);return r===o&&o.__redom_view&&(r=o.__redom_view),o.parentNode&&(h(r,o,n),n.removeChild(o)),r}function h(e,t,r){var n=t.__redom_lifecycle;if(u(n)){t.__redom_lifecycle={};return}var o=r;for(t.__redom_mounted&&C(t,"onunmount");o;){var i=o.__redom_lifecycle||{};for(var a in n)i[a]&&(i[a]-=n[a]);u(i)&&(o.__redom_lifecycle=null),o=o.parentNode}}function u(e){if(null==e)return!0;for(var t in e)if(e[t])return!1;return!0}l.extend=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return l.bind.apply(l,[this].concat(t))};var p=["onmount","onremount","onunmount"],g="undefined"!=typeof window&&"ShadowRoot"in window;function m(e,t,r,n){var o=t,a=k(e),s=k(o);o===s&&s.__redom_view&&(o=s.__redom_view),o!==s&&(s.__redom_view=o);var c=s.__redom_mounted,l=s.parentNode;if(c&&l!==a&&h(o,s,l),null!=r)if(n){var d=k(r);d.__redom_mounted&&C(d,"onunmount"),a.replaceChild(s,d)}else a.insertBefore(s,k(r));else a.appendChild(s);return function(e,t,r,n){t.__redom_lifecycle||(t.__redom_lifecycle={});var o,a,s=t.__redom_lifecycle,c=r===n,l=!1,d=i(p);try{for(d.s();!(a=d.n()).done;){var h=a.value;!c&&e!==t&&h in e&&(s[h]=(s[h]||0)+1),s[h]&&(l=!0)}}catch(e){d.e(e)}finally{d.f()}if(!l){t.__redom_lifecycle={};return}var u=r,m=!1;for((c||null!=(o=u)&&o.__redom_mounted)&&(C(t,c?"onremount":"onmount"),m=!0);u;){var f=u.parentNode;u.__redom_lifecycle||(u.__redom_lifecycle={});var y=u.__redom_lifecycle;for(var A in s)y[A]=(y[A]||0)+s[A];if(m)break;(u.nodeType===Node.DOCUMENT_NODE||g&&u instanceof ShadowRoot||null!=f&&f.__redom_mounted)&&(C(u,c?"onremount":"onmount"),m=!0),u=f}}(o,s,a,l),o}function C(e,t){"onmount"===t||"onremount"===t?e.__redom_mounted=!0:"onunmount"===t&&(e.__redom_mounted=!1);var r,n=e.__redom_lifecycle;if(n){var o=e.__redom_view,i=0;for(var a in null==o||null==(r=o[t])||r.call(o),n)a&&i++;if(i)for(var s=e.firstChild;s;){var c=s.nextSibling;C(s,t),s=c}}}function f(e,t,r){var n=k(e);if("object"===s(t))for(var o in t)y(n,o,t[o]);else y(n,t,r)}function y(e,t,r){e.style[t]=null==r?"":r}var A="http://www.w3.org/1999/xlink";function E(e,t,r,n){var o=k(e);if("object"===s(t))for(var i in t)E(o,i,t[i],n);else{var a,c,l=o instanceof SVGElement,d="function"==typeof r;if("style"===t&&"object"===s(r))f(o,r);else if(l&&d)o[t]=r;else if("dataset"===t)T(o,r);else if(!l&&(t in o||d)&&"list"!==t)o[t]=r;else{if(l&&"xlink"===t)return void v(o,r);if(n&&"class"===t){return void(a=o,null==(c=r)?a.removeAttribute("class"):a.classList?a.classList.add(c):"object"===s(a.className)&&a.className&&a.className.baseVal?a.className.baseVal="".concat(a.className.baseVal," ").concat(c).trim():a.className="".concat(a.className," ").concat(c).trim())}null==r?o.removeAttribute(t):o.setAttribute(t,r)}}}function v(e,t,r){if("object"===s(t))for(var n in t)v(e,n,t[n]);else null!=r?e.setAttributeNS(A,t,r):e.removeAttributeNS(A,t,r)}function T(e,t,r){if("object"===s(t))for(var n in t)T(e,n,t[n]);else null!=r?e.dataset[t]=r:delete e.dataset[t]}function I(e){return document.createTextNode(null!=e?e:"")}function w(e,t,r){var n,o=i(t);try{for(o.s();!(n=o.n()).done;){var a=n.value;if(0===a||a){var c=s(a);"function"===c?a(e):"string"===c||"number"===c?e.appendChild(I(a)):R(k(a))?m(e,a):a.length?w(e,a,r):"object"===c&&E(e,a,null,r)}}}catch(e){o.e(e)}finally{o.f()}}function S(e){return"string"==typeof e?l(e):k(e)}function k(e){return e.nodeType&&e||!e.el&&e||k(e.el)}function R(e){return null==e?void 0:e.nodeType}function _(e){for(var t=k(e),r=arguments.length,n=Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];for(var i=function e(t,r,n){for(var o=n,i=Array(r.length),a=0;a<r.length;a++)i[a]=r[a]&&k(r[a]);for(var s=0;s<r.length;s++){var c=r[s];if(c){var l=i[s];if(l===o){o=o.nextSibling;continue}if(R(l)){var d,h=null==(d=o)?void 0:d.nextSibling,u=null!=c.__redom_index&&h===i[s+1];m(t,c,o,u),u&&(o=h);continue}null!=c.length&&(o=e(t,c,o))}}return o}(e,n,t.firstChild);i;){var a=i.nextSibling;d(e,i),i=a}}var P=o(function e(t,n,o){var i;r(this,e),this.View=t,this.initData=o,this.oldLookup={},this.lookup={},this.oldViews=[],this.views=[],null!=n&&(this.key="function"==typeof n?n:(i=n,function(e){return e[i]}))},[{key:"update",value:function(e,t){for(var r=this.View,n=this.key,o=this.initData,i=null!=n,a=this.lookup,s={},c=Array(e.length),l=this.views,d=0;d<e.length;d++){var h,u,p=e[d],g=void 0;if(i){var m=n(p);g=a[m]||new r(o,p,d,e),s[m]=g,g.__redom_id=m}else g=l[d]||new r(o,p,d,e);null==(h=(u=g).update)||h.call(u,p,d,e,t),k(g.el).__redom_view=g,c[d]=g}this.oldViews=l,this.views=c,this.oldLookup=a,this.lookup=s}}]);function b(e,t,r,n){return new N(e,t,r,n)}var N=o(function e(t,n,o,i){r(this,e),this.View=n,this.initData=i,this.views=[],this.pool=new P(n,o,i),this.el=S(t),this.keySet=null!=o},[{key:"update",value:function(e,t){var r=this.keySet,n=this.views;this.pool.update(e||[],t);var o=this.pool,i=o.views,a=o.lookup;if(r)for(var s=0;s<n.length;s++){var c=n[s];null==a[c.__redom_id]&&(c.__redom_index=null,d(this,c))}for(var l=0;l<i.length;l++)i[l].__redom_index=l;_(this,i),r&&(this.lookup=a),this.views=i}}]);N.extend=function(e,t,r,n){return N.bind(N,e,t,r,n)},b.extend=N.extend;var O=o(function e(t,n){r(this,e),this.el=I(""),this.visible=!1,this.view=null,this._placeholder=this.el,t instanceof Node?this._el=t:t.el instanceof Node?(this._el=t,this.view=t):this._View=t,this._initData=n},[{key:"update",value:function(e,t){var r,n,o=this._placeholder,i=this.el.parentNode;if(e){if(!this.visible)if(this._el)m(i,this._el,o),d(i,o),this.el=k(this._el),this.visible=e;else{var a=new this._View(this._initData);this.el=k(a),this.view=a,m(i,a,o),d(i,o)}null==(r=this.view)||null==(n=r.update)||n.call(r,t)}else if(this.visible){if(this._el){m(i,o,this._el),d(i,this._el),this.el=o,this.visible=e;return}m(i,o,this.view),d(i,this.view),this.el=o,this.view=null}this.visible=e}}]),M=o(function e(t,n,o){r(this,e),this.el=S(t),this.views=n,this.Views=n,this.initData=o},[{key:"update",value:function(e,t){var r,n;if(e!==this.route){var o=this.views[e];this.route=e,o&&(o instanceof Node||o.el instanceof Node)?this.view=o:this.view=o&&new o(this.initData,t),_(this.el,[this.view])}null==(r=this.view)||null==(n=r.update)||n.call(r,t,e)}}]),x="http://www.w3.org/2000/svg";function U(e){for(var t,r=s(e),o=arguments.length,i=Array(o>1?o-1:0),a=1;a<o;a++)i[a-1]=arguments[a];if("string"===r)t=c(e,x);else if("function"===r)t=n(e,i);else throw Error("At least one argument required");return w(k(t),i,!0),t}U.extend=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return U.bind.apply(U,[this].concat(t))},U.ns=x,e.List=N,e.ListPool=P,e.Place=O,e.Router=M,e.dispatch=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"redom",n=k(e),o=new CustomEvent(r,{bubbles:!0,detail:t});n.dispatchEvent(o)},e.el=l,e.h=l,e.html=l,e.list=b,e.listPool=function(e,t,r){return new P(e,t,r)},e.mount=m,e.place=function(e,t){return new O(e,t)},e.ref=function(e,t,r){return e[t]=r,r},e.router=function(e,t,r){return new M(e,t,r)},e.s=U,e.setAttr=function(e,t,r){E(e,t,r)},e.setChildren=_,e.setData=T,e.setStyle=f,e.setXlink=v,e.svg=U,e.text=I,e.unmount=d,e.viewFactory=function(e,t){if(!e||"object"!==s(e))throw Error("views must be an object");if(!t||"string"!=typeof t)throw Error("key must be a string");return function(r,n,o,i){var a=n[t],s=e[a];if(s)return new s(r,n,o,i);throw Error("view ".concat(a," not found"))}}})(a);var s={};s=JSON.parse('{"name":"mileage-claims","version":"1.0.13","scripts":{"start":"npm run clean && parcel src/index.html --open","clean":"rm -rf dist","build":"npm run clean && parcel build src/index.html --no-source-maps"},"type":"module","dependencies":{"@azure/msal-browser":"^4.26.0","@picocss/pico":"^2.1.1","ky":"^1.8.1","redom-components":"^1.0.16"},"devDependencies":{"parcel":"^2.16.0","redom":"^4.3.0"}}');class c{constructor(e={}){let{placeholder:t="",value:r="",name:n}=e;this.name=n,this.el=(0,a.el)("",{role:"group"},[this.input=(0,a.el)("input",{type:"text",placeholder:t,value:r}),this.button=(0,a.el)("button",{class:"secondary",title:"Use current location"},[(0,a.svg)("svg.lucide.lucide-locate-fixed",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[(0,a.svg)("line",{x1:"2",x2:"5",y1:"12",y2:"12"}),(0,a.svg)("line",{x1:"19",x2:"22",y1:"12",y2:"12"}),(0,a.svg)("line",{x1:"12",x2:"12",y1:"2",y2:"5"}),(0,a.svg)("line",{x1:"12",x2:"12",y1:"19",y2:"22"}),(0,a.svg)("circle",{cx:"12",cy:"12",r:"7"}),(0,a.svg)("circle",{cx:"12",cy:"12",r:"3"})])])])}onmount=()=>{this.button.addEventListener("click",this.handleUseLocation)};onunmount=()=>{this.button.removeEventListener("click",this.handleUseLocation)};get value(){return this.input.value}set value(e){this.input.value=e||""}addEventListener(e,t,r){this.el.addEventListener(e,t,r)}removeEventListener(e,t,r){this.el.removeEventListener(e,t,r)}dispatchEvent(e){return this.el.dispatchEvent(e)}handleUseLocation=()=>{this.dispatchEvent(new CustomEvent("uselocation",{bubbles:!0,detail:{component:this,name:this.name}}))};focus(){this.input.focus()}clear(){this.value=""}}class l{constructor(e={}){this.props=e,this.createElement()}createElement=()=>{let e=new Date().toISOString().split("T")[0],t=this.props.value||e;this.el=(0,a.el)("input",{type:"date",value:t,name:this.props.name||"date"})};get value(){return this.el.value}set value(e){this.el.value=e}resetToToday=()=>{let e=new Date().toISOString().split("T")[0];this.value=e};focus=()=>{this.el.focus()}}class d{constructor(e={}){let{disabled:t=!1,title:r="Calculate mileage",name:n}=e;this.name=n,this._disabled=t,this.el=(0,a.el)("button.contrast",{type:"button",title:r,"aria-label":r,disabled:t},[(0,a.svg)("svg.lucide.lucide-calculator",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[(0,a.svg)("rect",{width:"16",height:"20",x:"4",y:"2",rx:"2"}),(0,a.svg)("line",{x1:"8",x2:"16",y1:"6",y2:"6"}),(0,a.svg)("line",{x1:"16",x2:"16",y1:"14",y2:"18"}),(0,a.svg)("path",{d:"M16 10h.01"}),(0,a.svg)("path",{d:"M12 10h.01"}),(0,a.svg)("path",{d:"M8 10h.01"}),(0,a.svg)("path",{d:"M12 14h.01"}),(0,a.svg)("path",{d:"M8 14h.01"}),(0,a.svg)("path",{d:"M12 18h.01"}),(0,a.svg)("path",{d:"M8 18h.01"})])])}onmount=()=>{this.el.addEventListener("click",this.handleClick)};onunmount=()=>{this.el.removeEventListener("click",this.handleClick)};get disabled(){return this._disabled}set disabled(e){this._disabled=e,this.el.disabled=e}addEventListener=(e,t,r)=>{this.el.addEventListener(e,t,r)};removeEventListener=(e,t,r)=>{this.el.removeEventListener(e,t,r)};dispatchEvent=e=>this.el.dispatchEvent(e);handleClick=()=>{this.disabled||this.dispatchEvent(new CustomEvent("calculate",{bubbles:!0,detail:{component:this,name:this.name}}))};focus=()=>{this.el.focus()}}var h=o("dm1sG");class u{static async getCurrentLocationPostcode(){if(!("geolocation"in navigator))throw Error("Geolocation is not supported by this browser");return console.log("Would reverse-geocode",await new Promise((e,t)=>{navigator.geolocation.getCurrentPosition(e,t)})),"SW1A 1AA"}static async calculateDistance(e,t){if(!e?.trim()||!t?.trim())throw Error("Both start and end postcodes are required");let r=Math.floor(100*Math.random())+10;return console.log(`Calculated ${r} miles from ${e} to ${t}`),await new Promise(e=>setTimeout(e,500)),r}static validateMileageEntry(e){let t=[];return e.date||t.push("Date is required"),e.fromPostcode?.trim()||t.push("Start postcode is required"),e.toPostcode?.trim()||t.push("End postcode is required"),(!e.distance||e.distance<=0)&&t.push("Miles must be greater than 0"),{isValid:0===t.length,errors:t}}static formatPostcode(e){if(!e)return"";let t=e.replace(/\s/g,"").toUpperCase();return t.length>=5?t.slice(0,-3)+" "+t.slice(-3):t}static async saveMileageEntry(e){try{let t=await h.AuthService.getAccessToken(),r=await h.AuthService.getUserInfo(),n={...e,submittedBy:r.email,submittedAt:new Date().toISOString(),status:"submitted"},o=await fetch("/api/saveMileageEntry",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`,"X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(n)});if(!o.ok){let e,t=await o.text();console.error("Server error response:",t),console.error("Response status:",o.status),console.error("Response headers:",[...o.headers.entries()]);try{e=JSON.parse(t)}catch(r){e={message:t||"Unknown server error"}}throw Error(e.error||e.message||`Server error: ${o.status}`)}return await o.json()}catch(e){throw console.error("Failed to save mileage entry:",e),Error(`Failed to save mileage entry: ${e.message}`)}}static async getMileageEntries(){try{let e=await h.AuthService.getAccessToken(),t=await fetch("/api/getMileageEntries",{method:"GET",headers:{Authorization:`Bearer ${e}`,"X-Requested-With":"XMLHttpRequest"}});if(!t.ok)throw Error(`Failed to fetch entries: ${t.status}`);return await t.json()}catch(e){throw console.error("Failed to get mileage entries:",e),e}}}u.getCurrentLocationPostcode,u.calculateDistance,u.validateMileageEntry,u.formatPostcode;class p{constructor(){this.onSave=null,this.onCancel=null,this.onMileageSubmitted=null,this.createElement()}createElement=()=>{this.dateInput=new l({name:"date"}),this.startPostcodeInput=new c({placeholder:"Start postcode",name:"start"}),this.endPostcodeInput=new c({placeholder:"End postcode",name:"end"}),this.milesInput=(0,a.el)("input",{type:"number",placeholder:"0",step:"1",min:"0"}),this.reasonInput=(0,a.el)("input",{type:"text",placeholder:"Reason for travel (optional)",value:"Business travel"}),this.calculateBtn=new d({name:"calculate"}),this.cancelBtn=(0,a.el)("button.secondary",{type:"button"},"Cancel"),this.saveBtn=(0,a.el)("button",{type:"button"},"Save Entry"),this.closeBtn=(0,a.el)("button",{"aria-label":"Close",rel:"prev"}),this.el=(0,a.el)("dialog",(0,a.el)("article",(0,a.el)("header",this.closeBtn,this.titleElement=(0,a.el)("p",(0,a.el)("strong","Add Mileage Entry"))),(0,a.el)(".modal-content",(0,a.el)("label","Date",this.dateInput),(0,a.el)("label","Start Location",this.startPostcodeInput),(0,a.el)("label","End Location",this.endPostcodeInput),(0,a.el)("label","Miles",(0,a.el)("",{role:"group"},this.milesInput,this.calculateBtn)),(0,a.el)("label","Reason for Travel",this.reasonInput)),(0,a.el)("footer",this.cancelBtn,this.saveBtn)))};onmount=()=>{this.setupEventListeners()};setupEventListeners=()=>{this.el.addEventListener("uselocation",this.handleLocation),this.el.addEventListener("calculate",this.handleCalculate),this.closeBtn.addEventListener("click",this.handleClose),this.cancelBtn.addEventListener("click",this.handleCancel),this.saveBtn.addEventListener("click",this.handleSave)};onunmount=()=>{this.teardownEventListeners()};teardownEventListeners=()=>{this.el.removeEventListener("uselocation",this.handleLocation),this.el.removeEventListener("calculate",this.handleCalculate),this.closeBtn.removeEventListener("click",this.handleClose),this.cancelBtn.removeEventListener("click",this.handleCancel),this.saveBtn.removeEventListener("click",this.handleSave)};open=()=>{document.body.appendChild(this.el),this.el.showModal(),this.dateInput.focus()};close=()=>{this.el.close(),this.el.parentNode&&this.el.parentNode.removeChild(this.el)};handleClose=()=>{this.close()};handleCancel=()=>{this.onCancel&&this.onCancel(),this.close()};handleLocation=async e=>{let t=e.detail.name;try{let e=await u.getCurrentLocationPostcode();"start"===t?this.startPostcodeInput.value=e:"end"===t&&(this.endPostcodeInput.value=e)}catch(e){alert(e.message)}};handleCalculate=async()=>{let e=this.startPostcodeInput.value.trim(),t=this.endPostcodeInput.value.trim();try{this.calculateBtn.disabled=!0;let r=await u.calculateDistance(e,t);this.milesInput.value=r}catch(e){alert(e.message)}finally{this.calculateBtn.disabled=!1}};handleSave=async()=>{let e={date:this.dateInput.value,fromPostcode:this.startPostcodeInput.value,toPostcode:this.endPostcodeInput.value,distance:this.milesInput.value,reason:this.reasonInput.value||"Business travel"},t=u.validateMileageEntry(e);if(!t.isValid)return void alert("Please fix the following errors:\n"+t.errors.join("\n"));e.fromPostcode=u.formatPostcode(e.fromPostcode),e.toPostcode=u.formatPostcode(e.toPostcode);try{await u.saveMileageEntry(e),this.onMileageSubmitted&&this.onMileageSubmitted({detail:{success:!0,data:e,message:"Mileage claim submitted successfully!"}}),this.close()}catch(r){console.error("Failed to submit mileage claim:",r);let t=this.el.querySelector(".error-message")||(0,a.el)("div",{className:"error-message"});t.textContent=r.message||"Failed to submit mileage claim. Please try again.",t.style.color="var(--del-color)",t.style.marginTop="1rem",this.el.querySelector(".error-message")||this.el.querySelector("form").appendChild(t),this.onMileageSubmitted&&this.onMileageSubmitted({detail:{success:!1,error:r.message,data:e}})}}}var h=o("dm1sG"),g=class{constructor(){this.user=null,this.onAuthStateChange=null,this.createElement(),this.checkAuthState()}createElement=()=>{this.loginBtn=(0,a.el)("button.primary","Sign in with Microsoft 365"),this.logoutBtn=(0,a.el)("button.secondary","Sign out"),this.userInfo=(0,a.el)(".user-info"),this.el=(0,a.el)(".auth-container",this.userInfo,this.loginBtn,this.logoutBtn),this.logoutBtn.style.display="none"};async checkAuthState(){try{if(await h.AuthService.isAuthenticated()){let e=await h.AuthService.getUserInfo();this.showLoggedInState(e)}else this.showLoggedOutState()}catch(e){console.error("Auth check failed:",e),this.showLoggedOutState()}}showLoggedInState(e){this.user=e,this.userInfo.textContent=`Welcome, ${e.name}`,this.userInfo.style.display="block",this.loginBtn.style.display="none",this.logoutBtn.style.display="inline-block",this.onAuthStateChange&&this.onAuthStateChange({detail:{isAuthenticated:!0}})}showLoggedOutState(){this.user=null,this.userInfo.style.display="none",this.loginBtn.style.display="inline-block",this.logoutBtn.style.display="none",this.onAuthStateChange&&this.onAuthStateChange({detail:{isAuthenticated:!1}})}onmount=()=>{this.loginBtn.addEventListener("click",this.handleLogin),this.logoutBtn.addEventListener("click",this.handleLogout)};onunmount=()=>{this.loginBtn.removeEventListener("click",this.handleLogin),this.logoutBtn.removeEventListener("click",this.handleLogout)};handleLogin=async()=>{try{this.loginBtn.disabled=!0,this.loginBtn.textContent="Signing in...",await h.AuthService.login();let e=await h.AuthService.getUserInfo();this.showLoggedInState(e)}catch(e){alert("Login failed: "+e.message),this.showLoggedOutState()}finally{this.loginBtn.disabled=!1,this.loginBtn.textContent="Sign in with Microsoft 365"}};handleLogout=async()=>{try{await h.AuthService.logout(),this.showLoggedOutState()}catch(e){console.error("Logout failed:",e),this.showLoggedOutState()}};getCurrentUser(){return this.user}};class m{constructor(){this.onVehicleRegistered=null,this.modal=(0,a.el)("dialog",{style:"max-width: 500px; padding: 2rem;"},(0,a.el)("article",(0,a.el)("header",(0,a.el)("h2","Vehicle Registration Required"),(0,a.el)("p","Please register your vehicle details to continue.")),this.form=(0,a.el)("form",(0,a.el)("label","Vehicle Registration Number:",this.regInput=(0,a.el)("input",{type:"text",placeholder:"e.g., AB12 XYZ",required:!0,style:"text-transform: uppercase;"})),(0,a.el)("label","Make:",this.makeInput=(0,a.el)("input",{type:"text",placeholder:"e.g., Ford",required:!0})),(0,a.el)("label","Model:",this.modelInput=(0,a.el)("input",{type:"text",placeholder:"e.g., Focus",required:!0})),(0,a.el)("div",{style:"display: flex; gap: 1rem; margin-top: 1rem;"},this.submitButton=(0,a.el)("button",{type:"submit"},"Register Vehicle"),this.lookupButton=(0,a.el)("button",{type:"button",style:"background-color: var(--secondary);"},"Lookup Details"))),this.messageDiv=(0,a.el)("div",{style:"margin-top: 1rem; padding: 1rem; border-radius: var(--border-radius); display: none;"}))),this.el=this.modal,this.setupEventListeners()}setupEventListeners(){this.regInput.addEventListener("input",e=>{e.target.value=e.target.value.toUpperCase()}),this.form.addEventListener("submit",this.handleSubmit),this.lookupButton.addEventListener("click",this.handleLookup),this.modal.addEventListener("click",e=>{e.target===this.modal&&this.close()})}handleSubmit=async e=>{e.preventDefault();let t=this.regInput.value.trim(),r=this.makeInput.value.trim(),n=this.modelInput.value.trim();if(!t||!r||!n)return void this.showMessage("Please fill in all fields.","error");try{this.submitButton.disabled=!0,this.submitButton.textContent="Registering...";let e=await Promise.resolve(o("dm1sG")).then(e=>e.AuthService.getUserInfo());if(!e)throw Error("User not authenticated");let i=await fetch("/api/saveUserVehicle",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:e.email,registration:t,make:r,model:n})}),a=await i.json();if(i.ok)this.showMessage("Vehicle registered successfully!","success"),setTimeout(()=>{this.onVehicleRegistered&&this.onVehicleRegistered({registration:t,make:r,model:n}),this.close()},1500);else throw Error(a.error||"Failed to register vehicle")}catch(e){console.error("Vehicle registration failed:",e),this.showMessage(`Registration failed: ${e.message}`,"error")}finally{this.submitButton.disabled=!1,this.submitButton.textContent="Register Vehicle"}};handleLookup=async()=>{if(!this.regInput.value.trim())return void this.showMessage("Please enter a registration number first.","error");this.lookupButton.disabled=!0,this.lookupButton.textContent="Looking up...";try{this.showMessage("Vehicle lookup feature coming soon!","info")}catch(e){this.showMessage("Lookup failed. Please enter details manually.","error")}finally{this.lookupButton.disabled=!1,this.lookupButton.textContent="Lookup Details"}};showMessage(e,t="info"){switch(this.messageDiv.textContent=e,this.messageDiv.style.display="block",t){case"success":this.messageDiv.style.backgroundColor="var(--ins-color)",this.messageDiv.style.color="white";break;case"error":this.messageDiv.style.backgroundColor="var(--del-color)",this.messageDiv.style.color="white";break;default:this.messageDiv.style.backgroundColor="var(--card-background-color)",this.messageDiv.style.color="var(--color)"}}open(){this.modal.showModal(),this.regInput.focus()}close(){this.modal.close(),this.form.reset(),this.messageDiv.style.display="none"}}var h=o("dm1sG");let C=document.getElementById("content-wrapper"),f=new class{constructor(){this.loginComponent=new g,this.entryModal=new p,this.vehicleRegistrationModal=new m,this.loginComponent.onAuthStateChange=this.handleAuthStateChange,this.entryModal.onMileageSubmitted=this.handleMileageSubmitted,this.vehicleRegistrationModal.onVehicleRegistered=this.handleVehicleRegistered,this.el=(0,a.el)("",(0,a.el)("header",(0,a.el)("nav",(0,a.el)("h1","Mileage Claims"),this.loginComponent)),(0,a.el)("main",this.contentContainer=(0,a.el)(".container",(0,a.el)("p","Please sign in with your Microsoft 365 account to submit mileage claims."),this.showModalButton=(0,a.el)("button",{type:"button",disabled:!0},"Add Mileage Entry"))),this.entryModal,this.vehicleRegistrationModal)}onmount=()=>{this.displayAppVersion(),this.setupEventListeners(),this.checkAuthState()};setupEventListeners=()=>{this.showModalButton.addEventListener("click",this.openModal)};handleAuthStateChange=async e=>{let{isAuthenticated:t}=e.detail;if(t){let e=await h.AuthService.getUserInfo();this.contentContainer.innerHTML="",this.contentContainer.appendChild((0,a.el)("p",`Welcome, ${e.name}! Checking your vehicle registration...`));try{let t=await fetch(`/api/getUserVehicle?userId=${encodeURIComponent(e.email)}`),r=await t.json();t.ok&&r.hasVehicle?this.showMainApp(e,r.vehicle):this.showVehicleRegistrationRequired(e)}catch(t){console.error("Error checking vehicle registration:",t),this.showVehicleRegistrationRequired(e)}}else this.showModalButton.disabled=!0,this.contentContainer.innerHTML="",this.contentContainer.appendChild((0,a.el)("p","Please sign in with your Microsoft 365 account to submit mileage claims.")),this.contentContainer.appendChild(this.showModalButton)};showMainApp=(e,t)=>{this.showModalButton.disabled=!1,this.contentContainer.innerHTML="",this.contentContainer.appendChild((0,a.el)("div",(0,a.el)("p",`Welcome, ${e.name}!`),(0,a.el)("p",`Vehicle: ${t.registration} - ${t.make} ${t.model}`))),this.contentContainer.appendChild(this.showModalButton);let r=(0,a.el)("button",{type:"button",style:"margin-left: 1rem; background-color: var(--secondary);"},"Change Vehicle");r.addEventListener("click",()=>{this.vehicleRegistrationModal.open()}),this.contentContainer.appendChild(r)};showVehicleRegistrationRequired=e=>{this.showModalButton.disabled=!0,this.contentContainer.innerHTML="",this.contentContainer.appendChild((0,a.el)("div",(0,a.el)("p",`Welcome, ${e.name}!`),(0,a.el)("p","You need to register your vehicle details before you can submit mileage claims."),(0,a.el)("button",{type:"button"},"Register Vehicle"))),this.contentContainer.querySelector("button").addEventListener("click",()=>{this.vehicleRegistrationModal.open()})};handleVehicleRegistered=async e=>{let t=await h.AuthService.getUserInfo();this.showMainApp(t,e)};handleMileageSubmitted=e=>{let{success:t,message:r,error:n}=e.detail;if(t){let e=(0,a.el)("div",{style:"color: var(--ins-color); padding: 1rem; margin: 1rem 0; border-left: 4px solid var(--ins-color);"},r);this.contentContainer.insertBefore(e,this.showModalButton),setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},5e3)}else n&&console.error("Mileage submission failed:",n)};checkAuthState=async()=>{await h.AuthService.isAuthenticated()&&this.handleAuthStateChange({detail:{isAuthenticated:!0}})};openModal=()=>{this.entryModal.open()};onunmount=()=>{this.showModalButton.removeEventListener("click",this.openModal)};displayAppVersion=()=>{var e;let t=document.getElementById("app-version");t&&(t.textContent=`v${((e=s)&&e.__esModule?e.default:e).version}`)}};(0,a.mount)(C,f);